/*! For license information please see chartiq-18a7b5.smartcharts.js.LICENSE.txt */
"use strict";(self.webpackChunksmartcharts=self.webpackChunksmartcharts||[]).push([["chartiq"],{"./chartiq/development/index.js":(t,e,i)=>{i.r(e),i.d(e,{$$:()=>a.$$,$$$:()=>a.$$$,CIQ:()=>a.CIQ,SplinePlotter:()=>a.SplinePlotter,accumulationDistribution:()=>s.accumulationDistribution,adx:()=>s.adx,aggregations:()=>s.aggregations,alligator:()=>s.alligator,animation:()=>n.animation,aroon:()=>s.aroon,atr:()=>s.atr,awesomeOscillator:()=>s.awesomeOscillator,balanceOfPower:()=>s.balanceOfPower,bollinger:()=>s.bollinger,cci:()=>s.cci,centerOfGravity:()=>s.centerOfGravity,chaikin:()=>s.chaikin,chande:()=>s.chande,choppiness:()=>s.choppiness,comparisonStudies:()=>s.comparisonStudies,continuousZoom:()=>n.continuousZoom,coppock:()=>s.coppock,createEngine:()=>r.createEngine,customCharts:()=>r.customCharts,darvasBox:()=>s.darvasBox,detrended:()=>s.detrended,disparity:()=>s.disparity,drawing:()=>r.drawing,drawingAdvanced:()=>s.drawingAdvanced,easeMachine:()=>r.easeMachine,easeOfMovement:()=>s.easeOfMovement,ehlerFisher:()=>s.ehlerFisher,elder:()=>s.elder,equations:()=>r.equations,equationsAdvanced:()=>s.equationsAdvanced,extendedHours:()=>n.extendedHours,fractalChaos:()=>s.fractalChaos,fullScreen:()=>n.fullScreen,highLowStudies:()=>s.highLowStudies,highPerformanceMarkers:()=>s.highPerformanceMarkers,i18n:()=>r.i18n,ichimoku:()=>s.ichimoku,inactivityTimer:()=>n.inactivityTimer,interaction:()=>r.interaction,intradayMomentum:()=>s.intradayMomentum,keltner:()=>s.keltner,klinger:()=>s.klinger,linearRegression:()=>s.linearRegression,macd:()=>s.macd,markers:()=>r.markers,market:()=>r.market,massIndex:()=>s.massIndex,medianPrice:()=>r.medianPrice,momentum:()=>r.momentum,moneyFlow:()=>s.moneyFlow,movement:()=>r.movement,movingAverages:()=>s.movingAverages,nameValueStore:()=>r.nameValueStore,outliers:()=>n.outliers,parabolicSAR:()=>s.parabolicSAR,pivotPoints:()=>s.pivotPoints,plotComplementer:()=>n.plotComplementer,prettyGoodOscillator:()=>s.prettyGoodOscillator,priceMomentumOscillator:()=>s.priceMomentumOscillator,priceRelative:()=>r.priceRelative,priceVolumeOscillator:()=>s.priceVolumeOscillator,primeNumber:()=>s.primeNumber,pring:()=>s.pring,projectedVolume:()=>s.projectedVolume,psychologicalLine:()=>s.psychologicalLine,qstick:()=>s.qstick,quoteFeed:()=>r.quoteFeed,rainbow:()=>s.rainbow,randomWalk:()=>s.randomWalk,rangeSlider:()=>n.rangeSlider,relativeVigor:()=>s.relativeVigor,renderersAdvanced:()=>s.renderersAdvanced,rsi:()=>s.rsi,schaffTrendCycle:()=>s.schaffTrendCycle,series:()=>r.series,share:()=>r.share,shinohara:()=>s.shinohara,shortcuts:()=>n.shortcuts,span:()=>r.span,stochastics:()=>s.stochastics,storage:()=>r.storage,studies:()=>r.studies,supertrend:()=>s.supertrend,swingIndex:()=>s.swingIndex,symbolLookupBase:()=>r.symbolLookupBase,tableView:()=>n.tableView,theme:()=>r.theme,timezone:()=>r.timezone,timezoneJS:()=>a.timezoneJS,tooltip:()=>n.tooltip,touch:()=>r.touch,trendIntensity:()=>s.trendIntensity,trix:()=>s.trix,twiggsMoneyFlow:()=>s.twiggsMoneyFlow,typicalPrice:()=>s.typicalPrice,ulcerIndex:()=>s.ulcerIndex,ultimateOscillator:()=>s.ultimateOscillator,valuationLines:()=>s.valuationLines,visualization:()=>r.visualization,volatilityIndex:()=>s.volatilityIndex,volumeProfile:()=>s.volumeProfile,volumeStudies:()=>s.volumeStudies,vortex:()=>s.vortex,vwap:()=>r.vwap,williamsMFI:()=>s.williamsMFI,zigzag:()=>r.zigzag});var a=i("./chartiq/development/js/chartiq.js"),r=i("./chartiq/development/js/standard.js"),s=i("./chartiq/development/js/advanced.js"),n=(i("./chartiq/development/js/deprecated.js"),i("./chartiq/development/js/addOns.js"))},"./chartiq/development/js/addOns.js":(t,e,i)=>{i.r(e),i.d(e,{CIQ:()=>a.CIQ,animation:()=>u,continuousZoom:()=>d,extendedHours:()=>r,fullScreen:()=>s,inactivityTimer:()=>n,outliers:()=>p,plotComplementer:()=>m,rangeSlider:()=>o,shortcuts:()=>l,tableView:()=>h,tooltip:()=>c});var a=i("./chartiq/development/js/chartiq.js");let r=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ExtendedHours=e.ExtendedHours||function(t){var i=t.stx;this.filter=t.filter,i||(i=t,this.filter=!1);var a={};this.stx=i,this.stx.extendedHours=this,this.cssRequired=!0,i.addEventListener("theme",(function(t){for(var e in a={},i.layout.marketSessions)a.session||(a.session={}),a.session[e]=i.canvasStyle("stx_market_session "+e)})),i.addEventListener("symbolChange",(function(t){"master"!=t.action||!i.layout.extended||i.chart.market.market_def&&i.chart.market.sessions.length||e.alert("There are no Extended Hours for this instrument.")})),this.prepare=function(t,e){for(var r in i.layout.extended=t,i.layout.marketSessions)a.session={},i.chart.market.disableSession(r);if(i.layout.marketSessions={},t)if(e||(e=["pre","post"]),e.length)for(var s=0;s<e.length;s++)i.layout.marketSessions[e[s]]=!0;else i.layout.marketSessions=e;for(r in i.layout.marketSessions)a.session||(a.session={}),a.session[r]=i.canvasStyle("stx_market_session "+r),i.chart.market.disableSession(r,!0)},this.complete=function(t){i.changeOccurred("layout"),i.chart.market.market_def?this.filter?(i.createDataSet(),i.draw(),t&&t()):i.loadChart(i.chart.symbol,t):t&&t()},this.set=function(t,e,i){this.prepare(t,e),this.complete(i)},this.stx.append("drawYAxis",(function(t,r){if(this.layout.extended&&t.yAxis==r.yAxis&&!1!==t.shareChartXAxis&&!t.hidden){var s=t.chart;if(!e.ChartEngine.isDailyInterval(this.layout.interval)&&(a.divider=this.canvasStyle("stx_market_session divider"),a.session)){for(var n,o,l=s.market,h=[],c={},u=0;u<s.dataSegment.length;u++){var d=s.dataSegment[u];if(d&&d.DT){var p=null;if(l.market_def)if(!n||n<=d.DT)o=l.getSession(d.DT),n=l[!(""===o||this.layout.marketSessions&&this.layout.marketSessions[o])?"getNextOpen":"getNextClose"](d.DT);var m=a.session[o];if(m&&(p=m.backgroundColor),c.color&&c.color!=p&&(h.push({start:c.start,end:c.end,color:c.color}),c={}),p){var g=this.layout.candleWidth;d.candleWidth&&(g=d.candleWidth),c.end=this.pixelFromBar(u,s)+g/2,c.start||0===c.start||(c.start=c.end-g+1),c.color=p}else c={}}}(c.start||0===c.start)&&h.push({start:c.start,end:c.end,color:c.color});var f=e.isTransparent(a.divider.backgroundColor),v=a.divider.width.replace(/px/g,""),y={y0:t.bottom,y1:t.top,color:a.divider.backgroundColor,type:"line",context:s.context,confineToPanel:t,pattern:"dashed",lineWidth:v,deferStroke:!0};for(this.startClip(t.name),s.context.beginPath(),i.highlightedDraggable&&(s.context.globalAlpha*=.3),u=0;u<h.length;u++)s.context.fillStyle=h[u].color,!f&&h[u].start>s.left&&this.plotLine(e.extend({x0:h[u].start,x1:h[u].start},y)),s.context.fillRect(h[u].start,t.top,h[u].end-h[u].start,t.bottom-t.top),!f&&h[u].end<s.right&&this.plotLine(e.extend({x0:h[u].end,x1:h[u].end},y));s.context.stroke(),this.endClip()}}}))}},s=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.FullScreen=e.FullScreen||function(t){if(t||(t={}),t.stx){try{if(window.location.host!==window.top.location.host)throw new Error(window.location.host+" does not match "+window.top.location.host)}catch(t){return void console.warn("Full screen mode disabled.")}this.stx=t.stx,this.stx.fullScreen=this,this.fullScreenButton=null,this.fullScreenState=!1,this.addFullScreenButton=function(){this.stx.registerChartControl&&(this.fullScreenButton=this.stx.registerChartControl("stx-full-screen","Full Screen",function(t){return function(e){t.fullScreenToggle(e),e.stopPropagation()}}(this)))},this.fullScreenToggle=function(t){document.documentElement.requestFullscreen||document.documentElement.webkitRequestFullscreen||document.documentElement.mozRequestFullscreen||document.documentElement.msRequestFullscreen?this.getFullScreenElement()?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.mozRequestFullscreen?document.documentElement.mozRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen():(this.fullScreenState=!this.fullScreenState,this.fullScreenRender())},this.fullScreenRender=function(){var t=null;(t=this.stx.container.closest("*[cq-context], cq-context, body"))&&(!0===this.fullScreenState?(this.fullScreenButton&&this.fullScreenButton.classList.add("active"),t.classList.add("full-screen")):(this.fullScreenButton&&this.fullScreenButton.classList.remove("active"),t.classList.remove("full-screen")),window.dispatchEvent(new Event("resize")))},this.onFullScreenChange=function(){this.getFullScreenElement()?this.fullScreenState=!0:this.fullScreenState=!1,this.fullScreenRender()},this.getFullScreenElement=function(){return document.fullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement},document.addEventListener("fullscreenchange",this.onFullScreenChange.bind(this),!1),document.addEventListener("webkitfullscreenchange",this.onFullScreenChange.bind(this),!1),document.addEventListener("mozfullscreenchange",this.onFullScreenChange.bind(this),!1),document.addEventListener("MSFullscreenChange",this.onFullScreenChange.bind(this),!1),this.addFullScreenButton()}else console.warn("The Full Screen addon requires an stx parameter")}},n=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.InactivityTimer=e.InactivityTimer||function(t){if(t.minutes){(!t.interval||t.interval<0)&&(t.interval=60),this.stx=t.stx,this.timeout=t.minutes,this.interval=t.interval,this.wakeCB=t.wakeCB,this.sleepCB=t.sleepCB,this.sleepTimer=null,this.sleeping=!1,this.last=(new Date).getTime(),this.wakeChart=function(){clearTimeout(this.sleepTimer),this.last=(new Date).getTime(),this.sleeping&&(this.stx.quoteDriver&&this.stx.quoteDriver.updateChartLoop(),this.sleeping=!1,document.body.classList.remove("ciq-sleeping")),this.sleepTimer=setTimeout(this.sleepChart.bind(this),6e4*this.timeout),this.wakeCB&&this.wakeCB()},this.sleepChart=function(){this.sleeping||(this.stx.quoteDriver&&this.stx.quoteDriver.updateChartLoop(this.interval),this.sleeping=!0,document.body.classList.add("ciq-sleeping")),this.sleepCB&&this.sleepCB()};var e=this;["mousemove","mousedown","touchstart","touchmove","pointerdown","pointermove","keydown","wheel"].forEach((function(t){document.body.addEventListener(t,(function(t){e.wakeChart()}))})),this.wakeChart()}}},o=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.RangeSlider=e.RangeSlider||function(t){this.cssRequired=!0;var i=t.stx;i.slider=this;var a=t.height?t.height:"95px",r=t.chartContainer?t.chartContainer:t.stx.container,s=document.createElement("div");s.className="ciq-chart";var n=document.createElement("div");n.className="chartContainer",s.appendChild(n),r.parentElement.parentElement.insertBefore(s,r.parentElement.nextSibling),Object.assign(s.style,{height:a,paddingTop:"5px",display:"none"}),n.style.height="100%",n.dimensionlessCanvas=!0;var o=this.slider=new e.ChartEngine({container:n,preferences:{labels:!1,whitespace:0}});o.xaxisHeight=30,o.manageTouchAndMouse=!1,o.minimumCandleWidth=0,o.chart.panel.subholder.style.cursor="ew-resize";var l=o.chart.panel.yAxis;l.drawCurrentPriceLabel=!1,Object.defineProperty(l,"position",{get:function(){return i.slider.yAxisPosition||i.chart.panel.yAxis.position},set:function(t){i.slider.yAxisPosition=t}});const{get:h,set:c}=Object.getOwnPropertyDescriptor(e.ChartEngine.YAxis.prototype,"width");Object.defineProperty(l,"width",{get:function(){return Math.max(h.call(l),i.chart.yAxis.width)},set:function(t){c.call(l,t)}}),e.extend(l,t.yAxis),o.chart.baseline.userLevel=!1,o.controls.home&&(o.controls.home.style.width=0),o.initializeChart();var u=o.chart.panel.subholder;this.updateStyles=function(t,e,a){i.setStyle(t,e,a),this.style=i.canvasStyle("stx_range_slider shading")},this.display=function(t){if(i.layout.rangeSlider!==t)return i.layout.rangeSlider=t,void i.changeOccurred("layout");s.style.display=t?"":"none",i.resizeChart(),window.dispatchEvent(new Event("resize")),t&&(o.resizeChart(),o.initializeChart(),o.draw(),this.drawSlider())},this.setSymbol=function(t){o.chart.panel.display=o.chart.symbol=t,o.setMainSeriesRenderer(),o.resizeChart(),this.adjustRange(i.chart),o.draw(),this.drawSlider()},this.acceptLayoutChange=function(t){var a=!1;o.layout.rangeSlider!==t.rangeSlider&&i.slider.display(t.rangeSlider);["chartType","aggregationType","periodicity","interval","timeUnit","chartScale","rangeSlider","flipped","extended","marketSessions","kagi","rangebars","renko","priceLines","pandf"].forEach((function(i){e.equals(o.layout[i],t[i])||(o.layout[i]=t[i],a=!0)})),e.trulyVisible(s)&&a&&(o.setMainSeriesRenderer(),o.draw(),this.drawSlider())},this.adjustRange=function(t){if(t.dataSet&&t.endPoints&&t.endPoints.begin){var e=o.chart;if(e.width){var a=0,r=0;if(i.quoteDriver){var s={symbol:t.symbol,symbolObject:t.symbolObject,interval:i.layout.interval};"month"!=s.interval&&"week"!=s.interval||i.dontRoll||(s.interval="day");var n=i.quoteDriver.getQuoteFeed(s).behavior;n&&n.bufferSize&&(t.moreAvailable&&(a=n.bufferSize),i.isHistoricalMode()&&(r=n.bufferSize))}e.baseline.defaultLevel=t.baseline.actualLevel,e.scroll=Math.max(0,t.dataSet.length-i.tickFromDate(t.endPoints.begin)-a)+1,e.maxTicks=e.scroll-r+1,o.layout.candleWidth=e.width/e.maxTicks}}},this.copyData=function(t){if(t.dataSet){var e=o.chart;e.masterData=o.masterData=t.masterData,e.dataSet=t.dataSet,e.state=t.state,o.draw(),this.drawSlider()}},this.calculateYAxisPosition=function(){var t=o.chart.panel;o.getYAxisCurrentPosition(t.yAxis,t)!=t.yAxis.position&&o.calculateYAxisPositions()},this.drawSlider=function(){if(e.trulyVisible(s)&&i.chart.dataSet&&i.chart.dataSet.length){var t=this.style;t||(t=this.style=i.canvasStyle("stx_range_slider shading"));var a=i.chart.panel,r=o.chart.context,n=o.chart.segmentImage||[],l=o.layout.candleWidth/2,h=o.tickLeft=Math.max(i.tickFromPixel(a.left+l),0),c=o.tickRight=Math.min(i.tickFromPixel(a.right-l),i.chart.dataSet.length-1),d=o.pixelLeft=o.pixelFromTick(h)-(n[h]?n[h].candleWidth/2:l),p=o.pixelRight=o.pixelFromTick(c)+(n[c]?n[c].candleWidth/2:l),m=u.offsetLeft,g=m+u.offsetWidth;r.save(),r.beginPath(),r.fillStyle=t.backgroundColor,r.fillRect(m,u.offsetTop,d-m,u.offsetHeight),r.fillRect(g,u.offsetTop,p-g,u.offsetHeight),r.strokeStyle=t.borderTopColor,r.lineWidth=parseInt(t.borderWidth,10),r.moveTo(d,u.offsetTop),r.lineTo(d,u.offsetTop+u.offsetHeight),r.moveTo(p,u.offsetTop),r.lineTo(p,u.offsetTop+u.offsetHeight),r.stroke(),r.beginPath(),r.lineWidth=parseInt(t.width,10),r.lineCap="round",r.moveTo(d,u.offsetTop+u.offsetHeight/4),r.lineTo(d,u.offsetTop+3*u.offsetHeight/4),r.moveTo(p,u.offsetTop+u.offsetHeight/4),r.lineTo(p,u.offsetTop+3*u.offsetHeight/4),r.stroke(),r.restore()}},i.addEventListener("layout",(function(t){t.stx.slider.acceptLayoutChange(t.stx.layout)})),i.addEventListener("preferences",(function(t){const{language:i}=t.stx.preferences;e.I18N&&o.preferences.language!=i&&e.I18N.setLocale(o,i),o.preferences.language=i,o.draw()})),i.addEventListener("symbolChange",(function(t){"master"==t.action&&t.stx.slider.setSymbol(t.symbol)})),i.addEventListener("symbolImport",(function(t){"master"==t.action&&t.stx.slider.setSymbol(t.symbol),t.stx.slider.acceptLayoutChange(t.stx.layout)})),i.addEventListener("theme",(function(t){if(o.clearPixelCache(),o.styles={},o.chart.container.style.backgroundColor="",e.ThemeHelper){var i=new e.ThemeHelper({stx:t.stx});i.params.stx=o,i.update()}})),i.append("createDataSet",(function(){this.slider.adjustRange(this.chart),this.slider.copyData(this.chart)})),i.append("draw",(function(){e.trulyVisible(s)&&o.chart.dataSet&&(this.slider.adjustRange(this.chart),this.slider.calculateYAxisPosition(),o.draw(),this.slider.drawSlider())})),i.prepend("resizeChart",(function(){var t=r.parentElement,i=t.parentElement,a=(parseFloat(getComputedStyle(t).height),parseFloat(getComputedStyle(r).height),e.elementDimensions(i).height),n=i.querySelectorAll(".chartContainer");Array.from(n).forEach((function(t){t!==r&&e.trulyVisible(t)&&(a-=e.elementDimensions(t,{border:1,padding:1,margin:1}).height)})),t.style.height=a+"px",this.layout.rangeSlider?(o.chart.breakpoint!==this.chart.breakpoint&&o.notifyBreakpoint(this.chart.breakpoint),s.style.display="",o.resizeChart(),o.initializeChart(),o.draw(),this.slider.drawSlider()):s.style.display="none"})),["mousedown","touchstart","pointerdown"].forEach((function(t){u.addEventListener(t,(function(t){var a=o.backOutX(t.pageX);if(a||0===a){a-=t.target.offsetLeft,o.startDrag=a,o.startPixelLeft=o.pixelLeft,o.startPixelRight=o.pixelRight;var r=i.slider.style;r||(r=i.slider.style=i.canvasStyle("stx_range_slider shading"));var s=parseInt(r.borderLeftWidth,10);(a+=this.offsetLeft)<o.pixelRight-s&&(o.needsLeft=!0),a>o.pixelLeft+s&&(o.needsRight=!0),e.touchDevice||o.needsLeft&&o.needsRight&&t.target.classList.add("stx-drag-chart")}}),{passive:!1})})),["mouseup","mouseover","touchend","pointerup"].forEach((function(t){u.addEventListener(t,(function(t){const{which:e,type:i}=t;1===e&&"pointerup"!==i&&"mouseup"!==i||(t.target.classList.remove("stx-drag-chart"),o.chart.panel.subholder.style.cursor="ew-resize",o.startDrag=null,o.needsLeft=!1,o.needsRight=!1)}))})),["mousemove","touchmove","pointermove"].forEach((function(t){u.addEventListener(t,(function(t){var e=o.startDrag;if(e||0===e){var a=t.touches,r=(a&&a.length?o.backOutX(a[0].pageX):o.backOutX(t.pageX))-t.target.offsetLeft;if(r||0===r){r-=e;var s=o.tickLeft,n=o.tickRight,l=o.startPixelLeft,h=o.startPixelRight,c=o.needsLeft,u=o.needsRight;if(c)l+r<o.chart.left&&(r=o.chart.left-l),u&&h+r>=o.chart.right&&(r=o.chart.right-h,o.isHome()||(r+=o.layout.candleWidth/2)),s=o.tickFromPixel(l+r),u&&(n=s+o.tickRight-o.tickLeft);else{if(!u)return;n=Math.min(o.tickFromPixel(h+r),i.chart.dataSet.length-1)}var d=i.chart.width/(n-s+1);n>=s&&d>=i.minimumCandleWidth&&(o.tickLeft=s,o.tickRight=n,i.chart.scroll=i.chart.dataSet.length-s,c&&u||i.setCandleWidth(d),i.micropixels=0,i.draw())}}}),{passive:!1})})),this.adjustRange(i.chart),this.copyData(i.chart)}},l=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Shortcuts=e.Shortcuts||function(){let{stx:t,width:e=580,windowForEachChart:i=!0,config:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t?(this.stx=t,this.width=e,this.windowForEachChart=i,this.content=this.getShortcutContent(a),this.enclosingContainer=t.container.querySelector(".stx-subholder"),this.ensureMessagingAvailable(t),this.enableUI(t),this.cssRequired=!0,t.shortcuts=this):console.warn("The Shortcuts addon requires an stx parameter")},e.Shortcuts.prototype.enableUI=function(t){t&&e.UI&&setTimeout((()=>{t.uiContext.getAdvertised("Layout").showShortcuts=(t,e)=>this.toggle(e)}))},e.Shortcuts.prototype.ensureMessagingAvailable=function(t){setTimeout((()=>{const e=t.uiContext.topNode;e.querySelector("cq-floating-window")||e.append(document.createElement("cq-floating-window"))}))},e.Shortcuts.prototype.getShortcutContent=function(t){const e=(t.drawingTools||[]).filter((t=>t.shortcut)).map((t=>{let{label:e,shortcut:i}=t;return`<div class="ciq-shortcut">\n\t\t\t\t\t<div>${e}</div>\n\t\t\t\t\t<div><span>Alt</span> + <span>${i.toUpperCase()}</span></div>\n\t\t\t\t</div>`})).join(""),i=t=>" + "===t?"<span>+</span>":t.split("+").map((t=>t&&" "!==t?"<span>"+t+"</span>":"")).join(" + "),a=this.stx.container.closest("cq-context");return`\n\t\t<div class="ciq-shortcut-container">\n\t\t\t<div>\n\t\t\t\t<div><b>Drawing tools shortcuts</b></div>\n\t\t\t\t<div>${e}</div>\n\t\t\t</div>\n\t\t\t<hr>\n\t\t\t<div>\n\t\t\t\t<div><b>Hotkeys</b></div>\n\t\t\t\t<div>${(t.hotkeyConfig&&t.hotkeyConfig.hotkeys||[]).map((t=>{let{label:e,action:r,commands:s,extension:n}=t;return n&&(o=n,!a.hasAttribute(o.toLowerCase()+"-active"))?"":`<div class="ciq-shortcut"><div>${e||r}</div><div>${(t=>t.map((t=>t.replace(/Arrow|Key|Digit|^ | $/g,""))).map((t=>t.replace(/\+/," + "))).reduce(((t,e)=>{return!t.includes(e)&&(i=e).charCodeAt(i.length-1)<127?t.concat(e):t;var i}),[]).map(i).join("<br>"))(s)}</div></div>`;var o})).join("")}</div>\n\t\t\t</div>\n\t\t</div>\n\t`},e.Shortcuts.prototype.toggle=function(t){this.stx.dispatch("floatingWindow",{type:"shortcut",title:"Shortcuts",content:this.content,container:this.enclosingContainer,onClose:()=>this.closed=!0,width:this.width,status:t,tag:this.windowForEachChart?void 0:"shortcut"})}},h=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;function i(){}e.TableView=e.TableView||function(){let{stx:t,minColumnWidth:a="84px",coverUIMaxWidth:r=400,coverContainer:s,usePreviousCloseForChange:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t?(this.stx=t,this.viewAdditionalColumns=!1,this.minColumnWidth=a,this.coverUIMaxWidth=r,this.coverContainer=s,this.usePreviousCloseForChange=n,this.builder=i,this.listeners=[],t.tableView=this,this.cssRequired=!0,e.UI&&e.UI.observeProperty("uiContext",t,(t=>{let{value:i}=t;i&&setTimeout((()=>{this.subscribeToChanges(i);const t=e.getFromNS(i.config,"hotkeyConfig.hotkeys",[]).find((t=>{let{action:e}=t;return"tableView"===e}));t&&(t.action=()=>{const{tableView:t}=document.body.keystrokeHub.context.stx;if(t)return t.toggle(),!0})}))}))):console.warn("The TableView addon requires an stx parameter")},e.TableView.prototype.open=function(t){t&&(this.params=t);const{config:i={},onClose:a}=this.params||{};if(this.view&&this.close(!1),i.minColumnWidth=this.minColumnWidth,i.coverUIMaxWidth=this.coverUIMaxWidth,i.coverContainer=this.coverContainer,this.onClose=a,this.view=this.builder.createTable(this.stx,i),!this.view)return;e.I18N&&e.I18N.translateUI(null,this.view);const{stx:r}=this,s=this.close.bind(this);setTimeout((()=>this.removeCloseListener=function(t){const i=r.uiContext.topNode,a=t=>t.closest(".ciq-data-table-container"),n=t=>{let{target:e}=t;return!a(e)&&s()};i.addEventListener("click",n);const o=t=>{if("Escape"===t.code){const{tableView:e}=document.body.keystrokeHub.context.stx;e&&(e.close(),t.preventDefault())}};document.body.addEventListener("keydown",o);const l=e.getFn("UI.getUIManager")();l&&(t.view.show=t.view.hide=function(){},l.openMenu(t.view,{}));return()=>{i.removeEventListener("click",n),document.body.removeEventListener("keydown",o),l&&l.closeMenu(t.view)}}(this)));const n=e.getFromNS(r,"uiContext.config.scrollbarStyling");n&&(n.refresh(this.view.querySelector("tbody")),n.refresh(this.view.querySelector(".ciq-data-table-wrapper"),{suppressScrollY:!0}))},e.TableView.prototype.close=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.view&&(this.view.remove(),this.view=null),t&&this.onClose&&this.onClose(),this.removeCloseListener&&(this.removeCloseListener(),this.removeCloseListener=null)},e.TableView.prototype.toggle=function(){this[this.view?"close":"open"]()},e.TableView.prototype.subscribeToChanges=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channels.tableView";const{channelSubscribe:a,channelWrite:r}=e.UI.BaseComponent.prototype,{channels:{tableView:s=i}={}}=t.config||{},{stx:n}=this;a(s,(t=>{t?n.tableView.open({onClose:()=>{r(s,!1,n)}}):n.tableView.close()}),n)},i.colHeaders={date:{label:"Date"},open:{label:"Open"},high:{label:"High"},low:{label:"Low"},close:{label:"Close"},pctChange:{label:"% Change",cls:"ciq-extra"},pctChangeVsAvg:{label:"% Change vs Average",cls:"ciq-extra"},volume:{label:"Volume",cls:"ciq-extra"}},i.percentDecimalPlaces=2,i.createTable=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.chart||!t.chart.dataSegment)return;const{builder:i}=t.tableView,{getChartData:a,dataToHtml:r,dataToCsv:s,downloadCsv:n,getDateFormatter:o,getValueFormatter:l,getVolumeFormatter:h,getFilenameFormatter:c,getSeriesDataNames:u,getStudyDataNames:d,getChartCover:p}=i,m=Object.assign({},this.colHeaders);if(t.chart.highLowBars||(delete m.open,delete m.high,delete m.low),!t.tableView.viewAdditionalColumns)for(let t in m)m[t].cls&&delete m[t];const g=Object.values(m).map((t=>t.label)),f=u(t);f.forEach((t=>m[t]={label:t}));const v=d(t);v.forEach((t=>{g.includes(t)||(m[t]={label:t})}));const y=f.concat(v),{dateFormatter:x=o(t),valueFormatter:b=l(t),percentFormatter:S=l(t,this.percentDecimalPlaces),volumeFormatter:C=h(t),fileNameFormatter:w=c(t),minColumnWidth:k="84px"}=e,D=a(t,{dateFormatter:x,valueFormatter:b,percentFormatter:S,volumeFormatter:C,additionalDataFields:y}),T=p(t,e),{symbolDisplay:M,symbol:A}=t.chart,_=i.getCoverToolbar({symbol:M||A,viewAdditionalColumns:t.tableView.viewAdditionalColumns,copyFn:function(){const e=document.createElement("textArea");document.body.appendChild(e),e.textContent=s(D,{colHeaders:m}),e.select(),document.execCommand("copy"),e.remove(),t.dispatch("notification","copytoclipboard")},downloadFn:function(){const t=s(D,{colHeaders:m}),e=w(t);n(t,e)},toggleAdditionalColumnsFn:()=>{const{tableView:e}=t;e.viewAdditionalColumns=!e.viewAdditionalColumns,e.open()},closeFn:()=>t.tableView.close()});T.appendChild(_);const F=r(D,{colHeaders:m,minColumnWidth:k});return T.appendChild(F),T},i.dataToHtml=function(t,e){let{colHeaders:i,minColumnWidth:a}=e;const r=Object.keys(i).length,s=`calc((100% - ${10+4*r}px ) / ${r})`,n=Object.entries(i).map(((t,e)=>{let[,{label:i}]=t;return`<th\n\t\t\tscope="col"\n\t\t\tstyle="width: ${s};"\n\t\t\t>${i.replace("(","  (")}</th>`})),o=t.map((t=>`<tr>${Object.keys(i).map(((e,i)=>{const a=t[e];return 0===i?`<th scope="row"\n\t\t\t\t\t\t\t\tstyle="width: ${s}"\n\t\t\t\t\t\t\t\t>${a}</th>`:`<td style="width: ${s}">${a}</td>`})).join("")}</tr>`)),l=document.createElement("div");l.classList.add("ciq-data-table-wrapper");const h=a?`calc(${r} * ${a})`:"";return l.innerHTML=`\n\t\t<table class="header-fixed"\t${h?`style="min-width: ${h}"`:""}>\n\t\t<thead>${n.join("")}</thead>\n\t\t<tbody>${o.join("")}</tbody>\n\t\t</table>`,l},i.dataToCsv=function(t,e){let{colHeaders:i,colSeparator:a="\t"}=e;return`${Object.entries(i).map((t=>{let[,{label:e}]=t;return`"${e}"`})).join(a)}\n${t.map((t=>Object.keys(i).map((e=>`"${t[e]}"`)).join(a))).join("\n")}`},i.downloadCsv=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"filename";const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i,{type:"text/plain"}),a.download=`${e}.csv`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},i.getChartData=function(t,i){let{dateFormatter:a,valueFormatter:r,percentFormatter:s,volumeFormatter:n,additionalDataFields:o}=i;const l=t.chart.dataSegment.filter((t=>null!==t)),{usePreviousCloseForChange:h}=t.tableView;let c=[],u=0;const d=l.reduce(((t,e)=>{let{Close:i,iqPrevClose:a,Open:r}=e;const s=h?a:r;return void 0===i||Number.isNaN(i)||void 0===s||Number.isNaN(s)?t:(u++,t+(i-s)/s)}),0)/u;return l.forEach(((i,l)=>{const{DT:u,displayDate:p,High:m,Low:g,Open:f,Close:v,iqPrevClose:y,Volume:x}=i,b=h?y:f,S=(v-b)/b,C=p||(t.displayZone?e.convertTimeZone(u,t.dataZone,t.displayZone):u),w={DT:u,date:a(C),open:r(f),close:r(v),change:r(v-b),pctChange:s(100*S),pctChangeVsAvg:s(100*(S-d)),high:r(m),low:r(g),volume:n(x)};o.forEach((t=>{let e=i[t];null!=e?("object"==typeof e&&(e=e.Close),w[t]=r(e)):w[t]=""})),c.push(w)})),c.sort(((t,e)=>e.DT-t.DT)),c},i.getDateFormatter=function(t){return(i,a)=>i?e.displayableDate(t,t.chart,i,!0):""},i.getValueFormatter=function(t,e){const{chart:{panel:i,yAxis:a},layout:{chartScale:r}}=t;let s;return s=a.originalPriceFormatter&&a.originalPriceFormatter.func?r=>a.originalPriceFormatter.func(t,i,r,e):a.priceFormatter&&"percent"!=r&&"relative"!=r?r=>a.priceFormatter(t,i,r,e):a=>t.formatYAxisPrice(a,i,e),t=>s(t).replace(/^-*0\.0*$/,"0")},i.getVolumeFormatter=function(t){return e=>{if(null==e)return"";if(t.internationalizer)return t.internationalizer.priceFormatters[0].format(e);const i=e.toString().split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),i[0]}},i.getFilenameFormatter=function(t){return e=>{const i=t.chart.symbolDisplay||t.chart.symbol;let a,r;if(e){const t=e.split("\n");t.length>1&&([,a=""]=t[1].match(/^"([^"]*)"/)||[],[,r=""]=t[t.length-1].match(/^"([^"]*)"/)||[],a=a.replace(/:/g,".").replace(/\//g,"-"),r=r.replace(/:/g,".").replace(/\//g,"-"))}return`${i}${a?` (${a} _ ${r})`:""}`}},i.getChartCover=function(t,e){let{coverUIMaxWidth:i,coverContainer:a}=e;const r=a&&document.querySelector(a)||(t.uiContext&&t.container.offsetWidth<i?t.uiContext.topNode:t.container.parentElement.parentElement),s=document.createElement("div");return Object.assign(s.style,{top:0,left:0,right:0,bottom:0}),s.classList.add("ciq-data-table-container"),r.appendChild(s),s},i.getCoverToolbar=function(t){let{symbol:e,viewAdditionalColumns:i,copyFn:a,downloadFn:r,toggleAdditionalColumnsFn:s,closeFn:n}=t;const o=document.createElement("div");o.classList.add("ciq-data-table-toolbar"),o.innerHTML=`\n\t\t<div class="ciq-data-table-title"></div>\n\t\t<button class="ciq-data-table-copy">${this.copyLabel}</button>\n\t\t<button class="ciq-data-table-download">${this.downloadLabel}</button>\n\t\t<button class="ciq-data-table-additionalColumns">${this.getAdditionalColumnLabel(i)}</button>\n\t\t<cq-close />\n\t`;o.querySelector(".ciq-data-table-title").textContent=e;const l=o.querySelector(".ciq-data-table-copy");a?l.addEventListener("click",a):l.style.display="none";const h=o.querySelector(".ciq-data-table-download");r?h.addEventListener("click",(function(){h.blur(),r()})):h.style.display="none";const c=o.querySelector(".ciq-data-table-additionalColumns");return s?c.addEventListener("click",s):c.style.display="none",o.close=n,o},i.copyLabel="Copy",i.downloadLabel="Download",i.getAdditionalColumnLabel=function(t){return`<span>${t?"- ":"+ "}</span>Additional columns`},i.getStudyDataNames=function(t){return Object.values(t.layout.studies||{}).map((function(t){return Object.keys(t.outputMap).filter(e)})).reduce(((t,e)=>t.concat(e)),[]);function e(e){return t.chart.dataSegment.some((t=>t&&t[e]))}},i.getSeriesDataNames=function(t){return Object.values(t.chart.seriesRenderers||{}).filter((t=>"_main_series"!==t.params.name)).map((t=>t.seriesParams.map((t=>{let{symbol:e}=t;return e})))).reduce(((t,e)=>t.concat(e)),[])}},c=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Marker?e.Tooltip=e.Tooltip||function(t){if(!e.Marker)return void console.warn("CIQ.Tooltip addon requires CIQ.Marker module to be enabled.");this.cssRequired=!0;const{stx:i,ohl:a,change:r,volume:s,series:n,studies:o,interpolation:l,showOverBarOnly:h,showBarHighlight:c=!0,useDataZone:u}=t,{container:d}=i.chart;let p=d.querySelector("stx-hu-tooltip");p||(p=document.createElement("stx-hu-tooltip"),d.appendChild(p));let m=d.querySelector(".stx-hu-tooltip-highlight");function g(){const{headsUp:t}=i.layout,e=!!i.huTooltip,a="object"!=typeof t,r=!1===t,s=t&&("floating"===t||t.floating);if(e&&(!s&&!a||r)){const{huTooltip:t}=i,{node:e}=t||{};return e&&(e.style.left="-50000px",e.style.right="auto",t.lastBar={},t.highlightEl&&(t.highlightEl.style.display="none")),!0}return!1}function f(){if(!g()){var t=this.barFromPixel(this.cx),h=this.chart.dataSegment[t];if(h){if(!e.Marker.Tooltip.sameBar(h,this.huTooltip.lastBar)||t==this.chart.dataSegment.length-1){var c=this.huTooltip.node;Array.from(c.parentElement.querySelectorAll("[auto]")).forEach((function(t){t.remove()})),Array.from(c.parentElement.querySelectorAll("stx-hu-tooltip-field-value")).forEach((function(t){t.innerHTML=""}));var d=this.chart.panel,p=d.yAxis,m={},f=[];if(f.push({member:"DT",display:"DT",panel:d,yAxis:p}),f.push({member:"Close",display:"Close",panel:d,yAxis:p}),m.DT=m.Close=1,r&&e.ChartEngine.isDailyInterval(this.layout.interval)&&f.push({member:"Change",display:"Change",panel:d,yAxis:p}),a&&(f.push({member:"Open",display:"Open",panel:d,yAxis:p}),f.push({member:"High",display:"High",panel:d,yAxis:p}),f.push({member:"Low",display:"Low",panel:d,yAxis:p}),m.Open=m.High=m.Low=1),s&&(f.push({member:"Volume",display:"Volume",panel:null,yAxis:null}),m.Volume=1),n){var v=this.chart.seriesRenderers;for(var y in v){var x=v[y];if(x!==this.mainSeriesRenderer){d=this.panels[x.params.panel],!(p=x.params.yAxis)&&x.params.shareYAxis&&(p=d.yAxis);for(var b=0;b<x.seriesParams.length;b++){var S=x.seriesParams[b],C=S.symbol,w=S.field;C?w&&C!=w&&(C=e.createObjectChainNames(C,w)[0]):C=w;var k=S.display||S.symbol||S.field;C&&!m[k]&&(f.push({member:C,display:k,panel:d,yAxis:p,isSeries:!0}),m[k]=1)}}}}if(o)for(var D in this.layout.studies){var T=this.layout.studies[D];for(var M in p=(d=this.panels[T.panel])&&T.getYAxis(this),this.layout.studies[D].outputMap)M&&!m[M]&&(f.push({member:M,display:M,panel:d,yAxis:p}),m[M]=1);m[D+"_hist"]||(f.push({member:D+"_hist",display:D+"_hist",panel:d,yAxis:p}),f.push({member:D+"_hist1",display:D+"_hist1",panel:d,yAxis:p}),f.push({member:D+"_hist2",display:D+"_hist2",panel:d,yAxis:p}),m[D+"_hist"]=1)}for(var A=0;A<f.length;A++){var _=f[A],F=_.member,P=_.display,I="DT"==F;!I||u||e.ChartEngine.isDailyInterval(i.layout.interval)||(F="displayDate"),d=_.panel;var L=null;(p=_.yAxis)&&(d&&d===d.chart.panel?(L=Math.max(p.printDecimalPlaces,d.chart.decimalPlaces),(p.maxDecimalPlaces||0===p.maxDecimalPlaces)&&(L=Math.min(L,p.maxDecimalPlaces))):p.decimalPlaces||0===p.decimalPlaces?L=p.decimalPlaces:(p.maxDecimalPlaces||0===p.maxDecimalPlaces)&&(L=p.maxDecimalPlaces));var E=null,N=e.existsInObjectChain(h,F);N?E=N.obj[N.member]:"Change"==F&&(E=h.Close-h.iqPrevClose);var O=P.replace(/^(Result )(.*)/,"$2");if(l&&f[A].isSeries&&null==E){var H=this.valueFromInterpolation(t,O,"Close",d,p);if(null===H)break;E=H}if(!E&&0!==E||!I&&"object"==typeof E&&!E.Close&&0!==E.Close){var V=c.querySelector('stx-hu-tooltip-field[field="'+O+'"]');if(V)""!==V.querySelector("stx-hu-tooltip-field-name").innerHTML&&(V.querySelector("stx-hu-tooltip-field-value").innerHTML="n/a")}else{var z="";(E.Close||0===E.Close)&&(E=E.Close),E.constructor==Number?z=p?p.originalPriceFormatter&&p.originalPriceFormatter.func?p.originalPriceFormatter.func(this,d,E,L):p.priceFormatter&&p.priceFormatter!=e.Comparison.priceFormat?p.priceFormatter(this,d,E,L):this.formatYAxisPrice(E,d,L,p):E:E.constructor==Date?I&&this.controls.floatDate&&this.controls.floatDate.innerHTML?z=this.chart.xAxis.noDraw?"N/A":e.displayableDate(this,d.chart,E):(z=e.yyyymmdd(E),e.ChartEngine.isDailyInterval(this.layout.interval)||(z+=" "+E.toTimeString().substr(0,8))):z=E;var R=c.querySelector('stx-hu-tooltip-field[field="'+O+'"]');if(R){R.querySelector("stx-hu-tooltip-field-value").innerHTML=z;var B=R.querySelector("stx-hu-tooltip-field-name");""===B.innerHTML&&(B.innerHTML=this.translateIf(O))}else{var Q=document.createElement("stx-hu-tooltip-field");Q.setAttribute("auto",!0);var W=document.createElement("stx-hu-tooltip-field-name");W.innerHTML=this.translateIf(O),Q.appendChild(W);var U=document.createElement("stx-hu-tooltip-field-value");U.innerHTML=z,Q.appendChild(U),c.appendChild(Q)}}}this.huTooltip.render()}}else this.positionMarkers()}}m||(m=document.createElement("div"),m.classList.add("stx-hu-tooltip-highlight"),d.appendChild(m)),e.Marker.Tooltip=function(t){this.className||(this.className="CIQ.Marker.Tooltip"),this.highlightEl=m,t.label="tooltip",e.Marker.call(this,t)},e.inheritsFrom(e.Marker.Tooltip,e.Marker,!1),e.Marker.Tooltip.sameBar=function(t,e){return!(!t||!e)&&(+t.DT==+e.DT&&(t.Close==e.Close&&(t.Open==e.Open&&t.Volume==e.Volume)))},e.Marker.Tooltip.placementFunction=function(t){if(!g()){for(var i=t.stx,a=0;a<t.arr.length;a++){var r,s,n,o=t.arr[a],l=i.barFromPixel(i.cx),u=i.chart.dataSegment[l],p=!0;if("undefined"!=u&&u&&u.DT&&(r=!0,u.High&&(s=i.pixelFromPrice(u.High)),u.Low&&(n=i.pixelFromPrice(u.Low)),i.chart.highLowBars||u.Close&&(s=i.pixelFromPrice(u.Close)-15,n=i.pixelFromPrice(u.Close)+15),!h||i.cy>=s&&i.cy<=n||(p=!1)),!i.insideChart||i.openDialog||i.activeDrawing||i.grabbingScreen||!r||!p)return m.style.display="none",o.node.style.left="-50000px",o.node.style.right="auto",void(o.lastBar={});if(e.Marker.Tooltip.sameBar(i.chart.dataSegment[l],o.lastBar)&&l!=i.chart.dataSegment.length-1)return;o.lastBar=i.chart.dataSegment[l];var f=o.lastBar.candleWidth||i.layout.candleWidth;parseInt(getComputedStyle(o.node).width,10)+i.chart.panel.left+30+f<i.backOutX(e.ChartEngine.crosshairX)?(o.node.style.left="auto",o.node.style.right=Math.round(d.clientWidth-i.pixelFromBar(l)+30)+"px"):(o.node.style.left=Math.round(i.pixelFromBar(l)+30)+"px",o.node.style.right="auto");var v=parseInt(getComputedStyle(o.node).height,10),y=Math.round(e.ChartEngine.crosshairY-i.top-v/2);if(y+v>i.height&&(y=i.height-v),y<0&&(y=0),o.node.style.top=y+"px",c&&!i.layout.crosshair){const t=o.lastBar.candleWidth||i.layout.candleWidth,e=i.pixelFromBar(l)-t/2;let a=t;e+a>i.chart.width&&(a=i.chart.width-e),m.style.display="block",m.style.left=e+"px",m.style.width=a+"px"}else m.style.display="none"}var x=i.overXAxis,b=i.overYAxis;i.overXAxis=i.overYAxis=!1,i.overXAxis=x,i.overYAxis=b}},i.append("deleteHighlighted",(function(){this.huTooltip.lastBar={},this.headsUpHR()})),i.append("headsUpHR",f),i.append("createDataSegment",f),i.huTooltip=new e.Marker.Tooltip({stx:i,xPositioner:"bar",chartContainer:!0,node:p})}:console.error("tooltip addon requires first activating markers feature.")},u=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Animation=e.Animation||function(t){if(!t)throw new Error("Invalid constructor arguments.");var i,a,r;if(t instanceof e.ChartEngine?(i=arguments[0],a=arguments[1],r=arguments[2]):(i=t.stx,a=t.animationParameters,r=t.easeMachine),!i)return console.warn("No CIQ.ChartEngine provided. Cannot properly create CIQ.Animation instance");var s={stayPut:!1,ticksFromEdgeOfScreen:5,granularity:1e6};a=e.extend(s,a),s.tension&&(i.chart.tension=a.tension),i.tickAnimator=r||new e.EaseMachine(Math.easeOutCubic,1e3);var n=new e.EaseMachine(Math.easeInOutCubic,1e3),o=["#0298d3","#19bcfc","#5dcffc","#9ee3ff"],l=0,h=0,c=!1,u=null;i.addEventListener(["symbolChange","layout"],(function(t){c=!1,u=null})),i.prepend("updateCurrentMarketData",(function(t,e,i,a){e||(e=this.chart),a&&a.fromTrade&&(e.closePendingAnimation||0===e.closePendingAnimation)&&(a.finalClose=e.closePendingAnimation)})),i.prepend("updateChartData",(function(t,i,r){var s=this;if(i||(i=s.chart),i&&i.defaultChartStyleConfig&&"none"!=i.defaultChartStyleConfig&&(void 0===r||!r.animationEntry&&!r.secondarySeries)&&i.dataSegment){var n=s.tickAnimator,o=this.mainSeriesRenderer&&this.mainSeriesRenderer.supportsAnimation;if(o){if(!n)return void console.warn("Animation plug-in can not run because the tickAnimator has not been declared. See instructions in animation.js");if(this.prevSymbol!=i.symbol&&(this.prevQuote=0,i.closePendingAnimation=null,this.prevSymbol=i.symbol),M(),n.stop(),t.length>2)return}var l=e.clone(r);l||(l={}),l.animationEntry=!0,l.bypassGovernor=!0,l.noCreateDataSet=!1,l.appending=!0,l.firstLoop=!0;var h=this.chart.symbol,d=this.layout.periodicity,p=this.layout.interval,m=this.layout.timeUnit;if(o){var g=t[t.length-1];this.prevQuote=this.currentQuote();var f=!1,v=!1;if(1==d&&2==t.length){this.prevQuote=t[0];var y=i.dataSet.length;T(this.prevQuote),y==i.dataSet.length&&(v=!0)}if(!(g&&g.Close&&this.prevQuote&&this.prevQuote.Close))return!1;if(this.extendedHours&&i.market.market_def){var x=g.DT;if(e.ChartEngine.isDailyInterval(p))c=!i.market.isMarketDate(x);else if(!u||u<=x){var b=i.market.getSession(x);c=!(""===b||this.layout.marketSessions&&this.layout.marketSessions[b]),u=i.market[c?"getNextOpen":"getNextClose"](x)}if(c)return this.draw(),!1}var S=d;"second"==p||"second"==m?S*=1e3:"minute"!=p&&"minute"!=m||(S*=6e4),isNaN(p)||(S*=p),f="day"==p||"day"==m?g.DT.getDate()!=this.prevQuote.DT.getDate():"week"==p||"week"==m?g.DT.getDate()>=this.prevQuote.DT.getDate()+7:"month"==p||"month"==m?g.DT.getMonth()!=this.prevQuote.DT.getMonth():g.DT.getTime()>=this.prevQuote.DT.getTime()+S;var C=!this.mainSeriesRenderer||!this.mainSeriesRenderer.standaloneBars,w=0;if(f){if(!this.animations.zoom.hasCompleted)return!1;var k=this.layout.candleWidth;if(i.scroll<=i.maxTicks)for(;this.micropixels>0;)i.scroll++,this.micropixels-=k;i.scroll<=i.maxTicks?(this.previousMicroPixels=this.micropixels,this.nextMicroPixels=this.micropixels+k,w=-1*k,i.dataSegment.length<i.maxTicks-a.ticksFromEdgeOfScreen&&!a.stayPut&&(this.nextMicroPixels=this.micropixels,i.scroll++),i.animatingHorizontalScroll=C,i.previousDataSetLength=i.dataSet.length):v||i.scroll++}i.closePendingAnimation=g.Close;var D=f&&!C?g.Open:this.prevQuote.Close;return n.run(function(t,r,o){return function(c){var u=c.Close;if(!i.dataSet.length||h!=i.symbol||d!=s.layout.periodicity||p!=s.layout.interval||m!=s.layout.timeUnit)return n.stop(),void M();var g=e.clone(t);g.Adj_Close=null,g.Close=Math.round(u*a.granularity)/a.granularity,o?(g.Open||0===g.Open||(g.Open=g.Close),g.High||0===g.High||(g.High=Math.max(g.Open,g.Close)),g.Low||0===g.Low||(g.Low=Math.min(g.Open,g.Close))):(t.Close>r.High&&(g.High=g.Close),t.Close<r.Low&&(g.Low=g.Close)),i.animatingHorizontalScroll&&(s.micropixels=c.micropixels,i.lastTickOffset=c.lineOffset),l.updateDataSegmentInPlace=!n.hasCompleted;var f=[g];o&&"tick"!==s.layout.interval&&f.unshift(r),s.updateChartData(f,i,l),l.firstLoop=!1,n.hasCompleted&&M()}}(g,e.clone(this.prevQuote),f),{Close:D,micropixels:this.nextMicroPixels,lineOffset:w},{Close:g.Close,micropixels:this.micropixels,lineOffset:0}),!0}}function T(t){if(i.masterData)for(var e=i.masterData.length-1;e>=0;e--){var a=i.masterData[e];if(a.Close||0===a.Close)return a.Close=t.Close,t.LastSize&&(a.LastSize=t.LastSize),t.LastTime&&(a.LastTime=t.LastTime),s.updateCurrentMarketData({Close:a.Close,DT:a.DT,LastSize:a.LastSize,LastTime:a.LastTime}),void s.createDataSet(null,null,{appending:!0})}}function M(){if(i.animatingHorizontalScroll&&(i.animatingHorizontalScroll=!1,s.micropixels=s.nextMicroPixels=s.previousMicroPixels,i.lastTickOffset=0),null!==i.closePendingAnimation){var t=i.closePendingAnimation;i.closePendingAnimation=null,T({Close:t})}}})),i.prepend("renderYAxis",(function(t){if(!this.grabbingScreen&&this.isHome()&&(this.mainSeriesRenderer&&this.mainSeriesRenderer.supportsAnimation)){var i=t.panel.yAxis;if(!e.Comparison||i.priceFormatter!=e.Comparison.priceFormat)if(t.prevLowValue||0===t.prevLowValue||(t.prevLowValue=t.animatedLow=t.lowValue),t.prevHighValue||0===t.prevHighValue||(t.prevHighValue=t.animatedHigh=t.highValue),n.running||(t.animatingVerticalScroll=!1),t.prevLowValue>=t.lowValue&&t.prevHighValue<=t.highValue)t.animatingVerticalScroll&&(i.highValue=t.animatedHigh,i.lowValue=t.animatedLow);else if(n.running&&n.stop(),t.lowValue||t.highValue){var a=t.prevLowValue,r=t.prevHighValue;t.prevLowValue=t.lowValue,t.prevHighValue=t.highValue,t.animatingVerticalScroll=!0,n.run(function(e){return function(i){t.animatedLow=i.low,t.animatedHigh=i.high,e.draw()}}(this),{low:a,high:r},{low:t.lowValue,high:t.highValue}),i.lowValue=t.animatedLow,i.highValue=t.animatedHigh}}})),i.append("draw",(function(){if(!c&&this.chart.dataSet&&this.chart.dataSet.length&&this.mainSeriesRenderer&&this.mainSeriesRenderer.supportsAnimation){h%20==0&&(l++,h=0),h++;var t=this.chart.context,e=this.chart.panel,i=this.currentQuote();if(!i)return;var a=i.Close,r=this.pixelFromTick(i.tick,this.chart);this.chart.lastTickOffset&&(r+=this.chart.lastTickOffset);var s=this.pixelFromPrice(a,e);this.chart.yAxis.left>r&&this.chart.yAxis.top<=s&&this.chart.yAxis.bottom>=s&&(l>=o.length&&(l=0),t.beginPath(),t.moveTo(r,s),t.arc(r,s,2+1.07*l,0,2*Math.PI,!1),t.fillStyle=o[l],t.fill())}}))}},d=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ContinuousZoom=e.ContinuousZoom||function(t){this.cssRequired=!0,this.update(t),this.stx.continuousZoom=this,this.addSmartZoomButton=function(){var t=this.stx.registerChartControl&&this.stx.registerChartControl("stx-smart-zoom","SmartZoom (Alt + 0)",function(t){return function(e){t.smartZoomToggle(e),e.stopPropagation()}}(this));t&&(this.stx.addEventListener("layout",(function(e){!0===e.stx.layout.smartzoom?t.classList.add("active"):t.classList.remove("active")})),this.stx.addEventListener("symbolImport",(function(e){!1===e.stx.layout.smartzoom&&t.classList.remove("active")})))},this.smartZoomToggle=function(t){this.smartZoomEnable(!this.stx.layout.smartzoom)},this.smartZoomEnable=function(t){this.stx.layout.smartzoom=t,this.stx.changeOccurred("layout")},this.addSmartZoomButton(),this.smartZoomEnable(!0)},e.ContinuousZoom.prototype.update=function(t){t||(t={}),this.stx=t.stx,this.periodicities=t.periodicities,this.boundaries=t.boundaries},e.ContinuousZoom.prototype.execute=function(t){function e(t){var e=t.period||t.periodicity,i=t.interval,a=t.timeUnit||"minute";switch(isNaN(i)&&(a=i,i=1),a){case"month":i*=4.35;case"week":i*=7;case"day":i*=1440;case"minute":i*=60;case"second":break;case"millisecond":i/=1e3;break;default:return null}return e*i}if(this.stx&&this.stx.layout.smartzoom){var i=this.periodicities,a=this.boundaries,r=this.stx,s=r.layout,n=r.chart;if(i&&a&&(!t&&a.maxCandleWidth&&s.candleWidth>a.maxCandleWidth||t&&a.minCandleWidth&&s.candleWidth<a.minCandleWidth||!t&&a.minTicks&&n.maxTicks<a.minTicks||t&&a.maxTicks&&n.maxTicks>a.maxTicks)){for(var o={value:t?Number.MAX_VALUE:0},l=e(s),h=0;h<i.length;h++){var c=e(i[h]);(c>l&&c<o.value&&t||c<l&&c>o.value&&!t)&&(o={value:c,periodicity:i[h]})}var u=o.periodicity;u&&r.setRange({dtLeft:n.xaxis[0].DT,dtRight:n.xaxis[n.xaxis.length-1].DT,dontSaveRangeToLayout:!0,periodicity:u})}}}},p=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Outliers=e.Outliers||function(t){if(t||(t={}),t.stx){Array.isArray(t.altColors)||(t.altColors=["#323390","#66308f","#0073ba","#f4932f","#0056a4","#00a99c","#00a553","#ea1d2c","#e9088c","#fff126","#912a8e","#ee652e","#00afed","#8ec648"]),this.stx=t.stx,this.stx.outliers=this,this.cssRequired=!0,this.multiplier=t.multiplier||3,this.altColors=t.altColors,this.axisData={},this.stx.addEventListener("layout",(function(t){Object.keys(t.stx.outliers.axisData).forEach(function(t){this.removeAllMarkers(this.axisData[t]),delete this.axisData[t]}.bind(t.stx.outliers))})),this.processDataSet=function(t,e,i){if(!t.length||t.length<=1)return!1;var a=[0,0];if(!this.axisData[i.name]){var r="",s=-1;Object.keys(this.axisData).forEach(function(t){this.axisData[t].panel.name==e.name&&s++}.bind(this)),s>-1&&s<this.altColors.length&&(r=this.altColors[s]),this.axisData[i.name]={axis:i,panel:e,displayState:"none",isFlipped:!1,originalZoom:i.zoom,markerColor:r,markers:{},axisMarkers:{}}}var n=this.axisData[i.name];return Object.assign(n,this.find(t)),this.refreshMarkerArray(n),this.refreshMarkers(n),"low"!==n.displayState&&"all"!==n.displayState||null===n.outlierMin?a[0]=n.trendMin:a[0]=n.outlierMin,"high"!==n.displayState&&"all"!==n.displayState||null===n.outlierMax?a[1]=n.trendMax:a[1]=n.outlierMax,a},this.find=function(t){if(t.length&&!(t.length<=0)){var e,i,a=function(t,e){return{quote:t.quote,DT:t.quote.DT,value:t.value,position:e}},r=null,s=null,n=null,o=null,l=[],h=t.slice();h.sort((function(t,e){return t.value-e.value}));var c=h.length,u=h[Math.floor(c/4)].value,d=h[Math.floor(c*(3/4))].value,p=d-u;e=u-p*this.multiplier,i=d+p*this.multiplier;for(var m=0;m<c;m++){var g=h[m],f=h[c-(m+1)];if(g.value<=e&&l.push(a(g,"low")),f.value>=i&&l.push(a(f,"high")),null===n&&g.value<=e&&(n=g.value),null===o&&f.value>=i&&(o=f.value),null===r&&g.value>e&&(r=g.value),null===s&&f.value<i&&(s=f.value),null!==r&&null!==s)break}return{minValue:e,maxValue:i,trendMin:r,trendMax:s,outlierMin:n,outlierMax:o,activeOutliers:l}}},this.refreshMarkerArray=function(t){this.deprecateMarkers(t);var e=t.markers;t.activeOutliers.forEach(function(i){var a=i.DT.getTime().toString();e[a]||(e[a]={isFresh:!0,type:"quote",value:i.value,marker:this.markOutlier(i,i.position,t)}),e[a].isFresh=!0}.bind(this)),null!==t.outlierMax&&(e.axisHigh||(e.axisHigh={isFresh:!0,type:"axis",value:t.outlierMax,marker:this.markAxis("high",t)}),e.axisHigh.isFresh=!0),null!==t.outlierMin&&(e.axisLow||(e.axisLow={isFresh:!0,type:"axis",value:t.outlierMin,marker:this.markAxis("low",t)}),e.axisLow.isFresh=!0)},this.setDisplayState=function(t,e){"high"!=t&&"low"!=t&&"all"!=t&&(t="none");var i=t;"all"==e.displayState&&"high"==t?i="low":"all"==e.displayState&&"low"==t?i="high":"high"==e.displayState&&"low"==t||"low"==e.displayState&&"high"==t?i="all":e.displayState==t&&(i="none"),e.displayState=i,e.axis.zoom=e.originalZoom,this.refreshMarkers(e),this.stx.draw()},this.deprecateMarkers=function(t){Object.keys(t.markers).forEach(function(t){var e;(e=this.markers[t]).marker&&!e.isFresh?(e.marker.remove&&e.marker.remove(),e.marker=null):e.isFresh=!1,this.markers[t].marker||delete this.markers[t]}.bind(t))},this.removeAllMarkers=function(t){Object.keys(t.markers).forEach((function(e){var i=t.markers[e].marker;i&&(i.remove&&i.remove(),i=null),i||delete t.markers[e]}))},this.updateMarkerVisibility=function(){Object.keys(this.markers).forEach(function(t){"all"==this.displayState||this.markers[t].marker.node.classList.contains(this.displayState)?this.markers[t].marker.node.style.display="none":this.markers[t].marker.node.style.display="block"}.bind(this))},this.refreshAxisMarkers=function(t,e){var i=!1;t.classList.contains("high")&&(i=!0);var a=e.axis.top;(!e.isFlipped&&!i||e.isFlipped&&i)&&(a=e.axis.bottom-50),t.classList.contains("nano")&&(a=e.axis.top+e.axis.height/2-22);var r=Math.floor(e.axis.left).toString()+"px",s=Math.floor(a).toString()+"px",n=i?e.outlierMax:e.outlierMin;t.style.transform="translate("+r+", "+s+")",t.querySelector(".outlier-value").innerText=this.stx.formatYAxisPrice(n),"0px"===r?t.classList.add("right"):t.classList.remove("right")},this.refreshMarkers=function(t){Object.keys(t.markers).forEach(function(t,e){var i=t.markers[e].marker,a=t.markers[e].value,r=t.markers[e].type;a>t.trendMax&&t.axis.high>=a||a<t.trendMin&&t.axis.low<=a?"quote"==r?i.node.style.display="none":"axis"==r&&i.node.classList.add("compress"):"quote"==r?i.node.style.display="block":"axis"==r&&i.node.classList.remove("compress"),"axis"==r&&this.refreshAxisMarkers(i.node,t),t.axis.height<100?i.node.classList.add("nano"):i.node.classList.remove("nano"),t.axis.height<250?i.node.classList.add("micro"):i.node.classList.remove("micro")}.bind(this,t)),t.isFlipped!==t.axis.flipped&&this.flipMarkers(t)},this.markAxis=function(t,i){var a=document.createElement("div");a.classList.add("outlier-sticker","axis","mini",t),a.innerHTML='<div class="expansion"><div class="pill"><div class="icon"></div></div><div class="tick"></div><span class="outlier-value"></div><div class="compression"><div class="pill"><div class="icon"></div></div></div></span>',this.matchYAxisStyle(a),this.setMarkerColor(a,i.markerColor);var r=this.handleMarkerClick.bind(this,t,i,a);return a.addEventListener("click",r),a.addEventListener("touchend",r),new e.Marker({stx:this.stx,xPositioner:"none",yPositioner:"none",label:"expand",permanent:!0,chartContainer:!0,node:a})},this.markOutlier=function(t,i,a){if(t){a||(a={panel:this.stx.panels.chart}),i=i||"high";var r=document.createElement("div");r.classList.add("outlier-sticker","quote","mini",i),r.innerHTML='<div class="pill"><div class="icon"></div></div><span class="outlier-value">'+this.stx.formatYAxisPrice(t.value,a.panel)+"</span>",this.matchYAxisStyle(r),this.setMarkerColor(r,a.markerColor);var s=this.handleMarkerClick.bind(this,i,a,r);return r.addEventListener("click",s),r.addEventListener("touchend",s),new e.Marker({stx:this.stx,xPositioner:"date",yPositioner:"high"==i?"top":"bottom",x:t.quote.DT,panelName:a.panel.name,node:r})}},this.handleMarkerClick=function(t,e,i){i.classList.contains("nano")&&(t="all"),this.setDisplayState(t,e),this.stx.draw()},this.matchYAxisStyle=function(t){if(this.stx.styles.stx_yaxis){var e=this.stx.styles.stx_yaxis;t.style.fontSize=e.fontSize,t.style.fontFamily=e.fontFamily,t.style.color=e.color,t.style.borderColor=e.color}},this.setMarkerColor=function(t,e){if(""!=e)for(var i=t.querySelectorAll(".pill"),a=0;a<i.length;a++)i[a].style.backgroundColor=e},this.flipMarkers=function(t){t.isFlipped=t.axis.flipped,Object.keys(t.markers).forEach(function(t,e){var i=t.markers[e].marker,a=t.markers[e].value,r=t.markers[e].type;t.isFlipped?i.node.classList.add("flipped"):i.node.classList.remove("flipped"),"quote"==r&&(a>t.trendMax?t.isFlipped?i.params.yPositioner="bottom":i.params.yPositioner="top":a<t.trendMin&&(t.isFlipped?i.params.yPositioner="top":i.params.yPositioner="bottom"))}.bind(this,t))};var i=e.ChartEngine.prototype.determineMinMax.bind(this.stx);e.ChartEngine.prototype.determineMinMax=function(t,e,a,r,s,n,o,l,h){return h||(h=[]),o&&l&&this.layout.outliers&&h.push(this.outliers.processDataSet.bind(this.outliers)),i(t,e,a,r,s,n,o,l,h)}}else console.warn("The Outliers addon requires an stx parameter")}},m=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.PlotComplementer=e.PlotComplementer||function(t){var i=t.stx,a=e.uniqueID();t.decorator||(t.decorator={});var r=t.decorator.symbol||"_"+a,s=t.decorator.display||" (addl)";i.plotComplementers||(i.plotComplementers=[]),i.plotComplementers.push(this),this.id=t.id||a,this.defaultRenderingParameters={chartType:"line",width:1,opacity:.5},t.renderingParameters&&(this.defaultRenderingParameters=t.renderingParameters);var n=this;function o(i,a,o,l){if("err"!=function(e){if(e.quoteDriver&&t.quoteFeed){for(var i=0;i<e.quoteDriver.quoteFeeds.length;i++)if(e.quoteDriver.quoteFeeds[i].engine==t.quoteFeed)return;return"err"}}(i)&&(l||(l=a),!i.isEquationChart(a)&&(o||(o={}),!o.isComparison&&l&&-1==l.indexOf(r)))){var h=l+r,c=a+r,u=i.getRendererFromSeries(l),d=e.extend({display:a+s,name:h,symbol:c,symbolObject:{symbol:c,generator:n.id,masterSymbol:a},overChart:!1,gapDisplayStyle:!0,permanent:!0,panel:o.panel,yAxis:o.yAxis,shareYAxis:!0,loadData:!!n.quoteFeed,dependentOf:u?u.params.name:i.mainSeriesRenderer.params.name},n.renderingParameters);d.color||(d.color=o.color||"auto"),i.addSeries(h,d,(function(t,e){t&&i.removeSeries(h,i.chart),i.chart.seriesRenderers[h]&&(i.chart.seriesRenderers[h].params.display=d.display)}))}}function l(t,e,i){e&&-1==e.indexOf(r)&&t.removeSeries(e+r,i)}function h(t){"master"==t.action?(t.prevSymbol||(t.prevSymbol=t.symbol),l(t.stx,t.prevSymbol,t.stx.chart),o(t.stx,t.symbol)):"add-series"==t.action?(l(t.stx,t.id,t.stx.chart),o(t.stx,t.symbol,t.parameters,t.id)):"remove-series"==t.action&&l(t.stx,t.id,t.stx.chart)}i.addEventListener("symbolChange",h),i.addEventListener("symbolImport",h),this.resetRenderingParameters=function(){this.renderingParameters=this.defaultRenderingParameters},this.setQuoteFeed=function(t){if(t.quoteFeed&&t.behavior){var a=e.clone(t.behavior);a.generator=this.id;var r=t.filter;i.attachQuoteFeed(t.quoteFeed,a,(function(t){return!(r&&!r(t))&&t.symbolObject.generator==a.generator})),this.quoteFeed=t.quoteFeed}},this.setQuoteFeed(t),this.resetRenderingParameters()}},g={CIQ:a.CIQ};"undefined"!=typeof __TREE_SHAKE__&&__TREE_SHAKE__||g.CIQ.activateImports(r,s,n,o,l,h,c,u,d,p,m,null)},"./chartiq/development/js/advanced.js":(t,e,i)=>{i.r(e),i.d(e,{$$:()=>a.$$,$$$:()=>a.$$$,CIQ:()=>a.CIQ,SplinePlotter:()=>a.SplinePlotter,accumulationDistribution:()=>l,adx:()=>h,aggregations:()=>xt,alligator:()=>c,aroon:()=>u,atr:()=>d,awesomeOscillator:()=>p,balanceOfPower:()=>m,bollinger:()=>g,cci:()=>f,centerOfGravity:()=>v,chaikin:()=>y,chande:()=>x,choppiness:()=>b,comparisonStudies:()=>S,coppock:()=>C,darvasBox:()=>w,detrended:()=>k,disparity:()=>D,drawingAdvanced:()=>r,easeOfMovement:()=>T,ehlerFisher:()=>M,elder:()=>A,equationsAdvanced:()=>s,fractalChaos:()=>_,highLowStudies:()=>F,highPerformanceMarkers:()=>n,ichimoku:()=>P,intradayMomentum:()=>I,keltner:()=>L,klinger:()=>E,linearRegression:()=>N,macd:()=>O,massIndex:()=>H,moneyFlow:()=>V,movingAverages:()=>z,parabolicSAR:()=>R,pivotPoints:()=>B,prettyGoodOscillator:()=>Q,priceMomentumOscillator:()=>W,priceVolumeOscillator:()=>U,primeNumber:()=>j,pring:()=>q,projectedVolume:()=>Y,psychologicalLine:()=>$,qstick:()=>X,rainbow:()=>Z,randomWalk:()=>K,relativeVigor:()=>G,renderersAdvanced:()=>o,rsi:()=>J,schaffTrendCycle:()=>tt,shinohara:()=>et,stochastics:()=>it,supertrend:()=>at,swingIndex:()=>rt,timezoneJS:()=>a.timezoneJS,trendIntensity:()=>st,trix:()=>nt,twiggsMoneyFlow:()=>ot,typicalPrice:()=>lt,ulcerIndex:()=>ht,ultimateOscillator:()=>ct,valuationLines:()=>ut,volatilityIndex:()=>dt,volumeProfile:()=>pt,volumeStudies:()=>mt,vortex:()=>gt,williamsMFI:()=>ft});var a=i("./chartiq/development/js/standard.js");let r=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,i="undefined"!=typeof _timezoneJS?_timezoneJS:t.timezoneJS;e.Drawing?(e.Drawing.ray=function(){this.name="ray"},e.inheritsFrom(e.Drawing.ray,e.Drawing.line),e.Drawing.ray.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]},a=i.x1+1e3;i.x0>i.x1&&(a=i.x1-1e3),this.v0B=this.v0,this.v1B=e.yIntersection(i,a),this.d0B=this.d0,this.d1B=this.stx.dateFromTick(a,t.chart)}},e.Drawing.ray.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&this.setPoint(1,this.d1B,this.v1B,t.chart))},e.Drawing.continuous=function(){this.name="continuous",this.dragToDraw=!1,this.maxSegments=null},e.inheritsFrom(e.Drawing.continuous,e.Drawing.segment),e.Drawing.continuous.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){if(this.copyConfig(),!this.penDown)return this.setPoint(0,i,a,r.chart),this.penDown=!0,!1;if(this.accidentalClick(i,a))return this.stx.undo(),!0;this.setPoint(1,i,a,r.chart);var s=new(0,e.Drawing.segment),n=this.serialize(this.stx);return s.reconstruct(this.stx,n),this.stx.addDrawing(s),this.stx.changeOccurred("vector"),this.stx.draw(),this.segment++,this.maxSegments&&this.segment>this.maxSegments?!0:(this.setPoint(0,i,a,r.chart),!1)}},e.Drawing.ellipse=function(){this.name="ellipse"},e.inheritsFrom(e.Drawing.ellipse,e.Drawing.BaseTwoPoint),e.Drawing.ellipse.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=a-(r-a),l=r,h=s,c=n,u=s-(n-s),d=(c-u)/6,p=this.lineWidth;p||(p=1.1);var m=this.color;("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.highlighted&&(m=this.stx.getCanvasColor("stx_highlight_vector"),.1==p&&(p=1.1));var g=this.fillColor;if(t.beginPath(),t.moveTo(o,h),t.bezierCurveTo(o,c+d,l,c+d,l,h),t.bezierCurveTo(l,u-d,o,u-d,o,h),g&&!e.isTransparent(g)&&"auto"!=g&&(t.fillStyle=g,t.globalAlpha=.2,t.fill(),t.globalAlpha=1),m&&"none"!=this.pattern&&(t.strokeStyle=m,t.lineWidth=p,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(p,this.pattern)),t.lineDashOffset=0),t.stroke()),t.closePath(),this.highlighted){var f="p1"==this.highlighted;this.littleCircle(t,r,n,f)}}},e.Drawing.ellipse.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;if(this.pointIntersection(this.p1[0],this.p1[1],a))return this.highlighted="p1",{action:"drag",point:"p1"};var r=this.p0[0]-(this.p1[0]-this.p0[0]),s=this.p1[0],n=this.p1[1],o=this.p0[1]-(this.p1[1]-this.p0[1]);return!(a.x0>Math.max(r,s)||a.x1<Math.min(r,s))&&(!(a.y1>Math.max(o,n)||a.y0<Math.min(o,n))&&(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}))},e.Drawing.ellipse.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.ellipse.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.ellipse.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.channel=function(){this.name="channel",this.dragToDraw=!1,this.p2=null},e.inheritsFrom(e.Drawing.channel,e.Drawing.segment),e.Drawing.channel.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.channel.prototype.move=function(t,e,i){if(this.penDown){if(this.copyConfig(),null===this.p2)this.p1=[e,i];else{var a=i-(this.p1[1]-this.p0[1])/(this.p1[0]-this.p0[0])*(e-this.p1[0]);this.p2=[this.p1[0],a]}this.render(t)}},e.Drawing.channel.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],a.chart),this.penDown=!1,!0):(this.setPoint(1,e,i,a.chart),this.p0[0]==this.p1[0]?(this.p1=null,!1):(this.p2=[this.p1[0],this.p1[1]],!1)):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.channel.prototype.boxIntersection=function(t,e,i){var a=this.p0,r=this.p1,s=this.p2;return!!(a&&r&&s)&&(!(i.x0>Math.max(a[0],r[0])||i.x1<Math.min(a[0],r[0]))&&((r[0]-a[0])*((s[1]<a[1]?i.y1:i.y0)-a[1])-(r[1]-a[1])*(t-a[0]))*((s[0]-a[0])*((s[1]>a[1]?i.y1:i.y0)-(a[1]+s[1]-r[1]))-(r[1]-a[1])*(t-a[0]))<0)},e.Drawing.channel.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1||!this.p2)return null;var r={0:this.p0,1:this.p1,2:this.p2};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};return this.boxIntersection(t,i,a)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i}):null},e.Drawing.channel.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=null;this.p2&&(o=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));var l=this.lineWidth,h=this.getLineColor(),c=this.fillColor;this.p2&&c&&!e.isTransparent(c)&&"auto"!=c&&(t.beginPath(),t.moveTo(a,s),t.lineTo(r,n),t.lineTo(r,o),t.lineTo(a,s+(o-n)),t.closePath(),t.globalAlpha=.2,t.fillStyle=c,t.fill(),t.globalAlpha=1);var u={pattern:this.pattern,lineWidth:l};if((this.penDown||this.highlighted)&&"none"==this.pattern&&(u.pattern="dotted"),this.stx.plotLine(a,r,s,n,h,"segment",t,i,u),this.p2&&this.stx.plotLine(a,r,s+(o-n),o,h,"segment",t,i,u),this.highlighted){var d="p0"==this.highlighted,p="p1"==this.highlighted,m="p2"==this.highlighted;this.littleCircle(t,a,s,d),this.littleCircle(t,r,n,p),this.littleCircle(t,r,o,m)}}},e.Drawing.channel.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.setPoint(1,e.p1[0]-s,e.p1[1]-n,r.chart),this.setPoint(2,e.p2[0]-s,e.p2[1]-n,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},e.Drawing.channel.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d1,this.v2,t.chart))},e.Drawing.channel.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.channel.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.pitchfork=function(){this.name="pitchfork",this.dragToDraw=!1,this.p2=null},e.inheritsFrom(e.Drawing.pitchfork,e.Drawing.channel),e.Drawing.pitchfork.prototype.configs=["color","lineWidth","pattern"],e.Drawing.pitchfork.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.pitchfork.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1||!this.p2)return null;var r={0:this.p0,1:this.p1,2:this.p2};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};for(var n=this.rays,o=0;o<n.length;o++)if(this.lineIntersection(t,i,a,o?"ray":"segment",n[o][0],n[o][1],!0))return this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i};return null},e.Drawing.pitchfork.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx,a=this.p2;a||(a=this.p1);var r=i.pixelFromTick(this.p0[0],e.chart),s=i.pixelFromTick(this.p1[0],e.chart),n=i.pixelFromTick(a[0],e.chart),o=i.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),l=i.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),h=i.pixelFromValueAdjusted(e,a[0],a[1]),c=this.lineWidth,u=this.getLineColor(),d={pattern:this.pattern,lineWidth:c},p=50,m=2*o-l-h,g=2*r-s-n;g<0&&(p*=-1),m*=p/g,this.rays=[[[s,l],[n,h]],[[r,o],[(s+n)/2,(l+h)/2]]],s==n&&l==h||this.rays.push([[s,l],[s-p,l-m]],[[n,h],[n-p,h-m]]);for(var f=0;f<this.rays.length;f++){var v=this.rays[f],y=f?"ray":"segment";i.plotLine(v[0][0],v[1][0],v[0][1],v[1][1],u,y,t,e,d)}if(this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted,S="p2"==this.highlighted;this.littleCircle(t,r,o,x),this.littleCircle(t,s,l,b),this.littleCircle(t,n,h,S)}}},e.Drawing.pitchfork.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.pitchfork.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.d2=e.d2,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.tzo2=e.tzo2,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.pitchfork.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.gartley=function(){this.name="gartley",this.dragToDraw=!1,this.maxSegments=4,this.shape=null,this.points=[]},e.inheritsFrom(e.Drawing.gartley,e.Drawing.continuous),e.Drawing.gartley.prototype.check=function(t,e){if(!e)return!0;if(t[0]>=e[0]||t[1]==e[1])return!1;if(1==this.segment)t[1]<e[1]?this.shape="M":this.shape="W";else if(2==this.segment){if("M"==this.shape&&t[1]<e[1])return!1;if("W"==this.shape&&t[1]>e[1])return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])>=.786)return!1}else if(3==this.segment){if("M"==this.shape&&t[1]>e[1])return!1;if("W"==this.shape&&t[1]<e[1])return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])>=.786)return!1}else if(4==this.segment){if("M"==this.shape&&(t[1]<e[1]||e[1]<this.points[0][1]))return!1;if("W"==this.shape&&(t[1]>e[1]||e[1]>this.points[0][1]))return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])<1.27)return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])>=1.618)return!1}return!0},e.Drawing.gartley.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){if(this.copyConfig(),!this.penDown)return this.setPoint(0,e,i,a.chart),this.pts=[],this.penDown=!0,this.segment=1,!1;if(this.accidentalClick(e,i))return this.penDown=!0,!1;if(this.check(this.p0,this.p1)){if(1==this.segment&&this.points.push(this.p0),this.points.push(this.p1),this.setPoint(1,e,i,a.chart),this.segment++,this.segment>this.maxSegments)return this.setPoint(0,this.points[0][0],this.points[0][1],a.chart),this.penDown=!1,!0;this.pts.push(this.d1,this.tzo1,this.v1),this.setPoint(0,e,i,a.chart)}return!1}},e.Drawing.gartley.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(2==this.segment)this.drawDropZone(t,.618*this.points[0][1]+.382*this.p0[1],.786*this.points[0][1]+.214*this.p0[1],this.p0[0]);else if(3==this.segment)this.drawDropZone(t,.618*this.points[1][1]+.382*this.p0[1],.786*this.points[1][1]+.214*this.p0[1],this.p0[0]);else if(4==this.segment){var o=1.618*this.points[2][1]-.618*this.points[1][1];o="M"==this.shape?Math.max(o,this.points[0][1]):Math.min(o,this.points[0][1]),this.drawDropZone(t,o,1.27*this.points[2][1]-.27*this.points[1][1],this.p0[0])}var l=this.lineWidth,h=this.getLineColor(),c={pattern:this.pattern,lineWidth:l};(this.penDown||this.highlighted)&&"none"==this.pattern&&(c.pattern="dotted"),this.segment<=this.maxSegments&&this.stx.plotLine(a,r,s,n,h,this.name,t,i,c);var u=this.fillColor,d=[];if(this.points.length){t.beginPath();for(var p=1;p<this.points.length&&p<=4;p++){var m=this.stx.pixelFromTick(this.points[p-1][0],i.chart),g=this.stx.pixelFromTick(this.points[p][0],i.chart),f=this.stx.pixelFromValueAdjusted(i,this.points[p-1][0],this.points[p-1][1]),v=this.stx.pixelFromValueAdjusted(i,this.points[p][0],this.points[p][1]);1==p&&d.push(m,f),d.push(g,v),this.stx.plotLine(m,g,f,v,h,this.name,t,i,c)}if(2!=this.points.length&&4!=this.points.length||d.push(r,n),this.points[2]&&d.push(this.stx.pixelFromTick(this.points[2][0],i.chart),this.stx.pixelFromValueAdjusted(i,this.points[2][0],this.points[2][1])),u&&"auto"!=u&&!e.isTransparent(u)){for(var y=0;y<d.length;y+=2)0===y&&t.moveTo(d[0],d[1]),t.lineTo(d[y],d[y+1]);t.fillStyle=u,t.globalAlpha=.2,t.closePath(),t.fill(),t.globalAlpha=1}}}},e.Drawing.gartley.prototype.lineIntersection=function(t,i,a,r){var s=this.points,n=this.stx.panels[this.panelName];if(s.length!=this.maxSegments+1||!n)return!1;for(var o=0;o<s.length-1;o++)if(e.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,i,a,"segment",s[o],s[o+1]))return!0;return!1},e.Drawing.gartley.prototype.boxIntersection=function(t,e,i){if(!this.p0||!this.p1)return!1;if(i.x0>Math.max(this.p0[0],this.p1[0])||i.x1<Math.min(this.p0[0],this.p1[0]))return!1;for(var a=Math.min(this.p0[1],this.p1[1]),r=Math.max(this.p0[1],this.p1[1]),s=0;s<this.points.length;s++)a=Math.min(a,this.points[s][1]),r=Math.max(r,this.points[s][1]);return!(i.y1>r||i.y0<a)},e.Drawing.gartley.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i;e.tick=i;var n=e.value-a;if(e.value=a,"move"==e.action){this.pts=[];for(var o=0;o<this.points.length;o++)this.points[o][0]-=s,this.points[o][1]-=n,this.setPoint(1,this.points[o][0],this.points[o][1],r.chart),o&&o<this.points.length-1&&this.pts.push(this.d1,this.tzo1,this.v1),this.points[o]=this.p1;this.setPoint(0,this.points[0][0],this.points[0][1],r.chart),this.render(t)}}},e.Drawing.gartley.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.gartley.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.reconstructPoints(),this.setPoint(0,this.d0,this.v0,t.chart),this.points.unshift(this.p0),this.setPoint(1,this.d1,this.v1,t.chart),this.points.push(this.p1))},e.Drawing.gartley.prototype.reconstructPoints=function(){var t=this.stx.panels[this.panelName];if(t){this.points=[];for(var i=0;i<this.pts.length;i+=3){var a=e.strToDateTime(this.pts[i]);a.setMinutes(a.getMinutes()+Number(this.pts[i+1])-a.getTimezoneOffset()),this.points.push([this.stx.tickFromDate(e.yyyymmddhhmmssmmm(a),t.chart),this.pts[i+2]])}}},e.Drawing.gartley.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.pts=e.pts.split(","),this.adjust()},e.Drawing.gartley.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,pts:this.pts.join(",")}},e.Drawing.freeform=function(){this.name="freeform",this.splineTension=.3,this.dragToDraw=!0},e.inheritsFrom(e.Drawing.freeform,e.Drawing.segment),e.Drawing.freeform.prototype.measure=function(){},e.Drawing.freeform.prototype.intersected=function(t,i,a){return a.x0>this.hiX||a.x1<this.lowX||a.y1>this.hiY||a.y0<this.lowY?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.freeform.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action&&(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.adjust(),this.render(t))}},e.Drawing.freeform.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){if(!1===this.penDown){this.copyConfig(),this.startX=Math.round(this.stx.resolveX(this.stx.pixelFromTick(i,r.chart))),this.startY=Math.round(this.stx.resolveY(this.stx.pixelFromValueAdjusted(r,i,a)));var s=this.stx.dateFromTick(i,r.chart,!0);return this.d0=e.yyyymmddhhmmssmmm(s),this.tzo0=s.getTimezoneOffset(),this.v0=a,this.p0=[e.ChartEngine.crosshairX-this.startX,e.ChartEngine.crosshairY-this.startY],this.nodes=[this.p0[0],this.p0[1]],this.pNodes=[this.p0],this.candleWidth=this.stx.layout.candleWidth,this.multiplier=r.yAxis.multiplier,this.interval=this.stx.layout.interval,this.periodicity=this.stx.layout.periodicity,this.tempSplineTension=this.splineTension,this.splineTension=-1,document.body.style.cursor="pointer",this.penDown=!0,!1}return this.penDown=!1,this.splineTension=this.tempSplineTension,document.body.style.cursor="auto",!0}},e.Drawing.freeform.prototype.move=function(t,i,a){if(this.penDown){var r=this.stx.panels[this.panelName],s=this.stx.dateFromTick(i,r.chart,!0);return this.d1=e.yyyymmddhhmmssmmm(s),this.tzo1=s.getTimezoneOffset(),this.v1=a,this.p1=[e.ChartEngine.crosshairX-this.startX,r.yAxis.flipped?this.startY-e.ChartEngine.crosshairY:e.ChartEngine.crosshairY-this.startY],this.pNodes.length>2&&(this.p1[0]==this.pNodes[this.pNodes.length-2][0]&&this.p1[0]==this.pNodes[this.pNodes.length-1][0]||this.p1[1]==this.pNodes[this.pNodes.length-2][1]&&this.p1[1]==this.pNodes[this.pNodes.length-1][1])&&(this.pNodes.length--,this.nodes.length-=2),this.nodes.push(this.p1[0],this.p1[1]),this.pNodes.push(this.p1),this.render(t),!1}},e.Drawing.freeform.prototype.intervalRatio=function(t,i,a,r,s,n){function o(t,i){return e.Market.Symbology.isForexSymbol(i)?1440:390}var l=0;return t==i?l=1:isNaN(t)||isNaN(i)?isNaN(t)?"month"==t?"week"==i?l=5:"day"==i?l=30:isNaN(i)||(l=30*o(0,n)/i):"week"==t?("month"==i&&(l=.2),"day"==i?l=5:isNaN(i)||(l=5*o(0,n)/i)):"day"==t&&("week"==i?l=.2:"month"==i?l=1/30:isNaN(i)||(l=o(0,n)/i)):isNaN(t)||("month"==i?l=t/(30*o(0,n)):"week"==i?l=t/(5*o(0,n)):"day"==i&&(l=t/o(0,n))):l=t/i,l*=a/r},e.Drawing.freeform.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,e.chart.symbol);if(0!==i){var a=this.stx.layout.candleWidth/this.candleWidth,r=e.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,e.chart);for(var s=this.stx.pixelFromTick(this.p0[0],e.chart),n=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=[],l=this.lineWidth,h=this.getLineColor(),c={pattern:this.pattern,lineWidth:l},u=0;u<this.pNodes.length;u++){var d=i*a*this.pNodes[u][0]+s,p=r*this.pNodes[u][1];e.yAxis.flipped?p=n-p:p+=n,o.push(d,p)}o.length&&(this.splineTension<0?this.stx.connectTheDots(o,h,this.name,t,e,c):this.stx.plotSpline(o,this.splineTension,h,this.name,t,!0,c))}}},e.Drawing.freeform.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t){var e=[this.nodes[0],this.nodes[1]];this.pNodes=[e],this.lowX=this.nodes[0],this.hiX=this.nodes[0],this.lowY=this.nodes[1],this.hiY=this.nodes[1];for(var i=2;i<this.nodes.length;i+=2){var a=[this.nodes[i],this.nodes[i+1]];this.pNodes.push(a),this.lowX=Math.min(this.lowX,a[0]),this.hiX=Math.max(this.hiX,a[0]),this.lowY=Math.max(this.lowY,a[1]),this.hiY=Math.min(this.hiY,a[1])}var r=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,t.chart.symbol);if(0!==r){var s=this.stx.layout.candleWidth/this.candleWidth,n=t.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,t.chart);var o=this.stx.pixelFromTick(this.p0[0],t.chart),l=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]);this.lowX=this.stx.tickFromPixel(Math.floor(r*s*this.lowX)+o,t.chart),this.hiX=this.stx.tickFromPixel(Math.ceil(r*s*this.hiX)+o,t.chart),t.yAxis.flipped?(this.lowY=this.stx.valueFromPixel(l-Math.floor(n*this.lowY),t),this.hiY=this.stx.valueFromPixel(l-Math.ceil(n*this.hiY),t)):(this.lowY=this.stx.valueFromPixel(Math.floor(n*this.lowY)+l,t),this.hiY=this.stx.valueFromPixel(Math.ceil(n*this.hiY)+l,t))}}},e.Drawing.freeform.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,cw:Number(this.candleWidth.toFixed(4)),mlt:Number(this.multiplier.toFixed(4)),d0:this.d0,tzo0:this.tzo0,v0:this.v0,inter:this.interval,pd:this.periodicity,nodes:this.nodes}},e.Drawing.freeform.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.candleWidth=e.cw,this.multiplier=e.mlt,this.d0=e.d0,this.tzo0=e.tzo0,this.v0=e.v0,this.interval=e.inter,this.periodicity=e.pd,this.nodes=e.nodes,this.adjust()},e.Drawing.callout=function(){this.name="callout",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={},this.stemEntry="",this.defaultWidth=50,this.defaultHeight=10},e.inheritsFrom(e.Drawing.callout,e.Drawing.annotation),e.Drawing.callout.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.callout.prototype.copyConfig=function(t){e.Drawing.copyConfig(this,t),this.borderColor=this.color},e.Drawing.callout.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p0=[e,i],this.render(t))},e.Drawing.callout.prototype.onChange=function(t){if(this.stx.panels[this.panelName]){var i=t.target;this.w=i.clientWidth,this.h=i.clientHeight;var a=this.context||this.stx.chart.tempCanvas.context;e.clearCanvas(a.canvas,this.stx),this.render(a),this.edit(a)}},e.Drawing.callout.prototype.render=function(t){this.context=t;var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(!isNaN(r)){t.font=this.fontString,t.textBaseline="top";var s=a,n=r,o=this.w/2,l=this.h/2;this.penDown&&(o=this.defaultWidth,(l=this.defaultHeight)||(l=this.fontSize));var h=this.lineWidth;h||(h=1.1);var c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor);var u,d,p,m,g=this.borderColor;("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor),this.highlighted&&(g=this.stx.getCanvasColor("stx_highlight_vector"));var f=Math.min(Math.min(o,l)/2,8);if(this.stem){this.stem.t?(u=this.stx.pixelFromTick(this.stem.t),p=this.stx.pixelFromValueAdjusted(i,this.stem.t,this.stem.v)):this.stem.x&&(u=s,p=n,s+=this.stem.x,n+=this.stem.y);var v="";u>=s+o?(d=s+o,v="r"):u>s-o&&u<s+o?(d=s,v="c"):u<=s-o&&(d=s-o,v="l"),p>=n+l?(m=n+l,v+="b"):p>n-l&&p<n+l?(m=n,v+="m"):p<=n-l&&(m=n-l,v+="t"),this.stemEntry=v,"cm"!=v&&(u=Math.round(u),d=Math.round(d),p=Math.round(p),m=Math.round(m))}if(this.highlighted?this.stx.canvasColor("stx_annotation_highlight_bg",t):this.fillColor?(t.fillStyle=this.fillColor,t.globalAlpha=.4):this.stem&&(t.fillStyle=this.stx.containerColor),t.strokeStyle=g,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(h,this.pattern)),t.lineDashOffset=0),g&&(t.beginPath(),t.lineWidth=h,t.moveTo(s+o-f,n-l),"rt"!=this.stemEntry?t.quadraticCurveTo(s+o,n-l,s+o,n-l+f):(t.lineTo(u,p),t.lineTo(s+o,n-l+f)),t.lineTo(s+o,n-f/2),"rm"==this.stemEntry&&t.lineTo(u,p),t.lineTo(s+o,n+f/2),t.lineTo(s+o,n+l-f),"rb"!=this.stemEntry?t.quadraticCurveTo(s+o,n+l,s+o-f,n+l):(t.lineTo(u,p),t.lineTo(s+o-f,n+l)),t.lineTo(s+f/2,n+l),"cb"==this.stemEntry&&t.lineTo(u,p),t.lineTo(s-f/2,n+l),t.lineTo(s-o+f,n+l),"lb"!=this.stemEntry?t.quadraticCurveTo(s-o,n+l,s-o,n+l-f):(t.lineTo(u,p),t.lineTo(s-o,n+l-f)),t.lineTo(s-o,n+f/2),"lm"==this.stemEntry&&t.lineTo(u,p),t.lineTo(s-o,n-f/2),t.lineTo(s-o,n-l+f),"lt"!=this.stemEntry?t.quadraticCurveTo(s-o,n-l,s-o+f,n-l):(t.lineTo(u,p),t.lineTo(s-o+f,n-l)),t.lineTo(s-f/2,n-l),"ct"==this.stemEntry&&t.lineTo(u,p),t.lineTo(s+f/2,n-l),t.lineTo(s+o-f,n-l),t.fill(),t.globalAlpha=1,"none"!=this.pattern&&t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=c,n+=this.padding,!this.ta)for(var y=0;y<this.arr.length;y++)t.fillText(this.arr[y],s-o+this.padding,n-l),n+=this.fontSize;if(t.textBaseline="alphabetic",this.highlighted&&!this.noHandles){var x="p0"==this.highlighted;this.littleCircle(t,u,p,x)}}}},e.Drawing.callout.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.penDown?(this.adjust(),this.edit(t),this.penDown=!1,!1):(this.stem={d:this.d0,v:this.v0},this.penDown=!0,this.adjust(),!1)}},e.Drawing.callout.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;e.stem?("drag"==e.action?this.stem={d:this.stx.dateFromTick(i,r.chart,!0),v:a}:"move"==e.action&&(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.stem={d:this.stx.dateFromTick(this.stx.tickFromDate(e.stem.d,r.chart)-s),v:e.stem.v-n}),this.adjust()):this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.render(t)}},e.Drawing.callout.prototype.lineIntersection=function(t,i,a,r){var s=this.stx.panels[this.panelName],n=this.stem,o=this.p0,l=this.stx;if(!o||!n||!s)return!1;var h=n.t||this.stx.tickFromDate(n.d,s.chart),c={x0:o[0],x1:h,y0:o[1],y1:n.v},u=e.convertBoxToPixels(l,this.panelName,c),d=u.x0,p=u.y0,m=u.x1,g=u.y1;"string"==typeof this.stemEntry&&(this.stemEntry.indexOf("l")>-1?d-=this.w/2:this.stemEntry.indexOf("r")>-1&&(d+=this.w/2),this.stemEntry.indexOf("t")>-1?p-=this.h/2:this.stemEntry.indexOf("b")>-1&&(p+=this.h/2));var f=e.convertBoxToPixels(l,this.panelName,a);return e.boxIntersects(f.x0,f.y0,f.x1,f.y1,d,p,m,g,r)},e.Drawing.callout.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(!this.p0)return null;if(this.pointIntersection(this.stem.t,this.stem.v,a))return this.highlighted="p0",{action:"drag",stem:!0};var s=this.stx.pixelFromTick(this.p0[0],r.chart)-this.w/2,n=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1])-this.h/2,o=s+this.w,l=n+this.h;this.stem&&this.stem.x&&(s+=this.stem.x,o+=this.stem.x,n+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,r.chart),c=this.stx.pixelFromValueAdjusted(r,t,i);return h+a.r>=s&&h-a.r<=o&&c+a.r>=n&&c-a.r<=l?(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i}):this.lineIntersection(t,i,a,"segment")?(this.highlighted=!0,{action:"move",stem:e.clone(this.stem),p0:e.clone(this.p0),tick:t,value:i}):null},e.Drawing.fibonacci=function(){this.name="fibonacci",this.configurator="fibonacci"},e.inheritsFrom(e.Drawing.fibonacci,e.Drawing.BaseTwoPoint),e.Drawing.fibonacci.mapping={trend:"t",color:"c",parameters:"p",pattern:"pt",opacity:"o",lineWidth:"lw",level:"l",extendLeft:"e",printLevels:"pl",printValues:"pv",timezone:"tz",display:"d"},e.Drawing.fibonacci.prototype.recommendedLevels=[-.618,-.382,0,.382,.5,.618,1,1.382,1.618],e.Drawing.fibonacci.prototype.configs=["color","fillColor","lineWidth","pattern","parameters"],e.Drawing.fibonacci.prototype.initializeSettings=function(t){var e=this.recommendedLevels;if(e&&!t.currentVectorParameters.fibonacci.fibsAlreadySet)for(var i=t.currentVectorParameters.fibonacci.fibs,a=0;a<i.length;a++){delete i[a].display;for(var r=0;r<e.length;r++)i[a].level==e[r]&&(i[a].display=!0)}},e.Drawing.fibonacci.prototype.setOuter=function(){var t=this.stx,i=t.panels[this.panelName];if(i){var a=Math.max(this.p0[1],this.p1[1]),r=Math.min(this.p0[1],this.p1[1]),s=a-r;this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};for(var n=t.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=t.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=t.pixelFromTick(this.p0[0],i.chart),h=t.pixelFromTick(this.p1[0],i.chart),c=0,u=1,d=0;d<this.parameters.fibs.length;d++){var p=this.parameters.fibs[d];if(!(p.level>=c&&p.level<=u)&&p.display){var m=t.pixelFromValueAdjusted(i,this.p0[0],o<n?a-s*p.level:r+s*p.level),g=e.xIntersection({x0:l,x1:h,y0:n,y1:o},m);p.level<c?(c=p.level,this.outer.p1[1]=t.valueFromPixel(m,i),this.outer.p1[0]=t.tickFromPixel(g,i.chart)):p.level>u&&(u=p.level,this.outer.p0[1]=t.valueFromPixel(m,i),this.outer.p0[0]=t.tickFromPixel(g,i.chart))}}}},e.Drawing.fibonacci.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(i,a)?this.dragToDraw:(this.setPoint(1,i,a,r.chart),this.setOuter(),this.parameters=e.clone(this.parameters),this.penDown=!1,!0):(this.setPoint(0,i,a,r.chart),this.penDown=!0,!1)},e.Drawing.fibonacci.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=Math.max(this.p0[1],this.p1[1]),s=Math.min(this.p0[1],this.p1[1]),n=a.flipped?s-r:r-s,o=this.stx.pixelFromTick(this.p0[0],i.chart),l=this.stx.pixelFromTick(this.p1[0],i.chart),h=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),c=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),u=Math.min(c,h),d=Math.max(c,h),p=d-u,m=(c-h)/(l-o)>0;this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var g=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var f=t.measureText("161.8%").width+10,v=Number.MAX_VALUE,y=Number.MAX_VALUE,x=-1*Number.MAX_VALUE,b=-1*Number.MAX_VALUE,S=this.color;("auto"==S||e.isTransparent(S))&&(S=this.stx.defaultColor),this.rays=[];for(var C=0;C<this.parameters.fibs.length;C++){t.textAlign="left",t.fillStyle=S;var w=this.parameters.fibs[C];if(w.display){var k=this.stx.pixelFromValueAdjusted(i,this.p0[0],c<h?r-n*w.level:s+n*w.level),D=e.xIntersection({x0:o,x1:l,y0:h,y1:c},k),T=this.parameters.extendLeft?0:D,M=i.left+i.width;if(this.parameters.printLevels){var A=Math.round(1e3*w.level)/10+"%";M-=f,this.parameters.printValues&&(t.fillStyle=S,this.stx.canvasFont("stx_yaxis",t)),M<T&&(t.textAlign="right"),t.fillText(A,M,k),M<T?M+=5:M-=5}if(this.parameters.printValues&&D<i.width){var _=this.stx.transformedPriceFromPixel(k,i);_=a.priceFormatter?a.priceFormatter(this.stx,i,_):this.stx.formatYAxisPrice(_,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,_,k,S,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var F=w.color;("auto"==F||e.isTransparent(F))&&(F=this.color),("auto"==F||e.isTransparent(F))&&(F=this.stx.defaultColor);var P=w.color;("auto"==P||e.isTransparent(P))&&(P=this.fillColor),("auto"==P||e.isTransparent(P))&&(P=this.stx.defaultColor),t.fillStyle=P;var I=e.clone(w.parameters);this.highlighted&&(I.opacity=1),this.stx.plotLine(T,M,k,k,this.highlighted?g:F,"segment",t,i,I),this.rays.push([[T,k],[M,k]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(M,k),t.lineTo(T,k),T?t.lineTo(l,c):t.lineTo(T,c),t.lineTo(M,c),void 0!==P&&t.fill(),t.globalAlpha=1,k<y&&(v=D,y=k),k>b&&(x=D,b=k)}}for(var L=0;L<=1;L++){var E=m?d-p*L:u+p*L;(E=Math.round(E))<y&&(v=e.xIntersection({x0:o,x1:l,y0:h,y1:c},E),y=E),E>b&&(x=e.xIntersection({x0:o,x1:l,y0:h,y1:c},E),b=E)}var N=e.clone(this.parameters.trend.parameters);if(this.highlighted&&(N.opacity=1),this.stx.plotLine(v,x,y,b,g,"segment",t,i,N),this.highlighted){var O="p0"==this.highlighted,H="p1"==this.highlighted;this.littleCircle(t,o,h,O),this.littleCircle(t,l,c,H)}}}},e.Drawing.fibonacci.prototype.reposition=function(t,i,a,r){i&&(e.Drawing.BaseTwoPoint.prototype.reposition.apply(this,arguments),this.adjust())},e.Drawing.fibonacci.prototype.intersected=function(t,i,a){var r=this.p0,s=this.p1;if(!r||!s)return null;var n={0:r,1:s};for(var o in n)if(this.pointIntersection(n[o][0],n[o][1],a))return this.highlighted="p"+o,{action:"drag",point:"p"+o};var l=this.outer,h=this.rays,c=l&&this.lineIntersection(t,i,a,"segment",l.p0,l.p1);if(!c)for(var u=0;u<h.length;u++)if(this.lineIntersection(t,i,a,"ray",h[u][0],h[u][1],!0)){c=!0;break}return c?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i}):null},e.Drawing.fibonacci.prototype.reconstruct=function(t,i){i=e.replaceFields(i,e.reverseObject(e.Drawing.fibonacci.mapping)),this.stx=t,this.parameters=i.parameters,this.parameters||(this.parameters=e.clone(this.stx.currentVectorParameters.fibonacci)),this.color=i.col,this.fillColor=i.fc,this.panelName=i.pnl,this.d0=i.d0,this.d1=i.d1,this.d2=i.d2,this.tzo0=i.tzo0,this.tzo1=i.tzo1,this.tzo2=i.tzo2,this.v0=i.v0,this.v1=i.v1,this.v2=i.v2,this.adjust()},e.Drawing.fibonacci.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setOuter())},e.Drawing.fibonacci.prototype.serialize=function(){var t={name:this.name,parameters:this.parameters,pnl:this.panelName,col:this.color,fc:this.fillColor,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2};return e.replaceFields(t,e.Drawing.fibonacci.mapping)},e.Drawing.retracement=function(){this.name="retracement"},e.inheritsFrom(e.Drawing.retracement,e.Drawing.fibonacci),e.Drawing.fibprojection=function(){this.name="fibprojection",this.dragToDraw=!1,this.p2=null},e.inheritsFrom(e.Drawing.fibprojection,e.Drawing.fibonacci),e.Drawing.fibprojection.prototype.recommendedLevels=[0,.618,1,1.272,1.618,2.618,4.236],e.Drawing.fibprojection.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(i,a)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.parameters=e.clone(this.parameters),!0):(this.setPoint(1,i,a,r.chart),this.p2=[this.p1[0],this.p1[1]],!1):(this.setPoint(0,i,a,r.chart),this.penDown=!0,!1)},e.Drawing.fibprojection.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.p1[1]-this.p0[1],s=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),o=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),l=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),h=null,c=null;this.p2&&(h=this.stx.pixelFromTick(this.p2[0],i.chart),c=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var u=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var d=t.measureText("161.8%").width+10,p=this.color;if(("auto"==p||e.isTransparent(p))&&(p=this.stx.defaultColor),this.p2){this.rays=[];for(var m=0;m<this.parameters.fibs.length;m++){t.textAlign="left",t.fillStyle=p;var g=this.parameters.fibs[m];if(g.display){var f=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]+r*g.level),v=e.xIntersection({x0:s,x1:n,y0:o,y1:l},f),y=this.parameters.extendLeft?0:s,x=i.left+i.width;if(this.parameters.printLevels){var b=Math.round(1e3*g.level)/10+"%";x-=d,this.parameters.printValues&&(t.fillStyle=p,this.stx.canvasFont("stx_yaxis",t)),x<y&&(t.textAlign="right"),t.fillText(b,x,f),x<y?x+=5:x-=5}if(this.parameters.printValues&&v<i.width){var S=this.stx.transformedPriceFromPixel(f,i);S=a.priceFormatter?a.priceFormatter(this.stx,i,S):this.stx.formatYAxisPrice(S,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,S,f,p,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var C=g.color;("auto"==C||e.isTransparent(C))&&(C=this.color),("auto"==C||e.isTransparent(C))&&(C=this.stx.defaultColor);var w=g.color;("auto"==w||e.isTransparent(w))&&(w=this.fillColor),("auto"==w||e.isTransparent(w))&&(w=this.stx.defaultColor),t.fillStyle=w;var k=e.clone(g.parameters);this.highlighted&&(k.opacity=1),this.stx.plotLine(y,x,f,f,this.highlighted?u:C,"segment",t,i,k),this.rays.push([[y,f],[x,f]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(x,f),t.lineTo(y,f),y?t.lineTo(s,c):t.lineTo(y,c),t.lineTo(x,c),void 0!==w&&t.fill(),t.globalAlpha=1}}}var D=e.clone(this.parameters.trend.parameters);if(this.highlighted&&(D.opacity=1),this.stx.plotLine(s,n,o,l,u,"segment",t,i,D),this.p2&&this.stx.plotLine(n,h,l,c,u,"segment",t,i,D),this.highlighted){var T="p0"==this.highlighted,M="p1"==this.highlighted,A="p2"==this.highlighted;this.littleCircle(t,s,o,T),this.littleCircle(t,n,l,M),this.littleCircle(t,h,c,A)}}}},e.Drawing.fibprojection.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.fibprojection.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.setPoint(1,e.p1[0]-s,e.p1[1]-n,r.chart),this.setPoint(2,e.p2[0]-s,e.p2[1]-n,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},e.Drawing.fibprojection.prototype.intersected=function(t,i,a){var r=this.p0,s=this.p1,n=this.p2;if(!r||!s||!n)return null;var o={0:r,1:s,2:n};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],a))return this.highlighted="p"+l,{action:"drag",point:"p"+l};var h=this.rays,c=this.lineIntersection(t,i,a,"segment",r,s)||this.lineIntersection(t,i,a,"segment",s,n);if(!c)for(var u=0;u<h.length;u++)if(this.lineIntersection(t,i,a,"ray",h[u][0],h[u][1],!0)){c=!0;break}return c?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),p2:e.clone(n),tick:t,value:i}):null},e.Drawing.fibprojection.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.fibarc=function(){this.name="fibarc"},e.inheritsFrom(e.Drawing.fibarc,e.Drawing.fibonacci),e.Drawing.fibarc.prototype.recommendedLevels=[.382,.5,.618,1],e.Drawing.fibarc.prototype.setOuter=function(){var t=this.stx.panels[this.panelName];if(t){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};var i=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]),a=this.stx.pixelFromValueAdjusted(t,this.p1[0],this.p1[1]),r=this.stx.pixelFromTick(this.p0[0],t.chart),s=this.stx.pixelFromTick(this.p1[0],t.chart),n=2*i-a,o=e.xIntersection({x0:r,x1:s,y0:i,y1:a},n);this.outer.p0[1]=this.stx.valueFromPixel(n,t),this.outer.p0[0]=this.stx.tickFromPixel(o,t.chart)}},e.Drawing.fibarc.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){var s=this.p0,n=this.p1,o=this.outer;if(!s||!n)return null;var l={0:s,1:n};for(var h in l)if(this.pointIntersection(l[h][0],l[h][1],a))return this.highlighted="p"+h,{action:"drag",point:"p"+h};if(this.lineIntersection(t,i,a,"segment",o.p0,o.p1))return this.highlighted=!0,{action:"move",p0:e.clone(s),p1:e.clone(n),tick:t,value:i};var c={x0:s[0],x1:n[0],y0:s[1],y1:n[1]},u=e.convertBoxToPixels(this.stx,this.panelName,c),d=Math.abs(Math.sqrt(2)*(u.x1-u.x0)),p=Math.abs(Math.sqrt(2)*(u.y1-u.y0)),m=this.stx.pixelFromTick(t,r.chart),g=this.stx.pixelFromValueAdjusted(r,t,i);return m+a.r<u.x1-d||m-a.r>u.x1+d||(g+a.r<u.y1-p||g-a.r>u.y1+p||u.y0<u.y1&&g-a.r>u.y1||u.y0>u.y1&&g+a.r<u.y1)?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i})}},e.Drawing.fibarc.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=o<n,h=Math.abs((o-n)/(s-r)),c=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var u=this.color;("auto"==u||e.isTransparent(u))&&(u=this.stx.defaultColor);for(var d=0;d<this.parameters.fibs.length;d++){t.fillStyle=u;var p=this.parameters.fibs[d];if(!(p.level<0)&&p.display){var m=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*p.level,g=this.p1[1]+m*(l?-1:1)*(a.flipped?-1:1),f=this.stx.pixelFromValueAdjusted(i,this.p0[0],g),v=e.xIntersection({x0:r,x1:s,y0:n,y1:o},f);if(this.parameters.printLevels){t.textAlign="center";var y=Math.round(1e3*p.level)/10+"%";this.parameters.printValues&&(t.fillStyle=u,this.stx.canvasFont("stx_yaxis",t)),t.fillText(y,s,Math.round(f-5))}if(t.textAlign="left",this.parameters.printValues&&v<i.width){var x=g;x=a.priceFormatter?a.priceFormatter(this.stx,i,x):this.stx.formatYAxisPrice(x,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,x,f,u,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var b=p.color;("auto"==b||e.isTransparent(b))&&(b=this.color),("auto"==b||e.isTransparent(b))&&(b=this.stx.defaultColor),t.strokeStyle=this.highlight?c:b;var S=p.color;("auto"==S||e.isTransparent(S))&&(S=this.fillColor),("auto"==S||e.isTransparent(S))&&(S=this.stx.defaultColor),t.fillStyle=S,t.globalAlpha=this.highlighted?1:p.parameters.opacity,t.lineWidth=p.parameters.lineWidth,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(t.lineWidth,p.parameters.pattern)),t.lineDashOffset=0),t.save(),t.beginPath(),t.scale(1/h,1),t.arc(s*h,o,Math.abs(f-o),0,Math.PI,!l),"none"!=this.pattern&&t.stroke(),t.globalAlpha=.05,t.fill(),t.restore(),t.setLineDash&&t.setLineDash([]),t.globalAlpha=1}}t.textAlign="left";var C=e.clone(this.parameters.trend.parameters);if(this.highlighted&&(C.opacity=1),this.stx.plotLine(s,2*r-s,o,2*n-o,c,"segment",t,i,C),this.highlighted){var w="p0"==this.highlighted,k="p1"==this.highlighted;this.littleCircle(t,r,n,w),this.littleCircle(t,s,o,k)}}}},e.Drawing.fibfan=function(){this.name="fibfan"},e.inheritsFrom(e.Drawing.fibfan,e.Drawing.fibonacci),e.Drawing.fibfan.prototype.recommendedLevels=[0,.382,.5,.618,1],e.Drawing.fibfan.prototype.setOuter=function(){},e.Drawing.fibfan.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=Math.min(o,n),h=Math.max(o,n),c=h-l,u=(o-n)/(s-r)>0,d=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var p=t.measureText("161.8%").width+10,m=Number.MAX_VALUE,g=-1*Number.MAX_VALUE,f=this.color;("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor),this.rays=[];for(var v=0;v<this.parameters.fibs.length;v++){t.fillStyle=f;var y=this.parameters.fibs[v];if(y.display){var x=this.stx.pixelFromValueAdjusted(i,this.p0[0],(this.p0[1]-this.p1[1])*y.level+this.p1[1]),b=e.xIntersection({x0:s,x1:s,y0:n,y1:o},x),S=i.left;s>r&&(S+=i.width);var C=(S-r)*(x-n)/(b-r)+n;if(!(r>S-(this.parameters.printLevels?p+5:0)&&s>r||r<S+(this.parameters.printLevels?p+5:0)&&s<r)){if(this.parameters.printLevels){var w=Math.round(1e3*y.level)/10+"%";s>r?(S-=p,t.textAlign="left"):(S+=p,t.textAlign="right"),this.parameters.printValues&&(t.fillStyle=f,this.stx.canvasFont("stx_yaxis",t)),C=(S-r)*(x-n)/(b-r)+n,t.fillText(w,S,C),s>r?S-=5:S+=5}if(t.textAlign="left",this.parameters.printValues&&b<i.width){var k=this.stx.transformedPriceFromPixel(x,i);k=a.priceFormatter?a.priceFormatter(this.stx,i,k):this.stx.formatYAxisPrice(k,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,k,x,f,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var D=y.color;("auto"==D||e.isTransparent(D))&&(D=this.color),("auto"==D||e.isTransparent(D))&&(D=this.stx.defaultColor);var T=y.color;("auto"==T||e.isTransparent(T))&&(T=this.fillColor),("auto"==T||e.isTransparent(T))&&(T=this.stx.defaultColor),t.fillStyle=T,this.parameters.printLevels&&(C=(S-r)*(x-n)/(b-r)+n);var M=e.clone(y.parameters);this.highlighted&&(M.opacity=1),this.stx.plotLine(r,S,n,C,this.highlighted?d:D,"segment",t,i,M),this.rays.push([[r,n],[S,C]]),t.globalAlpha=.05,t.beginPath(),t.moveTo(S,C),t.lineTo(r,n),t.lineTo(S,n),t.fill(),t.globalAlpha=1,x<m&&(m=x),x>g&&(g=x)}}}for(var A=0;A<=1;A++){var _=u?h-c*A:l+c*A;(_=Math.round(_))<m&&(m=_),_>g&&(g=_)}if(this.highlighted){var F="p0"==this.highlighted,P="p1"==this.highlighted;this.littleCircle(t,r,n,F),this.littleCircle(t,s,o,P)}}}},e.Drawing.fibtimezone=function(){this.name="fibtimezone"},e.inheritsFrom(e.Drawing.fibtimezone,e.Drawing.fibonacci),e.Drawing.fibtimezone.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=[1,0],l=this.getLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0],c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),t.textAlign="center";var u=a,d=i.yAxis.top,p=i.yAxis.bottom,m=0,g=this.parameters.timezone.color;("auto"==g||e.isTransparent(g))&&(g=this.color),("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor);var f=this.parameters.timezone.color;("auto"==f||e.isTransparent(f))&&(f=this.fillColor),("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor),this.parameters.printLevels&&(p-=13);var v=e.clone(this.parameters.timezone.parameters);this.highlighted&&(v.opacity=1);do{if(u=this.stx.pixelFromTick(this.p0[0]+m*h,i.chart),a<r&&u>i.left+i.width)break;if(a>r&&u<i.left)break;this.parameters.printLevels&&(t.fillStyle=c,t.fillText(r>a?m:-1*m,u,p+7)),t.fillStyle=f,this.stx.plotLine(u,u,0,p,this.highlighted?l:g,"segment",t,i,v),t.globalAlpha=.05,t.beginPath(),t.moveTo(a,d),t.lineTo(u,d),t.lineTo(u,p),t.lineTo(a,p),t.fill(),t.globalAlpha=1,m=o[0]+o[1],o.unshift(m)}while(h);if(t.textAlign="left",this.stx.plotLine(a,r,s,n,l,"segment",t,i,v),this.highlighted){var y="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,a,s,y),this.littleCircle(t,r,n,x)}else{var b=this.stx.valueFromPixel(i.height/2,i);this.setPoint(0,this.p0[0],b,i.chart),this.setPoint(1,this.p1[0],b,i.chart)}}},e.Drawing.fibtimezone.prototype.intersected=function(t,i,a){var r=this.p0,s=this.p1,n=this.stx.panels[this.panelName];if(!r||!s||!n)return null;var o={0:r,1:s};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],a))return this.highlighted="p"+l,{action:"drag",point:"p"+l};return this.lineIntersection(t,i,a,"segment")||a.x0<=this.p0[0]&&a.x1>=r[0]?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i}):null},e.Drawing.arrow_v0=function(){this.name="arrow",this.dimension=[11,11],this.points=[["M",3,0,"L",7,0,"L",7,5,"L",10,5,"L",5,10,"L",0,5,"L",3,5,"L",3,0]]},e.inheritsFrom(e.Drawing.arrow_v0,e.Drawing.shape),e.Drawing.xcross=function(){this.name="xcross",this.dimension=[7,7],this.points=[["M",1,0,"L",3,2,"L",5,0,"L",6,1,"L",4,3,"L",6,5,"L",5,6,"L",3,4,"L",1,6,"L",0,5,"L",2,3,"L",0,1,"L",1,0]]},e.inheritsFrom(e.Drawing.xcross,e.Drawing.shape),e.Drawing.check=function(){this.name="check",this.dimension=[8,9],this.points=[["M",1,5,"L",0,6,"L",2,8,"L",7,1,"L",6,0,"L",2,6,"L",1,5]]},e.inheritsFrom(e.Drawing.check,e.Drawing.shape),e.Drawing.star=function(){this.name="star",this.dimension=[12,12],this.points=[["M",0,4,"L",4,4,"L",5.5,0,"L",7,4,"L",11,4,"L",8,7,"L",9,11,"L",5.5,9,"L",2,11,"L",3,7,"L",0,4]]},e.inheritsFrom(e.Drawing.star,e.Drawing.shape),e.Drawing.heart=function(){this.name="heart",this.dimension=[23,20],this.points=[["M",11,3,"B",11,2.4,10,0,6,0,"B",0,0,0,7.5,0,7.5,"B",0,11,4,15.4,11,19,"B",18,15.4,22,11,22,7.5,"B",22,7.5,22,0,16,0,"B",13,0,11,2.4,11,3]]},e.inheritsFrom(e.Drawing.heart,e.Drawing.shape),e.Drawing.focusarrow=function(){this.name="focusarrow",this.dimension=[7,5],this.points=[["M",0,0,"L",2,2,"L",0,4,"L",0,0],["M",6,0,"L",4,2,"L",6,4,"L",6,0]]},e.inheritsFrom(e.Drawing.focusarrow,e.Drawing.shape),e.Drawing.crossline=function(){this.name="crossline"},e.inheritsFrom(e.Drawing.crossline,e.Drawing.horizontal),e.extend(e.Drawing.crossline.prototype,{measure:function(){},accidentalClick:function(t,e){return!1},adjust:function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=e.clone(this.p0))},intersected:function(t,i,a){if(!this.p0||!this.p1)return null;this.p1[0]+=1;var r=this.lineIntersection(t,i,a,"line");return this.p1=e.clone(this.p0),r||(this.p1[1]+=1,r=this.lineIntersection(t,i,a,"line"),this.p1=e.clone(this.p0),r)?(this.highlighted=!0,this.pointIntersection(this.p0[0],this.p0[1],a)&&(this.highlighted="p0"),{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},render:function(t){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.pixelFromTick(this.p0[0],a.chart),s=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),n=this.getLineColor(),o={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(r,r+100,s,s,n,"horizontal",t,a,o),this.stx.plotLine(r,r,s,s+100,n,"vertical",t,a,o),this.axisLabel&&!this.repositioner){this.stx.endClip();var l=this.p0[1];if(a.chart.transformFunc&&(l=a.chart.transformFunc(this.stx,a.chart,l)),l=a.yAxis.priceFormatter?a.yAxis.priceFormatter(this.stx,a,l):this.stx.formatYAxisPrice(l,a),this.stx.createYAxisLabel(a,l,s,n),this.stx.startClip(a.name),this.p0[0]>=0&&!this.stx.chart.xAxis.noDraw){var h,c;if(h=this.stx.dateFromTick(this.p0[0],a.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))h.setHours(0,0,0,0);else{var u=1e3*h.getSeconds()+h.getMilliseconds();i.Date&&this.stx.displayZone&&(c=new i.Date(h.getTime(),this.stx.displayZone),h=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes()),h=new Date(h.getTime()+u))}var d=e.mmddhhmm(e.yyyymmddhhmm(h));if(a.chart.xAxis.formatter)d=a.chart.xAxis.formatter(h,this.name,null,null,d);else if(this.stx.internationalizer){var p;0!==h.getHours()||0!==h.getMinutes()?(p=this.stx.internationalizer.monthDay.format(h),p+=" "+this.stx.internationalizer.hourMinute.format(h)):p=this.stx.internationalizer.yearMonthDay.format(h),d=p}this.stx.endClip(),this.stx.createXAxisLabel({panel:a,txt:d,x:r,backgroundColor:n,color:null,pointed:!0,padding:2}),this.stx.startClip(a.name)}}if(this.highlighted){var m="p0"==this.highlighted;this.littleCircle(t,r,s,m)}}}},!0),e.Drawing.speedarc=function(){this.name="speedarc",this.printLevels=!0},e.inheritsFrom(e.Drawing.speedarc,e.Drawing.segment),e.extend(e.Drawing.speedarc.prototype,{defaultOpacity:.25,configs:["color","fillColor","lineWidth","pattern"],copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},intersected:function(t,i,a){if(!this.p0||!this.p1)return null;var r={0:this.p0,1:this.p1};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};if(this.lineIntersection(t,i,a,this.name))return this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i};var n=this.p1[0]-(this.p0[0]-this.p1[0]),o=this.p0[0],l=this.p1[1],h=this.p0[1];return t>Math.max(n,o)||t<Math.min(n,o)||i>Math.max(h,l)||i<Math.min(h,l)?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i})},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=n<s,l=Math.abs((n-s)/(r-a)),h=this.getLineColor();t.strokeStyle=h;var c=this.fillColor;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),t.fillStyle=c,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(this.lineWidth,this.pattern)),t.lineDashOffset=0),this.stx.canvasFont("stx_yaxis",t);for(var u=1;u<3;u++){var d=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*u/3,p=this.p1[1]+d*(o?-1:1)*(i.yAxis.flipped?-1:1),m=this.stx.pixelFromValueAdjusted(i,this.p0[0],p);if(t.save(),t.beginPath(),t.scale(1/l,1),t.arc(r*l,n,Math.abs(m-n),0,Math.PI,!o),t.globalAlpha=this.highlighted?1:this.defaultOpacity,"none"!=this.pattern&&t.stroke(),t.globalAlpha=.1,t.fill(),t.restore(),t.globalAlpha=1,this.printLevels){t.fillStyle=h,t.textAlign="center";var g=u+"/3";t.fillText(g,r,Math.round(m-5)),t.fillStyle=c}}t.textAlign="left";var f={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity};if(this.stx.plotLine(a,r,s,n,h,"segment",t,i,f),t.setLineDash&&t.setLineDash([]),this.highlighted){var v="p0"==this.highlighted,y="p1"==this.highlighted;this.littleCircle(t,a,s,v),this.littleCircle(t,r,n,y)}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}}},!0),e.Drawing.speedline=function(){this.name="speedline",this.printLevels=!0},e.inheritsFrom(e.Drawing.speedline,e.Drawing.speedarc),e.extend(e.Drawing.speedline.prototype,{intersected:function(t,i,a){var r=this.p0,s=this.p1;if(!r||!s)return null;var n={0:r,1:s};for(var o in n)if(this.pointIntersection(n[o][0],n[o][1],a))return this.highlighted="p"+o,{action:"drag",point:"p"+o};for(var l=this.rays,h=0;h<l.length;h++)if(this.lineIntersection(t,i,a,"ray",l[h][0],l[h][1],!0))return this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i};return null},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.getLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;var c,u,d={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},p=["1","2/3","1/3","3/2","3"],m=[1,2/3,1/3,1.5,3],g=[];this.rays=[];for(var f=0;f<m.length;f++){var v=m[f];if(!(v>1)||this.extension){var y,x=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]-(this.p0[1]-this.p1[1])*v);v>1?(y=e.xIntersection({x0:a,x1:r,y0:s,y1:x},n),g.push(y)):(y=e.xIntersection({x0:r,x1:r,y0:s,y1:n},x),g.push(x));var b=v>1?y:r,S=v>1?n:x;if(this.confineToGrid||(b=i.left,r>a&&(b+=i.width),S=(b-a)*(x-s)/(r-a)+s),this.printLevels&&(1!=v||this.extension)){t.fillStyle=l;var C=0,w=0;s>n?(w=-5,t.textBaseline="bottom"):(w=5,t.textBaseline="top"),a>r?(C=5,t.textAlign="right"):(C=-5,t.textAlign="left"),v>1?t.fillText(p[f],y+(this.confineToGrid?0:C),n):t.fillText(p[f],r,x+(this.confineToGrid?0:w)),t.fillStyle=h}this.stx.plotLine(a,b,s,S,this.highlighted?o:l,"segment",t,i,d),1==v&&(c=b,u=S),this.rays.push([[a,s],[b,S]]),t.globalAlpha=.1,t.beginPath(),t.moveTo(b,S),t.lineTo(a,s),t.lineTo(c,u),t.fill(),t.globalAlpha=1}}if(t.textAlign="left",t.textBaseline="middle",this.confineToGrid&&(t.globalAlpha=.3,t.beginPath(),t.strokeRect(a,s,r-a,n-s),t.moveTo(a,g[1]),t.lineTo(r,g[1]),t.moveTo(a,g[2]),t.lineTo(r,g[2]),this.extension&&(t.moveTo(g[3],s),t.lineTo(g[3],n),t.moveTo(g[4],s),t.lineTo(g[4],n)),t.stroke(),t.globalAlpha=1),this.highlighted){var k="p0"==this.highlighted,D="p1"==this.highlighted;this.littleCircle(t,a,s,k),this.littleCircle(t,r,n,D)}}}},!0),e.Drawing.gannfan=function(){this.name="gannfan",this.printLevels=!0},e.inheritsFrom(e.Drawing.gannfan,e.Drawing.speedline),e.extend(e.Drawing.gannfan.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.getLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;var c,u,d={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},p=[1,2,3,4,8,.5,1/3,1/4,1/8];this.rays=[];for(var m=0;m<p.length;m++){var g=p[m],f=a+(r-a)/g,v=s-g*(s-n),y=i.left;r>a&&(y+=i.width);var x=(y-a)*(v-s)/(r-a)+s;if(this.printLevels){t.fillStyle=l;var b=0,S=0;s>n?(S=5,t.textBaseline="top"):(S=-5,t.textBaseline="bottom"),a>r?(b=5,t.textAlign="left"):(b=-5,t.textAlign="right"),g>1?t.fillText(g+"x1",f+b,n):t.fillText("1x"+1/g,r,v+S),t.fillStyle=h}this.stx.plotLine(a,y,s,x,this.highlighted?o:l,"segment",t,i,d),this.rays.push([[a,s],[y,x]]),1==g&&(c=y,u=x),t.globalAlpha=.1,t.beginPath(),t.moveTo(y,x),t.lineTo(a,s),t.lineTo(c,u),t.fill(),t.globalAlpha=1}if(t.textAlign="left",t.textBaseline="middle",this.highlighted){var C="p0"==this.highlighted,w="p1"==this.highlighted;this.littleCircle(t,a,s,C),this.littleCircle(t,r,n,w)}}}},!0),e.Drawing.timecycle=function(){this.name="timecycle",this.printLevels=!0},e.inheritsFrom(e.Drawing.timecycle,e.Drawing.speedarc),e.extend(e.Drawing.timecycle.prototype,{intersected:function(t,i,a){var r=this.p0,s=this.p1,n=this.stx.panels[this.panelName];if(!r||!s||!n)return null;var o={0:r,1:s};for(var l in o)if(this.pointIntersection(o[l][0],o[l][1],a))return this.highlighted="p"+l,{action:"drag",point:"p"+l};return this.lineIntersection(t,i,a,"segment")||a.x0<=this.p0[0]&&a.x1>=r[0]?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(s),tick:t,value:i}):null},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=0,l=this.getLineColor();t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0];t.textAlign="center";var c=a,u=i.yAxis.top,d=i.yAxis.bottom,p=this.color;("auto"==p||e.isTransparent(p))&&(p=this.stx.defaultColor);var m=this.fillColor;("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.printLevels&&(d-=13);var g={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.highlighted?1:this.defaultOpacity},f=[];t.save(),t.fillStyle=m,t.globalAlpha=.05;do{if(c=this.stx.pixelFromTick(this.p0[0]+o*h,i.chart),o++,a<r&&c>i.left+i.width)break;if(a>r&&c<i.left)break;c<i.left||c>i.left+i.width||(t.beginPath(),t.moveTo(a,u),t.lineTo(c,u),t.lineTo(c,d),t.lineTo(a,d),t.fill(),f.push({c:o,x:c}))}while(h);t.globalAlpha=1;for(var v=0,y=0;y<f.length;y++){if(this.stx.plotLine(f[y].x,f[y].x,0,d,this.highlighted?l:p,"segment",t,i,g),this.printLevels)t.fillStyle=p,this.stx.chart.context.measureText(f[y].c).width+3<this.stx.layout.candleWidth+v?(t.fillText(f[y].c,f[y].x,d+7),v=0):v+=this.stx.layout.candleWidth}if(t.restore(),t.textAlign="left",this.stx.plotLine(a,r,s,n,l,"segment",t,i,g),this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted;this.littleCircle(t,a,s,x),this.littleCircle(t,r,n,b)}else{var S=this.stx.valueFromPixel(i.height/2,i);this.setPoint(0,this.p0[0],S,i.chart),this.setPoint(1,this.p1[0],S,i.chart)}}}},!0),e.Drawing.regression=function(){this.name="regression"},e.inheritsFrom(e.Drawing.regression,e.Drawing.segment),e.extend(e.Drawing.regression.prototype,{configs:["color","lineWidth","pattern","active1","color1","lineWidth1","pattern1","active2","color2","lineWidth2","pattern2","active3","color3","lineWidth3","pattern3"],copyConfig:function(t){e.Drawing.copyConfig(this,t);var i=this.stx.currentVectorParameters;this.active1=!!i.active1,this.active2=!!i.active2,this.active3=!!i.active3,this.color1=i.color1||"auto",this.color2=i.color2||"auto",this.color3=i.color3||"auto",this.lineWidth1=i.lineWidth1,this.lineWidth2=i.lineWidth2,this.lineWidth3=i.lineWidth3,this.pattern1=i.pattern1,this.pattern2=i.pattern2,this.pattern3=i.pattern3},$controls:['cq-cvp-controller[cq-cvp-header="1"]','cq-cvp-controller[cq-cvp-header="2"]','cq-cvp-controller[cq-cvp-header="3"]'],click:function(t,e,i){if(!(e<0)){this.copyConfig();var a=this.stx.panels[this.panelName];if(!this.penDown){this.setPoint(0,e,i,a.chart),this.penDown=!0;var r=this.stx;if(this.field=r.highlightedDataSetField,!this.field&&a!=r.chart.panel){for(var s in r.chart.seriesRenderers){var n=r.chart.seriesRenderers[s];if(n.params.panel==a.name){this.field=n.seriesParams[0].field;break}}for(var o in r.layout.studies){var l=r.layout.studies[o];if(l.panel==a.name){this.field=Object.keys(l.outputMap)[0];break}}}return!1}return this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.penDown=!1,!0)}},getYValue:function(t){var i=this.stx.chart.dataSet[t],a=this.stx.chart.dataSet[t];if(!i)return null;var r=this.stx.panels[this.panelName],s=this.stx.getYAxisByField(r,this.field)||r.yAxis;if(this.stx.charts[r.name]&&r.chart.transformFunc&&s==r.yAxis&&(a=i.transform),!a)return null;var n=null,o=null,l=this.stx.defaultPlotField||"Close";if(this.field){if(!(o=e.existsInObjectChain(a,this.field)))return null;n=o=o.obj[o.member],i!=a&&(n=(n=e.existsInObjectChain(i,this.field)).obj[n.member]),"object"==typeof o&&(o=o[l],n=n[l])}else o=a[l],n=i[l];return{transformed:o,untransformed:n}},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){for(var r=this.stx.getYAxisByField(e,this.field),s=[],n=[],o=0,l=0,h=0,c=0,u=Math.min(this.p1[0],this.p0[0]),d=Math.max(this.p1[0],this.p0[0])+1,p=d-u,m=u;m<d;m++){var g=this.getYValue(m);g&&(s.push(g.transformed),n.push(g.untransformed))}var f=s.length,v=f*(f+1)/2,y=Math.pow(v,2),x=v*(2*f+1)/3;for(m=0;m<f;m++)h+=f*s[m]-o,o+=s[m],c+=f*n[m]-l,l+=n[m];var b,S,C=(f*h-v*o)/(f*x-y),w=(o-C*v)/f,k=(f*c-v*l)/(f*x-y),D=(l-C*v)/f;this.p0[0]<this.p1[0]?(b=w,S=C*p+w,this.p0[1]=D,this.p1[1]=k*p+D):(b=C*p+w,S=w,this.p0[1]=k*p+D,this.p1[1]=D);var T=this.stx.pixelFromTransformedValue(b,e,r),M=this.stx.pixelFromTransformedValue(S,e,r),A=this.getLineColor(),_={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,a,T,M,A,"segment",t,e,_),this.stx.plotLine(i,i,T-20,T+20,A,"segment",t,e,_),this.stx.plotLine(a,a,M-20,M+20,A,"segment",t,e,_),this.active1||this.active2||this.active3){var F=o/f,P=0;for(m=0;m<f;m++)P+=Math.pow(s[m]-F,2);var I={context:t,panel:e,points:{0:{x:i,v:b},1:{x:a,v:S}},stddev:Math.sqrt(P/f),yAxis:r};this.lines={},this.active1&&(this.renderStddev("1","p",I),this.renderStddev("1","n",I)),this.active2&&(this.renderStddev("2","p",I),this.renderStddev("2","n",I)),this.active3&&(this.renderStddev("3","p",I),this.renderStddev("3","n",I))}if(this.highlighted){var L="p0"==this.highlighted,E="p1"==this.highlighted;this.littleCircle(t,i,T,L),this.littleCircle(t,a,M,E)}else this.pixelX=[i,a],this.pixelY=[T,M]}}},renderStddev:function(t,e,i){var a="stddev"+t+e,r="color"+t,s="pattern"+t,n="lineWidth"+t,o=i.points,l=o[0].v,h=o[1].v,c=i.stddev,u="n"===e?-1*t:1*t,d=this.stx,p=i.panel,m=i.yAxis,g={name:a,color:this.getLineColor(this[r]),type:"segment",y0:d.pixelFromTransformedValue(l+c*u,p,m),y1:d.pixelFromTransformedValue(h+c*u,p,m),params:{pattern:this[s],lineWidth:this[n]}};this.lines&&(this.lines[a]=g);var f=i.context,v=o[0].x,y=o[1].x;d.plotLine(v,y,g.y0,g.y1,g.color,g.type,f,p,g.params),d.plotLine(v,v,g.y0-10,g.y0+10,g.color,g.type,f,p,g.params),d.plotLine(y,y,g.y1-10,g.y1+10,g.color,g.type,f,p,g.params);var x=t+"σ",b=Math.max(v,y)+5,S=v<y?g.y1:g.y0;if(f.fillStyle=g.color,f.save(),f.textBaseline="middle",f.fillText(x,b,S),f.restore(),i.formatPrice&&this.axisLabel&&!this.highlighted&&!this.penDown&&(v>=p.chart.left&&v<=p.chart.right||y>=p.chart.left&&y<=p.chart.right)){var C=(v<y?h:l)+c*u;d.endClip(),d.createYAxisLabel(p,i.formatPrice(C,m),S,g.color,null,f,m),d.startClip(p.name)}},intersected:function(t,i,a){if(!this.pixelX||!this.pixelY)return null;var r=this.repositionIntersection(t,i);if(r)return r;for(var s={0:this.pixelX,1:this.pixelY},n=0;n<2;n++)if(this.pointIntersection(s[0][n],s[1][n],a,!0))return this.highlighted="p"+n,{action:"drag",point:"p"+n};var o=this,l=this.pixelX[0],h=this.pixelX[1],c=function(e){var r=[l,e.y0],s=[h,e.y1];return o.lineIntersection(t,i,a,o.name,r,s,!0)},u=c({y0:this.pixelY[0],y1:this.pixelY[1]});if(!u&&this.lines)for(var d in this.lines)if(c(this.lines[d])){u=!0;break}return u?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},repositionIntersection:function(t,i){return!(!this.p0||!this.p1)&&(!(this!=this.stx.repositioningDrawing||!this.highlighted)&&(!0===this.highlighted?{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}:{action:"drag",point:this.highlighted}))},lineIntersection:function(t,i,a,r,s,n,o){if(!o)return console.log(r+" lineIntersection must accept p0 and p1 in pixels.  Please verify and set isPixels=true."),!1;if(s||(s=this.p0),n||(n=this.p1),!s||!n)return!1;var l=this.stx,h=e.convertBoxToPixels(l,this.panelName,a);if(void 0===h.x0)return!1;var c={x0:s[0],x1:n[0],y0:s[1],y1:n[1]};return e.boxIntersects(h.x0,h.y0,h.x1,h.y1,c.x0,c.y0,c.x1,c.y1)},boxIntersection:function(t,e,i){return!(i.cx0>Math.max(this.pixelX[0],this.pixelX[1])||i.cx1<Math.min(this.pixelX[0],this.pixelX[1]))&&!(!this.stx.repositioningDrawing&&(i.cy1<this.pixelY[0]||i.cy0>this.pixelY[1]))},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.color1=e.col1,this.color2=e.col2,this.color3=e.col3,this.active1=e.dev1,this.active2=e.dev2,this.active3=e.dev3,this.panelName=e.pnl,this.pattern=e.ptrn,this.pattern1=e.ptrn1,this.pattern2=e.ptrn2,this.pattern3=e.ptrn3,this.lineWidth=e.lw,this.lineWidth1=e.lw1,this.lineWidth2=e.lw2,this.lineWidth3=e.lw3,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.field=e.fld,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,dev1:this.active1,dev2:this.active2,dev3:this.active3,col:this.color,col1:this.color1,col2:this.color2,col3:this.color3,ptrn:this.pattern,ptrn1:this.pattern1,ptrn2:this.pattern2,ptrn3:this.pattern3,lw:this.lineWidth,lw1:this.lineWidth1,lw2:this.lineWidth2,lw3:this.lineWidth3,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,fld:this.field}}},!0),e.Drawing.trendline=function(){this.name="trendline"},e.inheritsFrom(e.Drawing.trendline,e.Drawing.segment),e.Drawing.trendline.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.trendline.prototype.measure=function(){},e.Drawing.trendline.prototype.reconstruct=function(t,i){e.Drawing.segment.prototype.reconstruct.call(this,t,i),this.callout=new e.Drawing.callout,this.callout.reconstruct(t,i.callout)},e.Drawing.trendline.prototype.serialize=function(){var t=e.Drawing.segment.prototype.serialize.call(this);return t.callout=this.callout.serialize(),t},e.Drawing.trendline.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){if(e.Drawing.segment.prototype.render.call(this,t),!this.callout){this.callout=new e.Drawing.callout;var a=e.Drawing.segment.prototype.serialize.call(this);this.callout.reconstruct(this.stx,a)}this.callout.p0=e.clone(this.p0);var r=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(isFinite(n)&&isFinite(o)){var l=(r+s)/2,h=(n+o)/2;this.fontSize=e.stripPX(this.font&&this.font.size||13);var c=1.2*this.callout.w+("c"==this.callout.stemEntry[0]?0:50),u=c/(Math.sqrt(Math.pow(s-r,2)+Math.pow(o-n,2))||c)*(this.p1[1]<this.p0[1]?1:-1),d=-(o-h)*u+l,p=(s-l)*u+h;this.callout.p0[0]=this.stx.tickFromPixel(d,i.chart),this.callout.p0[1]=this.stx.priceFromPixel(p,i),this.callout.v0=this.callout.p0[1],this.callout.p1=e.clone(this.p0),this.callout.stx=this.stx,this.callout.fillColor=this.fillColor||this.callout.fillColor,this.callout.borderColor=this.color,this.callout.font=this.font||this.callout.font,this.callout.noHandles=!0;var m=this.p1[1]-this.p0[1];this.callout.text=Number(m).toFixed(2)+(0===this.p0[1]?"":" ("+Number(100*m/this.p0[1]).toFixed(2)+"%) ")+Math.abs(this.p1[0]-this.p0[0])+" Bars";var g,f=Math.floor((this.p0[0]+this.p1[0])/2);if(Math.abs(this.p0[0]-this.p1[0])>1&&Math.abs(this.p0[0]-this.p1[0])<20){var v=n+(o-n)/(s-r)*(this.stx.pixelFromTick(f,i.chart)-r);g=this.stx.priceFromPixel(v,i)||h}else g=this.stx.priceFromPixel(h,i);if(this.callout.stem={t:f,v:g},this.callout.renderText(),this.callout.render(t),this.highlighted){var y="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,r,n,y),this.littleCircle(t,s,o,x)}}}},e.Drawing.trendline.prototype.lineIntersection=function(t,i,a,r){return e.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,i,a,"segment")},e.Drawing.trendline.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r=this.callout.intersected(t,i,a),s=e.Drawing.segment.prototype.intersected.call(this,t,i,a);return this.callout.highlighted=!(!r&&!s),s||(r?{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}:null)},e.Drawing.average=function(){this.name="average"},e.inheritsFrom(e.Drawing.average,e.Drawing.regression),e.extend(e.Drawing.average.prototype,{configs:e.Drawing.regression.prototype.configs.concat("axisLabel"),measure:function(){if(this.p0&&this.p1){this.stx.setMeasure(0,!1,this.p0[0],this.p1[0],!0,this.name);var t=[],i="";this.active1&&t.push("1"),this.active2&&t.push("2"),this.active3&&t.push("3"),t.length&&(i="&ensp;"+t.join(", ")+" &sigma;");var a=(this.stx.drawingContainer||document).querySelector(".mMeasure"),r=this.stx.controls.mSticky,s=r&&r.querySelector(".mStickyInterior");if(a&&(a.innerHTML+=i),s){var n=[];n.push(e.capitalize(this.name)),n.push(this.field||this.stx.defaultPlotField||"Close"),n.push(s.innerHTML+i),s.innerHTML=n.join("<br>")}}},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){var r,s,n=this.stx.getYAxisByField(e,this.field),o=this.stx,l=Math.min(this.p1[0],this.p0[0]),h=Math.max(this.p1[0],this.p0[0])+1,c=0,u=[];for(r=l;r<h;r++)null!==(s=this.getYValue(r))&&(c+=s.transformed,u.push(s));var d=u.length;if(d){var p=c/d,m=o.pixelFromTransformedValue(p,e,n),g=this.getLineColor(),f={pattern:this.pattern,lineWidth:this.lineWidth};if(o.plotLine(i,a,m,m,g,"segment",t,e,f),o.plotLine(i,i,m-20,m+20,g,"segment",t,e,f),o.plotLine(a,a,m-20,m+20,g,"segment",t,e,f),!this.axisLabel||this.highlighted||this.penDown||(i>=e.chart.left&&i<=e.chart.right||a>=e.chart.left&&a<=e.chart.right)&&(o.endClip(),o.createYAxisLabel(e,C(p,n),m,g,null,t,n),o.startClip(e.name)),this.active1||this.active2||this.active3){var v=0;for(r=0;r<d;r++)s=u[r],v+=Math.pow(s.transformed-p,2);var y=Math.sqrt(v/d),x={context:t,formatPrice:C,panel:e,points:{0:{x:i,v:p},1:{x:a,v:p}},stddev:y,yAxis:n};this.lines={},this.active1&&(this.renderStddev("1","p",x),this.renderStddev("1","n",x)),this.active2&&(this.renderStddev("2","p",x),this.renderStddev("2","n",x)),this.active3&&(this.renderStddev("3","p",x),this.renderStddev("3","n",x))}if(this.highlighted){var b="p0"==this.highlighted,S="p1"==this.highlighted;this.littleCircle(t,i,m,b),this.littleCircle(t,a,m,S)}else this.pixelX=[i,a],this.pixelY=[m,m]}}}function C(t,i){return t=i&&i.priceFormatter?i.priceFormatter(o,e,t):o.formatYAxisPrice(t,e,null,i)}},reconstruct:function(t,i){this.axisLabel=i.al,e.Drawing.regression.prototype.reconstruct.call(this,t,i)},serialize:function(){var t=e.Drawing.regression.prototype.serialize.call(this);return t.al=this.axisLabel,t}},!0),e.Drawing.quadrant=function(){this.name="quadrant"},e.inheritsFrom(e.Drawing.quadrant,e.Drawing.regression),e.extend(e.Drawing.quadrant.prototype,{configs:["color","fillColor","lineWidth","pattern"],copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},$controls:[],render:function(t){var i=this.stx,a=i.panels[this.panelName];if(a&&this.p1){var r=i.pixelFromTick(this.p0[0],a.chart),s=i.pixelFromTick(this.p1[0],a.chart);if(!(r<a.left&&s<a.left||r>a.right&&s>a.right)){for(var n=this.stx.getYAxisByField(a,this.field),o=null,l=null,h=Math.min(this.p1[0],this.p0[0]);h<=Math.max(this.p1[0],this.p0[0]);h++){var c=this.getYValue(h);null!==c&&((null===o||c.transformed>o)&&(o=c.transformed),(null===l||c.transformed<l)&&(l=c.transformed))}var u=i.pixelFromTransformedValue(o,a,n),d=i.pixelFromTransformedValue((3*o+l)/4,a,n),p=i.pixelFromTransformedValue((2*o+l)/3,a,n),m=i.pixelFromTransformedValue((o+l)/2,a,n),g=i.pixelFromTransformedValue((o+2*l)/3,a,n),f=i.pixelFromTransformedValue((o+3*l)/4,a,n),v=i.pixelFromTransformedValue(l,a,n);this.p0[1]=0,this.p1[1]=!1;var y=this.getLineColor(),x=this.fillColor;("auto"==x||e.isTransparent(x))&&(x=i.defaultColor),t.fillStyle=x;var b={pattern:this.pattern,lineWidth:this.lineWidth};if(i.plotLine(r,s,u,u,y,"segment",t,a,b),i.plotLine(r,s,v,v,y,"segment",t,a,b),"quadrant"==this.name?(i.plotLine(r,s,d,d,y,"segment",t,a,b),i.plotLine(r,s,f,f,y,"segment",t,a,b)):"tirone"==this.name&&(i.plotLine(r,s,p,p,y,"segment",t,a,b),i.plotLine(r,s,g,g,y,"segment",t,a,b)),i.plotLine(r,r,u,v,y,"segment",t,a,b),i.plotLine(s,s,u,v,y,"segment",t,a,b),i.plotLine(r,s,m,m,y,"segment",t,a,e.extend(b,{opacity:"tirone"==this.name?.2:1})),t.globalAlpha=.1,t.beginPath(),t.fillRect(r,u,s-r,v-u),"quadrant"==this.name?t.fillRect(r,d,s-r,f-d):"tirone"==this.name&&t.fillRect(r,p,s-r,g-p),t.globalAlpha=1,this.highlighted){var S="p0"==this.highlighted,C="p1"==this.highlighted;this.littleCircle(t,r,m,S),this.littleCircle(t,s,m,C)}else this.pixelX=[r,s],this.pixelY=[u,v,m],"quadrant"===this.name&&this.pixelY.push(d,f),"tirone"===this.name&&this.pixelY.push(p,g)}}},intersected:function(t,i,a){const{pixelX:r,pixelY:s}=this;if(!r||!s)return null;const n=this.repositionIntersection(t,i);if(n)return n;for(let t=0;t<2;t++)if(this.pointIntersection(r[t],s[2],a,!0))return this.highlighted="p"+t,{action:"drag",point:"p"+t};const o=[];r.forEach((t=>{o.push({p0:[t,s[0]],p1:[t,s[1]]})})),s.forEach((t=>{o.push({p0:[r[0],t],p1:[r[1],t]})}));return o.some((e=>{let{p0:r,p1:s}=e;return this.lineIntersection(t,i,a,this.name,r,s,!0)}))?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.field=e.fld,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,fld:this.field}}},!0),e.Drawing.tirone=function(){this.name="tirone"},e.inheritsFrom(e.Drawing.tirone,e.Drawing.quadrant),e.Drawing.elliottwave=function(){this.name="elliottwave",this.lastPoint=0,this.points=[],this.pts=[],this.dx=0,this.dy=-20,this.dragToDraw=!1,this.annotationPoints=[],this.edit=null},e.inheritsFrom(e.Drawing.elliottwave,e.Drawing.annotation),e.Drawing.elliottwave.defaultTemplate={impulse:["I","II","III","IV","V"],corrective:["A","B","C"],decoration:"enclosed",showLines:!0},e.Drawing.elliottwave.prototype.initializeSettings=function(t){t.currentVectorParameters.waveParameters=e.clone(e.Drawing.elliottwave.defaultTemplate)},e.Drawing.elliottwave.prototype.configs=["color","lineWidth","lineColor","pattern","font","waveParameters"],e.Drawing.elliottwave.prototype.$controls=["br[cq-wave-parameters]","cq-wave-parameters"],e.Drawing.elliottwave.prototype.construct=function(t,e){this.stx=t,this.panelName=e.name;var i=t.currentVectorParameters;Object.assign(this,i.waveParameters)},e.Drawing.elliottwave.prototype.serialize=function(){for(var t={},i=0;i<this.points.length;i++)t["d"+i]=this["d"+i],t["tzo"+i]=this["tzo"+i],t["v"+i]=this["v"+i];return t.annotations=this.annotationPoints.join(","),Object.assign({name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,mxSeg:this.maxSegments,show:this.showLines,decor:this.decoration,dx:this.dx,dy:this.dy,trend:this.trend,fnt:e.removeNullValues(e.replaceFields(this.font,{style:"st",size:"sz",weight:"wt",family:"fl"}))},t)},e.Drawing.elliottwave.prototype.reconstruct=function(t,i){this.stx=t,this.color=i.col,this.panelName=i.pnl,this.pattern=i.ptrn,this.lineWidth=i.lw,this.font=e.replaceFields(i.fnt,{st:"style",sz:"size",wt:"weight",fl:"family"}),this.decoration=i.decor,this.showLines=i.show,this.dx=i.dx,this.dy=i.dy,this.trend=i.trend,this.annotationPoints=i.annotations.split(","),"enclosed"===i.decor&&this.calculateRadius(t.chart.tempCanvas.context),this.maxSegments=i.mxSeg,this.reconstructPoints(i),this.adjust()},e.Drawing.elliottwave.prototype.reconstructPoints=function(t){var i=this.stx.panels[this.panelName];if(i)for(var a=0;a<this.annotationPoints.length;a++){this["d"+a]=t["d"+a],this["v"+a]=t["v"+a],this["tzo"+a]=t["tzo"+a];var r=e.strToDateTime(t["d"+a]),s=this.stx.tickFromDate(r,i.chart);this.points.push([s,t["v"+a]])}},e.Drawing.elliottwave.prototype.calculateRadius=function(t){this.getFontString(),t.font=this.fontString;for(var e=0,i=0;i<this.annotationPoints.length;i++){var a=t.measureText(this.annotationPoints[i]).width;e<a&&(e=a)}this.enclosedRadius=e},e.Drawing.elliottwave.prototype.check=function(t,e,i){if(1===i&&2===this.points.length)return!0;var a=this.points[i-1];if(a&&t<=a[0])return!1;var r=this.points[i+1];return!(r&&t>=r[0])&&!!function(t){for(var e=2;e<t.length;e++)if(Math.sign(t[e][1]-t[e-1][1])==Math.sign(t[e-1][1]-t[e-2][1]))return!1;return!0}(this.points)},e.Drawing.elliottwave.prototype.move=function(t,e,i){this.copyConfig(),this.points[this.lastPoint+1]=[e,i],this.render(t)},e.Drawing.elliottwave.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t)for(var i=0;this.maxSegments+1>i;i++){var a=this["d"+i];this.setPoint(i,a,this["v"+i],t.chart),this.points[i][0]=this.stx.tickFromDate(e.strToDateTime(a),t.chart),this.points[i][1]=this["v"+i]}},e.Drawing.elliottwave.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.penDown=!0,!1):!!(this.check(e,i,this.lastPoint+1)&&(this.lastPoint++,this.setPoint(this.lastPoint,e,i,a.chart),1===this.lastPoint&&(this.trend=Math.sign(this.v1-this.v0)),this.segment++,this.segment>=this.maxSegments))&&(this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.points.push(this.p0),this.penDown=!0,this.segment=0,this.lastPoint=0,this.impulse&&(this.annotationPoints=this.annotationPoints.concat(this.impulse)),this.corrective&&(this.annotationPoints=this.annotationPoints.concat(this.corrective)),this.annotationPoints.unshift("0"),"enclosed"===this.decoration&&this.calculateRadius(t),this.maxSegments=this.annotationPoints.length-1,this.trend=1,!1)},e.Drawing.elliottwave.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx,r=this.annotationPoints,s=this.pattern?e.borderPatternToArray(this.lineWidth,this.pattern):[];this.getFontString(),t.font=this.fontString,t.textAlign="center",t.textBaseline="middle",t.lineWidth=this.lineWidth,this.fontString!==this.lastFontString&&this.calculateRadius(t),this.lastFontString=this.fontString;var n=this.getLineColor();t.fillStyle=t.strokeStyle=n,t.save(),t.setLineDash(s);var o,l=this.dx,h=this.dy,c=this.points,u=this.pts,d=!this.showLines&&this.highlighted,p=c.length;if(this.penDown&&this.segment)o=this.trend*(p%2-.5)<0,i.yAxis.flipped&&(o=!o),this.drawDropZone(t,c[p-2][1],this.stx.priceFromPixel(i.yAxis[o?"top":"bottom"]),c[p-2][0]);else if("string"==typeof this.highlighted&&this.stx.repositioningDrawing){var m=parseInt(this.highlighted.substring(1,this.highlighted.length),10);o=this.trend*(m%2-.5)>0;var g=c[m-1],f=c[m+1],v=m>0?g[1]:f[1];f&&(v=Math[o?"max":"min"](v,f[1])),i.yAxis.flipped&&(o=!o),this.drawDropZone(t,v,this.stx.priceFromPixel(i.yAxis[o?"top":"bottom"]),g?g[0]:null,f?f[0]:null)}for(var y=0;y<p;y++){var x=c[y],b=a.pixelFromTick(x[0],i.chart),S=a.pixelFromValueAdjusted(i,x[0],x[1]);u[y]=[b,S]}if(y=0,this.showLines||d){for(t.beginPath(),d&&(t.globalAlpha=.3);y<u.length;y++)t.lineTo(u[y][0],u[y][1]);t.stroke(),y=0}for(t.restore();y<p;y++){var C=y%2?l:-l,w=y%2?h:-h;C*=this.trend,w*=this.trend,i.yAxis.flipped&&(C*=-1,w*=-1);var k=u[y],D=k[2]=k[0]+C,T=k[3]=k[1]+w,M=this.enclosedRadius||8,A=r[y];"parentheses"===this.decoration&&(A="("+A+")"),t.fillText(A,D,T),"enclosed"===this.decoration&&(t.beginPath(),t.arc(D,T,M,0,2*Math.PI,!1),t.stroke()),this.highlighted&&(t.save(),this.littleCircle(t,this.pts[y][0],this.pts[y][1],this.highlighted==="p"+y),t.restore())}}},e.Drawing.elliottwave.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;if("move"===e.action)for(var o=0;e.points.length>o;o++){var l=e.points[o];this.setPoint(o,l[0]-s,l[1]-n,r.chart),this.points[o]=[l[0]-s,l[1]-n]}if("drag"===e.action){var h=e.point;this.points[h]=[i,a],this.check(i,a,h)&&this.setPoint(h,i,a,r.chart)}this.render(t)}},e.Drawing.elliottwave.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;for(var r,s=0;this.points.length>s;s++){var n=this.points[s];if(this.pointIntersection(n[0],n[1],a))return this.highlighted="p"+s,{action:"drag",point:s,tick:t,value:i};this.points[s+1]&&this.lineIntersection(t,i,a,"segment",n,this.points[s+1])&&(this.highlighted=!0,r={action:"move",points:e.clone(this.points),tick:t,value:i})}return r},e.Drawing.elliottwave.prototype.measure=function(){if(this.points.length>=2){var t=this.points;this.stx.setMeasure(t[0][1],t[t.length-1][1],t[0][0],t[t.length-1][0],!0);var i=this.stx.controls.mSticky,a=i&&i.querySelector(".mStickyInterior");if(a){var r=[];r.push(e.capitalize("Elliott Wave")),this.getYValue&&r.push(this.field||this.stx.defaultPlotField||"Close"),r.push(a.innerHTML),a.innerHTML=r.join("<br>")}}},e.Drawing.printProjection=function(t,i,a){var r=i.arr;if(r.length>1)for(var s=r[0][0],n=Math.round(.75*t.chart.maxTicks),o=1;o<r.length;o++){for(var l=r[o-1][0],h=r[o][0],c=e.strToDateTime(l),u=e.strToDateTime(h).getTime(),d=t.standardMarketIterator(c),p=0;c.getTime()<u;)c=d.next(),p+=1;var m,g=e.strToDateTime(l).getTime();if(g>e.strToDateTime(a[a.length-1].Date).getTime())m=a.length-1,p+=1;else for(m=a.length-1;m>=0&&!(g<=e.strToDateTime(a[m].Date).getTime());m--);var f={x0:0,x1:p,y0:a[m].Close,y1:r[o][1]};s=e.strToDateTime(l),d=t.standardMarketIterator(s);for(var v=!1,y=0;y<=p;y++)if(v?s=d.next():v=!0,!(s.getTime()<=a[a.length-1].DT.getTime())){var x=e.yIntersection(f,y);x||(x=0);var b=Math.round(1e4*x)/1e4;0===b&&(b=r[o][1]);var S={Date:e.yyyymmddhhmmssmmm(s),DT:s,Open:b,Close:b,High:b,Low:b,Volume:0,Adj_Close:b,Split_Close:b,projection:!0};if("minute"==t.layout.interval&&n--<0)break;a[a.length]=S}}}):console.error("drawingAdvanced feature requires first activating drawing feature.")},s=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.computeEquationChart?(e.formatEquation=function(t){for(var e="",i=[],a="",r=!1,s=1;s<t.length;s++){var n=t[s].toUpperCase();"["!=n||r?"]"==n&&r?(r=!1,""!==a&&(i.push(a),e+="["+a+"]"),a=""):r?a+=n:"+"==n||"-"==n||"*"==n||"/"==n||":"==n||"%"==n||"("==n||")"==n?(""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,":"==n&&(n="/"),e+=n,a=""):" "!=n&&(a+=n):r=!0}return""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,{equation:e,symbols:i}},e.fetchEquationChart=function(t,i){var a=e.formatEquation(t.symbol),r=a.symbols,s=[],n=t.stx;t.stx=null;for(var o=0;o<r.length;o++){var l=e.shallowClone(t);l.stx=n,l.symbol=r[o],l.symbolObject={symbol:r[o]},s.push(l)}t.stx=n,n.quoteDriver.multiFetch(s,(function(r){var n={};t.loadMoreReplace=!0;for(var o={charge:0},l=0;l<r.length;l++){var h=r[l];if(h.dataCallback.error)return void i({error:h.dataCallback.error});n[h.params.symbol]=h.dataCallback.quotes,t.loadMoreReplace=t.loadMoreReplace&&h.params.loadMoreReplace,t.moreToLoad=t.moreToLoad||h.dataCallback.moreAvailable;var c=h.dataCallback.attribution;c&&(c.charge&&(o.charge+=c.charge),o.source=c.source,void 0===o.exchange?o.exchange=c.exchange:o.exchange!=c.exchange&&(o.exchange=""))}if(s.length||!t.loadMore&&!t.update)try{var u=e.computeEquationChart(a.equation,n);i({quotes:u,moreAvailable:t.moreToLoad,attribution:o})}catch(t){var d={error:"Invalid equation: "+a.equation};t.name&&"NoException"==t.name&&(d.suppressAlert=!0),i(d)}}))}):console.error("equationsAdvanced feature requires first activating equations feature.")},n=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Marker?e.Marker.Performance||(e.ChartEngine.prototype.removeDOMMarker=function(t){console.warn("CIQ.ChartEngine#removeDOMMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance#remove instead."),e.Marker.Performance.prototype.removeDOMMarker.call(t.params.node,t)},e.ChartEngine.prototype.drawMarkers=function(){console.warn("CIQ.ChartEngine#drawMarkers is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawMarkers instead."),e.Marker.Performance.drawMarkers(this)},e.ChartEngine.prototype.calculateMarkerStyles=function(t,i){console.warn("CIQ.ChartEngine#calculateMarkerStyles is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.calculateStyles instead."),e.Marker.Performance.calculateMarkerStyles(this,t,i)},e.ChartEngine.prototype.drawCircleMarker=function(t,i,a){console.warn("CIQ.ChartEngine#drawCircleMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawCircleMarker instead."),e.Marker.Performance.drawCircleMarker(t,i,a)},e.ChartEngine.prototype.drawSquareMarker=function(t,i,a){console.warn("CIQ.ChartEngine#drawSquareMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawSquareMarker instead."),e.Marker.Performance.drawSquareMarker(t,i,a)},e.ChartEngine.prototype.drawCalloutMarker=function(t,i,a){console.warn("CIQ.ChartEngine#drawCalloutMarker is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawCalloutMarker instead."),e.Marker.Performance.drawCalloutMarker(t,i,a)},e.ChartEngine.prototype.drawMarkerStem=function(t,i,a){console.warn("CIQ.ChartEngine#drawMarkerStem is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawMarkerStem instead."),e.Marker.Performance.drawMarkerStem(t,i,a)},e.ChartEngine.prototype.positionDOMMarkers=function(){console.warn("CIQ.ChartEngine#positionDOMMarkers is scheduled for deprecation in a future release\n Please use CIQ.Marker.Performance.drawMarkers instead."),e.Marker.Performance.drawMarkers(this)},e.Marker.Performance=function(t){this.params={displayCategory:!0,displayStem:!0,invert:!1,story:"",headline:""},e.extend(this.params,t);var i=this.template=document.createElement("TEMPLATE");i.innerHTML='<div class="stx-marker highlight"><div class="stx-visual"><div class="stx-marker-content"><div class="stx-marker stx-performance-marker stx-marker-expand"><h4></h4><p></p></div></div></div><div class="stx-stem"></div></div>';var a=this.template.content.cloneNode(!0),r=a.querySelector(".stx-marker",i);r.classList.add(t.type),r.classList.add(t.category);var s=a.querySelector(".stx-visual",i),n=a.querySelector(".stx-marker-expand"),o=a.querySelector("h4",i),l=a.querySelector("p",i);if(o.innerText=this.params.headline,l.innerText=this.params.story,this.hasText=!!t.headline||!!t.story,this.deferAttach=!0,this.node=a.firstChild,this.node.params=this.params,this.visual=s,this.expand=n,"callout"===t.type){var h=n.removeChild(o);a.querySelector(".stx-marker-content",i).insertBefore(h,n)}},e.inheritsFrom(e.Marker.Performance,e.Marker.NodeCreator,!1),e.Marker.Performance.consolidateExpanded=function(t){var e=t.markerHelper.highlighted;if(e.length){var i,a,r=e[e.length-1],s=r.params.node;r.consolidated||(r.consolidated=[]);for(var n=e.length-2;n>=0;n--){var o=(i=e[n],a=void 0,(a=i.params.node.expand)&&"none"!==a.style.display?a.innerHTML:""),l="<consolidated>"+o+"</consolidated>";o.length&&(s.expand.innerHTML+=l)}r.stxNodeCreator.quickCache(r)}},e.Marker.Performance.reconstituteExpanded=function(t){var e=t.markerHelper.highlighted;if(e.length&&t.activeMarker)for(var i=(e=[t.activeMarker]).length-1;i>=0;i--)for(var a=e[i].params.node.expand;"CONSOLIDATED"===a.lastElementChild.nodeName;)a.removeChild(a.lastElementChild)},e.Marker.Performance.drawMarkers=function(t){for(var e=t.getMarkerArray("all"),i=t.chart,a=0;a<e.length;a++){var r=e[a],s=r.stxNodeCreator,n=i.dataSegment[0].tick,o=i.dataSegment[i.dataSegment.length-1].tick;n<=r.tick<=o&&s&&s.drawMarker&&s.drawMarker(r)}},e.Marker.Performance.calculateMarkerStyles=function(t,e,i){var a=document.querySelector(".stx-marker-templates");a||((a=document.createElement("DIV")).style.visibility="hidden",a.style.left="-1000px",document.body.append(a)),a.appendChild(e.node);var r=getComputedStyle(e.stxNodeCreator.visual);if(!t.styles.stx_marker_stem){var s=getComputedStyle(document.querySelector(".stx-stem",e.node));t.styles.stx_marker_stem=t.cloneStyle(s)}t.styles[i]=t.cloneStyle(r),a.removeChild(e.node)},e.Marker.Performance.drawCircleMarker=function(t,i,a){var r=t.params.stx.chart.context,s=a.x,n=a.y,o=a.radius,l=a.label,h=a.color?a.color:i.backgroundColor;r.beginPath(),r.setLineDash([]),r.lineWidth=1,r.fillStyle=h,r.strokeStyle=h,r.font="normal bold 12px Roboto, Helvetica, sans-serif",r.arc(s,n,o,0,2*Math.PI,!1),r.fill(),r.stroke(),r.closePath(),l&&(r.fillStyle=e.colorsEqual("white",r.fillStyle)?"black":"white",r.fillText(l.charAt(0).toUpperCase(),s-4,n+1)),(t.highlight||t.active)&&(r.beginPath(),r.arc(s,n,o+4,0,2*Math.PI,!1),r.stroke(),r.closePath())},e.Marker.Performance.drawSquareMarker=function(t,i,a){var r=t.params.stx.chart.context,s=a.x,n=a.y,o=a.half,l=a.label,h=a.color?a.color:i.backgroundColor,c=2*o;r.beginPath(),r.setLineDash([]),r.lineWidth=1,r.fillStyle=h,r.strokeStyle=h,r.font="normal bold 12px Roboto, Helvetica, sans-serif",r.rect(s-o,n-o,c,c),r.fill(),(t.highlight||t.active)&&r.rect(s-o-4,n-o-4,c+8,c+8),r.stroke(),r.closePath(),l&&(r.fillStyle=e.colorsEqual("white",r.fillStyle)?"black":"white",r.fillText(l.charAt(0).toUpperCase(),s-4,n+1))},e.Marker.Performance.drawCalloutMarker=function(t,e,i){var a=t.params.stx.chart.context,r=t.params,s=(i.x,i.y),n=i.half,o=i.midWidth,l=i.headline,h=i.color?i.color:e.backgroundColor,c=2*n||25,u=Math.round(a.measureText(l).width),d=o?2*o:u+8;a.beginPath(),a.setLineDash([]),a.lineWidth=1,a.fillStyle=h,a.strokeStyle=h,a.font="normal bold 12px Roboto, Helvetica, sans-serif",a.rect(r.box.x0,r.box.y0,d,c),a.fill(),a.stroke(),a.closePath(),a.beginPath(),a.fillStyle=t.highlight||t.active?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.65)";var p=(d-(u+20))/2;a.rect(r.box.x0+p,s-n,u+40,22),a.fill(),a.stroke(),a.closePath(),a.fillStyle="black",a.fillText(l,r.box.x0+p+10,s)},e.Marker.Performance.drawMarkerStem=function(t,i,a){var r=t.params.stx.chart.context,s=a.x;a.y;r.beginPath(),r.strokeStyle=i.borderLeftColor,r.setLineDash([1,1]);let n=e.stripPX(i.height),o=a.invert?t.params.box.y0:t.params.box.y1,l=a.invert?t.params.box.y0-n:t.params.box.y1+n;r.moveTo(s,o),r.lineTo(s,l),r.stroke(),r.closePath()},e.Marker.Performance.prototype.drawMarker=function(t){var i=t.params,a=t.params.stx;if(a&&a.chart.dataSegment.length){var r=a.panels[t.params.panelName],s=t.stxNodeCreator.params,n=s.type,o=s.category,l=s.headline,h=s.displayCategory,c=s.color,u=s.invert,d="stx_marker_"+n+"_"+o;a.styles[d]||e.Marker.Performance.calculateMarkerStyles(a,t,d);var p=t.style=a.styles[d],m=a.styles.stx_marker_stem,g=parseInt(p.height,10)/2,f=parseInt(p.width,10)/2,v=s.displayStem?parseInt(m.height,10)+parseInt(m.marginBottom,10):0,y=v+parseInt(p.height,10),x=v?v+g:0,b=a.pixelFromDate(i.x),S=i.node.calculateYPosition({marker:t,panel:r,height:y,half:g,offset:x,inverted:u});(t.tick||0===t.tick)&&(i.box={x0:b-(f||g),y0:S-g,x1:b+(f||g),y1:S+g,midY:g,midX:f||g,stemHeight:v},h||(o=h),a.startClip(r.name),"circle"===n?e.Marker.Performance.drawCircleMarker(t,p,{x:b,y:S,radius:g,label:o,color:c}):"square"===n?e.Marker.Performance.drawSquareMarker(t,p,{x:b,y:S,half:g,label:o,color:c}):"callout"===n?e.Marker.Performance.drawCalloutMarker(t,p,{x:b,y:S,half:g,midWidth:f,headline:l,color:c}):console.warn("Marker type: "+n+" is unsupported with canvas markers!\nSupported Styles are Square, Circle, and Callout."),s.displayStem&&e.Marker.Performance.drawMarkerStem(t,m,{x:b,y:S,invert:u}),a.endClip(),t.attached&&this.positionPopUpNode(t))}},e.Marker.Performance.prototype.positionPopUpNode=function(t){if(t.attached&&t.params.box){var e,i=t.params,a=i.stx,r=i.box,s=t.params.node.expand,n=a.chart.dataSet,o=a.chart.dataSegment;if(t.tick){var l=[n[o[0]&&o[0].tick-1],n[o[0]&&o[0].tick-2]],h=a.getFirstLastDataRecord(l.concat(o),"Date"),c=[n[o[o.length-1].tick+1],n[o[o.length-1].tick+2]],u=a.getFirstLastDataRecord(o.concat(c),"Date",!0);e=h.DT<=n[t.tick].DT&&n[t.tick].DT<=u.DT}else e=!1;if(t.highlight||t.active||(e=!1),s.style.visibility=e?"":"hidden",e){var d,p=a.panels[i.panelName],m=s.rects,g=m.height/2,f=t.node.params.infoOffset||0;d=t.node.params.infoOnLeft?r.x0-m.width-f<p.left?r.x1+f:r.x0-m.width-f:r.x0+m.width>p.right?r.x0-m.width-f:r.x1+f,d-=a.chart.left;var v=r.y0-g>=p.top?r.y0+r.midY-g:r.y0;!i.avoidFlush&&r.y1+r.stemHeight===p.yAxis.bottom&&m.height>r.y1-r.y0+r.stemHeight&&(v=r.y1-m.height+r.stemHeight),v-=a.chart.panel.top;var y="translateX("+Math.floor(d)+"px) translateY("+Math.floor(v)+"px) translateZ(0)";s.style.transform=y,s.transform={translateX:d,translateY:v}}}},e.Marker.Performance.prototype.quickCache=function(t){var i=t.params.node.expand,a=t.style,r=e.stripPX(a.marginLeft)+e.stripPX(a.marginRight)+e.stripPX(a.borderRight)+e.stripPX(a.borderLeft);i.rects=i.getBoundingClientRect(),i.scrollBarWidth=i.rects.width-i.clientWidth-r},e.Marker.Performance.prototype.calculateYPosition=function(t){var e=t.marker,i=t.panel,a=t.height,r=t.half,s=t.offset,n=t.inverted,o=e.params.stx,l=o.chart,h=o.chart.highLowBars,c=l.dataSet[e.tick];if(c){var u,d=h?c.High:c.Close;switch(e.params.yPositioner){case"value":u=e.params.y||0===e.params.y?o.pixelFromPrice(e.params.y,i)-.5*a+r:o.pixelFromPrice(d,i)-s;break;case"above_candle":u=o.pixelFromPrice(d,i)-s;break;case"below_candle":u=o.pixelFromPrice(c.Low||d,i),u+=n&&s?s:r;break;case"on_candle":var p=c.High||c.Close,m=c.Low||0===c.Low||c.Close;u=o.pixelFromPrice((p+m)/2,i)-.5*a+r;break;case"top":u=o.pixelFromPrice(i.yAxis.high,i),u+=n&&s?s:r;break;case"bottom":u=o.pixelFromPrice(i.yAxis.low,i)-(s||r)}return u}},e.Marker.Performance.prototype.prepareForHolder=function(t){var e=this.expand,i=t.params.stx;return e.classList.add(this.params.type),i.markerHelper.domMarkers.push(t),e},e.Marker.Performance.prototype.addToHolder=function(t){var i=this.expand,a=t.params.stx;function r(e){a.activeMarker=t,a.activeMarker.click({cx:e.clientX,cy:e.clientY,panel:a.currentPanel}),e.stopPropagation()}e.Marker.Performance.reconstituteExpanded(a),e.Marker.Performance.consolidateExpanded(a),this.quickCache(t),i.clickClosure||(i.addEventListener("mousedown",r),i.addEventListener("touchstart",r),i.clickClosure=r)},e.Marker.Performance.prototype.remove=function(t){var e=t.params.stx;if(e&&e.markerHelper.domMarkers){var i=e.markerHelper.domMarkers.indexOf(t);if(-1!=i&&e.markerHelper.domMarkers.splice(i,1),t.attached){var a=e.panels[t.params.panelName],r=t.params.node.expand;r.parentNode===a.subholder&&a.subholder.removeChild(r),r.removeEventListener("click",r.clickClosure)}}},e.Marker.Performance.prototype.click=function(t){if(!this.hasText)return;"number"==typeof arguments[0]&&(t={cx:arguments[0],cy:arguments[1],marker:arguments[2],panel:arguments[3]});const{cx:e,cy:i,marker:a,panel:r}=t;var s,n=a.params.stx;if(a.attached){var o=this.expand;if(o.rects.width-o.scrollBarWidth+o.transform.translateX<n.backOutX(e)&&n.backOutX(e)<o.rects.width+o.transform.translateX)return;this.remove(a)}else n.addToHolder(a),s=!0;a.attached=!a.attached,a.active=!a.active,s&&a.stxNodeCreator.positionPopUpNode(a)}):console.error("highPerformanceMarkers feature requires first activating markers feature.")},o=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Renderer.OHLC.requestNew=function(t,i){for(var a=null,r=i.hlc,s=i.colored,n=i.hollow,o=i.volume,l=i.histogram,h=0;h<t.length;h++){var c=t[h];switch(c){case"bar":case"candle":a=c;break;case"volume":o=!0;break;case"hollow":n=!0;break;case"colored":s=!0;break;case"histogram":l=!0,a="candle";break;case"hlc":r=!0,a="bar";break;default:return null}}return null===a?null:new e.Renderer.OHLC({params:e.extend(i,{type:a,hlc:r,colored:s,hollow:n,volume:o,histogram:l})})},e.Renderer.OHLC.getChartParts=function(t,e){var i=16;return[{type:"histogram",drawType:"histogram",style:"stx_histogram_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_down",condition:i,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_even",condition:32,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0,useBorderStyleProp:!0},{type:"bar",drawType:"bar",style:t||"stx_bar_chart",border:"border_color",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_up",condition:e?8:1,border:"border_color_up",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_down",condition:e?i:2,border:"border_color_down",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_even",condition:e?32:4,border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"candle",drawType:"shadow",style:"stx_candle_shadow",border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_up",condition:8,border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_down",condition:i,border:"border_color_down"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_even",condition:32,border:"border_color_even",skipIfPass:!0},{type:"candle",drawType:"candle",style:"stx_candle_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"candle",drawType:"candle",style:"stx_candle_down",condition:i,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_up",condition:1,border:"border_color_up"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_down",condition:2,border:"border_color_down"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_even",condition:4,border:"border_color_even",skipIfPass:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:17,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:18,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:20,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:9,fill:"fill_color_up",border:"border_color_up"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:10,fill:"fill_color_down",border:"border_color_down"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:12,fill:"fill_color_even",border:"border_color_even"}]},e.Renderer.Bars=function(t){this.construct(t);var e=this.params;e.type="bar",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.volume=e.hollow=e.histogram=!1},e.inheritsFrom(e.Renderer.Bars,e.Renderer.OHLC,!1),e.Renderer.HLC=function(t){this.construct(t);var e=this.params;e.type="bar",e.hlc=!0,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.volume=e.hollow=e.histogram=!1},e.inheritsFrom(e.Renderer.HLC,e.Renderer.Bars,!1),e.Renderer.Shading=function(t){this.construct(t),this.beenSetup=!1,this.errTimeout=null,this.params.useChartLegend=!1,this.shading=[],"rangechannel"==this.params.type&&(this.highLowBars=!0)},e.inheritsFrom(e.Renderer.Shading,e.Renderer.Lines,!1),e.Renderer.Shading.requestNew=function(t,i){let a=null,r=null;for(let e=0;e<t.length;e++){let i=t[e];"rangechannel"==i?a="rangechannel":"step"==i&&(r=!0)}return null===a?null:new e.Renderer.Shading({params:e.extend(i,{type:a,step:r})})},e.Renderer.Shading.prototype.setShading=function(t){t.constructor!=Array&&(t=[t]),this.shading=t},e.Renderer.Shading.prototype.draw=function(){var t=this.stx,i=this.params,a=t.panels[i.panel].chart;if("rangechannel"==i.type)if(this.beenSetup)this.seriesParams.length>2&&this.removeSeries(this.seriesParams[2].id);else{this.beenSetup=!0,i.display=this.seriesParams[0].display,i.yAxis=this.seriesParams[0].yAxis;var r=this.seriesParams[0].color||"auto",s=this.seriesParams[0].symbol;s&&s+".",this.removeAllSeries(!0);var n=i.name;t.addSeries(null,{symbol:s,loadData:!!s,field:"High",renderer:"Shading",name:n,style:"stx_line_up",display:i.display,shareYAxis:!0}),t.addSeries(null,{symbol:s,loadData:!!s,field:"Low",renderer:"Shading",name:n,style:"stx_line_down",display:i.display,shareYAxis:!0}),this.setShading({primary:this.seriesParams[0].id,secondary:this.seriesParams[1].id,color:r})}if(!this.shading&&!this.errTimeout){console.log("Warning: no shading scheme set.  Use myRenderer.setShading(scheme) to set.");var o=this;this.errTimeout=setTimeout((function(){o.errTimeout=null}),1e4)}var l,h={};for(l=0;l<this.seriesParams.length;l++){var c={};a.series[this.seriesParams[l].id]&&(c=e.clone(a.series[this.seriesParams[l].id].parameters)),h[this.seriesParams[l].id]={parameters:e.extend(e.extend(c,i),this.seriesParams[l]),yValueCache:this.caches[this.seriesParams[l].id]}}if(t.drawSeries(a,h,i.yAxis,this),a.legend&&"rangechannel"==i.type){a.legend.colorMap||(a.legend.colorMap={});var u=i.display,d=[t.getCanvasColor("stx_line_up"),t.getCanvasColor("stx_line_down")];a.legend.colorMap[u]={color:d,display:u,isBase:this==t.mainSeriesRenderer}}for(l in h)this.caches[l]=h[l].yValueCache;function p(t){var e=h[t];if(e){var i=e.parameters.field,a=e.parameters.subField;return i+(a?"."+a:"")}return t}for(l=0;l<this.shading.length;l++){var m=this.shading[l],g=m.color;if("auto"==m.color&&(g=t.defaultColor),m.primary||(m.primary="Close"),!m.secondary&&this.seriesParams[0]&&(m.secondary=this.seriesParams[0].field),m.secondary&&(h[m.primary]||"Close"==m.primary)&&h[m.secondary]&&("Close"!=m.primary||!i.yAxis||i.yAxis==a.yAxis)){var f=p(m.primary).split("."),v=p(m.secondary).split("."),y={topBand:f[0],topSubBand:f[1],topColor:m.greater||g||t.containerColor,topAxis:i.yAxis,bottomBand:v[0],bottomSubBand:v[1],bottomColor:m.lesser||g||t.containerColor,bottomAxis:"Close"==m.primary?null:i.yAxis,tension:i.tension||a.tension,opacity:.1,step:i.step};(y.topColor||y.bottomColor)&&(!i.highlight&&t.highlightedDraggable&&(y.opacity*=.3),e.fillIntersecting(t,i.panel,y))}}},e.Renderer.Histogram=function(t){this.construct(t),this.params.type="histogram",this.barsHaveWidth=this.standaloneBars=!0,this.params.yAxis&&(this.params.bindToYAxis=!0,"number"==typeof this.params.yAxis.baseline&&(this.params.yAxis.baseline={value:this.params.yAxis.baseline}))},e.inheritsFrom(e.Renderer.Histogram,e.Renderer,!1),e.Renderer.Histogram.prototype.adjustYAxis=function(){const t=this.params.yAxis;t&&!t.baseline&&(t.min=0,t.highValue/=this.params.heightPercentage||1)},e.Renderer.Histogram.prototype.draw=function(){var t=e.clone(this.params);t.type=t.subtype,this.useSum="stacked"==t.subtype,t.yAxis&&t.yAxis!=this.stx.chart.yAxis||(t.bindToYAxis=!0),this.stx.drawHistogram(t,this.seriesParams);const i=t.yAxis&&t.yAxis.baseline;if(i&&i.color){const t=this.stx.panels[this.params.panel],e=this.stx.pixelFromPrice(i.value,t,this.params.yAxis)-.5;this.stx.plotLine({x0:t.left,x1:t.right,y0:e,y1:e,color:i.color,type:"line",context:t.chart.context,confineToPanel:t,pattern:i.pattern||"solid",lineWidth:i.lineWidth||1,opacity:i.opacity||.8,globalCompositeOperation:"destination-over"})}},e.Renderer.Histogram.prototype.getBasis=function(t,e,i){var a=0;if(t&&this.useSum)for(var r=0;r<this.seriesParams.length;r++){var s=this.seriesParams[r].field;if(s===e)break;var n=t[s];n&&"object"==typeof n&&(n=n[i||this.seriesParams[r].subField||this.stx.chart.defaultPlotField||"Close"]),n&&(a+=n)}return a},e.Renderer.Heatmap=function(t){this.construct(t),this.params.type="heatmap",this.params.highlightable=!1,this.barsHaveWidth=this.standaloneBars=!0},e.inheritsFrom(e.Renderer.Heatmap,e.Renderer,!1),e.Renderer.Heatmap.requestNew=function(t,i){for(var a=null,r=0;r<t.length;r++){"heatmap"==t[r]&&(a="heatmap")}return null===a?null:new e.Renderer.Heatmap({params:e.extend(i,{type:a})})},e.Renderer.Heatmap.prototype.draw=function(){this.stx.drawHeatmap(e.clone(this.params),this.seriesParams)},e.Renderer.Scatter=function(t){this.construct(t),this.standaloneBars=this.barsHaveWidth=!0,this.bounded=!0},e.inheritsFrom(e.Renderer.Scatter,e.Renderer.Lines,!1),e.Renderer.Scatter.requestNew=function(t,i){for(var a=null,r=0;r<t.length;r++){"scatterplot"==t[r]&&(a="scatter")}return null===a?null:new e.Renderer.Scatter({params:e.extend(i,{type:a})})},e.Renderer.Scatter.prototype.drawIndividualSeries=function(t,e){var i=this.stx.panels[e.panel]||t.panel,a={colors:[]};return this.stx.scatter?a=this.stx.scatter(i,e):console.warn("Error, Scatter renderer requires customChart.js"),a}},l=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateAccumulationDistribution=function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)if(a){var r=i[a];if(r.futureTick)break;var s=i[a-1],n=0;r.Close>s.Close?n=r.Close-Math.min(r.Low,s.Close):r.Close<s.Close&&(n=r.Close-Math.max(r.High,s.Close)),e.inputs["Use Volume"]&&(n*=r.Volume);var o=s["Result "+e.name];o||(o=0),o+=n,isNaN(r.Close)||(r["Result "+e.name]=o)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"W Acc Dist":{name:"Accumulation/Distribution",calculateFN:e.Studies.calculateAccumulationDistribution,inputs:{"Use Volume":!1}}})):console.error("accumulationDistribution feature requires first activating studies feature.")},h=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateADX=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.chart.scrubbed,r=i.days,s=parseInt(i.inputs["Smoothing Period"],10);if(s||0===s||(s=r),a.length<i.days+1)i.error=!0;else for(var n,o=0,l=0,h=0,c=0,u=Math.max(1,i.startFrom);u<a.length;u++){n=a[u];var d=Math.max(0,n.High-a[u-1].High),p=Math.max(0,a[u-1].Low-n.Low);if(d>p?p=0:d=p>d?0:p=0,u<=r?(l+=d,h+=p,o+=n["True Range "+i.name]):(l=a[u-1]["_sm+DM "+i.name]*(r-1)/r+d,h=a[u-1]["_sm-DM "+i.name]*(r-1)/r+p,o=a[u-1]["_smTR "+i.name]*(r-1)/r+n["True Range "+i.name]),n["_sm+DM "+i.name]=l,n["_sm-DM "+i.name]=h,n["_smTR "+i.name]=o,!(u<r)){var m=100*l/o,g=100*h/o,f=100*Math.abs(m-g)/(m+g);if(n["+DI "+i.name]=m,n["-DI "+i.name]=g,!1!==i.inputs.Series&&s)if(u<r+s-1){if(u==i.startFrom)for(var v=r;v<i.startFrom;v++)c+=100*Math.abs(a[v]["+DI "+i.name]-a[v]["-DI "+i.name])/(a[v]["+DI "+i.name]+a[v]["-DI "+i.name]);c+=f}else n["ADX "+i.name]=u==r+s-1?c/s:(a[u-1]["ADX "+i.name]*(s-1)+f)/s;if(i.inputs.Histogram){var y=i.name+"_hist";if(!n["+DI "+i.name]&&0!==n["+DI "+i.name])continue;if(!n["-DI "+i.name]&&0!==n["-DI "+i.name])continue;n[y]=n["+DI "+i.name]-n["-DI "+i.name],!1===i.inputs.Series&&(n["+DI "+i.name]=null,n["-DI "+i.name]=null),i.outputMap[y]=""}}}},e.Studies.displayADX=function(t,i,a){var r=i.underlay?.3:i.inputs.Series?.4:1;if(i.inputs.Series&&i.inputs.Shading){var s="+DI "+i.name,n="-DI "+i.name,o=e.Studies.determineColor(i.outputs[i.outputMap[s]]),l=e.Studies.determineColor(i.outputs[i.outputMap[n]]),h=i.getYAxis(t),c={topBand:s,bottomBand:n,topColor:o,bottomColor:l,skipTransform:t.panels[i.panel].name!=i.chart.name,topAxis:h,bottomAxis:h,opacity:.3};!i.highlight&&t.highlightedDraggable&&(c.opacity*=.3),e.fillIntersecting(t,i.panel,c)}i.inputs.Histogram&&e.Studies.createHistogram(t,i,a,!1,r),!1!==i.inputs.Series?e.Studies.displaySeriesAsLine(t,i,a):i.inputs.Series||i.inputs.Histogram||t.displayErrorAsWatermark(i.panel,t.translateIf(i.name)+": "+t.translateIf("Nothing to display"))},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{ADX:{name:"ADX/DMS",calculateFN:e.Studies.calculateADX,seriesFN:e.Studies.displayADX,inputs:{Period:14,"Smoothing Period":14,Series:!0,Shading:!1,Histogram:!1},outputs:{"+DI":"#00FF00","-DI":"#FF0000",ADX:"auto","Positive Bar":"#00DD00","Negative Bar":"#FF0000"}}})):console.error("adx feature requires first activating studies feature.")},c=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateAlligator=function(t,i){var a={J:Number(i.inputs["Jaw Period"]),T:Number(i.inputs["Teeth Period"]),L:Number(i.inputs["Lips Period"])},r=i.chart.scrubbed;if(r.length<Math.max(a.J,a.T,a.L)+1)i.error=!0;else{("Gator"===i.type||i.inputs["Show Lines"])&&(e.Studies.MA("welles wilder",a.J,"hl/2",i.inputs["Jaw Offset"],"Jaw",t,i),e.Studies.MA("welles wilder",a.T,"hl/2",i.inputs["Teeth Offset"],"Teeth",t,i),e.Studies.MA("welles wilder",a.L,"hl/2",i.inputs["Lips Offset"],"Lips",t,i));for(var s=i.startFrom;s<r.length;s++)if(r[s]){if("Gator"==i.type){var n=r[s]["Jaw "+i.name],o=r[s]["Lips "+i.name],l=r[s]["Teeth "+i.name];(l||0===l)&&((n||0===n)&&(r[s][i.name+"_hist1"]=Math.abs(n-l)),(o||0===o)&&(r[s][i.name+"_hist2"]=-Math.abs(l-o))),i.outputMap={},i.outputMap[i.name+"_hist1"]="",i.outputMap[i.name+"_hist2"]=""}if(i.inputs["Show Fractals"]){if(!(r[s-2]&&r[s-1]&&r[s]&&r[s+1]&&r[s+2]))continue;r[s-2].High&&r[s-1].High&&r[s].High&&r[s+1].High&&r[s+2].High&&r[s].High>r[s-1].High&&r[s].High>r[s-2].High&&r[s].High>r[s+1].High&&r[s].High>r[s+2].High&&(r[s]["Fractal High "+i.name]=1),r[s-2].Low&&r[s-1].Low&&r[s].Low&&r[s+1].Low&&r[s+2].Low&&r[s].Low<r[s-1].Low&&r[s].Low<r[s-2].Low&&r[s].Low<r[s+1].Low&&r[s].Low<r[s+2].Low&&(r[s]["Fractal Low "+i.name]=1)}}}},e.Studies.displayAlligator=function(t,i,a){function r(e,i){var r,o=t.chart.panel.yAxis.flipped;"high"==e?(s.fillStyle=t.defaultColor,s.textBaseline=o?"top":"bottom",r=t.pixelFromPrice(a[i].High),s.fillText(o?"▼":"▲",t.pixelFromBar(n,t.chart)-s.measureText("▲").width/2+1,o?r+5:r-5)):"low"==e&&(s.fillStyle=t.defaultColor,s.textBaseline=o?"bottom":"top",r=t.pixelFromPrice(a[i].Low),s.fillText(o?"▲":"▼",t.pixelFromBar(n,t.chart)-s.measureText("▼").width/2+1,o?r-5:r+5))}var s=i.getContext(t);if(i.inputs["Show Lines"]&&e.Studies.displaySeriesAsLine(t,i,a),i.inputs["Show Fractals"]){t.startClip(),s.globalAlpha=i.underlay?.3:1,!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var n=2;n<a.length-2;n++)a[n]&&(a[n]["Fractal High "+i.name]&&r("high",n),a[n]["Fractal Low "+i.name]&&r("low",n));t.endClip()}},e.Studies.displayGator=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs["Increasing Bar"]),c=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),s.fillStyle="#CCCCCC",t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var d=a[u],p=a[u-1];if(d)for(var m=1;m<=2;m++)p||(p=t.getPreviousBar(t.chart,i.name+"_hist"+m,u)),p?Math.abs(p[i.name+"_hist"+m])<Math.abs(d[i.name+"_hist"+m])?s.fillStyle=h:Math.abs(p[i.name+"_hist"+m])>Math.abs(d[i.name+"_hist"+m])&&(s.fillStyle=c):s.fillStyle="#CCCCCC",d.candleWidth&&(l=Math.floor(Math.max(1,d.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(u,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(d[i.name+"_hist"+m],r,n)-o))}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Alligator:{name:"Alligator",overlay:!0,seriesFN:e.Studies.displayAlligator,calculateFN:e.Studies.calculateAlligator,inputs:{"Show Lines":!0,"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3,"Show Fractals":!1},outputs:{Jaw:"#0000FF",Teeth:"#FF0000",Lips:"#00DD00"}},Gator:{name:"Gator Oscillator",seriesFN:e.Studies.displayGator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0}})):console.error("alligator feature requires first activating studies feature.")},u=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateAroon=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a,r=0,s=0,n=null,o=null;if(e.startFrom>0){var l=i[e.startFrom-1]["_state "+e.name];l&&(r=l[0],s=l[1],n=l[2],o=l[3])}for(var h=e.startFrom;h<i.length;h++){var c=i[h];if(c.futureTick)break;if(null===n&&(n=c.High),null===o&&(o=c.Low),(n=Math.max(n,c.High))==c.High)r=0;else if(++r>e.days)for(n=c.High,r=0,a=1;a<=e.days;a++)(n=Math.max(n,i[h-a].High))==i[h-a].High&&(r=a);if((o=Math.min(o,c.Low))==c.Low)s=0;else if(++s>e.days)for(o=c.Low,s=0,a=1;a<=e.days;a++)(o=Math.min(o,i[h-a].Low))==i[h-a].Low&&(s=a);var u=!isNaN(c.High),d=!isNaN(c.Low),p=100*(1-r/e.days);u&&(c["Aroon Up "+e.name]=p);var m=100*(1-s/e.days);d&&(c["Aroon Down "+e.name]=m),u&&d&&(c["Aroon Oscillator "+e.name]=c["Aroon Up "+e.name]-c["Aroon Down "+e.name]),c["_state "+e.name]=[r,s,n,o]}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Aroon:{name:"Aroon",range:"0 to 100",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Up":"#00DD00","Aroon Down":"#FF0000"}},"Aroon Osc":{name:"Aroon Oscillator",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Oscillator":"auto"}}})):console.error("aroon feature requires first activating studies feature.")},d=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateATRBands=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,a,"ATR "+i.name)},e.Studies.calculateSTARCBands=function(t,i){e.Studies.calculateStudyATR(t,i),e.Studies.MA("simple",i.inputs["MA Period"],"Close",0,"_MA",t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Multiplier,"_MA "+i.name,"ATR "+i.name)},e.Studies.calculateATRStops=function(t,i){var a=i.chart.scrubbed;if(a){e.Studies.calculateStudyATR(t,i);for(var r=i.inputs.HighLow,s=Math.max(i.startFrom-1,1);s<a.length-1;s++){var n=a[s],o=a[s-1],l=n["Buy Stops "+i.name];if(l||(l=n["Sell Stops "+i.name]),l||(l=0),n&&o){var h=n.Close,c=h,u=n["ATR "+i.name]*i.inputs.Multiplier;n.Close>l&&o.Close>l?(r&&(h=n.High),c=Math.max(l,h-u)):n.Close<=l&&o.Close<=l?(r&&(h=n.Low),c=Math.min(l,h+u)):n.Close>l?(r&&(h=n.High),c=h-u):n.Close<=l&&(r&&(h=n.Low),c=h+u),h<=c?(a[s+1]["Buy Stops "+i.name]=c,delete a[s+1]["Sell Stops "+i.name]):h>c&&(a[s+1]["Sell Stops "+i.name]=c,delete a[s+1]["Buy Stops "+i.name]),a[s+1]["All Stops "+i.name]=c}}i.referenceOutput="All Stops",i.outputMap={},i.outputMap["All Stops "+i.name]=""}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{ATR:{name:"Average True Range",calculateFN:e.Studies.calculateStudyATR,outputs:{ATR:"auto"}},"ATR Bands":{name:"ATR Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateATRBands,inputs:{Period:5,Field:"field",Shift:3,"Channel Fill":!0},outputs:{"ATR Bands Top":"auto","ATR Bands Bottom":"auto","ATR Bands Channel":"auto"},attributes:{Shift:{min:.1,step:.1}}},"STARC Bands":{name:"STARC Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateSTARCBands,inputs:{Period:15,"MA Period":5,Multiplier:1.3,"Channel Fill":!0},outputs:{"STARC Bands Top":"auto","STARC Bands Median":"auto","STARC Bands Bottom":"auto"},attributes:{Multiplier:{min:.1,step:.1}}},"ATR Trailing Stop":{name:"ATR Trailing Stops",overlay:!0,seriesFN:e.Studies.displayPSAR2,calculateFN:e.Studies.calculateATRStops,inputs:{Period:21,Multiplier:3,"Plot Type":["points","squarewave"],HighLow:!1},outputs:{"Buy Stops":"#FF0000","Sell Stops":"#00FF00"},attributes:{Multiplier:{min:.1,step:.1}}}})):console.error("atr feature requires first activating studies feature.")},p=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateAwesomeOscillator=function(t,i){var a=i.chart.scrubbed;if(a.length<33)i.error=!0;else{e.Studies.MA("simple",5,"hl/2",0,"_MA5",t,i),e.Studies.MA("simple",34,"hl/2",0,"_MA34",t,i);for(var r=Math.max(i.startFrom,33);r<a.length;r++)a[r]&&(a[r][i.name+"_hist"]=a[r]["_MA5 "+i.name]-a[r]["_MA34 "+i.name]);i.outputMap={},i.outputMap[i.name+"_hist"]=""}},e.Studies.displayAwesomeOscillator=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs["Increasing Bar"]),c=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),s.fillStyle="#CCCCCC",t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var d=a[u],p=a[u-1];p||(p=t.getPreviousBar(t.chart,i.name+"_hist",u)),d&&(p&&(p[i.name+"_hist"]<d[i.name+"_hist"]?s.fillStyle=h:p[i.name+"_hist"]>d[i.name+"_hist"]&&(s.fillStyle=c)),d.candleWidth&&(l=Math.floor(Math.max(1,d.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(u,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(d[i.name+"_hist"],r,n)-o)))}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Awesome:{name:"Awesome Oscillator",seriesFN:e.Studies.displayAwesomeOscillator,calculateFN:e.Studies.calculateAwesomeOscillator,inputs:{},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}}})):console.error("awesomeOscillator feature requires first activating studies feature.")},m=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateBalanceOfPower=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.startFrom;r<a.length;r++){var s=a[r];s["_Ratio "+i.name]=s.Close-s.Open,s.High-s.Low!=0&&(s["_Ratio "+i.name]/=s.High-s.Low)}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Ratio "+i.name,0,"Result",t,i)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Bal Pwr":{name:"Balance of Power",range:"-1 to 1",centerline:0,calculateFN:e.Studies.calculateBalanceOfPower,inputs:{Period:14,"Moving Average Type":"ma"}}})):console.error("balanceOfPower feature requires first activating studies feature.")},g=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateBollinger=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,a,0,"_MA",t,i),i.std=new e.Studies.StudyDescriptor(i.name,"STD Dev",i.panel),i.std.chart=i.chart,i.std.startFrom=i.startFrom,i.std.days=i.days,i.std.inputs={Field:a,"Standard Deviations":1,Type:i.inputs["Moving Average Type"]},i.std.outputs={"_STD Dev":null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.calculateGenericEnvelope(t,i,i.inputs["Standard Deviations"],"_MA "+i.name,"_STD Dev "+i.name),"Boll %b"==i.type&&(i.zoneOutput="%b")},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Bollinger Bands":{name:"Bollinger Bands",overlay:!0,calculateFN:e.Studies.calculateBollinger,seriesFN:e.Studies.displayChannel,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"Bollinger Bands Top":"auto","Bollinger Bands Median":"auto","Bollinger Bands Bottom":"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Boll %b":{name:"Bollinger %b",calculateFN:e.Studies.calculateBollinger,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},outputs:{"%b":"auto"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:0,studyOverSoldColor:"auto"}},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Boll BW":{name:"Bollinger Bandwidth",calculateFN:e.Studies.calculateBollinger,inputs:{Period:20,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},outputs:{Bandwidth:"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}}})):console.error("bollinger feature requires first activating studies feature.")},f=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateCCI=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.MA("simple",i.days,"hlc/3",0,"MA",t,i);for(var r=Math.max(i.startFrom,i.days-1);r<a.length;r++){var s=a[r];if(s){for(var n=0,o=0;o<i.days;o++)n+=Math.abs(a[r-o]["hlc/3"]-s["MA "+i.name]);n/=i.days,Math.abs(n)<1e-8?s["Result "+i.name]=0:s["Result "+i.name]=(s["hlc/3"]-s["MA "+i.name])/(.015*n)}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{CCI:{name:"Commodity Channel Index",calculateFN:e.Studies.calculateCCI,inputs:{Period:20},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:-100,studyOverSoldColor:"auto"}},attributes:{Period:{min:2}}}})):console.error("cci feature requires first activating studies feature.")},v=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateCenterOfGravity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");for(var r=Math.max(e.startFrom,e.days-1);r<i.length;r++){for(var s=0,n=0,o=0;o<e.days;o++){var l=i[r-o][a];s-=(o+1)*l,n+=l}n&&(i[r]["Result "+e.name]=s/n)}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{COG:{name:"Center Of Gravity",calculateFN:e.Studies.calculateCenterOfGravity,inputs:{Period:10,Field:"field"}}})):console.error("centerOfGravity feature requires first activating studies feature.")},y=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateChaikinMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,s=i[e.startFrom-1];s&&(s["_sumMF "+e.name]&&(a=s["_sumMF "+e.name]),s["_sumV "+e.name]&&(r=s["_sumV "+e.name]));for(var n=e.startFrom;n<i.length;n++)i[n].High==i[n].Low?i[n]["_MFV "+e.name]=0:i[n]["_MFV "+e.name]=i[n].Volume*(2*i[n].Close-i[n].High-i[n].Low)/(i[n].High-i[n].Low),a+=i[n]["_MFV "+e.name],r+=i[n].Volume,n>e.days-1&&(a-=i[n-e.days]["_MFV "+e.name],(r-=i[n-e.days].Volume)&&(i[n]["Result "+e.name]=a/r)),i[n]["_sumMF "+e.name]=a,i[n]["_sumV "+e.name]=r}},e.Studies.calculateChaikinVolatility=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{var r;for(r=i.startFrom;r<a.length&&!a[r].futureTick;r++)a[r]["_High-Low "+i.name]=a[r].High-a[r].Low;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_High-Low "+i.name,0,"_MA",t,i);var s=i.inputs["Rate Of Change"];for(s||(s=i.days),r=Math.max(i.startFrom,s);r<a.length;r++)if(a[r-s]["_MA "+i.name]){if(a[r].futureTick)break;a[r]["Result "+i.name]=100*(a[r]["_MA "+i.name]/a[r-s]["_MA "+i.name]-1)}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Chaikin MF":{name:"Chaikin Money Flow",calculateFN:e.Studies.calculateChaikinMoneyFlow,inputs:{Period:20}},"Chaikin Vol":{name:"Chaikin Volatility",calculateFN:e.Studies.calculateChaikinVolatility,inputs:{Period:14,"Rate Of Change":2,"Moving Average Type":"ma"}}})):console.error("chaikin feature requires first activating studies feature.")},x=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.prettify.variable="vma",e.Studies.movingAverage.conversions.vma="variable",e.Studies.movingAverage.translations.variable="Variable",e.Studies.movingAverage.typeMap.vma="Variable",e.Studies.movingAverage.typeMap.variable="Variable",e.Studies.calculateChandeForecast=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("time series",i.days,r,0,"MA",t,i);for(var s=Math.max(1,i.startFrom);s<a.length;s++){var n=a[s][r];n&&"object"==typeof n&&(n=n[i.subField]),a[s]["Result "+i.name]=100*(1-a[s]["MA "+i.name]/n)}}},e.Studies.calculateChandeMomentum=function(t,e){var i=e.name;for(var a in e.outputs)i=a+" "+i;var r=e.chart.scrubbed;if(r.length<e.days+1)e.error=!0;else{var s=e.inputs.Field;s&&"field"!=s||(s="Close");for(var n=0,o=0,l=[],h=e.startFrom-e.days+1;h<r.length;h++)if(!(h<1)){var c=r[h][s],u=r[h-1][s];if(c&&"object"==typeof c&&(c=c.Close),u&&"object"==typeof u&&(u=u.Close),void 0!==u){var d=c-u;if(l.push(d),n+=d,o+=Math.abs(d),l.length==e.days){r[h][i]=100*n/o;var p=l.shift();n-=p,o-=Math.abs(p)}}}}},e.Studies.calculateMovingAverageVariable=function(t,i){i.inputs.Type;var a=i.chart.scrubbed,r=2/(i.days+1),s=null,n=i.name;for(var o in i.outputs)n=o+" "+n;var l=i.inputs.Field;l&&"field"!=l||(l="Close"),i.cmo=new e.Studies.StudyDescriptor(i.name,"cmo",i.panel),i.cmo.chart=i.chart,i.cmo.days=9,i.cmo.inputs={Field:l},i.cmo.startFrom=i.startFrom,i.cmo.outputs={_CMO:null},e.Studies.calculateChandeMomentum(t,i.cmo);var h,c,u,d=parseInt(i.inputs.Offset,10);isNaN(d)&&(d=0);var p=i.startFrom,m=d;for(h=i.startFrom-1;h>=0;h--)if((c=a[h][n])||0===c){if(null===s&&(s=c),m<=0)break;m--,p=h}null===s&&(s=p=0);var g=[];for(h=p;h<a.length;h++){var f=a[h];(c=f[l])&&"object"==typeof c&&(c=c[i.subField]);var v=h+d>=0&&h+d<a.length?a[h+d]:null;if(c||0===c){if(f["_CMO "+i.name]||0===f["_CMO "+i.name]){var y=Math.abs(f["_CMO "+i.name])/100,x=r*y*c+(1-r*y)*s;s=x,h<i.days&&(x=null),v?v[n]=x:h+d>=a.length&&((u={})[n]=x,g.push(u))}}else v?v[n]=null:h+d>=a.length&&((u={})[n]=null,g.push(u))}i.appendFutureTicks(t,g)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Chande Fcst":{name:"Chande Forecast Oscillator",calculateFN:e.Studies.calculateChandeForecast,inputs:{Period:14,Field:"field"}},"Chande Mtm":{name:"Chande Momentum Oscillator",calculateFN:e.Studies.calculateChandeMomentum,inputs:{Period:9},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:50,studyOverBoughtColor:"auto",studyOverSoldValue:-50,studyOverSoldColor:"auto"}}}})):console.error("chande feature requires first activating studies feature.")},b=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateChoppiness=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else for(var r=Math.max(i.startFrom,i.days);r<a.length;r++){var s=a[r];if(s){if(s.futureTick)break;var n=o(i.days,r);s["Sum True Range "+i.name]?s["Result "+i.name]=100*Math.log(s["Sum True Range "+i.name]/Math.max(1e-6,n[1]-n[0]))/Math.log(i.days):isNaN(s)||(s["Result "+i.name]=0)}}function o(t,e){for(var i=-1*Number.MAX_VALUE,r=Number.MAX_VALUE,s=e-t+1;s<=e;s++)s<0||(i=Math.max(i,a[s].High),r=Math.min(r,a[s].Low));return[r,i]}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Choppiness:{name:"Choppiness Index",calculateFN:e.Studies.calculateChoppiness,centerline:50,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:61.8,studyOverBoughtColor:"auto",studyOverSoldValue:38.2,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:50,step:"0.1"},studyOverSoldValue:{max:50,step:"0.1"}}}})):console.error("choppiness feature requires first activating studies feature.")},S=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?e.Studies.initPriceRelative?(e.Studies.calculateCorrelationCoefficient=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{if(e.compare=e.inputs["Compare To"],e.compare)e.compare=[e.compare];else for(var r in e.compare=[],e.outputs={},e.outputMap={},t.chart.series){var s=t.chart.series[r];s.parameters.color&&(e.compare.push(s.display),e.outputs["Result "+s.display]=s.parameters.color,e.outputMap["Result "+s.display+" "+e.name]="Result "+s.display)}if(e.compare.length){for(var n=0;n<e.compare.length;n++)for(var o=0,l=0,h=0,c=0,u=0,d=e.compare[n],p=0,m=e.startFrom-a;m<i.length;m++)if(i[m]){var g=i[m][d];if(g&&"object"==typeof g&&(g=g.Close),g||0===g||(g=m>0&&i[m-1]&&i[m-1]["_temps "+e.name]&&i[m-1]["_temps "+e.name].c?i[m-1]["_temps "+e.name].c:0),g&&"object"==typeof g&&(g=g.Close),i[m]["_temps "+e.name]={},o+=i[m]["_temps "+e.name].b=i[m].Close,l+=i[m]["_temps "+e.name].c=g,h+=i[m]["_temps "+e.name].b2=Math.pow(i[m].Close,2),c+=i[m]["_temps "+e.name].c2=Math.pow(g,2),u+=i[m]["_temps "+e.name].bc=i[m].Close*g,p>=a){o-=i[m-a]["_temps "+e.name].b,l-=i[m-a]["_temps "+e.name].c,h-=i[m-a]["_temps "+e.name].b2,c-=i[m-a]["_temps "+e.name].c2,u-=i[m-a]["_temps "+e.name].bc;var f=h/a-Math.pow(o/a,2),v=c/a-Math.pow(l/a,2),y=(u/a-o*l/Math.pow(a,2))/Math.sqrt(f*v);i[m]["Result "+d+" "+e.name]=y}p++}}else e.error="Correlation Coefficient requires at least one comparison symbol"}},e.Studies.calculatePerformance=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();if(r||(r=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),a.length<i.days+1)i.error=!0;else{e.Studies.MA("ma",i.days,"Close",0,"_MA Base",t,i),e.Studies.MA("ma",i.days,r,0,"_MA Comp",t,i);for(var s=i.startFrom;s<a.length;s++){var n=a[s][r];n&&(n.Close||0===n.Close)&&(n=n.Close),a[s]["Result "+i.name]=a[s].Close/n*(a[s]["_MA Comp "+i.name]/a[s]["_MA Base "+i.name])}}},e.Studies.calculateBeta=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();if(r||(r=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),a.length<i.days+1)i.error=!0;else{for(var s=Math.max(i.startFrom,1);s<a.length;s++){a[s]["_BaseChange "+i.name]=a[s].Close/a[s-1].Close-1;var n=a[s][r];n&&(n.Close||0===n.Close)&&(n=n.Close);var o=a[s-1][r];o&&(o.Close||0===o.Close)&&(o=o.Close),a[s]["_CompChange "+i.name]=n/o-1}for(e.Studies.MA("ma",i.days,"_BaseChange "+i.name,0,"_MA Base",t,i),e.Studies.MA("ma",i.days,"_CompChange "+i.name,0,"_MA Comp",t,i),s=Math.max(i.startFrom,i.days);s<a.length;s++)a[s]["_COVARn "+i.name]=(a[s]["_BaseChange "+i.name]-a[s]["_MA Base "+i.name])*(a[s]["_CompChange "+i.name]-a[s]["_MA Comp "+i.name]),a[s]["_VARn "+i.name]=Math.pow(a[s]["_CompChange "+i.name]-a[s]["_MA Comp "+i.name],2);for(e.Studies.MA("ma",i.days,"_COVARn "+i.name,0,"_COVAR",t,i),e.Studies.MA("ma",i.days,"_VARn "+i.name,0,"_VAR",t,i),s=Math.max(i.startFrom,2*i.days-1);s<a.length;s++)a[s]["Result "+i.name]=a[s]["_COVAR "+i.name]/a[s]["_VAR "+i.name]}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{correl:{name:"Correlation Coefficient",range:"-1 to 1",calculateFN:e.Studies.calculateCorrelationCoefficient,outputs:{}},"Perf Idx":{name:"Performance Index",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePerformance,inputs:{Period:120,"Comparison Symbol":"SPY"},outputs:{Result:"auto",Gain:"#00DD00",Loss:"#FF0000"},deferUpdate:!0},Beta:{name:"Beta",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculateBeta,inputs:{Period:20,"Comparison Symbol":"SPY"},deferUpdate:!0}})):console.error("comparisonStudies feature requires first activating priceRelative feature."):console.error("comparisonStudies feature requires first activating studies feature.")},C=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateCoppock=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=parseInt(i.inputs["Long RoC"],10);s||(s=14);var n=parseInt(i.inputs["Short RoC"],10);n||(n=11);var o=i.days;if(o||(o=10),!(s<n))if(a.length<Math.max(n,s,o)+1)i.error=!0;else{for(var l=Math.max(i.startFrom,s);l<a.length;l++){var h=a[l-n][r],c=a[l-s][r];h&&c&&(a[l]["_Sum "+i.name]=100*(a[l][r]/h+a[l][r]/c-2))}e.Studies.MA("weighted",o,"_Sum "+i.name,0,"Result",t,i)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Coppock:{name:"Coppock Curve",calculateFN:e.Studies.calculateCoppock,inputs:{Period:10,Field:"field","Short RoC":11,"Long RoC":14}}})):console.error("coppock feature requires first activating studies feature.")},w=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateDarvas=function(t,i){var a=i.chart.scrubbed,r=0,s=parseInt(i.inputs["ATH Lookback Period"],10);i.inputs["Volume Spike"]&&e.Studies.MA("simple",s,"Volume",0,"ADV",t,i);var n,o=parseFloat(i.inputs["Volume % of Avg"])/100,l="none",h={},c=null,u=null,d=null,p=parseFloat(i.inputs["Level Offset"]),m=!1;var g={};for(["Darvas","Ghost","Profit","Loss","ATH","ADV","Spike"].forEach((function(t){g[t]=t+" "+i.name})),n=i.startFrom-1;n>0;n--){var f=a[n];if(!f[g.Darvas]&&!f[g.Ghost]){r=f[g.ATH]||0,u=f[g.Profit],d=f[g.Loss];break}for(var v in g)f[v]=null}for(;n<a.length;n++){var y=a[n];if(y){if(parseFloat(i.inputs["Price Minimum"])<=a[r].Close){if(!c||c.End&&n!=c.End+1||(a[n-1].Close>h.High?h={State:1,High:2*h.High-h.Low,Low:h.High,Start:n,End:2*h.End-h.Start+1}:c=null,c&&(y[g.Ghost]=e.clone(h),h.State=0,a[h.End]&&(a[h.End][g.Ghost]=e.clone(h)),c={Start:h.Start,End:h.End},u=h.High+p,(!d||d<h.Low-p)&&(d=h.Low-p))),y[g.Profit]=u,y[g.Loss]=d,(y.Close>=u||"high/low"==i.inputs["Exit Field"]&&y.High>=u)&&(u=null),"none"==l&&n==r+3&&!a[r+2][g.Darvas]&&!a[r+1][g.Darvas]&&!a[r][g.Darvas]&&a[r].High>y.High&&(l="high"),"high"==l&&(y.High>a[r].High?l="none":a[n-3].Low<a[n-2].Low&&a[n-3].Low<a[n-1].Low&&a[n-3].Low<y.Low&&(h={State:1,High:a[r].High,Low:a[n-3].Low,Start:r},a[r][g.Darvas]=e.clone(h),l="darvas",c&&(c.End>n&&a[c.Start]&&(y[g.Ghost]=e.clone(a[c.Start][g.Ghost]),y[g.Ghost].End=n,a[c.End]&&delete a[c.End][g.Ghost]),y[g.Ghost].State=0,a[c.Start][g.Ghost].End=n,c=null),u=h.High+p,(!d||d<h.Low-p)&&(d=h.Low-p))),"darvas"==l&&(y.Close>h.High||"high/low"==i.inputs["Exit Field"]&&y.High>h.High?c={}:(y.Close<h.Low||"high/low"==i.inputs["Exit Field"]&&y.Low<h.Low)&&(l="none"),c?l="none":"none"==l&&(u=null,d=null),i.inputs["Ghost Boxes"]||(c=null),"none"==l)){for(var x=h.Start+1;x<n;x++)a[x][g.Darvas]=e.clone(h);h.State=0,h.End=n,y[g.Darvas]=e.clone(h),y[g.ATH]=r;continue}d&&(y.Close<h.Low||"high/low"==i.inputs["Exit Field"]&&y.Low<h.Low)&&("darvas"==l&&(l="none"),(y.Close<d||"high/low"==i.inputs["Exit Field"]&&y.Low<d)&&(u=null,d=null),c&&(c.End>n&&a[c.Start]&&(y[g.Ghost]=e.clone(a[c.Start][g.Ghost]),y[g.Ghost].End=n,a[c.End]&&delete a[c.End][g.Ghost]),y[g.Ghost].State=0,a[c.Start][g.Ghost].End=n,c=null))}if(y.High>=a[r].High&&(r=n),(n<3||y.High>=a[n-1].High&&y.High>=a[n-2].High&&y.High>=a[n-3].High)&&n-r>=s){r=n;for(var b=0;b<s&&!(n-b<0);b++)a[n-b].High>a[r].High&&(r=n-b);m}i.inputs["Volume Spike"]&&n>s&&n==r&&y[g.ADV]*o<y.Volume&&(y[g.Spike]=1),y[g.ATH]=r}}},e.Studies.displayDarvas=function(t,i,a){var r=e.Studies.determineColor(i.outputs.Levels);r&&"auto"!=r&&!e.isTransparent(r)||(r=t.defaultColor);var s=e.Studies.determineColor(i.outputs.Darvas);s&&"auto"!=s&&!e.isTransparent(s)||(s=t.defaultColor);var n=e.Studies.determineColor(i.outputs.Ghost);n&&"auto"!=n&&!e.isTransparent(n)||(n=t.defaultColor);var o,l,h,c,u=t.panels[i.panel],d=i.getContext(t),p=t.layout.candleWidth-2;if(p<2&&(p=1),t.startClip(i.panel),i.inputs["Stop Levels"]){for(d.setLineDash&&d.setLineDash([2,2]),d.lineWidth=2,d.strokeStyle=r,d.beginPath(),o=0;o<a.length;o++){l=a[o];var m=a[o-1];if(l){c=l["Loss "+i.name]?Math.floor(t.pixelFromPrice(l["Loss "+i.name],u)):null;var g=m&&m["Loss "+i.name]?Math.floor(t.pixelFromPrice(m["Loss "+i.name],u)):null;if(c){l.candleWidth&&(p=Math.floor(Math.max(1,l.candleWidth)));var f=Math.floor(t.pixelFromBar(o,u.chart)+p/2),v=Math.floor(t.pixelFromBar(o,u.chart)-p/2);g&&g>=c?d.lineTo(v,c):0===o?d.moveTo(t.chart.left,c):d.moveTo(v,c),d.lineTo(f,c)}}}d.stroke(),d.setLineDash&&d.setLineDash([]),d.lineWidth=1}var y,x,b,S,C=-10,w=0,k=-10,D=0,T=!1,M=!1,A=d.measureText("▲").width/2,_=0;for(o=0;o<a.length;o++)if(a[o]){if((a[o].Close||0===a[o].Close)&&(_=o),a[o]["Spike "+i.name]){d.fillStyle=s,d.textBaseline="bottom";var F=t.pixelFromPrice(a[o].High,t.chart.panel);d.fillText("▼",t.pixelFromBar(o)-A,F-5)}a[o].candleWidth&&(p=Math.floor(Math.max(1,a[o].candleWidth))),a[o]["Darvas "+i.name]&&(1!=(l=a[o]["Darvas "+i.name]).State||T?0===l.State&&(w=Math.floor(t.pixelFromBar(o,u.chart)+p/2)-C,y=Math.floor(t.pixelFromPrice(l.High,u)),x=Math.floor(t.pixelFromPrice(l.Low,u))-y,d.strokeStyle=s,d.fillStyle=s,i.inputs["Stop Levels"]?d.globalAlpha=.3:(d.strokeRect(C,y,w,x),d.globalAlpha=.2),d.fillRect(C,y,w,x),d.globalAlpha=1,T=!1):(C=Math.floor(t.pixelFromBar(o,u.chart)-p/2),y=Math.floor(t.pixelFromPrice(l.High,u)),x=Math.floor(t.pixelFromPrice(l.Low,u))-y,T=!0)),a[o]["Ghost "+i.name]&&i.inputs["Ghost Boxes"]&&(1!=(l=a[o]["Ghost "+i.name]).State||M?0===l.State&&(l.Start==l.End&&(k=Math.floor(t.pixelFromBar(o,u.chart)-p/2)),D=Math.floor(t.pixelFromBar(o,u.chart)+p/2)-k,b=Math.floor(t.pixelFromPrice(l.High,u)),S=Math.floor(t.pixelFromPrice(l.Low,u))-b,d.strokeStyle=n,d.fillStyle=n,i.inputs["Stop Levels"]?d.globalAlpha=.3:(d.strokeRect(k,b,D,S),d.globalAlpha=.2),d.fillRect(k,b,D,S),d.globalAlpha=1,M=!1):(k=Math.floor(t.pixelFromBar(o,u.chart)-p/2),b=Math.floor(t.pixelFromPrice(l.High,u)),D=Math.floor((l.End-l.Start+1)*t.layout.candleWidth+p/2),S=Math.floor(t.pixelFromPrice(l.Low,u))-b,M=!0))}if(T&&(w=Math.floor(t.pixelFromBar(_,u.chart)+p/2)-C,d.strokeStyle=s,d.fillStyle=s,i.inputs["Stop Levels"]?d.globalAlpha=.3:(d.beginPath(),d.moveTo(C+2*w,y),d.lineTo(C,y),d.lineTo(C,y+x),d.lineTo(C+2*w,y+x),d.stroke(),d.globalAlpha=.2),d.fillRect(C,y,2*w,x),d.globalAlpha=1),M&&(d.strokeStyle=n,d.fillStyle=n,i.inputs["Stop Levels"]?d.globalAlpha=.3:(d.strokeRect(k,b,D,S),d.globalAlpha=.2),d.fillRect(k,b,D,S),d.globalAlpha=1),T||M){if(i.inputs["Stop Levels"]){d.setLineDash&&d.setLineDash([2,2]),d.lineWidth=2,d.strokeStyle=r;var P=Math.floor(t.pixelFromBar(_-1,u.chart)+p/2);h,c&&(d.beginPath(),d.moveTo(P,c),d.lineTo(T?C+2*w:k+D,c),d.stroke()),d.setLineDash&&d.setLineDash([]),d.lineWidth=1}T=!1,M=!1}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Darvas:{name:"Darvas Box",underlay:!0,calculateFN:e.Studies.calculateDarvas,seriesFN:e.Studies.displayDarvas,inputs:{"ATH Lookback Period":100,"Exit Field":["close","high/low"],"Ghost Boxes":!0,"Stop Levels":!1,"Level Offset":.01,"Price Minimum":5,"Volume Spike":!1,"Volume % of Avg":400},outputs:{Darvas:"#5F7CB8",Ghost:"#699158",Levels:"auto"},customRemoval:!0,attributes:{"Price Minimum":{min:.01,step:.01},yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0},flippedEnabled:{hidden:!0}}}})):console.error("darvasBox feature requires first activating studies feature.")},k=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateDetrendedPrice=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=Math.floor(i.days/2+1);e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,-s,"MA",t,i);for(var n=Math.max(i.days-s-1,i.startFrom-s);n<a.length-s;n++)if(!(n<0)){var o=a[n][r];o&&"object"==typeof o&&(o=o[i.subField]);var l=a[n]["MA "+i.name];!o&&0!==o||!l&&0!==l||(a[n]["Result "+i.name]=o-l)}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Detrended:{name:"Detrended Price Oscillator",calculateFN:e.Studies.calculateDetrendedPrice,inputs:{Period:14,Field:"field","Moving Average Type":"ma"}}})):console.error("detrended feature requires first activating studies feature.")},D=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateDisparity=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,0,"_MA",t,i);for(var s=Math.max(i.startFrom,i.days-1);s<a.length;s++)if(a[s]){var n=a[s]["_MA "+i.name];n&&(a[s]["Result "+i.name]=100*(a[s][r]/n-1))}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Disparity:{name:"Disparity Index",calculateFN:e.Studies.calculateDisparity,inputs:{Period:14,Field:"field","Moving Average Type":"ma"}}})):console.error("disparity feature requires first activating studies feature.")},T=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateEaseOfMovement=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{for(var r=Math.max(1,i.startFrom);r<a.length;r++){var s=((a[r].High+a[r].Low)/2-(a[r-1].High+a[r-1].Low)/2)/(a[r].Volume/1e8/(a[r].High-a[r].Low));isFinite(s)?a[r]["_EOM1 "+i.name]=s:a[r]["_EOM1 "+i.name]=NaN}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_EOM1 "+i.name,0,"Result",t,i)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{EOM:{name:"Ease of Movement",calculateFN:e.Studies.calculateEaseOfMovement,inputs:{Period:14,"Moving Average Type":"ma"}}})):console.error("easeOfMovement feature requires first activating studies feature.")},M=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateEhlerFisher=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0;e.startFrom>1&&(a=i[e.startFrom-1]["_n "+e.name]);for(var r=e.startFrom;r<i.length;r++){var s=i[r];if(s.futureTick)break;if(r<e.days-1)s["EF "+e.name]=s["EF Trigger "+e.name]=a;else{var n=l(e.days,r);(a=.66*(((i[r].High+i[r].Low)/2-n[0])/Math.max(1e-6,n[1]-n[0])-.5)+.67*a)>0?a=Math.min(a,.9999):a<0&&(a=Math.max(a,-.9999));var o=r?i[r-1]["EF "+e.name]:0;s["EF "+e.name]=.5*Math.log((1+a)/(1-a))+.5*o,s["EF Trigger "+e.name]=o,s["_n "+e.name]=a}}}function l(t,e){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,s=e-t+1;s<=e;s++){var n=(i[s].High+i[s].Low)/2;a=Math.min(a,n),r=Math.max(r,n)}return[a,r]}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Ehler Fisher":{name:"Ehler Fisher Transform",calculateFN:e.Studies.calculateEhlerFisher,inputs:{Period:10},outputs:{EF:"auto","EF Trigger":"#FF0000"}}})):console.error("ehlerFisher feature requires first activating studies feature.")},A=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateElderImpulse=function(t,i){var a,r=i.chart.scrubbed,s=i.outputs.Bullish,n=i.outputs.Bearish,o=i.outputs.Neutral;e.Studies.MA("exponential",13,"Close",0,"_MA",t,i),i.macd=new e.Studies.StudyDescriptor("_"+i.name,"macd",i.panel),i.macd.chart=i.chart,i.macd.days=i.days,i.macd.startFrom=i.startFrom,i.macd.inputs={"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},i.macd.outputs={_MACD:null,_Signal:null},e.Studies.calculateMACD(t,i.macd);for(var l=i.startFrom;l<r.length;l++)a=0===l?o:r[l]["_MA "+i.name]>r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]>r[l-1]["_"+i.name+"_hist"]?s:r[l]["_MA "+i.name]<r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]<r[l-1]["_"+i.name+"_hist"]?n:o,r[l]["Result "+i.name]=a},e.Studies.calculateElderRay=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{e.Studies.MA("exponential",i.days,"Close",0,"_EMA",t,i);for(var r=Math.max(i.startFrom,i.days-1);r<a.length;r++)a[r][i.name+"_hist1"]=a[r].High-a[r]["_EMA "+i.name],a[r][i.name+"_hist2"]=a[r].Low-a[r]["_EMA "+i.name];i.outputMap={},i.outputMap[i.name+"_hist1"]="",i.outputMap[i.name+"_hist2"]=""}},e.Studies.calculateElderForce=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{for(var r=Math.max(1,i.startFrom);r<a.length;r++)a[r]["_EF1 "+i.name]=a[r].Volume*(a[r].Close-a[r-1].Close);e.Studies.MA("exponential",i.days,"_EF1 "+i.name,0,"Result",t,i)}},e.Studies.initElderImpulse=function(t,i,a,r,s,n){var o=e.Studies.initializeFN(t,i,a,r,s,n);return s.calculateOnly||(t.chart.customChart={chartType:"colored_bar",colorFunction:function(t,e,i){var a=e["Result "+o.name];return a&&"object"==typeof a&&(a=a.color),a}},t.setMainSeriesRenderer()),o},e.Studies.displayElderForce=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=e.Studies.determineColor(i.outputs.Result),s=t.panels[i.panel],n=i.getYAxis(t),o={skipTransform:s.name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:0,color:r,yAxis:n};!i.highlight&&t.highlightedDraggable&&(o.opacity=.3),o.direction=1,e.preparePeakValleyFill(t,o),o.direction=-1,e.preparePeakValleyFill(t,o)},e.Studies.displayElderRay=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;function h(a,h,c,u){s.fillStyle=e.Studies.determineColor(i.outputs[c]),s.fillRect(Math.floor(t.pixelFromBar(a,r.chart)-l/2+l*h),Math.floor(o),Math.floor(l*(1-2*h)),Math.floor(t.pixelFromPrice(d[i.name+u],r,n)-o))}l<2&&(l=1),t.canvasColor("stx_histogram");var c=s.fillStyle;i.underlay||(s.globalAlpha=1),t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var d=a[u];d&&(d.candleWidth&&(l=Math.floor(Math.max(1,d.candleWidth-2))),d[i.name+"_hist1"]>0&&h(u,0,"Elder Bull Power","_hist1"),d[i.name+"_hist2"]<0&&h(u,0,"Elder Bear Power","_hist2"),d[i.name+"_hist1"]<0&&h(u,.1,"Elder Bull Power","_hist1"),d[i.name+"_hist2"]>0&&h(u,.1,"Elder Bear Power","_hist2"))}t.endClip(),s.fillStyle=c},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Elder Force":{name:"Elder Force Index",calculateFN:e.Studies.calculateElderForce,seriesFN:e.Studies.displayElderForce,inputs:{Period:13}},"Elder Ray":{name:"Elder Ray Index",seriesFN:e.Studies.displayElderRay,calculateFN:e.Studies.calculateElderRay,centerline:0,inputs:{Period:13},outputs:{"Elder Bull Power":"#00DD00","Elder Bear Power":"#FF0000"}},"Elder Impulse":{name:"Elder Impulse System",calculateFN:e.Studies.calculateElderImpulse,initializeFN:e.Studies.initElderImpulse,seriesFN:null,customRemoval:!0,underlay:!0,inputs:{},outputs:{Bullish:"#8BC176",Bearish:"#DD3E39",Neutral:"#5F7CB8"},removeFN:function(t,e){t.chart.customChart=null,t.setMainSeriesRenderer()}}})):console.error("elder feature requires first activating studies feature.")},_=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateFractalChaos=function(t,e){var i=e.chart.scrubbed,a=0,r=0,s=0;e.startFrom&&"Fractal Chaos Bands"==e.type&&(a=i[e.startFrom-1]["Fractal High "+e.name],r=i[e.startFrom-1]["Fractal Low "+e.name]);for(var n=Math.max(4,e.startFrom);n<i.length&&!i[n].futureTick;n++){var o,l=!isNaN(i[n].High),h=!isNaN(i[n].Low);for((l||h)&&(i[n]["Result "+e.name]=0),s=0,o=0;o<=n&&i[n-o]&&!(i[n-o].High>i[n-2].High)&&!(o<2&&i[n-o].High==i[n-2].High);o++)if(i[n-o].High<i[n-2].High&&s++,4==s){a=i[n-2].High;break}for("Fractal Chaos Bands"==e.type?l&&(i[n]["Fractal High "+e.name]=a>0?a:null):4==s&&(i[n]["Result "+e.name]=1),s=0,o=0;o<=n&&i[n-o]&&!(i[n-o].Low<i[n-2].Low)&&!(o<2&&i[n-o].Low==i[n-2].Low);o++)if(i[n-o].Low>i[n-2].Low&&s++,4==s){r=i[n-2].Low;break}"Fractal Chaos Bands"==e.type?h&&(i[n]["Fractal Low "+e.name]=r>0?r:null):4==s&&(i[n]["Result "+e.name]=-1)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Fractal Chaos":{name:"Fractal Chaos Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculateFractalChaos,inputs:{},centerline:null},"Fractal Chaos Bands":{name:"Fractal Chaos Bands",overlay:!0,calculateFN:e.Studies.calculateFractalChaos,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Fractal High":"auto","Fractal Low":"auto","Fractal Channel":"auto"}}})):console.error("fractalChaos feature requires first activating studies feature.")},F=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateMaxHighMinLow=function(t,e){var i=e.chart.scrubbed,a=e.days,r=e.days;if(e.inputs["High Period"]&&(a=e.inputs["High Period"]),e.inputs["Low Period"]&&(r=e.inputs["Low Period"]),i.length<Math.max(a,r)+1)e.error=!0;else{var s,n=Number.MAX_VALUE,o=-1*Number.MAX_VALUE;if(e.startFrom>1){for(s=1;s<a;s++)e.startFrom-s>=0&&(o=Math.max(o,i[e.startFrom-s].High));for(s=1;s<r;s++)e.startFrom-s>=0&&(n=Math.min(n,i[e.startFrom-s].Low))}for(var l=Math.max(0,e.startFrom-1);l<i.length;l++){if(o=Math.max(o,i[l].High),n=Math.min(n,i[l].Low),l>=a&&i[l-a].High==o)for(o=i[l].High,s=1;s<a;s++)o=Math.max(o,i[l-s].High);if(l>=r&&i[l-r].Low==n)for(n=i[l].Low,s=1;s<r;s++)n=Math.min(n,i[l-s].Low);var h=0;if("HHV"==e.type)h=o;else if("LLV"==e.type)h=n;else if("Donchian Width"==e.type)h=o-n;else if("GAPO"==e.type||"Gopala"==e.type)h=Math.log(o-n)/Math.log(r);else{if("VT HZ Filter"==e.type){h=o-n,i[l]["_MHML "+e.name]=h;continue}if("Williams %R"==e.type){h=-100*(o-i[l].Close)/(o-n),i[l]["Result "+e.name]=h;continue}}if(l==i.length-1)break;i[l+1].futureTick||("Donchian Channel"==e.type?(i[l+1]["Donchian High "+e.name]=o,i[l+1]["Donchian Low "+e.name]=n,i[l+1]["Donchian Median "+e.name]=(o+n)/2):i[l+1]["Result "+e.name]=h)}}},e.Studies.calculateVerticalHorizontalFilter=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{i.mhml=new e.Studies.StudyDescriptor(i.name,i.type,i.panel),i.mhml.chart=i.chart,i.mhml.days=i.days,i.mhml.startFrom=i.startFrom,i.mhml.inputs={},i.mhml.outputs={_MHML:null},e.Studies.calculateMaxHighMinLow(t,i.mhml);for(var r=0,s=[],n=Math.max(1,i.startFrom-i.days);n<a.length;n++){var o=Math.abs(a[n].Close-a[n-1].Close);s.push(o),r+=o,s.length==i.days&&(a[n]["Result "+i.name]=a[n]["_MHML "+i.name]/r,r-=s.shift())}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Donchian Channel":{name:"Donchian Channel",overlay:!0,calculateFN:e.Studies.calculateMaxHighMinLow,seriesFN:e.Studies.displayChannel,inputs:{"High Period":20,"Low Period":20,"Channel Fill":!0},outputs:{"Donchian High":"auto","Donchian Median":"auto","Donchian Low":"auto"}},"Donchian Width":{name:"Donchian Width",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{"High Period":20,"Low Period":20}},GAPO:{name:"Gopalakrishnan Range Index",calculateFN:e.Studies.calculateMaxHighMinLow},HHV:{name:"Highest High Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},LLV:{name:"Lowest Low Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},"Williams %R":{name:"Williams %R",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:-20,studyOverBoughtColor:"auto",studyOverSoldValue:-80,studyOverSoldColor:"auto"}}},"VT HZ Filter":{name:"Vertical Horizontal Filter",calculateFN:e.Studies.calculateVerticalHorizontalFilter,inputs:{Period:28}},"High-Low":{name:"High Minus Low",calculateFN:function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)i[a]["Result "+e.name]=i[a].High-i[a].Low},inputs:{}}})):console.error("highLowStudies feature requires first activating studies feature.")},P=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateIchimoku=function(t,e){var i,a,r=e.chart.scrubbed,s={Base:Number(e.inputs["Base Line Period"]),Conv:Number(e.inputs["Conversion Line Period"]),LeadB:Number(e.inputs["Leading Span B Period"]),Lag:Number(e.inputs["Lagging Span Period"])};function n(t,e){for(var i=Number.MAX_VALUE,a=-1*Number.MAX_VALUE,s=e-t+1;s<=e;s++)s<0||(i=Math.min(i,r[s].Low),a=Math.max(a,r[s].High));return[i,a]}for(i=e.startFrom;i<r.length;i++)r[i]&&(a=n(s.Conv,i),r[i]["Conversion Line "+e.name]=(a[1]+a[0])/2,a=n(s.Base,i),r[i]["Base Line "+e.name]=(a[1]+a[0])/2,i<s.Lag||(r[i-s.Lag]["Lagging Span "+e.name]=r[i].Close));var o=[];for(i=Math.max(0,e.startFrom-s.Base);i<r.length;i++){a=n(s.LeadB,i);var l=(r[i]["Conversion Line "+e.name]+r[i]["Base Line "+e.name])/2,h=(a[1]+a[0])/2;if(r[i+s.Base])r[i+s.Base]["Leading Span A "+e.name]=l,r[i+s.Base]["Leading Span B "+e.name]=h;else{var c={};c["Leading Span A "+e.name]=l,c["Leading Span B "+e.name]=h,o.push(c)}}e.appendFutureTicks(t,o)},e.Studies.displayIchimoku=function(t,i,a){var r="Leading Span A "+i.name,s="Leading Span B "+i.name,n=e.Studies.determineColor(i.outputs[i.outputMap[r]]),o=e.Studies.determineColor(i.outputs[i.outputMap[s]]),l=t.panels[i.panel],h=i.getYAxis(t),c={topBand:r,bottomBand:s,topColor:n,bottomColor:o,skipTransform:l.name!=i.chart.name,topAxis:h,bottomAxis:h,opacity:.3};!i.highlight&&t.highlightedDraggable&&(c.opacity*=.3),e.fillIntersecting(t,i.panel,c),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Ichimoku Clouds":{name:"Ichimoku Clouds",overlay:!0,calculateFN:e.Studies.calculateIchimoku,seriesFN:e.Studies.displayIchimoku,inputs:{"Conversion Line Period":9,"Base Line Period":26,"Leading Span B Period":52,"Lagging Span Period":26},outputs:{"Conversion Line":"#0000FF","Base Line":"#FF0000","Leading Span A":"#00FF00","Leading Span B":"#FF0000","Lagging Span":"#808000"}}})):console.error("ichimoku feature requires first activating studies feature.")},I=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateIntradayMomentum=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{var r=0,s=0;e.startFrom>1&&(r=i[e.startFrom-1]["_totUp "+e.name],s=i[e.startFrom-1]["_totDn "+e.name]);for(var n=e.startFrom;n<i.length;n++){var o=i[n].Close-i[n].Open;if(o>0?r+=o:s-=o,n>=a){var l=i[n-a].Close-i[n-a].Open;l>0?r-=l:s+=l}i[n]["Result "+e.name]=100*r/(r+s),i[n]["_totUp "+e.name]=r,i[n]["_totDn "+e.name]=s}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Intraday Mtm":{name:"Intraday Momentum Index",calculateFN:e.Studies.calculateIntradayMomentum,inputs:{Period:20},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}}})):console.error("intradayMomentum feature requires first activating studies feature.")},L=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateKeltner=function(t,i){e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Close",0,"MA",t,i),e.Studies.calculateStudyATR(t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,"MA "+i.name,"ATR "+i.name)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Keltner:{name:"Keltner Channel",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateKeltner,inputs:{Period:50,Shift:5,"Moving Average Type":"ema","Channel Fill":!0},outputs:{"Keltner Top":"auto","Keltner Median":"auto","Keltner Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}}})):console.error("keltner feature requires first activating studies feature.")},E=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateKlinger=function(t,i){var a=i.chart.scrubbed,r=Number(i.inputs["Short Cycle"]),s=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,s)+1)i.error=!0;else{var n,o=i.name+"_hist",l="Klinger "+i.name,h="KlingerSignal "+i.name,c="_SV "+i.name,u="_EMA-S "+i.name,d="_EMA-L "+i.name;for(n=Math.max(1,i.startFrom);n<a.length;n++){var p=a[n].Volume;a[n]["hlc/3"]<a[n-1]["hlc/3"]&&(p*=-1),p&&(a[n][c]=p)}for(e.Studies.MA("exponential",r,c,0,"_EMA-S",t,i),e.Studies.MA("exponential",s,c,0,"_EMA-L",t,i),n=Math.max(s,i.startFrom);n<a.length&&(!a[n].futureTick&&null!==a[n][u]&&null!==a[n][d]);n++)a[n][l]=a[n][u]-a[n][d];for(e.Studies.MA("exponential",Number(i.inputs["Signal Periods"]),l,0,"KlingerSignal",t,i),n=i.startFrom;n<a.length;n++)a[n][o]=a[n][l]-a[n][h];i.outputMap[o]=""}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Klinger:{name:"Klinger Volume Oscillator",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateKlinger,inputs:{"Signal Periods":13,"Short Cycle":34,"Long Cycle":55},outputs:{Klinger:"auto",KlingerSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}}})):console.error("klinger feature requires first activating studies feature.")},N=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.prettify["time series"]="tsma",e.Studies.movingAverage.conversions.tsma="time series",e.Studies.movingAverage.translations["time series"]="Time Series",e.Studies.movingAverage.typeMap.tsma="TimeSeries",e.Studies.movingAverage.typeMap["time series"]="TimeSeries",e.Studies.calculateMovingAverageTimeSeries=function(t,i){i.ma=new e.Studies.StudyDescriptor(i.name,"ma",i.panel),i.ma.chart=i.chart,i.ma.days=i.days,i.ma.startFrom=i.startFrom,i.ma.inputs=i.inputs,e.Studies.calculateLinearRegressionIndicator(t,i.ma);var a=i.name;for(var r in i.outputs)a=r+" "+a;var s=parseInt(i.inputs.Offset,10);isNaN(s)&&(s=0);for(var n=i.chart.scrubbed,o=s,l=i.startFrom-1;l>=0;l--){var h=n[l][a];if(h||0===h){if(!(o>0))break;o--}}var c=[];for(l++;l<n.length;l++){var u=n[l];if(l+s>=0)if(l+s<n.length)n[l+s][a]=u["Forecast "+i.name];else{var d={};d[a]=u["Forecast "+i.name],c.push(d)}}i.appendFutureTicks(t,c)},e.Studies.calculateLinearRegressionIndicator=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.days*(e.days+1)/2,s=Math.pow(r,2),n=r*(2*e.days+1)/3,o=0,l=0,h=0;if(e.startFrom){var c=i[e.startFrom-1]["_sums "+e.name];c&&(l=c[0],o=c[1],h=c[2])}for(var u=e.startFrom;u<i.length;u++){var d=i[u][a];if(d&&"object"==typeof d&&(d=d[e.subField]),(d||0===d)&&(l+=e.days*d-o,o+=d,h+=Math.pow(d,2),!(u<e.days-1))){if(u>e.days-1){var p=i[u-e.days][a];if(p&&"object"==typeof p&&(p=p[e.subField]),!p&&0!==p)continue;o-=p,h-=Math.pow(p,2)}var m=(e.days*l-r*o)/(e.days*n-s);i[u]["Slope "+e.name]=m;var g=(o-m*r)/e.days;i[u]["Intercept "+e.name]=g,i[u]["Forecast "+e.name]=g+m*e.days;var f=(e.days*n-s)/(e.days*h-Math.pow(o,2));i[u]["RSquared "+e.name]=m*m*f,i[u]["_sums "+e.name]=[l,o,h]}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Lin Fcst":{name:"Linear Reg Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"Lin Incpt":{name:"Linear Reg Intercept",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Intercept:"auto"}},"Lin R2":{name:"Linear Reg R2",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{RSquared:"auto"}},"LR Slope":{name:"Linear Reg Slope",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Slope:"auto"}},"Time Fcst":{name:"Time Series Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}}})):console.error("linearRegression feature requires first activating studies feature.")},O=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateMACD=function(t,i){var a=i.chart.scrubbed,r=i.inputs,s=i.name;if(i.macd1Days||(i.macd1Days=parseFloat(r["Fast MA Period"])),i.macd2Days||(i.macd2Days=parseFloat(r["Slow MA Period"])),i.signalDays||(i.signalDays=parseFloat(r["Signal Period"])),i.days||(i.days=Math.max(i.macd1Days,i.macd2Days,i.signalDays)),a.length<i.days+1)i.error=!0;else{var n=i.inputs.Field;n&&"field"!=n||(n="Close");var o=r["Moving Average Type"];o||(o="exponential"),e.Studies.MA(o,i.macd1Days,n,0,"_MACD1",t,i),e.Studies.MA(o,i.macd2Days,n,0,"_MACD2",t,i);var l,h,c=Math.max(i.startFrom,i.days-1);for(l=c;l<a.length;l++)!(h=a[l])["_MACD1 "+s]&&0!==h["_MACD1 "+s]||!h["_MACD2 "+s]&&0!==h["_MACD2 "+s]||(h["MACD "+s]=h["_MACD1 "+s]-h["_MACD2 "+s]);var u=r["Signal MA Type"];u||(u="exponential"),e.Studies.MA(u,i.signalDays,"MACD "+s,0,"Signal",t,i);var d=s+"_hist";for(l=c;l<a.length;l++){var p=(h=a[l])["Signal "+s];(p||0===p)&&(h[d]=h["MACD "+s]-h["Signal "+s])}i.outputMap[d]=""}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{macd:{name:"MACD",calculateFN:e.Studies.calculateMACD,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},outputs:{MACD:"auto",Signal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}}})):console.error("macd feature requires first activating studies feature.")},H=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateMassIndex=function(t,i){var a=i.chart.scrubbed;if(a.length<Math.max(9,i.days+1))i.error=!0;else{for(var r=i.startFrom;r<a.length;r++)a[r]["_High-Low "+i.name]=a[r].High-a[r].Low;e.Studies.MA("exponential",9,"_High-Low "+i.name,0,"_EMA",t,i),e.Studies.MA("exponential",9,"_EMA "+i.name,0,"_EMA2",t,i);var s=0;a[i.startFrom-1]&&a[i.startFrom-1]["_total "+i.name]&&(s=a[i.startFrom-1]["_total "+i.name]);for(var n=Math.max(17,i.startFrom);n<a.length;n++)s+=a[n]["_EMA "+i.name]/a[n]["_EMA2 "+i.name],n>=17+i.days-1&&(a[n]["Result "+i.name]=s,s-=a[n-i.days+1]["_EMA "+i.name]/a[n-i.days+1]["_EMA2 "+i.name]),a[n]["_total "+i.name]=s}},e.Studies.displayMassIndex=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=i.inputs["Bulge Threshold"],s=(t.panels[i.panel],i.getYAxis(t)),n=e.Studies.determineColor(i.outputs.Result),o={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:r,direction:1,color:n,yAxis:s,opacity:.3};!i.highlight&&t.highlightedDraggable&&(o.opacity*=.3),e.preparePeakValleyFill(t,o),e.Studies.drawHorizontal(t,i,null,r,s,n)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Mass Idx":{name:"Mass Index",seriesFN:e.Studies.displayMassIndex,calculateFN:e.Studies.calculateMassIndex,inputs:{Period:25,"Bulge Threshold":27},attributes:{"Bulge Threshold":{min:20,max:35,step:.1}}}})):console.error("massIndex feature requires first activating studies feature.")},V=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateMoneyFlowIndex=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0,r=0,s=i[e.startFrom-1],n="_rawMF "+e.name,o="_cumMF "+e.name,l="Result "+e.name;s&&s[o]&&(a=s[o][0],r=s[o][1]);for(var h=e.startFrom;h<i.length;h++){var c=i[h]["hlc/3"];if(h>0&&!i[h].futureTick){var u=i[h-1]["hlc/3"],d=c*i[h].Volume;if(c>u?a+=d:c<u?r-=d*=-1:d=0,h>e.days){var p=i[h-e.days][n];p>0?a-=p:r+=p,0===r?i[h][l]=100:i[h].Volume&&(i[h][l]=100-100/(1+a/r))}i[h][n]=d,i[h][o]=[a,r]}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"M Flow":{name:"Money Flow Index",range:"0 to 100",calculateFN:e.Studies.calculateMoneyFlowIndex,inputs:{Period:14},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}}})):console.error("moneyFlow feature requires first activating studies feature.")},z=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.prettify=e.extend({"2-exponential":"dema","3-exponential":"tema",hull:"hma"},e.Studies.prettify),e.extend(e.Studies.movingAverage,{conversions:{hma:"hull",dema:"2-exponential",tema:"3-exponential"},translations:{hull:"Hull","2-exponential":"Double Exponential","3-exponential":"Triple Exponential"},typeMap:{hma:"Hull",hull:"Hull",dema:"DoubleExponential","2-exponential":"DoubleExponential",tema:"TripleExponential","3-exponential":"TripleExponential"}}),e.Studies.calculateMovingAverageHull=function(t,i){var a,r,s=i.chart.scrubbed,n=i.inputs.Field;for(n&&"field"!=n||(n="Close"),e.Studies.MA("wma",i.days,n,0,"_WMA1",t,i),e.Studies.MA("wma",Math.ceil(i.days/2),n,0,"_WMA2",t,i),a=i.startFrom-1;a>=0&&((r=s[a][n])&&"object"==typeof r&&(r=r[i.subField]),!r&&0!==r);a--);for(a++;a<s.length;a++){var o=s[a];o["_MMA "+i.name]=2*o["_WMA2 "+i.name]-o["_WMA1 "+i.name]}var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);var h=Math.floor(Math.sqrt(i.days));e.Studies.MA("wma",h,"_MMA "+i.name,l,"_HMA",t,i);var c=i.name;for(var u in i.outputs)c=u+" "+c;for(a=Math.max(i.days+h-1,i.startFrom);a<s.length;a++)s[a][c]=s[a]["_HMA "+i.name]},e.Studies.calculateMovingAverageDoubleExponential=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ema",i.days,r,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i);var s,n,o=parseInt(i.inputs.Offset,10);isNaN(o)&&(o=0);var l=o;for(s=i.startFrom-1;s>=0;s--)if((n=a[s][r])&&"object"==typeof n&&(n=n[i.subField]),n||0===n){if(!(l>0))break;l--}var h=i.name;for(var c in i.outputs)h=c+" "+h;var u=[];for(s++;s<a.length;s++)if(!(s<2*(i.days-1))){var d=a[s],p=2*d["_EMA1 "+i.name]-d["_EMA2 "+i.name];if(s+o>=0)if(s+o<a.length)a[s+o][h]=p;else{var m={};m[h]=p,u.push(m)}}i.appendFutureTicks(t,u)},e.Studies.calculateMovingAverageTripleExponential=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ema",i.days,r,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i),e.Studies.MA("ema",i.days,"_EMA2 "+i.name,0,"_EMA3",t,i);var s,n,o=parseInt(i.inputs.Offset,10);isNaN(o)&&(o=0);var l=o;for(s=i.startFrom-1;s>=0;s--)if((n=a[s][r])&&"object"==typeof n&&(n=n[i.subField]),n||0===n){if(!(l>0))break;l--}var h=i.name;for(var c in i.outputs)h=c+" "+h;var u=[];for(s++;s<a.length;s++)if(!(s<3*(i.days-1))){var d=a[s],p=3*d["_EMA1 "+i.name]-3*d["_EMA2 "+i.name]+d["_EMA3 "+i.name];if(s+o>=0)if(s+o<a.length)a[s+o][h]=p;else{var m={};m[h]=p,u.push(m)}}i.appendFutureTicks(t,u)},e.Studies.calculateMAEnvelope=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,a,0,"MA",t,i);var r=i.inputs["Shift Type"],s=i.inputs.Shift;r||(r="percent",s=i.inputs["Shift Percentage"]),"percent"==r?e.Studies.calculateGenericEnvelope(t,i,s/100,"MA "+i.name):"points"==r&&e.Studies.calculateGenericEnvelope(t,i,null,"MA "+i.name,null,Number(s))},e.Studies.calculateMADev=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=i.inputs["Points Or Percent"];s||(s="Points");var n=i.inputs["Moving Average Type"];n||(n="exponential"),e.Studies.MA(n,i.days,r,0,"_MA",t,i);for(var o=i.name+"_hist",l=Math.max(i.startFrom,i.days-1);l<a.length;l++){var h=a[l],c=h[r];c&&"object"==typeof c&&(c=c[i.subField]);var u=h["_MA "+i.name];(u||0===u)&&(h[o]="Points"==s?c-u:100*(c/u-1))}i.outputMap={},i.outputMap[i.name+"_hist"]=""}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"MA Env":{name:"Moving Average Envelope",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateMAEnvelope,inputs:{Period:50,Field:"field","Shift Type":["percent","points"],Shift:5,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"MA Env Top":"auto","MA Env Median":"auto","MA Env Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},"MA Dev":{name:"Moving Average Deviation",calculateFN:e.Studies.calculateMADev,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{Period:12,Field:"field","Moving Average Type":"ma","Points Or Percent":["Points","Percent"]},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"High Low":{name:"High Low Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:function(t,i){i.inputs["Moving Average Type"]="triangular",e.Studies.calculateMAEnvelope(t,i)},inputs:{Period:10,Field:"field","Shift Percentage":5,"Channel Fill":!0},outputs:{"High Low Top":"auto","High Low Median":"auto","High Low Bottom":"auto"},attributes:{"Shift Percentage":{min:.1,step:.1}}}})):console.error("movingAverages feature requires first activating studies feature.")},R=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePSAR=function(t,e){var i=e.chart.scrubbed,a=0,r=null,s=!1,n=0,o=parseFloat(e.inputs["Minimum AF"]),l=parseFloat(e.inputs["Maximum AF"]);function h(){a=0,r=null,s=!s}if(e.startFrom>0){n=i[e.startFrom-1]["Result "+e.name];var c=i[e.startFrom-1]["_state "+e.name];c&&3==c.length&&(a=c[0],r=c[1],s=c[2])}for(var u=e.startFrom-1;u<i.length-1;u++)if(!(u<0)){if(i[u].futureTick)break;var d=n;if(s){(!r||r<i[u].High)&&(r=i[u].High,a=Math.min(a+o,l)),n=d+a*(r-d);var p=Math.min(i[Math.max(1,u)-1].Low,i[u].Low);n>i[u+1].Low?(n=r,h()):n>p&&(n=p)}else{(!r||r>i[u].Low)&&(r=i[u].Low,a=Math.min(a+o,l)),n=d+a*(r-d);var m=Math.max(i[Math.max(1,u)-1].High,i[u].High);n<i[u+1].High?(n=r,h()):n<m&&(n=m)}i[u+1]["_state "+e.name]=[a,r,s],isNaN(i[u].High)&&isNaN(i[u].Low)||(i[u+1]["Result "+e.name]=n)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{PSAR:{name:"Parabolic SAR",overlay:!0,calculateFN:e.Studies.calculatePSAR,seriesFN:e.Studies.displayPSAR2,inputs:{"Minimum AF":.02,"Maximum AF":.2}}})):console.error("parabolicSAR feature requires first activating studies feature.")},B=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePivotPoints=function(t,i){var a=i.chart.scrubbed,r="day",s=t.layout.interval,n=t.layout.timeUnit;if("day"==s)r="month";else if(e.ChartEngine.isDailyInterval(s))r="year";else if("second"==s||"millisecond"==s||"second"==n||"millisecond"==n)r="15min";else{var o=t.layout.periodicity;"minute"!=s&&(o*=s),o>=30&&(r="week")}var l=null,h=7-e.getFromNS(t.chart,"market.beginningDayOfWeek",0),c={pivotPoint:NaN,high:0,low:0,prevHigh:0,prevLow:0,hlSpread:0};function u(){c.pivotPoint=(c.high+c.low+a[d-1].Close)/3,c.prevHigh=c.high,c.prevLow=c.low,c.hlSpread=c.high-c.low,c.high=c.low=0}i.startFrom>1&&a[i.startFrom-1]["_pointers "+i.name]&&(c=e.clone(a[i.startFrom-1]["_pointers "+i.name]));for(var d=Math.max(1,i.startFrom);d<a.length;d++)if(a[d-1]){if(c.high=Math.max(c.high,a[d-1].High),c.low=Math.min(c.low>0?c.low:a[d-1].Low,a[d-1].Low),i.inputs.Continuous)u();else if("year"==r&&a[d].DT.getYear()!=a[d-1].DT.getYear())u();else if("month"==r&&a[d].DT.getMonth()!=a[d-1].DT.getMonth())u();else if("week"==r&&(a[d].DT.getDay()+h)%7<(a[d-1].DT.getDay()+h)%7)u();else if("day"==r){null===l&&(l=e.Studies.getMarketOffset({stx:t,localQuoteDate:a[d].DT,shiftToDateBoundary:!0}));var p=new Date(new Date(+a[d].DT).setMilliseconds(a[d].DT.getMilliseconds()+l)),m=new Date(new Date(+a[d-1].DT).setMilliseconds(a[d-1].DT.getMilliseconds()+l));m.getDate()!==p.getDate()&&0!==m.getDay()&&t.chart.market.isMarketDate(p)&&(l=null,u())}else"15min"!=r||a[d].DT.getHours()==a[d-1].DT.getHours()&&Math.floor(a[d].DT.getMinutes()/15)==Math.floor(a[d-1].DT.getMinutes()/15)||u();a[d]["Pivot "+i.name]=c.pivotPoint,"fibonacci"==i.inputs.Type.toLowerCase()?(a[d]["Resistance 1 "+i.name]=c.pivotPoint+.382*c.hlSpread,a[d]["Resistance 2 "+i.name]=c.pivotPoint+.618*c.hlSpread,a[d]["Resistance 3 "+i.name]=c.pivotPoint+c.hlSpread,a[d]["Support 1 "+i.name]=c.pivotPoint-.382*c.hlSpread,a[d]["Support 2 "+i.name]=c.pivotPoint-.618*c.hlSpread,a[d]["Support 3 "+i.name]=c.pivotPoint-c.hlSpread):(a[d]["Resistance 1 "+i.name]=2*c.pivotPoint-c.prevLow,a[d]["Resistance 2 "+i.name]=c.pivotPoint+c.hlSpread,a[d]["Resistance 3 "+i.name]=c.prevHigh+2*(c.pivotPoint-c.prevLow),a[d]["Support 1 "+i.name]=2*c.pivotPoint-c.prevHigh,a[d]["Support 2 "+i.name]=c.pivotPoint-c.hlSpread,a[d]["Support 3 "+i.name]=c.prevLow-2*(c.prevHigh-c.pivotPoint)),a[d]["_pointers "+i.name]=e.clone(c)}},e.Studies.displayPivotPoints=function(t,i,a){if(i.noSlopes=!i.inputs.Continuous,e.Studies.displaySeriesAsLine(t,i,a),i.inputs.Shading){var r=t.panels[i.panel],s={noSlopes:i.noSlopes,opacity:i.parameters.opacity?i.parameters.opacity:.2,skipTransform:r.name!=i.chart.name,yAxis:i.getYAxis(t)};!i.highlight&&t.highlightedDraggable&&(s.opacity*=.3),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 3 "+i.name,bottomBand:"Resistance 2 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 3"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 2 "+i.name,bottomBand:"Resistance 1 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 2"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 1"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Support 1"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 2 "+i.name,bottomBand:"Support 1 "+i.name,color:e.Studies.determineColor(i.outputs["Support 2"])},s)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 3 "+i.name,bottomBand:"Support 2 "+i.name,color:e.Studies.determineColor(i.outputs["Support 3"])},s))}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Pivot Points":{name:"Pivot Points",overlay:!0,seriesFN:e.Studies.displayPivotPoints,calculateFN:e.Studies.calculatePivotPoints,inputs:{Type:["standard","fibonacci"],Continuous:!1,Shading:!1},outputs:{Pivot:"auto","Resistance 1":"#b82c0b","Support 1":"#699158","Resistance 2":"#e36460","Support 2":"#b3d987","Resistance 3":"#ffd0cf","Support 3":"#d3e8ae"},parameters:{init:{opacity:.2}}}})):console.error("pivotPoints feature requires first activating studies feature.")},Q=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePrettyGoodOscillator=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.MA("exponential",i.days,"trueRange",0,"_EMA",t,i),e.Studies.MA("simple",i.days,"Close",0,"_SMA",t,i);for(var r=Math.max(1,i.startFrom);r<a.length;r++)a[r]["_SMA "+i.name]&&a[r]["_EMA "+i.name]&&(a[r]["Result "+i.name]=(a[r].Close-a[r]["_SMA "+i.name])/a[r]["_EMA "+i.name])}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Pretty Good":{name:"Pretty Good Oscillator",calculateFN:e.Studies.calculatePrettyGoodOscillator,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}}}})):console.error("prettyGoodOscillator feature requires first activating studies feature.")},W=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePMO=function(t,i){var a={Smooth:Number(i.inputs["Smoothing Period"])-1,Double:Number(i.inputs["Double Smoothing Period"])-1,Signal:Number(i.inputs["Signal Period"])},r=i.chart.scrubbed;if(r.length<a.Smooth+a.Double)i.error=!0;else{var s,n=i.inputs.Field;for(n&&"field"!=n||(n="Close"),s=i.startFrom;s<r.length;s++)if(r[s]&&r[s-1]){var o=r[s-1][n];o&&(r[s]["_ROCx10 "+i.name]=1e3*(r[s][n]/o-1))}e.Studies.MA("exponential",a.Smooth,"_ROCx10 "+i.name,0,"_EMAx10",t,i),e.Studies.MA("exponential",a.Double,"_EMAx10 "+i.name,0,"PMO",t,i),e.Studies.MA("exponential",a.Signal,"PMO "+i.name,0,"PMOSignal",t,i),i.zoneOutput="PMO"}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{PMO:{name:"Price Momentum Oscillator",calculateFN:e.Studies.calculatePMO,inputs:{Field:"field","Smoothing Period":35,"Double Smoothing Period":20,"Signal Period":10},outputs:{PMO:"auto",PMOSignal:"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:2.5,studyOverBoughtColor:"auto",studyOverSoldValue:-2.5,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.05"},studyOverSoldValue:{max:0,step:"0.05"}}}})):console.error("priceMomentumOscillator feature requires first activating studies feature.")},U=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePriceOscillator=function(t,i){var a=i.chart.scrubbed,r=Number(i.inputs["Short Cycle"]),s=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,s)+1)i.error=!0;else{var n=i.inputs.Field,o=i.inputs["Moving Average Type"];o||(o="simple"),n&&"field"!=n||(n="Close"),i.parameters.isVolume&&(n="Volume",o="exponential");var l=i.inputs["Points Or Percent"];l||(l="Percent"),e.Studies.MA(o,r,n,0,"_Short MA",t,i),e.Studies.MA(o,s,n,0,"_Long MA",t,i);for(var h=Math.max(s,i.startFrom);h<a.length;h++){var c=a[h];if(c){var u=c["_Short MA "+i.name],d=c["_Long MA "+i.name];!u&&0!==u||!d&&0!==d||(c["Result "+i.name]="Points"==l?u-d:100*(u/d-1),i.outputs["Increasing Bar"]&&(c[i.name+"_hist"]=c["Result "+i.name],i.outputMap={},i.outputMap[i.name+"_hist"]=""))}}}},e.Studies.displayRAVI=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=t.pixelFromPrice(0,r,n),l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs["Increasing Bar"]),c=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.startClip(i.panel),t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var u=0;u<a.length;u++){var d=a[u],p=a[u-1];if(p||(p=t.getPreviousBar(t.chart,i.name+"_hist",u)),d){var m=0,g=0;i.parameters&&i.parameters.studyOverZonesEnabled&&(m=parseFloat(i.parameters.studyOverBoughtValue),g=parseFloat(i.parameters.studyOverSoldValue)),p?d[i.name+"_hist"]>m&&p[i.name+"_hist"]<d[i.name+"_hist"]?s.fillStyle=h:d[i.name+"_hist"]<g&&p[i.name+"_hist"]>d[i.name+"_hist"]?s.fillStyle=c:s.fillStyle="#CCCCCC":s.fillStyle="#CCCCCC",d.candleWidth&&(l=Math.floor(Math.max(1,d.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(u,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(d[i.name+"_hist"],r,n)-o))}}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Price Osc":{name:"Price Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Short Cycle":12,"Long Cycle":26,"Moving Average Type":"ema","Points Or Percent":["Points","Percent"]}},"Vol Osc":{name:"Volume Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{"Short Cycle":12,"Long Cycle":26,"Points Or Percent":["Points","Percent"]},parameters:{init:{isVolume:!0}}},RAVI:{name:"RAVI",seriesFN:e.Studies.displayRAVI,calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Moving Average Type":"vdma","Short Cycle":7,"Long Cycle":65},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.1"},studyOverSoldValue:{max:0,step:"0.1"}}}})):console.error("priceVolumeOscillator feature requires first activating studies feature.")},j=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePrimeNumber=function(t,e){var i=[];function a(t){if(t<=0)return!1;if(t!=Math.floor(t))return!1;if(!0===i[t]||!1===i[t])return i[t];for(var e=parseInt(Math.sqrt(t),10),a=2;a<=e;a++)if(t%a==0)return i[t]=!1,!1;return i[t]=!0,!0}for(var r=e.chart.scrubbed,s=e.startFrom;s<r.length;s++){var n=r[s];if(n){var o=n.High;if(!isNaN(o)){for(var l=0;o>0&&o<=10;l++)o*=10;for(a(o)&&(o+=2),(o=Math.ceil(o))%2==0&&o++;!a(o);)o+=2;o/=Math.pow(10,l)}var h=n.Low;if(!isNaN(h)){for(var c=0;h>0&&h<=10;c++)h*=10;if(a(h)&&(h-=2),(h=Math.floor(h))%2==0&&h--,h>0){for(;!a(h);)h-=2;h/=Math.pow(10,c)}}if("Prime Number Bands"==e.type)isNaN(o)||(n["Prime Bands Top "+e.name]=o),isNaN(h)||(n["Prime Bands Bottom "+e.name]=Math.max(0,h));else{var u=0,d=e.inputs["Tolerance Percentage"]*(o-h)/100,p=o+h-2*n.Close;p<d?u=1:p>d&&(u=-1),u&&(n["Result "+e.name]=u)}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Prime Number":{name:"Prime Number Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculatePrimeNumber,centerline:0,inputs:{"Tolerance Percentage":5},attributes:{"Tolerance Percentage":{min:.1,step:.1}}},"Prime Number Bands":{name:"Prime Number Bands",overlay:!0,calculateFN:e.Studies.calculatePrimeNumber,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Prime Bands Top":"auto","Prime Bands Bottom":"auto","Prime Bands Channel":"auto"}}})):console.error("primeNumber feature requires first activating studies feature.")},q=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateKST=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s={},n={};s[1]=Number(i.inputs["Lightest Rate of Change Period"]),s[2]=Number(i.inputs["Light Rate of Change Period"]),s[3]=Number(i.inputs["Heavy Rate of Change Period"]),s[4]=Number(i.inputs["Heaviest Rate of Change Period"]),n[1]=Number(i.inputs["Lightest SMA Period"]),n[2]=Number(i.inputs["Light SMA Period"]),n[3]=Number(i.inputs["Heavy SMA Period"]),n[4]=Number(i.inputs["Heaviest SMA Period"]);var o,l,h=Number(i.inputs["Signal Period"]);for(o=i.startFrom;o<a.length;o++)if(a[o])for(l=1;l<=4;l++)o>=s[l]&&a[o-s[l]]&&a[o-s[l]][r]&&(a[o]["_ROC"+l+" "+i.name]=100*(a[o][r]/a[o-s[l]][r]-1));for(l=1;l<=4;l++)e.Studies.MA("simple",n[l],"_ROC"+l+" "+i.name,0,"_SMA"+l,t,i);for(o=i.startFrom;o<a.length;o++)for(a[o]["KST "+i.name]=null,l=1;l<=4;l++){var c=a[o]["_SMA"+l+" "+i.name];(c||0===c)&&(a[o]["KST "+i.name]+=l*c)}e.Studies.MA("simple",h,"KST "+i.name,0,"KSTSignal",t,i)},e.Studies.calculateSpecialK=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=i.inputs.Interval;s||(s="daily");var n,o,l={daily:[10,15,20,30,50,65,75,100,195,265,390,530],weekly:[4,5,6,8,10,13,15,20,39,52,78,104]},h={daily:[10,10,10,15,50,65,75,100,130,130,130,195],weekly:[4,5,6,8,10,13,15,20,26,26,26,39]};for(n=i.startFrom;n<a.length;n++)if(a[n])for(o=0;o<l[s].length;o++)n>=l[s][o]&&a[n-l[s][o]]&&a[n-l[s][o]][r]&&(a[n]["_ROC"+o+" "+i.name]=100*(a[n][r]/a[n-l[s][o]][r]-1));for(o=0;o<h[s].length;o++)e.Studies.MA("daily"==s?"simple":"exponential",h[s][o],"_ROC"+o+" "+i.name,0,"_MA"+o,t,i);for(n=i.startFrom;n<a.length;n++)for(a[n]["Result "+i.name]=null,o=0;o<h[s].length;o++){var c=a[n]["_MA"+o+" "+i.name];(c||0===c)&&(a[n]["Result "+i.name]+=(o%4+1)*c)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Pring KST":{name:"Pring's Know Sure Thing",calculateFN:e.Studies.calculateKST,inputs:{Field:"field","Lightest Rate of Change Period":10,"Lightest SMA Period":10,"Light Rate of Change Period":15,"Light SMA Period":10,"Heavy Rate of Change Period":20,"Heavy SMA Period":10,"Heaviest Rate of Change Period":30,"Heaviest SMA Period":15,"Signal Period":9},outputs:{KST:"#00DD00",KSTSignal:"#FF0000"}},"Pring Sp-K":{name:"Pring's Special K",calculateFN:e.Studies.calculateSpecialK,inputs:{Field:"field",Interval:["daily","weekly"]}}})):console.error("pring feature requires first activating studies feature.")},Y=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,i="undefined"!=typeof _timezoneJS?_timezoneJS:t.timezoneJS;e.Studies?e.Studies.studyLibrary.PVAT||(e.Studies.initProjectedVolume=function(t,i,a,r,s,n){const{market:o}=t.chart;let l="00:00";o&&(l=o.getNormalOpen()),l.match(/^[\d]{2}:[\d]{2}$/)&&(l+=":00"),a["Anchor Time"]&&a["Anchor Time"].length||(a["Anchor Time"]=l);const h=e.Studies.initializeFN(t,i,a,r,s,n);return t.currentlyImporting||(h.defaultAnchorTime=l),h},e.Studies.validateProjectedVolumeLookback=function(t,e){const{interval:i,periodicity:a}=t.layout,{"Lookback Days":r}=e.inputs;return r/(i*a)<=10},e.Studies.calculateProjectedVolume=function(t,a){const{interval:r,timeUnit:s,aggregationType:n}=t.layout,{symbol:o,scroll:l,scrubbed:h,market:c}=t.chart,u="PAV"===a.type,d=a.study?a.study.name:a.type;if(e.ChartEngine.isDailyInterval(r)?a.error=`${d} is Intraday Only`:"tick"===s?a.error=`Tick mode not supported for ${d}`:"minute"!==s?a.error=`Sub-minute periodicities not supported for ${d}`:n&&["ohlc","heikinashi"].includes(n)?e.Studies.validateProjectedVolumeLookback(t,a)||(a.error=`Selected lookback/periodicity combo not supported for ${d}`):a.error=`Aggregation type not supported for ${d}`,a.error)return;a.inputs["Anchor Selector"]?e.Studies.initAnchorHandle(t,a):e.Studies.removeAnchorHandle(t,a);let p=c?c.getNormalOpen():"00:00";if(p.match(/^[\d]{2}:[\d]{2}$/)&&(p+=":00"),!t.currentlyImporting)if(a.defaultAnchorTime){if(p!==a.defaultAnchorTime)return a.defaultAnchorTime=p,a.inputs["Anchor Time"]=p,void e.Studies.repositionAnchor(t,a)}else a.defaultAnchorTime=p;const{"Lookback Days":m,"Anchor Time":g}=a.inputs,[f,v,y=0]=g.split(":"),x=e.getFn("Market.Symbology.isForexSymbol")(o),b=a.getDependents(t);let S,C=0,w=[];b.forEach((t=>{let{inputs:e,outputMap:i}=t;e.Period&&(C=Math.max(parseInt(e.Period),C),w.push(...Object.keys(i)))})),a.dependentsOutputMap=w;const k=R(h.length-1,!0);let D=R(Math.ceil(h.length-1-l)-C);x&&h[D]&&e.dateToStr(h[D].DT,"HH:mm")!==p&&(D=R(D-1)),S=!x&&a.startFrom>D&&h[D]&&void 0!==h[D]["V "+a.name]&&w.every((t=>![void 0,null].includes(h[D][t])))&&!1!==k?k:D;const T=H(z(D),m);T.setHours(0,0,0);const M=R(0,!0),A=(M||0===M)&&V(H(h[M].DT,m,!0));if(h[0].DT>T){if(!t.quoteDriver)return a.error=`Not enough data to calculate ${d}`;if(t.quoteDriver.extendHistoricalData({from:T}),!(A>0))return;S=A}if(S<0||S>h.length-1)return;const _=h.length-a.startFrom==1&&a.cachedFutureTicks&&a.cachedLastProjection&&+a.cachedLastProjection.DT==+h[h.length-1].DT&&h[S]["PV "+a.name];if(_)h[h.length-1]["PV "+a.name]=a.cachedLastProjection.projectedValue,a.appendFutureTicks(t,a.cachedFutureTicks),S=a.startFrom;else{a.cachedFutureTicks=null,a.cachedLastProjection=null;let e=[k],i=[];for(let t=0;t<m;t++){let t=R(e[0]-1);e.unshift(t)}for(;e[m]>=S;){let t=e.pop();if(!h[t])return N(t);const r=O(h[t].DT);let s,{hours:n,minutes:o}=r,l=c.getClose(h[t].DT);if(l){let e=c.getNextClose(h[t].DT);for(s=O(l);(0!==s.hours||0!==s.minutes)&&l.getDate()===e.getDate();)l=e,e=c.getNextClose(e);s=O(l),0===s.hours&&(s.hours=24)}else s={hours:24,minutes:0};let u=e.slice();for(let t=0;t<u.length;t++){let e=u[t];if(!h[e])return N(e);let{hours:i,minutes:a}=O(h[e].DT);if(i<n||i===n&&a<o)do{e++,({hours:i,minutes:a}=O(h[e].DT))}while(i!==n||a!==o);u[t]=e}for(;n<s.hours||n===s.hours&&o<s.minutes;){let e,r,s=!1,l=0,c=0;for(let t=0;t<u.length;t++){let i=u[t];if(null===i)continue;let a=h[i];if(!a)return N(i);let{hours:d,minutes:p}=O(a.DT),m=a.DT.getDate();d===n&&p===o&&(l+=a.Volume,c++,u[t]++,h[u[t]].DT.getDate()!==m?u[t]=null:s||(({hours:e,minutes:r}=O(h[u[t]].DT)),s=!0))}if(n=e,o=r,0===c)break;let d=l/c;h[t]?h[t]["PV "+a.name]=d:i.push({["PV "+a.name]:d}),t++}e.unshift(R(e[0]-1))}a.cachedLastProjection={DT:h[h.length-1].DT,projectedValue:h[h.length-1]["PV "+a.name]},a.cachedFutureTicks=i,a.appendFutureTicks(t,i)}let F,P=null,I=0,L=0;if(_&&u)for(;S>0;){var E=h[S-1]["V "+a.name];if(E||0===E){I=E;break}S--}for(let r=S;r<h.length;r++){const s=h[r],n=s.Volume,o=s["PV "+a.name];s.futureTick||(F=r),null===P&&(P=e.Studies.getMarketOffset({stx:t,localQuoteDate:h[r].DT,shiftToDateBoundary:!0}));const l=new Date(new Date(s.DT).getTime()+P),p=h[r-1]&&new Date(new Date(h[r-1].DT).getTime()+P);let m=new i.Date(s.DT,c.market_def.market_tz||"America/New_York");if(m.setHours(f,v,y),m=new Date(m+P),m.setDate(l.getDate()),p&&l.getDate()!==p.getDate()&&(P=null,I=0,L=0),l<m)s["V "+a.name]=0,s["PV "+a.name]=0;else if(u?(I+=n,L+=o):(I=n,L=o),s["V "+a.name]=I,_||(s["PV "+a.name]=L),[NaN,null,void 0].includes(I)&&!s.futureTick)return void(a.error=`${d} requires volume`)}function N(t){console.error(`Expected data for ${z(t).toDateString()} but found none. This may be caused by gaps in your data or an improperly configured market definition.`)}function O(t){return{hours:t.getHours(),minutes:t.getMinutes()}}function H(t,e,i){for(;e;)t=new Date(new Date(t).setDate(t.getDate()+(i?1:-1))),c.isMarketDate(t)&&e--;return t}function V(e){return t.tickFromDate(e,null,null,!0,"scrubbed")}function z(e){return t.dateFromTick(e,null,!0,"scrubbed")}function R(i,a){let r=z(i),s=c.getOpen(r)||function(i){i.setHours(0),i.setMinutes(0);let a=e.Studies.getMarketOffset({stx:t,localQuoteDate:i});return new Date(i.getTime()+a)}(r),n=V(s);return a?(n<0&&(n=V(H(s,1,!0))),!(n>=h.length)&&n):n}a.cachedLastProjection.projectedValue=h[F]["PV "+a.name],a.outputMap={},a.outputMap["V "+a.name]="",a.outputMap["PV "+a.name]="Average Line",b.forEach((e=>{e.startFrom=S,e.study.calculateFN(t,e)}))},e.Studies.displayProjectedVolume=function(t,i,a){if(i.error)return e.Studies.removeAnchorHandle(t,i);const{"Alert Threshold":r=""}=i.inputs,s=parseInt(r.slice(0,-1),10)/100;let n=i.outputs["Alert Bar"];"object"==typeof n&&(n=n.color),i.volumeField="V "+i.name,i.alignStepToSide=!0,i.extendToEndOfLastBar=!0,i.lineWidth=2;const o=t.canvasStyle("stx_volume_underlay_up").opacity,l=t.canvasStyle("stx_volume_underlay_down").opacity;i.colorFunction=function(e){const{Open:a,Close:r,iqPrevClose:h}=e,c=(t.colorByCandleDirection?a:h)>r,u=e["PV "+i.name],d=e["V "+i.name],p=u*(s+1),m=s<0?d<p:d>p;return{fill_color:m&&n||(c?this.fill_color_down:this.fill_color_up),border_color:c?this.border_color_down:this.border_color_up,opacity:m?1:c?l:o,border_opacity:c?l:o}};const h=i.study?i.study.name:i.type,{loadingMore:c}=t.chart,u=a.some((t=>t&&t[i.volumeField]&&t["PV "+i.name])),d=a[0]&&!a[0].futureTick&&(void 0===a[0]["PV "+i.name]||(i.dependentsOutputMap||[]).some((t=>[void 0,null].includes(a[0][t]))));if(!u&&c)return i.error=`Fetching data for ${h}`;e.Studies.createVolumeChart(t,i,a),e.Studies.displaySeriesAsLine(t,i,a),i.anchorHandle&&e.Studies.displayAnchorHandleAndLine(t,i,a),d&&e.Studies.calculateProjectedVolume(t,i)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{PVAT:{name:"Projected Volume at Time",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,zoom:0},calculateFN:e.Studies.calculateProjectedVolume,seriesFN:e.Studies.displayProjectedVolume,initializeFN:e.Studies.initProjectedVolume,removeFN:e.Studies.removeAnchorHandle,inputs:{"Lookback Days":10,"Anchor Time":"","Alert Threshold":["+150%","+125%","+100%","+75%","+50%","+25%","None","-25%","-50%","-75%","-100%","-125%","-150%"],"Anchor Selector":!0},outputs:{"Average Line":"#fe641c","Alert Bar":"#cfbd0e","Up Volume":"#8cc176","Down Volume":"#b82c0c"},parameters:{plotType:"step"},attributes:{"Anchor Time":{placeholder:"hh:mm:ss",step:1},"Alert Threshold":{defaultSelected:"+50%"}}},PAV:{name:"Projected Aggregate Volume",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,zoom:0},calculateFN:e.Studies.calculateProjectedVolume,seriesFN:e.Studies.displayProjectedVolume,initializeFN:e.Studies.initProjectedVolume,removeFN:e.Studies.removeAnchorHandle,inputs:{"Lookback Days":10,"Anchor Time":"","Anchor Selector":!0},outputs:{"Average Line":"#fe641c","Up Volume":"#8cc176","Down Volume":"#b82c0c"},parameters:{plotType:"step"},attributes:{"Anchor Time":{placeholder:"hh:mm:ss",step:1}}}})):console.error("projectedVolume feature requires first activating studies feature.")},$=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculatePsychologicalLine=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=[],r=100/e.days,s=0,n=Math.max(e.startFrom-e.days,1);n<i.length&&!i[n].futureTick;n++){var o=Number(i[n].Close>i[n-1].Close);o&&(s+=r),a.push(o),a.length>e.days&&(s-=a.shift()*r),n<e.startFrom||isNaN(i[n].Close)||(i[n]["Result "+e.name]=s)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{PSY:{name:"Psychological Line",range:"0 to 100",calculateFN:e.Studies.calculatePsychologicalLine,inputs:{Period:20}}})):console.error("psychologicalLine feature requires first activating studies feature.")},X=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateQStick=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.startFrom;r<a.length;r++)a[r]["_Close-Open "+i.name]=a[r].Close-a[r].Open;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Close-Open "+i.name,0,"Result",t,i)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{QStick:{name:"QStick",calculateFN:e.Studies.calculateQStick,inputs:{Period:8,"Moving Average Type":"ma"}}})):console.error("qstick feature requires first activating studies feature.")},Z=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateRainbow=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");for(var s=r,n=1;n<=10;n++)e.Studies.MA("simple",i.days,s,0,"SMA"+n,t,i),s="SMA"+n+" "+i.name;for(var o=Math.max(i.startFrom,10);o<a.length;o++)if(a[o]){if(a[o].futureTick)break;var l=0,h=0,c=-1*Number.MAX_VALUE,u=Number.MAX_VALUE;for(n=1;n<=10;n++){var d=a[o]["SMA"+n+" "+i.name];(d||0===d)&&(l+=d,h++,c=Math.max(c,d),u=Math.min(u,d))}if(i.name.indexOf("Osc")>-1){var p=m(i.inputs["HHV/LLV Lookback"],o);h&&(a[o][i.name+"_hist"]=100*(a[o][r]-l/h)/Math.max(1e-6,p[1]-p[0]),a[o]["Over "+i.name]=100*(c-u)/Math.max(1e-6,p[1]-p[0]),a[o]["Under "+i.name]=-a[o]["Over "+i.name],a[o]["Zero "+i.name]=0)}}i.name.indexOf("Osc")>-1&&(i.outputMap={},i.outputMap["Over "+i.name]="Positive Bar",i.outputMap["Under "+i.name]="Negative Bar",i.outputMap["Zero "+i.name]="",i.outputMap[i.name+"_hist"]="")}function m(t,e){for(var i=-1*Number.MAX_VALUE,r=Number.MAX_VALUE,s=e-t+1;s<=e;s++)s<0||(i=Math.max(i,a[s].Close),r=Math.min(r,a[s].Close));return[r,i]}},e.Studies.displayRainbowMA=function(t,i,a){for(var r=t.panels[i.panel],s=10;s>0;s--)e.Studies.displayIndividualSeriesAsLine(t,i,r,"SMA"+s+" "+i.name,a)},e.Studies.displayRainbowOsc=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t);t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);var o=t.pixelFromPrice(0,r,n),l=r.name!=i.chart.name,h=e.Studies.determineColor(i.outputs["Positive Bar"]);s.strokeStyle=h,t.plotDataSegmentAsLine("Over "+i.name,r,{skipTransform:l,label:!1,yAxis:n});var c=s.createLinearGradient(0,o,0,n.flipped?n.bottom:n.top);c.addColorStop(0,t.containerColor),c.addColorStop(1,h),e.prepareChannelFill(t,{skipTransform:l,color:c,opacity:!i.highlight&&t.highlightedDraggable?.3:1,panelName:i.panel,topBand:"Over "+i.name,bottomBand:"Zero "+i.name,yAxis:n});var u=e.Studies.determineColor(i.outputs["Negative Bar"]);s.strokeStyle=u,t.plotDataSegmentAsLine("Under "+i.name,r,{skipTransform:l,label:!1,yAxis:n});var d=s.createLinearGradient(0,o,0,n.flipped?n.top:n.bottom);d.addColorStop(0,t.containerColor),d.addColorStop(1,u),e.prepareChannelFill(t,{skipTransform:l,color:d,opacity:!i.highlight&&t.highlightedDraggable?.3:1,panelName:i.panel,topBand:"Zero "+i.name,bottomBand:"Under "+i.name,yAxis:n});var p=t.layout.candleWidth-2;p<2&&(p=1),t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3),s.fillStyle="#CCCCCC";for(var m=0;m<a.length;m++){var g=a[m];g&&(g[i.name+"_hist"]>0?s.fillStyle=h:g[i.name+"_hist"]<0&&(s.fillStyle=u),g.candleWidth&&(p=Math.floor(Math.max(1,g.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(m,r.chart)-p/2),Math.floor(o),Math.floor(p),Math.floor(t.pixelFromPrice(g[i.name+"_hist"],r,n)-o)))}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Rainbow MA":{name:"Rainbow Moving Average",overlay:!0,calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowMA,inputs:{Period:2,Field:"field"},outputs:{SMA1:"#FF0000",SMA2:"#FF7F00",SMA3:"#FFFF00",SMA4:"#7FFF00",SMA5:"#00FF7F",SMA6:"#00FFFF",SMA7:"#007FFF",SMA8:"#0000FF",SMA9:"#7F00FF",SMA10:"#FF00FF"}},"Rainbow Osc":{name:"Rainbow Oscillator",calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowOsc,centerline:0,inputs:{Period:2,Field:"field","HHV/LLV Lookback":10},outputs:{"Positive Bar":"#00DD00","Negative Bar":"#FF0000"}}})):console.error("rainbow feature requires first activating studies feature.")},K=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateRandomWalk=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=Math.max(2,e.startFrom);a<i.length;a++){for(var r=0,s=i[a].High,n=i[a].Low,o=0,l=0,h=1;h<=e.days&&!i[a].futureTick;h++){if(a<=h){o=l=0;break}var c=(r+=i[a-h].trueRange)/h*Math.sqrt(h);if(c){var u=(s-i[a-h].Low)/c,d=(i[a-h].High-n)/c;o=Math.max(o,u),l=Math.max(l,d)}}i[a].futureTick||isNaN(s)&&isNaN(n)||(i[a]["Random Walk High "+e.name]=o,i[a]["Random Walk Low "+e.name]=l)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Random Walk":{name:"Random Walk Index",calculateFN:e.Studies.calculateRandomWalk,outputs:{"Random Walk High":"#FF0000","Random Walk Low":"#0000FF"}}})):console.error("randomWalk feature requires first activating studies feature.")},G=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateRelativeVigor=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r;for(r=i.startFrom;r<a.length;r++){var s=a[r];isNaN(s.Close)||isNaN(s.Open)||(s["_Change "+i.name]=s.Close-s.Open),isNaN(s.High)||isNaN(s.Low)||(s["_Range "+i.name]=s.High-s.Low)}e.Studies.MA("triangular",4,"_Change "+i.name,0,"_Numer",t,i),e.Studies.MA("triangular",4,"_Range "+i.name,0,"_Denom",t,i);var n=[],o=[];for(r=Math.max(i.startFrom-i.days,0);r<a.length&&!a[r].futureTick;r++)if(null!==a[r]["_Numer "+i.name]||null!==a[r]["_Denom "+i.name]){n.push(a[r]["_Numer "+i.name]),o.push(a[r]["_Denom "+i.name]),n.length>i.days&&(n.shift(),o.shift());var l,h=0,c=0;for(l=0;l<n.length;l++)h+=n[l];for(l=0;l<o.length;l++)c+=o[l];0===c&&(c=1e-8),r<i.startFrom||(a[r]["Rel Vig "+i.name]=h/c)}for(e.Studies.MA("triangular",4,"Rel Vig "+i.name,0,"RelVigSignal",t,i),r=i.startFrom;r<a.length;r++)a[r][i.name+"_hist"]=a[r]["Rel Vig "+i.name]-a[r]["RelVigSignal "+i.name];i.outputMap[i.name+"_hist"]=""}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Rel Vig":{name:"Relative Vigor Index",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateRelativeVigor,inputs:{Period:10},outputs:{"Rel Vig":"auto",RelVigSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}}})):console.error("relativeVigor feature requires first activating studies feature.")},J=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateRSI=function(t,e){var i=e.chart.scrubbed,a=e.inputs.Field;function r(t,e){return 0===e?100:100-100/(1+t/e)}if(a&&"field"!=a||(a="Close"),i.length<e.days+1)e.error=!0;else{for(var s=e.startFrom;s<i.length;s++)if(s){var n=i[s],o=i[s-1];if((n[a]||0===n[a])&&(o[a]||0===o[a])){var l=n[a]-o[a],h=Math.min(s,e.days),c=o["_avgG "+e.name];c||(c=0),c-=c/h;var u=o["_avgL "+e.name];if(u||(u=0),u-=u/h,l>0)c+=l/h;else{if(!(l<=0))continue;u-=l/h}s>=e.days&&(!c&&0===c||!u&&0===u||(n["RSI "+e.name]=r(c,u))),n["_avgG "+e.name]=c,n["_avgL "+e.name]=u}}e.zoneOutput="RSI"}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{rsi:{name:"RSI",inputs:{Period:14,Field:"field"},calculateFN:e.Studies.calculateRSI,range:"0 to 100",outputs:{RSI:"auto"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}}})):console.error("rsi feature requires first activating studies feature.")},tt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateSchaff=function(t,i){var a=i.chart.scrubbed,r=i.days,s=Number(i.inputs["Short Cycle"]),n=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,s,n)+1)i.error=!0;else{var o=i.inputs.Field;o&&"field"!=o||(o="Close");e.Studies.MA(i.inputs["Moving Average Type"],s,o,0,"_MACD1",t,i),e.Studies.MA(i.inputs["Moving Average Type"],n,o,0,"_MACD2",t,i);for(var l=0,h=0,c=i.startFrom;c<a.length;c++){var u=a[c];if(!(c<n-1)){var d=u["_MACD1 "+i.name],p=u["_MACD2 "+i.name];(d||0===d||p||0===p)&&(u["_MACD "+i.name]=d-p);var m=u["_MACD "+i.name];if(!(c<n+(r-1))){var g=v(r,c,"_MACD");l=g[1]>g[0]?100*(m-g[0])/(g[1]-g[0]):l,(m||0===m)&&(u["_PF "+i.name]=a[c-1]["_PF "+i.name]?a[c-1]["_PF "+i.name]+.5*(l-a[c-1]["_PF "+i.name]):l);var f=u["_PF "+i.name];c<n+2*(r-1)||(h=(g=v(r,c,"_PF"))[1]>g[0]?100*(f-g[0])/(g[1]-g[0]):h,(f||0===f)&&(u["Result "+i.name]=a[c-1]["Result "+i.name]?a[c-1]["Result "+i.name]+.5*(h-a[c-1]["Result "+i.name]):h))}}}}function v(t,e,r){for(var s=null,n=null,o=e-t+1;o<=e;o++){var l=a[o][r+" "+i.name];l&&(s=null===s?l:Math.min(s,l),n=null===n?l:Math.max(n,l))}return[s,n]}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Schaff:{name:"Schaff Trend Cycle",range:"0 to 100",calculateFN:e.Studies.calculateSchaff,inputs:{Period:10,Field:"field","Short Cycle":23,"Long Cycle":50,"Moving Average Type":"ema"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:75,studyOverBoughtColor:"auto",studyOverSoldValue:25,studyOverSoldColor:"auto"}}}})):console.error("schaffTrendCycle feature requires first activating studies feature.")},et=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateShinohara=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r={weakNum:0,weakDen:0,strongNum:0,strongDen:0};i.startFrom>1&&(r=e.clone(a[i.startFrom-1]["_accums "+i.name]));for(var s=i.startFrom;s<a.length;s++)r.weakNum+=a[s].High-a[s].Close,r.weakDen+=a[s].Close-a[s].Low,s>0&&(r.strongNum+=a[s].High-a[s-1].Close,r.strongDen+=a[s-1].Close-a[s].Low),s>=i.days&&(r.weakNum-=a[s-i.days].High-a[s-i.days].Close,r.weakDen-=a[s-i.days].Close-a[s-i.days].Low,a[s]["Weak Ratio "+i.name]=100*r.weakNum/r.weakDen,s>i.days&&(r.strongNum-=a[s-i.days].High-a[s-i.days-1].Close,r.strongDen-=a[s-i.days-1].Close-a[s-i.days].Low,a[s]["Strong Ratio "+i.name]=100*r.strongNum/r.strongDen)),a[s]["_accums "+i.name]=e.clone(r)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Shinohara:{name:"Shinohara Intensity Ratio",calculateFN:e.Studies.calculateShinohara,inputs:{Period:26},outputs:{"Strong Ratio":"#E99B54","Weak Ratio":"#5F7CB8"}}})):console.error("shinohara feature requires first activating studies feature.")},it=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateStochastics=function(t,i){i.smooth||(i.smooth=i.inputs.Smooth);var a=i.inputs.Field;a&&"field"!=a||(a="Close");var r=i.inputs["%K Periods"];r||(r=i.days);var s=i.chart.scrubbed;if(s.length<Math.max(r,i.days)+1)i.error=!0;else{var n=i.inputs["%K Smoothing Periods"];n&&!i.inputs.Fast?i.smooth=!0:i.smooth&&(n=3);var o=i.inputs["%D Periods"];o||(o=3),i.outputs.Fast&&(i.outputMap={},i.outputMap["%K "+i.name]="Fast",i.outputMap["%D "+i.name]="Slow");for(var l=Math.max(r,i.startFrom);l<s.length;l++){null!==h(l,a,r)&&(s[l]["_Fast%K "+i.name]=h(l,a,r))}e.Studies.MA("simple",i.smooth?n:1,"_Fast%K "+i.name,0,"%K",t,i),e.Studies.MA("simple",o,"%K "+i.name,0,"%D",t,i)}function h(t,e,i){for(var a=t-i+1,r=-1*Number.MAX_VALUE,n=Number.MAX_VALUE,o=a;o<=t;o++){var l=s[o]["Close"==e?"Low":e],h=s[o]["Close"==e?"High":e];(l||0===l)&&((h||0===h)&&(n=Math.min(n,l),r=Math.max(r,h)))}return r==-1*Number.MAX_VALUE||n==Number.MAX_VALUE?null:r==n?0:(s[t][e]-n)/(r-n)*100}},e.Studies.calculateStochMomentum=function(t,i){var a=Number(i.inputs["%K Periods"]),r=Number(i.inputs["%K Smoothing Periods"]),s=Number(i.inputs["%K Double Smoothing Periods"]),n=Number(i.inputs["%D Periods"]),o=i.chart.scrubbed;if(o.length<a+r+s-1||o.length<n)i.error=!0;else{var l;for(l=Math.max(a,i.startFrom)-1;l<o.length;l++){var h=o[l],c=u(a,l);h["_H "+i.name]=h.Close-(c[0]+c[1])/2,h["_DHL "+i.name]=c[1]-c[0]}for(e.Studies.MA("exponential",r,"_H "+i.name,0,"_HS1",t,i),e.Studies.MA("exponential",s,"_HS1 "+i.name,0,"_HS2",t,i),e.Studies.MA("exponential",r,"_DHL "+i.name,0,"_DHL1",t,i),e.Studies.MA("exponential",s,"_DHL1 "+i.name,0,"_DHL2",t,i),l=a-1;l<o.length;l++)o[l]["%K "+i.name]=o[l]["_HS2 "+i.name]/(.5*o[l]["_DHL2 "+i.name])*100;e.Studies.MA(i.inputs["%D Moving Average Type"],n,"%K "+i.name,0,"%D",t,i),i.zoneOutput="%K"}function u(t,e){for(var i=null,a=null,r=e-t+1;r<=e;r++)i=null===i?o[r].Low:Math.min(i,o[r].Low),a=null===a?o[r].High:Math.max(a,o[r].High);return[i,a]}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Stch Mtm":{name:"Stochastic Momentum Index",calculateFN:e.Studies.calculateStochMomentum,inputs:{"%K Periods":10,"%K Smoothing Periods":3,"%K Double Smoothing Periods":3,"%D Periods":10,"%D Moving Average Type":"ema"},outputs:{"%K":"auto","%D":"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:40,studyOverBoughtColor:"auto",studyOverSoldValue:-40,studyOverSoldColor:"auto"}}},stochastics:{name:"Stochastics (Simple)",range:"0 to 100",calculateFN:e.Studies.calculateStochastics,inputs:{Period:14,Field:"field",Smooth:!0},outputs:{Fast:"auto",Slow:"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Stochastics:{name:"Stochastics",range:"0 to 100",calculateFN:e.Studies.calculateStochastics,inputs:{Field:"field","%K Periods":14,Fast:!1,"%K Smoothing Periods":3,"%D Periods":3},outputs:{"%K":"auto","%D":"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}},attributes:{"%K Smoothing Periods":{hidden:function(){return this.inputs.Fast}}},centerline:50}})):console.error("stochastics feature requires first activating studies feature.")},at=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateSupertrend=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.calculateStudyATR(t,i);for(var r=i.startFrom;r<a.length;r++){var s=a[r];if(s){var n=(s.High+s.Low)/2,o=i.inputs.Multiplier*s["ATR "+i.name],l=n-o,h=n+o;r&&(a[r-1]&&a[r-1].Close&&a[r-1].Close>a[r-1]["_Uptrend "+i.name]&&a[r-1]["_Uptrend "+i.name]>l&&(l=a[r-1]["_Uptrend "+i.name]),a[r-1]&&a[r-1].Close&&a[r-1].Close<a[r-1]["_Downtrend "+i.name]&&a[r-1]["_Downtrend "+i.name]<h&&(h=a[r-1]["_Downtrend "+i.name])),s["_Direction "+i.name]=1,r&&(s["_Direction "+i.name]=a[r-1]["_Direction "+i.name],s.Close>a[r-1]["_Downtrend "+i.name]?s["_Direction "+i.name]=1:s.Close<a[r-1]["_Uptrend "+i.name]&&(s["_Direction "+i.name]=-1)),s["_Uptrend "+i.name]=l,s["_Downtrend "+i.name]=h,s["Trend "+i.name]=s["_Direction "+i.name]>0?l:h}}i.outputMap={},i.outputMap["Trend "+i.name]=""}},e.Studies.displaySupertrend=function(t,e,i){var a=t.panels[e.panel],r=e.getContext(t),s=e.getYAxis(t);function n(t,i,a){return i&&i["_Direction "+e.name]<0?e.outputs.Downtrend:e.outputs.Uptrend}var o={skipTransform:a.name!=e.chart.name,skipProjections:!0,label:t.preferences.labels,yAxis:s,highlight:e.highlight};r.strokeStyle=n(0,i[i.length-1]),r.lineWidth=2,e.highlight&&(r.lineWidth=1.5);for(var l="Trend "+e.name,h=0;a.chart.transformFunc&&s!=a.chart.yAxis&&h<i.length;h++){var c=i[h];c&&c.transform&&(c.transform[l]=a.chart.transformFunc(t,a.chart,c[l]))}t.plotDataSegmentAsLine(l,a,o,n),r.lineWidth=1,r.globalAlpha=1,t.startClip(e.panel),!e.highlight&&t.highlightedDraggable&&(r.globalAlpha*=.3);var u,d=r.measureText("▲").width/2;for(u=0;u<i.length;u++)if(i[u]&&i[u-1])if(i[u-1]["_Direction "+e.name]>i[u]["_Direction "+e.name]){r.fillStyle=e.outputs.Downtrend,r.textBaseline="bottom";for(var p=t.pixelFromPrice(i[u].High,a,s),m=5;m<=45;m+=10)s.flipped?r.fillText("▲",t.pixelFromBar(u)-d,p+m):r.fillText("▼",t.pixelFromBar(u)-d,p-m)}else if(i[u-1]["_Direction "+e.name]<i[u]["_Direction "+e.name]){r.fillStyle=e.outputs.Uptrend,r.textBaseline="top";for(var g=t.pixelFromPrice(i[u].Low,a,s),f=5;f<=45;f+=10)s.flipped?r.fillText("▼",t.pixelFromBar(u)-d,g-f):r.fillText("▲",t.pixelFromBar(u)-d,g+f)}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Supertrend:{name:"Supertrend",overlay:!0,seriesFN:e.Studies.displaySupertrend,calculateFN:e.Studies.calculateSupertrend,inputs:{Period:7,Multiplier:3},outputs:{Uptrend:"#8cc176",Downtrend:"#b82c0c"},attributes:{Multiplier:{min:.1,step:.1}}}})):console.error("supertrend feature requires first activating studies feature.")},rt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateSwingIndex=function(t,e){var i=e.inputs["Limit Move Value"];(null===i||isNaN(i))&&(i=99999);var a=e.chart.scrubbed,r=0;e.startFrom>1&&(r=a[e.startFrom-1]["Result "+e.name]);for(var s=Math.max(1,e.startFrom);s<a.length;s++){var n=Math.abs(a[s].High-a[s-1].Close),o=Math.abs(a[s].Low-a[s-1].Close),l=Math.abs(a[s].High-a[s].Low),h=Math.abs(a[s-1].Close-a[s-1].Open),c=Math.max(n,o),u=Math.max(l,c),d=u+.25*h;u==n?d-=.5*o:u==o&&(d-=.5*n);var p=50*(a[s].Close-a[s-1].Close+.5*(a[s].Close-a[s].Open)+.25*(a[s-1].Close-a[s-1].Open))/d*(c/i);0!==d&&0!==i||(p=0),"Swing"==e.type&&(r=0),r+=p,a[s]["Result "+e.name]=r}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Acc Swing":{name:"Accumulative Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},Swing:{name:"Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}}})):console.error("swingIndex feature requires first activating studies feature.")},st=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateTrendIntensity=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ma",i.days,r,0,"_SMA",t,i);var s,n,o=0,l=0,h=[],c=Math.ceil(i.days/2);for(s=Math.max(0,i.startFrom-c);s<a.length;s++)(a[s]["_SMA "+i.name]||0===a[s]["_SMA "+i.name])&&((n=a[s][r]-a[s]["_SMA "+i.name])<0?l+=-1*n:o+=n,h.push(n),h.length>c&&((n=h.shift())<0?l-=-1*n:o-=n),s<i.startFrom||(a[s]["TII "+i.name]=u(o,l)));e.Studies.MA("ema",i.inputs["Signal Period"],"TII "+i.name,0,"Signal",t,i)}function u(t,e){return Math.abs(e)<1e-8?100:100-100/(1+t/e)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Trend Int":{name:"Trend Intensity Index",calculateFN:e.Studies.calculateTrendIntensity,range:"0 to 100",inputs:{Period:14,Field:"field","Signal Period":9},outputs:{TII:"auto",Signal:"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}}})):console.error("trendIntensity feature requires first activating studies feature.")},nt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateTRIX=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.name,s=["Close","_MA1 "+r,"_MA2 "+r,"_MA3 "+r],n=0;n<s.length-1;n++)e.Studies.MA("exponential",i.days,s[n],0,"_MA"+(n+1).toString(),t,i);for(var o=s[3],l=Math.max(1,i.startFrom);l<a.length;l++){var h=a[l-1][o];if(h){var c=a[l][o];(c||0===c)&&(a[l]["Result "+r]=100*(c/h-1))}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{TRIX:{name:"TRIX",calculateFN:e.Studies.calculateTRIX}})):console.error("trix feature requires first activating studies feature.")},ot=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateTwiggsMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,s=i[e.startFrom-1];s&&(s["_sumMF "+e.name]&&(a=s["_sumMF "+e.name]),s["_sumV "+e.name]&&(r=s["_sumV "+e.name]));for(var n=Math.max(1,e.startFrom);n<i.length;n++){var o=Math.max(i[n-1].Close,i[n].High),l=Math.min(i[n-1].Close,i[n].Low);i[n]["_MFV "+e.name]=i[n].Volume*(2*i[n].Close-o-l)/(o-l==0?999999:o-l),n>e.days-1&&(a*=(e.days-1)/e.days,r*=(e.days-1)/e.days),a+=i[n]["_MFV "+e.name],r+=i[n].Volume,n>e.days-1&&r&&(i[n]["Result "+e.name]=a/(r>0?r:999999)),i[n]["_sumMF "+e.name]=a,i[n]["_sumV "+e.name]=r}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Twiggs:{name:"Twiggs Money Flow",calculateFN:e.Studies.calculateTwiggsMoneyFlow,inputs:{Period:21}}})):console.error("twiggsMoneyFlow feature requires first activating studies feature.")},lt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?e.Studies.calculateTypicalPrice?e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Typical Price":{name:"Typical Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"Weighted Close":{name:"Weighted Close",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}}}):console.error("typicalPrice feature requires first activating medianPrice feature."):console.error("typicalPrice feature requires first activating studies feature.")},ht=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateUlcerIndex=function(t,i){var a=i.chart.scrubbed;if(a.length<2*i.days-1)i.error=!0;else{var r,s=i.inputs.Field;for(s&&"field"!=s||(s="Close"),r=Math.max(i.startFrom,i.days-1);r<a.length;r++)a[r]["_PD2 "+i.name]=Math.pow(100*(a[r][s]/o(i.days,r,s)-1),2);for(e.Studies.MA("simple",i.days,"_PD2 "+i.name,0,"_MA",t,i),r=Math.max(i.startFrom,2*(i.days-1));r<a.length;r++){var n=a[r]["_MA "+i.name];(n||0===n)&&(a[r]["Result "+i.name]=Math.sqrt(n))}}function o(t,e,i){for(var r=null,s=e-t+1;s<=e;s++)s<0||(r=null===r?a[s][i]:Math.max(r,a[s][i]));return r}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Ulcer:{name:"Ulcer Index",calculateFN:e.Studies.calculateUlcerIndex,inputs:{Period:14,Field:"field"}}})):console.error("ulcerIndex feature requires first activating studies feature.")},ct=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateUltimateOscillator=function(t,e){var i=e.chart.scrubbed,a=[e.inputs["Cycle 1"],e.inputs["Cycle 2"],e.inputs["Cycle 3"]],r=Math.max(a[0],a[1],a[2]);if(i.length<r+1)e.error=!0;else{var s=a[0]*a[1],n=a[0]*a[2],o=a[1]*a[2],l=[0,0,0],h=[0,0,0];e.startFrom&&(i[e.startFrom-1]["_accbp "+e.name]&&(l=i[e.startFrom-1]["_accbp "+e.name].slice()),i[e.startFrom-1]["_acctr "+e.name]&&(h=i[e.startFrom-1]["_acctr "+e.name].slice()));for(var c=Math.max(1,e.startFrom);c<i.length;c++){for(var u=Math.min(i[c].Low,i[c-1].Close),d=i[c].Close-u,p=Math.max(i[c].High,i[c-1].Close)-u,m=0;m<a.length;m++)if(l[m]+=d,h[m]+=p,c>a[m]){var g=Math.min(i[c-a[m]].Low,i[c-a[m]-1].Close),f=i[c-a[m]].Close-g,v=Math.max(i[c-a[m]].High,i[c-a[m]-1].Close)-g;l[m]-=f,h[m]-=v}if(i[c]["_accbp "+e.name]=l.slice(),i[c]["_acctr "+e.name]=h.slice(),!(c<r)){var y=o*l[0]/h[0]+n*l[1]/h[1]+s*l[2]/h[2],x=o+n+s;i[c]["Result "+e.name]=100*y/x}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Ultimate:{name:"Ultimate Oscillator",calculateFN:e.Studies.calculateUltimateOscillator,inputs:{"Cycle 1":7,"Cycle 2":14,"Cycle 3":28},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}}})):console.error("ultimateOscillator feature requires first activating studies feature.")},ut=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateValuationLines=function(t,e,i){for(var a="field"==e.inputs.Field?"Close":e.inputs.Field,r=e.inputs["Average Type"],s=e.inputs["Display Average"],n=e.inputs["Display 1 Standard Deviation (1σ)"],o=e.inputs["Display 2 Standard Deviation (2σ)"],l=e.inputs["Display 3 Standard Deviation (3σ)"],h=[],c=0;c<i.length;++c)i[c]&&!isNaN(i[c][a])&&h.push(i[c][a]);var u=function(t,e){var i=t.length,a=0,r=0,s=0;switch(e){case"mean":for(r=i;s<i;++s)a+=t[s];break;case"harmonic":for(a=i;s<i;++s)r+=1/t[s];break;case"median":var n=Math.floor(i/2),o=t.slice().sort((function(t,e){return t>e?1:t<e?-1:0}));i%2==0?(a=o[n]+o[n-1],r=2):(a=o[n],r=1)}return a/r}(h,r),d=!(n||o||l)||function(t,e){for(var i=t.length,a=0,r=0;r<i;++r)a+=Math.pow(t[r]-e,2);return Math.sqrt(a/i)}(h,u);e.data={Average:s?[u]:null,"1 Standard Deviation (1σ)":n?[u+d,u-d]:null,"2 Standard Deviation (2σ)":o?[u+2*d,u-2*d]:null,"3 Standard Deviation (3σ)":l?[u+3*d,u-3*d]:null};var p=d;if(e.parameters||(e.parameters={}),l?e.parameters.range=[u-3*d-p,u+3*d+p]:o?e.parameters.range=[u-2*d-p,u+2*d+p]:n?e.parameters.range=[u-d-p,u+d+p]:s&&(e.parameters.range=[u-p,u+p]),e.panel){var m=t.panels[e.panel],g=t.getYAxisByName(m,e.name);if(g){g.decimalPlaces=m.chart.yAxis.printDecimalPlaces;var f={yAxis:g};t.calculateYAxisRange(m,g,e.parameters.range[0],e.parameters.range[1]),t.createYAxis(m,f),t.drawYAxis(m,f)}}},e.Studies.displayValuationLines=function(t,i){var a,r,s,n,o,l,h,c,u,d=t.panels[i.panel],p=i.getYAxis(t),m=i.getContext(t),g=i.data,f=i.parameters.labels,v=i.inputs["Average Type"],y={mean:"AVG",median:"MED",harmonic:"HAVG"},x=t.canvasStyle("ciq-valuation-average-line"),b=t.canvasStyle("ciq-valuation-deviation-line"),S=t.getCanvasFontSize("stx_yaxis")+6;for(var C in g)if(g[C])for(a="Average"==C,r=e.Studies.determineColor(i.outputs[C]),s=g[C],n=0;n<s.length;++n)if(o=s[n],!((l=t.pixelFromPrice(o,d,p))<=d.top||l>=d.yAxis.bottom))if(u=a?{pattern:"none"!=x.borderStyle&&x.borderStyle||"solid",lineWidth:parseFloat(x.borderWidth)||1,opacity:parseFloat(x.opacity)||1,yAxis:p}:{pattern:"none"!=b.borderStyle&&b.borderStyle||"dashed",lineWidth:parseFloat(b.borderWidth)||1,opacity:parseFloat(b.opacity)||1,yAxis:p},t.plotLine(d.left,d.right,l,l,r,"line",m,d,u),"yaxis"!==f){if(!((l+=Math.floor(u.lineWidth/2))+S>=d.yAxis.bottom)){h=(a?y[v]+": ":C[0]+"σ: ")+t.formatYAxisPrice(o,d),c=m.measureText(h).width;var w=d.right-c-3;p&&"left"==p.position&&(w=d.left+3),m.strokeText(h,w,l+S/2+.5)}}else t.createYAxisLabel(d,t.formatYAxisPrice(o,d),l,r,null,m,p)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"val lines":{name:"Valuation Lines",calculateFN:function(){},seriesFN:function(t,i,a){e.Studies.calculateValuationLines(t,i,a),e.Studies.displayValuationLines(t,i)},overlay:!0,yAxisFN:function(){},inputs:{Field:"field","Average Type":["mean","median","harmonic"],"Display Average":!0,"Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1},outputs:{Average:"#00afed","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"}}})):console.error("valuationLines feature requires first activating studies feature.")},dt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateRelativeVolatility=function(t,i){i.days=Number(i.inputs["Smoothing Period"]);var a=Number(i.inputs["STD Period"]),r=i.chart.scrubbed;if(r.length<i.days+a)i.error=!0;else{var s=i.inputs.Field;s&&"field"!=s||(s="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=a,i.std.startFrom=i.startFrom,i.std.inputs={Field:s,"Standard Deviations":1,Type:"ma"},i.std.outputs={_STD:null},e.Studies.calculateStandardDeviation(t,i.std);var n=0,o=0;i.startFrom>1&&(n=r[i.startFrom-1]["_avgG "+i.name]||0,o=r[i.startFrom-1]["_avgL "+i.name]||0);for(var l=Math.max(i.startFrom,i.days);l<r.length;l++){var h=r[l],c=r[l-1];(h[s]||0===h[s])&&((c[s]||0===c[s])&&(h["_STD "+i.name]||0===h["_STD "+i.name])&&(h[s]>c[s]?(n=(n*(i.days-1)+h["_STD "+i.name])/i.days,o=o*(i.days-1)/i.days):(o=(o*(i.days-1)+h["_STD "+i.name])/i.days,n=n*(i.days-1)/i.days),h["Rel Vol "+i.name]=u(n,o),h["_avgG "+i.name]=n,h["_avgL "+i.name]=o))}i.zoneOutput="Rel Vol"}function u(t,e){return t+e===0?100:100*t/(t+e)}},e.Studies.calculateHistoricalVolatility=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs["Standard Deviations"];r<0&&(r=1);var s,n=100*Math.sqrt((s=e.inputs["Days Per Year"],isNaN(s)&&(s=365),"day"==t.layout.interval?s:"week"==t.layout.interval?52:"month"==t.layout.interval?12:s))*r,o=[],l=0;e.startFrom>1&&(l=i[e.startFrom-1]["_state "+e.name][0],o=i[e.startFrom-1]["_state "+e.name][1].slice());for(var h=Math.max(1,e.startFrom);h<i.length;h++){var c=i[h-1][a];if(c){var u=Math.log(i[h][a]/c);if(o.push(u),l+=u,h>=e.days){var d=0;l/=e.days;for(var p=0;p<o.length;p++)d+=Math.pow(o[p]-l,2);l*=e.days,l-=o.shift(),i[h]["Result "+e.name]=Math.sqrt(d/e.days)*n}}i[h]["_state "+e.name]=[l,o.slice()]}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Hist Vol":{name:"Historical Volatility",calculateFN:e.Studies.calculateHistoricalVolatility,inputs:{Period:10,Field:"field","Days Per Year":[252,365],"Standard Deviations":1},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Rel Vol":{name:"Relative Volatility",range:"0 to 100",calculateFN:e.Studies.calculateRelativeVolatility,inputs:{Field:"field","STD Period":10,"Smoothing Period":14},outputs:{"Rel Vol":"auto"},centerline:50,parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}}})):console.error("volatilityIndex feature requires first activating studies feature.")},pt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.displayVolumeProfile=function(t,i,a){if(t&&t.chart.dataSet){var r=t.chart,s=i.parameters.numberOfBars,n=i.parameters.widthPercentage,o=i.parameters.displayBorder,l=i.parameters.displayVolume;(!s||s<0)&&(s=30),s=Math.ceil(s),(!n||n<0)&&(n=.25),!1!==o&&(o=!0),!0!==l&&(l=!1);var h=(r.highValue-r.lowValue)/s;if(0!==h){for(var c=[],u=r.lowValue;u<r.highValue+.1;u+=h)c.push([u,0]);if(c.length<2)t.displayErrorAsWatermark("chart",t.translateIf("Not enough data to render the Volume Profile"));else{for(var d=0,p=0;p<a.length;p++){var m=a[p];if(m){var g=m.Volume;i.panel==r.name&&m.transform&&(m=m.transform);for(var f=c[0][0],v=0,y=1;y<c.length;y++)v=c[y][0],(m.Low>=f&&m.Low<=v||m.Low<f&&m.High>v||m.High>=f&&m.High<=v)&&(c[y][1]+=g,c[y][1]>d&&(d=c[y][1])),f=v}}if(0!==d){t.setStyle("stx_volume_profile","color",e.Studies.determineColor(i.outputs["Bars Color"]));var x=i.getContext(t),b="stx-float-date";t.canvasFont(b,x);var S=t.getCanvasFontSize(b),C=r.panel,w=C.yAxis.bottom,k=Math.round(r.right)-.5,D=r.width*n,T=t.canvasStyle("stx_volume_profile").borderTopColor,M=!e.isTransparent(t.canvasStyle("stx_volume_profile").borderTopColor)&&o,A=t;_("stx_volume_profile",!1),M&&_("stx_volume_profile",!0),x.globalAlpha=1}else t.displayErrorAsWatermark("chart",t.translateIf("Not enough data to render the Volume Profile"))}}}function _(a,r){r||(k-=2),A.canvasColor(a),x.beginPath();for(var s=c[0][0],n=k,o=1;o<c.length;o++){if(c[o][1]){var h=Math.round(k-c[o][1]*D/d)-.5,u=Math.round(A.pixelFromTransformedValue(s,C))+.5,p=Math.round(A.pixelFromTransformedValue(c[o][0],C))+.5;if(r||(u-=.5,p+=.5,h+=.5),u>w&&(u=w),p<w)if(x.moveTo(k,u),x.lineTo(k,p),x.lineTo(h,p),x.lineTo(h,u),r)(n>h||1==o)&&x.lineTo(n,u);else if(x.lineTo(k,u),l){var m=e.condenseInt(c[o][1]),g=u-p;if(S<=g-2){var f;try{f=x.measureText(m).width}catch(t){f=0}x.textBaseline="top";var v=x.fillStyle;x.fillStyle=T,x.fillText(m,h-f-3,p+(g/2-S/2)),x.fillStyle=v}}n=h}else n=k;s=c[o][0]}!i.highlight&&t.highlightedDraggable&&(x.globalAlpha*=.3),r||x.fill(),x.strokeStyle=T,r&&x.stroke(),x.closePath()}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"vol profile":{name:"Volume Profile",underlay:!0,seriesFN:e.Studies.displayVolumeProfile,calculateFN:null,inputs:{},outputs:{"Bars Color":"#b64a96"},customRemoval:!0,parameters:{init:{displayBorder:!0,displayVolume:!1,numberOfBars:30,widthPercentage:.25}},attributes:{yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0},flippedEnabled:{hidden:!0}}}})):console.error("volumeProfile feature requires first activating studies feature.")},mt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateOnBalanceVolume=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.inputs["Min Tick Value"],r=!1;a||0===a||(r=!0,a=0);for(var s,n,o=e.chart.scrubbed,l=0,h=e.startFrom;h<o.length;h++)if(s=o[h],h&&s[i]&&(o[h-1][i]&&(n=o[h-1]),n)){s[i]-n[i]>a?l=1:n[i]-s[i]>a?l=-1:r&&(l=0);var c=n["Result "+e.name];c||(c=0),c+=s.Volume*l,s["Result "+e.name]=c}},e.Studies.calculatePriceVolumeTrend=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.chart.scrubbed,r=0;e.startFrom>1&&(r=a[e.startFrom-1]["Result "+e.name]);for(var s=Math.max(1,e.startFrom);s<a.length;s++)a[s][i]&&a[s-1][i]&&(r+=a[s].Volume*(a[s][i]-a[s-1][i])/a[s-1][i],a[s]["Result "+e.name]=r)},e.Studies.calculateVolumeIndex=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close");var r=i.chart.scrubbed;if(r.length<i.days+1)i.error=!0;else{var s=100;i.startFrom>1&&(s=r[i.startFrom-1]["Index "+i.name]);for(var n=Math.max(1,i.startFrom);n<r.length;n++){var o=r[n][a],l=r[n].Volume;o&&"object"==typeof o&&(l=o.Volume,o=o[i.subField]);var h=r[n-1][a],c=r[n-1].Volume;h&&"object"==typeof h&&(c=h.Volume,h=h[i.subField]),o&&(h&&(("Pos Vol"==i.type&&l>c||"Neg Vol"==i.type&&l<c)&&(s*=o/h),r[n]["Index "+i.name]=s))}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Index "+i.name,0,"MA",t,i)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Neg Vol":{name:"Negative Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Period:255,Field:"field","Moving Average Type":"ma"},outputs:{Index:"auto",MA:"#FF0000"}},"On Bal Vol":{name:"On Balance Volume",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{}},"Pos Vol":{name:"Positive Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Period:255,Field:"field","Moving Average Type":"ma"},outputs:{Index:"auto",MA:"#FF0000"}},"Price Vol":{name:"Price Volume Trend",calculateFN:e.Studies.calculatePriceVolumeTrend,inputs:{Field:"field"}},"Trade Vol":{name:"Trade Volume Index",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{"Min Tick Value":.5}},"Vol ROC":{name:"Volume Rate of Change",calculateFN:function(t,i){e.Studies.calculateRateOfChange?e.Studies.calculateRateOfChange(t,i):(console.error("Volume Rate of Change study requires first activating momentum feature."),e.Studies.calculateRateOfChange=function(t,e){})},parameters:{init:{isVolume:!0}}},"vol undr":{name:"Volume Underlay",underlay:!0,range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,position:"none",zoom:0,heightFactor:.25},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},customRemoval:!0,removeFN:function(t,e){t.layout.volumeUnderlay=!1,t.changeOccurred("layout")},attributes:{panelName:{hidden:!0}}}})):console.error("volumeStudies feature requires first activating studies feature.")},gt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateVortex=function(t,i){var a=i.chart.scrubbed,r=i.days;if(a.length<r+1)i.error=!0;else{var s={tr:0,vmPlus:0,vmMinus:0};i.startFrom>1&&(s=e.clone(a[i.startFrom-1]["_totals "+i.name]));for(var n=Math.max(i.startFrom,1);n<a.length;n++){var o=a[n],l=a[n-1],h=Math.abs(o.High-l.Low),c=Math.abs(o.Low-l.High),u=Math.max(o.High,l.Close)-Math.min(o.Low,l.Close);s.tr+=u,s.vmPlus+=h,s.vmMinus+=c,n>r&&(s.tr-=a[n-r]["_True Range "+i.name],s.vmPlus-=a[n-r]["_VMPlus "+i.name],s.vmMinus-=a[n-r]["_VMMinus "+i.name]),o["_True Range "+i.name]=u,o["_VMPlus "+i.name]=h,o["_VMMinus "+i.name]=c,n>=r&&(o["+VI "+i.name]=s.vmPlus/s.tr,o["-VI "+i.name]=s.vmMinus/s.tr),o["_totals "+i.name]=e.clone(s)}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{Vortex:{name:"Vortex Indicator",calculateFN:e.Studies.calculateVortex,centerline:1,outputs:{"+VI":"#00FF00","-VI":"#FF0000"},parameters:{init:{studyOverZonesEnabled:!0,studyOverBoughtValue:1.1,studyOverBoughtColor:"auto",studyOverSoldValue:.9,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:1,step:"0.01"},studyOverSoldValue:{max:1,step:"0.01"}}}})):console.error("vortex feature requires first activating studies feature.")},ft=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateMFI=function(t,e){var i,a=e.chart.scrubbed,r=0,s=e.inputs["Scale Factor"];s||(s=e.study.inputs["Scale Factor"]);var n,o=Math.pow(10,Number(s));for(e.startFrom>1&&(r=a[e.startFrom-1]["_high "+e.name]),n=e.startFrom;n<a.length;n++)a[n]&&a[n].Volume&&(a[n][e.name+"_hist"]=i=o*(a[n].High-a[n].Low)/a[n].Volume,a[n]["_high "+e.name]=r=Math.max(r,i));e.outputMap={},e.outputMap[e.name+"_hist"]=""},e.Studies.displayMFI=function(t,i,a){var r=t.panels[i.panel],s=i.getContext(t),n=i.getYAxis(t),o=n.flipped?n.top:n.bottom,l=t.layout.candleWidth-2;l<2&&(l=1);var h=e.Studies.determineColor(i.outputs.Green),c=e.Studies.determineColor(i.outputs.Fade),u=e.Studies.determineColor(i.outputs.Fake),d=e.Studies.determineColor(i.outputs.Squat);t.canvasColor("stx_histogram"),i.underlay||(s.globalAlpha=1),s.fillStyle="#CCCCCC",t.startClip(i.panel),!i.highlight&&t.highlightedDraggable&&(s.globalAlpha*=.3);for(var p=0;p<a.length;p++){var m=a[p],g=a[p-1];g||(g=t.getPreviousBar(t.chart,i.name+"_hist",p)),m&&(g&&(g[i.name+"_hist"]<m[i.name+"_hist"]?g.Volume<m.Volume?s.fillStyle=h:g.Volume>m.Volume&&(s.fillStyle=u):g[i.name+"_hist"]>m[i.name+"_hist"]&&(g.Volume<m.Volume?s.fillStyle=d:g.Volume>m.Volume&&(s.fillStyle=c))),m.candleWidth&&(l=Math.floor(Math.max(1,m.candleWidth-2))),s.fillRect(Math.floor(t.pixelFromBar(p,r.chart)-l/2),Math.floor(o),Math.floor(l),Math.floor(t.pixelFromPrice(m[i.name+"_hist"],r,n)-o)))}t.endClip()},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"W MFI":{name:"Market Facilitation Index",seriesFN:e.Studies.displayMFI,calculateFN:e.Studies.calculateMFI,yAxis:{ground:!0},range:"0 to max",inputs:{"Scale Factor":6},outputs:{Green:"#8bc176",Fade:"#ab611f",Fake:"#5f7cb8",Squat:"#ffd0cf"}}})):console.error("williamsMFI feature requires first activating studies feature.")};var vt,yt,xt;function bt(){}bt[539515]=function(){for(var t=2;9!==t;)switch(t){case 2:t="object"==typeof globalThis?1:5;break;case 1:return globalThis;case 5:var e;t=4;break;case 4:try{for(var i=2;6!==i;)switch(i){case 2:Object.defineProperty(Object.prototype,"oPQVM",{get:function(){for(;;)return this},configurable:!0}),e=oPQVM,i=5;break;case 5:e.x9iAb=e,i=4;break;case 4:i="undefined"==typeof x9iAb?3:9;break;case 3:throw"";case 9:delete e.x9iAb,delete Object.prototype.oPQVM,i=6}}catch(t){e=window}return e}}(),function(t){function e(t){for(;;){return[arguments][0][0]}}function i(t,e,i,a,r){for(var n=2;14!==n;)switch(n){case 2:var o=[arguments];o[3]="ty",o[4]="",o[4]="per",o[5]="definePro",o[1]=!0,n=8;break;case 8:o[1]=!0,o[1]=!1;try{for(var l=2;13!==l;)switch(l){case 3:return;case 9:o[9][o[0][4]]=o[9][o[0][2]],o[8].set=function(t){for(var e=2;5!==e;)if(2===e){var i=[arguments];o[9][o[0][2]]=i[0][0],e=5}},l=7;break;case 4:l=o[9].hasOwnProperty(o[0][4])&&o[9][o[0][4]]===o[9][o[0][2]]?3:9;break;case 7:o[8].get=function(){for(var t=2;14!==t;)switch(t){case 2:var e=[arguments];e[4]="",e[4]="fine",e[3]="",t=3;break;case 6:return typeof o[9][o[0][2]]==e[8]?void 0:o[9][o[0][2]];case 3:e[3]="unde",e[8]=e[3],e[8]+=e[4],e[8]+=s[91],t=6}},o[8].enumerable=o[1];try{for(var h=2;3!==h;)switch(h){case 2:o[7]=o[5],h=1;break;case 1:o[7]+=o[4],o[7]+=o[3],o[0][0].Object[o[7]](o[9],o[0][4],o[8]),h=3}}catch(t){}l=13;break;case 2:o[8]={},o[6]=(0,o[0][1])(o[0][0]),o[9]=[o[6],o[6].prototype][o[0][3]],l=4}}catch(t){}n=14}}function a(t){for(;;){return[arguments][0][0].Array}}for(var r=2;104!==r;)switch(r){case 50:s[11]="f",s[90]=1,s[36]=1,s[36]=0,r=46;break;case 61:s[35]=s[42],s[35]+=s[30],s[35]+=s[97],s[63]=s[91],r=57;break;case 86:s[38]+=s[3],r=85;break;case 18:s[3]="r",s[5]="timiz",s[75]="x4f",s[56]="9t",r=27;break;case 57:s[63]+=s[47],s[63]+=s[13],s[45]=s[55],s[45]+=s[65],r=76;break;case 27:s[85]="",s[85]="mvL",s[71]="__op",s[13]="",r=23;break;case 54:s[89]="L_Q",s[10]="QA",s[73]="78_",s[11]="",r=50;break;case 46:s[32]=s[11],s[32]+=s[73],s[32]+=s[10],s[31]=s[89],s[31]+=s[43],s[31]+=s[14],r=61;break;case 2:var s=[arguments];s[9]="u$",s[6]="",s[1]="Gy",r=3;break;case 72:s[25]=s[75],s[25]+=s[4],s[25]+=s[3],s[26]=s[55],s[26]+=s[56],s[26]+=s[2],s[21]=s[8],r=90;break;case 34:s[47]="",s[47]="39s",s[91]="",s[91]="d",r=30;break;case 30:s[97]="",s[97]="ual",s[30]="",s[30]="",r=43;break;case 90:s[21]+=s[6],s[21]+=s[7],s[38]=s[9],s[38]+=s[1],r=86;break;case 43:s[30]="esid",s[42]="",s[42]="__r",s[14]="",r=39;break;case 83:n(e,s[21],s[36],s[26]),r=82;break;case 80:n(a,"push",s[90],s[63]),r=79;break;case 23:s[22]="e",s[65]="9",s[13]="UX",s[55]="s",r=34;break;case 82:n(h,"test",s[90],s[25]),r=81;break;case 3:s[6]="",s[6]="bs",s[8]="",s[7]="tract",s[8]="",r=14;break;case 39:s[14]="8",s[43]="",s[43]="CC",s[89]="",r=54;break;case 79:n(e,s[35],s[36],s[31]),r=78;break;case 14:s[8]="__a",s[2]="",s[2]="XJ",s[4]="",s[4]="",s[4]="$",s[5]="",r=18;break;case 85:var n=function(t,e,a,r){for(var n=2;5!==n;)if(2===n){var o=[arguments];i(s[0][0],o[0][0],o[0][1],o[0][2],o[0][3]),n=5}};r=84;break;case 76:s[45]+=s[85],s[96]=s[71],s[96]+=s[5],s[96]+=s[22],r=72;break;case 84:n(l,"charCodeAt",s[90],s[38]),r=83;break;case 81:n(e,s[96],s[36],s[45]),r=80;break;case 78:n(o,"apply",s[90],s[32]),r=104}function o(t){for(;;){return[arguments][0][0].Function}}function l(t){for(;;){return[arguments][0][0].String}}function h(t){for(;;){return[arguments][0][0].RegExp}}}(bt[539515]),bt[156040]="cIs",bt[370258]=(vt=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{V29cT4d:function(t,e,i){for(var a=3432918353,r=461845907,s=i,n=-4&e,o=0;o<n;o+=4){var l=255&t.u$Gyr(o)|(255&t.u$Gyr(o+1))<<8|(255&t.u$Gyr(o+2))<<16|(255&t.u$Gyr(o+3))<<24;l=vt(l,a),s=5*(s=(524287&(s^=l=vt(l=(131071&l)<<15|l>>>17,r)))<<13|s>>>19)+3864292196|0}switch(l=0,e%4){case 3:l=(255&t.u$Gyr(n+2))<<16;case 2:l|=(255&t.u$Gyr(n+1))<<8;case 1:l|=255&t.u$Gyr(n),l=vt(l,a),s^=l=vt(l=(131071&l)<<15|l>>>17,r)}return s^=e,s=vt(s^=s>>>16,2246822507),s=vt(s^=s>>>13,3266489909),s^=s>>>16}}),bt.q$=function(){return"function"==typeof bt[370258].V29cT4d?bt[370258].V29cT4d.apply(bt[370258],arguments):bt[370258].V29cT4d},bt.Q4=function(){return"function"==typeof bt[593596].i9agN$W?bt[593596].i9agN$W.apply(bt[593596],arguments):bt[593596].i9agN$W},bt.X3=function(){return"function"==typeof bt[446427].N$y1PkD?bt[446427].N$y1PkD.apply(bt[446427],arguments):bt[446427].N$y1PkD},bt[103941]=bt[446427],bt.x5=function(){return"function"==typeof bt[593596].i9agN$W?bt[593596].i9agN$W.apply(bt[593596],arguments):bt[593596].i9agN$W},bt[238553]=552,bt.K9=function(){return"function"==typeof bt[370258].V29cT4d?bt[370258].V29cT4d.apply(bt[370258],arguments):bt[370258].V29cT4d},bt.P6=function(){return"function"==typeof bt[446427].N$y1PkD?bt[446427].N$y1PkD.apply(bt[446427],arguments):bt[446427].N$y1PkD},bt[150014]=bt[370258],bt[593596]=function(){for(;;){var t=[arguments];return t[1]=void 0,t[7]={},t[7].i9agN$W=function(){for(var e=2;90!==e;)switch(e){case 5:return 43;case 49:i[7].d39sUX(i[71]),i[7].d39sUX(i[52]),i[7].d39sUX(i[2]),i[7].d39sUX(i[17]),e=45;break;case 57:e=i[24]<i[7].length?56:69;break;case 4:i[7]=[],i[9]={},i[9].O8=["w4"],e=8;break;case 67:return t[1]=50,36;case 56:i[49]=i[7][i[24]];try{i[15]=i[49][i[18]]()?i[82]:i[42]}catch(t){i[15]=i[42]}e=77;break;case 58:i[24]=0,e=57;break;case 77:i[89]=0,e=76;break;case 24:i[52]=i[27],i[66]={},i[66].O8=["M6"],e=21;break;case 62:i[11]="O8",i[53]="O3",i[18]="D9",i[79]="S$",e=58;break;case 75:i[45]={},i[45][i[79]]=i[49][i[11]][i[89]],i[45][i[53]]=i[15],i[99].d39sUX(i[45]),e=71;break;case 21:i[66].D9=function(){return!/\050\x5b/.x4f$r(function(){return[1,2,3,4,5].concat([5,6,7,8])}+[])},i[71]=i[66],i[91]={},i[91].O8=["M6"],e=32;break;case 18:i[8]={},i[8].O8=["w4"],i[8].D9=function(){return"function"==typeof s9mvL},i[4]=i[8],i[27]={},i[27].O8=["M6"],i[27].D9=function(){return!/\u0032\x35/.x4f$r(function(){return decodeURIComponent("%25")}+[])},e=24;break;case 69:e=function(t){for(var e=2;22!==e;)switch(e){case 26:e=a[1]>=.5?25:24;break;case 19:a[3]++,e=7;break;case 7:e=a[3]<a[0][0].length?6:18;break;case 17:a[3]=0,e=16;break;case 24:a[3]++,e=16;break;case 10:e=a[2][i[53]]===i[82]?20:19;break;case 18:a[9]=!1,e=17;break;case 14:e=void 0===a[8][a[2][i[79]]]?13:11;break;case 23:return a[9];case 11:a[8][a[2][i[79]]].t+=!0,e=10;break;case 2:var a=[arguments];e=1;break;case 1:e=0===a[0][0].length?5:4;break;case 20:a[8][a[2][i[79]]].h+=!0,e=19;break;case 6:a[2]=a[0][0][a[3]],e=14;break;case 5:return;case 16:e=a[3]<a[4].length?15:23;break;case 25:a[9]=!0,e=24;break;case 8:a[3]=0,e=7;break;case 4:a[8]={},a[4]=[],a[3]=0,e=8;break;case 15:a[5]=a[4][a[3]],a[1]=a[8][a[5]].h/a[8][a[5]].t,e=26;break;case 12:a[4].d39sUX(a[2][i[79]]),e=11;break;case 13:a[8][a[2][i[79]]]=function(){for(var t=2;9!==t;)switch(t){case 3:return e[5];case 2:var e=[arguments];e[5]={},e[5].h=0,e[5].t=0,t=3}}.f78_QA(this,arguments),e=12}}(i[99])?68:67;break;case 54:i[7].d39sUX(i[55]),i[7].d39sUX(i[97]),e=52;break;case 14:i[1].O8=["M6"],i[1].D9=function(){return!/\x7c/.x4f$r(function(){return"a|a".split("|")}+[])},i[5]=i[1],i[3]={},i[3].O8=["M6"],i[3].D9=function(){return/\x39\067/.x4f$r(function(){return"aa".charCodeAt(1)}+[])},i[6]=i[3],e=18;break;case 32:i[91].D9=function(){return!/\u0061\x74\x6f\x62/.x4f$r(function(){return atob("PQ==")}+[])},i[12]=i[91],i[46]={},i[46].O8=["w4"],i[46].D9=function(){var t=!1,e=[];try{for(var i in console)e.d39sUX(i);t=0===e.length}catch(t){}return t},i[97]=i[46],i[70]={},e=42;break;case 52:i[7].d39sUX(i[5]),i[7].d39sUX(i[12]),i[7].d39sUX(i[4]),e=49;break;case 8:i[9].D9=function(){return"function"==typeof s9tXJ},i[2]=i[9],i[1]={},e=14;break;case 1:e=t[1]?5:4;break;case 71:i[89]++,e=76;break;case 70:i[24]++,e=57;break;case 2:var i=[arguments];e=1;break;case 45:i[7].d39sUX(i[6]),i[99]=[],i[82]="M0",i[42]="i6",e=62;break;case 42:i[70].O8=["w4"],i[70].D9=function(){return"function"==typeof L_QCC8},i[55]=i[70],e=39;break;case 68:e=68;break;case 76:e=i[89]<i[49][i[11]].length?75:70;break;case 39:i[72]={},i[72].O8=["M6"],i[72].D9=function(){return/\061/.x4f$r(function(){return"aa".lastIndexOf("a")}+[])},i[17]=i[72],e=54}},t[7]}}(),bt[539515].T5oo=bt,bt.p$=function(){return"function"==typeof bt[446427].g9iUvuS?bt[446427].g9iUvuS.apply(bt[446427],arguments):bt[446427].g9iUvuS},bt[636832]=bt[370258],bt.W$=function(){return"function"==typeof bt[446427].g9iUvuS?bt[446427].g9iUvuS.apply(bt[446427],arguments):bt[446427].g9iUvuS},bt[446427]={N$y1PkD:function(){var t,e=arguments;switch(yt){case 23:t=e[0]+(e[2]-e[1])*e[3];break;case 7:t=(e[1]+e[0])/e[2];break;case 11:t=e[0]*e[1];break;case 13:t=e[2]*e[0]*e[1]-e[3];break;case 14:t=e[2]/e[3]/e[0]-e[1];break;case 22:t=e[0]^e[1];break;case 16:t=e[1]|e[0];break;case 9:t=e[3]+e[2]-e[0]-e[1];break;case 0:t=e[1]-e[0];break;case 8:t=e[0]+e[1]-e[2];break;case 4:t=e[1]<<e[0];break;case 3:t=e[0]+e[1];break;case 18:t=(-e[2]*e[0]+e[4])*e[3]+e[1];break;case 12:t=e[0]/e[1];break;case 1:t=-e[1]*e[0]/e[3]-e[2]+e[4];break;case 6:t=e[2]-e[0]+e[3]+e[1];break;case 21:t=e[2]*e[1]-e[0];break;case 20:t=e[1]*e[3]-e[2]-e[0];break;case 25:t=-e[0]+e[1];break;case 2:t=e[1]+e[2]+e[3]-e[0];break;case 17:t=(e[1]-e[0])/e[3]-e[4]+e[2];break;case 19:t=e[2]/e[0]-e[1];break;case 10:t=(e[2]+e[0])/(e[1]<<e[3]);break;case 5:t=e[2]-e[0]+e[1];break;case 15:t=(e[0]+e[5]+e[3]+e[2])/(e[4]^e[1]);break;case 26:t=e[1]>>e[0];break;case 24:t=e[1]-e[0]*e[3]*e[2]}return t},g9iUvuS:function(t){yt=t}},bt.Q4(),xt=t=>{var e,i=bt;(e="undefined"!=typeof _CIQ?_CIQ:t.CIQ).Renderer.Aggregations=function(t){var e,a;i.x5(),this.construct(t),e=2;for(var r=1;1146658272!==i.q$(r.toString(),r.toString().length,84776);r++)a=this.params,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!1,e+=2;-1060791603!==i.K9(e.toString(),e.toString().length,82911)&&(a=this.params,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0),this.isAggregation=!0,a.highlightable=!1,"_main_series"!=a.name&&(console.warn("Aggregations are only allowed on main series."),a.invalid=!0)},e.inheritsFrom(e.Renderer.Aggregations,e.Renderer.OHLC,!1),e.Renderer.Aggregations.requestNew=function(t,a){var r,s,n;r=null;for(var o=0;o<t.length;o++)switch("r","angeb","a","rs",s=t[o]){case"kagi":case"pandf":r=s;break;case"heikinashi":case"linebreak":case"rangebars":case"renko":r="candle";break;default:return null}return i.x5(),null===r?null:((n=new e.Renderer["candle"==r?"OHLC":"Aggregations"]({params:e.extend(a,{type:r})})).isAggregation=!0,n)},e.Renderer.Aggregations.prototype.drawIndividualSeries=function(t,e){var a,r,s;if(!e.invalid){if(a=this.stx,r={colors:[]},"kagi"==e.type){"stx_k","a","gi_up",a.drawKagiSquareWave(t.panel,"stx_kagi_up","stx_kagi_down",e),r.colors.push(a.getCanvasColor("stx_kagi_up")),-1119126723,-1849760554,s=2;for(var n=1;-1119126723!==i.q$(n.toString(),n.toString().length,93368);n++)r.colors.push(a.getCanvasColor("")),s+=2;-1849760554!==i.q$(s.toString(),s.toString().length,37336)&&("stx_k","agi_dow","n",r.colors.push(a.getCanvasColor("stx_kagi_down")))}else"pandf"==e.type&&("stx_","pandf_","do","wn",a.drawPointFigureChart(t.panel,"stx_pandf_up","X",e),r.colors.push(a.getCanvasColor("stx_pandf_up")),a.drawPointFigureChart(t.panel,"stx_pandf_down","O",e),r.colors.push(a.getCanvasColor("stx_pandf_down")));-738875569,-1040864222,i.x5(),2;for(var o=1;-738875569!==i.K9(o.toString(),o.toString().length,21451);o++)return r;return-1040864222!==i.q$(2..toString(),2..toString().length,69453)?r:void 0}},e.ChartEngine.prototype.setAggregationType=function(t){var a;this.layout.chartType="candle",!1!==(a=this.chart).baseline.userLevel&&(a.baseline.userLevel=a.baseline.defaultLevel,a.panel.yAxis.scroll=e.ChartEngine.YAxis.prototype.scroll),i.x5(),this.layout.aggregationType=t,this.setMainSeriesRenderer(),a.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},e.ChartEngine.prototype.drawKagiSquareWave=function(t,a,r,s){var n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T;if(n=t.chart,this.startClip(t.name),o=n.dataSegment,l=n.context,(h=t.yAxis).flipped&&(c=a,a=r,r=c),u=this.canvasStyle(a),d=this.canvasStyle(r),this.canvasColor(a),s.border_color_up&&(l.strokeStyle=s.border_color_up),p=l.strokeStyle,this.canvasColor(r),s.border_color_down&&(l.strokeStyle=s.border_color_down),m=l.strokeStyle,g=1,u.width&&parseInt(u.width,10)<=25){2145854299,-392945673,f=2;for(var M=1;2145854299!==i.q$(M.toString(),M.toString().length,80544);M++)g=Math.max(1,e.stripPX(u.width)),f+=2;-392945673!==i.K9(f.toString(),f.toString().length,23683)&&(i.p$(0),g=Math.max(i.P6(0,"3"),e.stripPX(u.width)))}v=1,d.width&&parseInt(d.width,10)<=25&&(v=Math.max(1,e.stripPX(d.width))),this.highlightedDraggable&&(l.globalAlpha*=.3),l.beginPath(),i.p$(1),i.Q4();var A=i.P6(2,17,13,1,48);y=n.dataSet.length-n.scroll-A,x=!0,b=null,S=null,i.W$(2);var _=i.P6(31,19,10,3);C=t.left-.5*this.layout.candleWidth+this.micropixels-_;for(var F=0;F<=o.length;F++)if(C+=this.layout.candleWidth,w=o[F]){if(w.projection)break;S=w.kagiTrend,h.flipped&&(S*=-1),w.transform&&n.transformFunc&&(k=w.kagiPrevOpen,(w=w.transform).kagiPrevOpen=n.transformFunc(this,n,k)),D=w.cache,i.W$(3),((T=i.P6(y,F))<t.cacheLeft||T>t.cacheRight||!D.kagiOpen)&&(D.kagiOpen=h.semiLog?h.height*(1-(Math.log(Math.max(w.Open,0))/Math.LN10-h.logLow)/h.logShadow):(h.high-w.Open)*h.multiplier,D.kagiClose=h.semiLog?h.height*(1-(Math.log(Math.max(w.Close,0))/Math.LN10-h.logLow)/h.logShadow):(h.high-w.Close)*h.multiplier,h.flipped?(D.kagiOpen=h.bottom-D.kagiOpen,D.kagiClose=h.bottom-D.kagiClose):(D.kagiOpen+=h.top,D.kagiClose+=h.top)),D.kagiClose,b=h.semiLog?h.height*(1-(Math.log(Math.max(w.kagiPrevOpen,0))/Math.LN10-h.logLow)/h.logShadow):(h.high-w.kagiPrevOpen)*h.multiplier,h.flipped?b=h.bottom-b:b+=h.top,x?(l.moveTo(y>=0?t.left:Math.floor(C),D.kagiOpen),l.lineTo(Math.floor(C),D.kagiOpen),D.kagiClose<D.kagiOpen?(l.strokeStyle=p,l.lineWidth=g):(l.strokeStyle=m,l.lineWidth=v)):-1!=S&&D.kagiClose<b&&b<D.kagiOpen?(l.lineTo(Math.floor(C),b),l.stroke(),l.beginPath(),l.moveTo(Math.floor(C),b),l.strokeStyle=p,l.lineWidth=g):1!=S&&D.kagiClose>b&&b>D.kagiOpen&&(l.lineTo(Math.floor(C),b),l.stroke(),l.beginPath(),l.moveTo(Math.floor(C),b),l.strokeStyle=m,l.lineWidth=v),l.lineTo(Math.floor(C),D.kagiClose),F+1<o.length&&l.lineTo(Math.floor(C+this.layout.candleWidth),D.kagiClose),x=!1}l.stroke(),this.endClip(),i.p$(4),l.lineWidth=i.P6(32,"1")},e.ChartEngine.prototype.drawPointFigureChart=function(t,a,r,s){var n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P;function I(t,e,a){i.p$(3),l.moveTo(i.P6(t,d),i.P6(u,b,a,i.p$(5))),i.p$(0),l.lineTo(i.P6(p,e),i.X3(x,b,a,c,i.W$(6))),i.p$(3),l.moveTo(i.P6(t,d),i.P6(x,b,a,c,i.p$(6))),i.Q4(),i.W$(0),l.lineTo(i.X3(p,e),i.X3(u,b,a,i.W$(5)))}function L(t,e,a){i.W$(7),l.moveTo(i.P6(e,t,2),i.X3(a,c,b,i.p$(8))),i.W$(3),l.bezierCurveTo(i.X3(e,p),i.P6(a,c,b,i.W$(8)),i.X3(e,p,i.W$(3)),i.P6(u,b,x,a,i.p$(9)),i.X3(e,t,2,i.p$(7)),i.X3(u,b,x,a,i.W$(9))),i.p$(0),l.bezierCurveTo(i.X3(d,t),i.P6(u,b,x,a,i.W$(9)),i.P6(d,t,i.W$(0)),i.P6(a,c,b,i.W$(8)),i.P6(e,"2",t,0,i.W$(10)),i.P6(a,c,b,i.W$(8)))}n=t.chart,this.startClip(t.name),o=n.dataSegment,l=n.context,this.canvasColor(a),"X"==r&&s.border_color_up?l.strokeStyle=s.border_color_up:"O"==r&&s.border_color_down&&(l.strokeStyle=s.border_color_down),h=this.canvasStyle(a),c=parseInt(h.paddingTop,10),u=parseInt(h.paddingBottom,10),d=parseInt(h.paddingLeft,10),p=parseInt(h.paddingRight,10),h.width&&parseInt(h.width,10)<=25?l.lineWidth=Math.max(1,e.stripPX(h.width)):l.lineWidth=2,this.highlightedDraggable&&(i.W$(11),l.globalAlpha*=i.X3("0.3",1)),l.beginPath(),m=this.chart.state.aggregation.box,g=n.dataSet.length-n.scroll-1,f=t.yAxis,i.x5(),x=m*f.multiplier,i.W$(12),b=i.X3(x,2),S=this.layout.candleWidth,i.p$(13);var E=i.P6(17,20,4,1359);C=t.left-S+this.micropixels-E;for(var N=0;N<o.length;N++)if(C+=S,w=o[N]){if(w.projection)break;if(k=w.pfOpen,D=w.pfClose,T=w.pfTrend,M=w.pfStepBack,w.transform&&n.transformFunc&&(w=w.transform,k=n.transformFunc(this,n,k),D=n.transformFunc(this,n,D)),A=w.cache,i.p$(3),((_=i.P6(g,N))<t.cacheLeft||_>t.cacheRight||!A.pfOpen)&&(f.flipped?(A.pfOpen=f.bottom-(f.high-k)*f.multiplier,A.pfClose=f.bottom-(f.high-D)*f.multiplier):(A.pfOpen=(f.high-k)*f.multiplier+f.top,A.pfClose=(f.high-D)*f.multiplier+f.top)),F=Math.round(C),i.W$(3),P=Math.round(i.X3(C,S)),v=Math.abs(Math.round((D-k)/m)),y=A.pfOpen,r==M&&("X"==M?(i.W$(0),I(F,P,i.P6(x,y))):"O"==M&&(i.p$(3),L(F,P,i.X3(y,x)))),r==T)for(;v>=0;v--)"X"==r?(I(F,P,y),y-=f.flipped?-x:x):"O"==r&&(L(F,P,y),y+=f.flipped?-x:x)}l.stroke(),this.endClip(),l.lineWidth=1},e.ChartEngine.calculateAggregation=function(t,a,r,s){var n,o,l,h,c;n="h",n+="eiken",n+="ashi",o=2;for(var u=1;1342577537!==i.K9(u.toString(),u.toString().length,120);u++)h=t.layout,o+=2;if(-49619997!==i.K9(o.toString(),o.toString().length,96578)&&(h=t.layout),["heikinashi",n].indexOf(a)>-1)l=e.calculateHeikinAshi(t,r,s);else if("rangebars"==a)l=e.calculateRangeBars(t,r,h.rangebars,s);else if("kagi"==a){-1464574226,904262113,c=2;for(var d=1;-1464574226!==i.K9(d.toString(),d.toString().length,48492);d++)l=e.calculateKagi(t,r,h.kagi,s),c+=2;904262113!==i.q$(c.toString(),c.toString().length,35600)&&(l=e.calculateKagi(t,r,h.kagi,s))}else"linebreak"==a?l=e.calculateLineBreak(t,r,h.priceLines,s):"renko"==a?l=e.calculateRenkoBars(t,r,h.renko,s):"pandf"==a&&(l=e.calculatePointFigure(t,r,h.pandf,s));return l},i.Q4(),e.calculateHeikinAshi=function(t,e,a){var r,s,n,o,l,h,c,u,d,p,m,g;if(!e.length)return e;i.Q4(),r=2;for(var f=1;1029030827!==i.q$(f.toString(),f.toString().length,93770);f++)+a&&(a=[]),r+=2;-311093123!==i.q$(r.toString(),r.toString().length,83973)&&(a||(a=[])),a||(a=[]),s=[];for(var v=0;v<e.length;v++)if(n=e[v]){if(!(o=s[s.length-1])&&!v){i.W$(14);var y=i.P6(4,3,16,1);o=a[a.length-y]}o||(o=n),l=n.Close,h=(h=n.Open)||0===h?h:l,c=(c=n.High)||0===c?c:l,u=(u=n.Low)||0===u?u:l,d=(d=o.Open)||0===d?d:o.Close,i.W$(5);var x=i.P6(2,4,0);for(var b in p=(d+o.Close)/x,i.p$(15),m=i.P6(h,0,l,u,"4",c),g={DT:n.DT,displayDate:n.displayDate,Date:n.Date,Open:p,Close:m,High:Math.max(c,Math.max(p,m)),Low:Math.min(u,Math.min(p,m)),Volume:n.Volume,iqPrevClose:o.Close},n)g[b]||0===g[b]||(g[b]=n[b]);s.push(g)}return s},e.calculateKagi=function(t,a,r,s){var n,o,l,h,c,u,d,p,m,g;if(!a.length)return a;n=2;for(var f=1;1862342432!==i.q$(f.toString(),f.toString().length,15170);f++)+s&&(s=[]),o=t.layout,l=t.chart,n+=2;if(2095720567!==i.q$(n.toString(),n.toString().length,19863)&&(s||(s=[]),o=t.layout,l=t.chart),r=parseFloat(r),l.defaultChartStyleConfig.kagi=e.ChartEngine.isDailyInterval(o.interval)?4:.4,(isNaN(r)||r<=0)&&(r=l.defaultChartStyleConfig.kagi,e.Market.Symbology.isForexSymbol(l.symbol)&&(r/=4),null!==o.kagi)){"la","yout",-1006291810,-1652807533,i.W$(16),h=i.P6(2,"2");for(var v=1;-1006291810!==i.K9(v.toString(),v.toString().length,50737);v++)o.kagi=null,h+=2;-1652807533!==i.K9(h.toString(),h.toString().length,16709)&&(o.kagi=1),t.changeOccurred("layout")}i.Q4(),r/=100,c=[],i.W$(8);var y=i.P6(20,7,26);d=(u=s[s.length-y])?u.DT:0;for(var x=0;x<a.length;x++)if((p=a[x])&&(u||(i.p$(0),u=a[i.X3(1,x)]),u)){if((m=u.Open||0===u.Open?u.Open:u.Close)>u.Close){if(p.Close>u.Close*(1+r))p.Open=u.Close;else if(u.Close>p.Close&&(u.Close=p.Close),u.Volume+=p.Volume,x<a.length-1)continue}else if(m<u.Close){if(p.Close<u.Close*(1-r))p.Open=u.Close;else if(u.Close<p.Close&&(u.Close=p.Close),u.Volume+=p.Volume,x<a.length-1)continue}else if(u.Close=p.Close,u.Volume+=p.Volume,x<a.length-1)continue;for(var b in g={DT:u.DT,displayDate:u.displayDate,Date:u.Date,Open:u.Open,Close:u.Close,High:Math.max(u.Open,u.Close),Low:Math.min(u.Open,u.Close),Volume:u.Volume,iqPrevClose:u.iqPrevClose},u)g[b]||0===g[b]||(g[b]=u[b]);c.length?g.kagiPrevOpen=c[c.length-1].Open:g.kagiPrevOpen=g.Open,g.Close>g.kagiPrevOpen&&g.kagiPrevOpen>g.Open?g.kagiTrend=1:g.Close<g.kagiPrevOpen&&g.kagiPrevOpen<g.Open&&(g.kagiTrend=-1),d<g.DT&&c.push(g),u=p,l.currentQuote={Close:p.Close}}return c},e.calculateLineBreak=function(t,e,a,r){var s,n,o,l,h,c,u,d,p,m,g,f,v,y,x;if(!e.length)return e;r||(r=[]),s=t.layout,(n=t.chart).defaultChartStyleConfig.priceLines=3,a=parseInt(a,10),isNaN(a)||a<=0?(a=n.defaultChartStyleConfig.priceLines,null!==s.priceLines&&(s.priceLines=null,t.changeOccurred("layout"))):a>10&&(s.priceLines=a=10),o=2;for(var b=1;-236231964!==i.q$(b.toString(),b.toString().length,89735);b++)h=(l=r.slice(-a)).length,c=0,o+=2;-1898486189!==i.q$(o.toString(),o.toString().length,8134)&&(h=(l=r.slice(!a)).length,c=4);t:for(var S=0;S<e.length;S++)if(u=e[S]){c+=u.Volume,i.p$(17);var C=i.P6(10,15,17,5,17);if((d=l[l.length-C])||(d={Open:u.Open,Close:u.Open,High:u.Open,Low:u.Open}),p=d.Close,m=(m=d.High)||0===m?m:p,g=(g=d.Low)||0===g?g:p,f=(f=d.Open)||0===f?f:p,v={DT:u.DT,displayDate:u.displayDate,Date:u.Date,Close:u.Close,Volume:c,iqPrevClose:p},n.currentQuote={Close:u.Close},u.Close>p&&d.Close>f);else if(u.Close<p&&d.Close<f);else if(u.Close>m){for(y=2;y<=a;y++)if((x=l[l.length-y])&&u.Close<=x.High)continue t}else{if(!(u.Close<g))continue;for(y=2;y<=a;y++)if((x=l[l.length-y])&&u.Close>=x.Low)continue t}for(var w in u.Close<d.Close?v.Open=Math.min(f,p):v.Open=Math.max(f,p),v.Low=Math.min(v.Open,v.Close),v.High=Math.max(v.Open,v.Close),u)v[w]||0===v[w]||(v[w]=u[w]);l.push(v),c=0}return l.slice(h)},e.calculateRenkoBars=function(t,e,a,r){var s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k;function D(t,e){var a;for(var r in i.x5(),t=Number(t.toFixed(8)),e=Number(e.toFixed(8)),a={DT:y.DT,displayDate:y.displayDate,Date:y.Date,Open:t,Close:e,High:Math.max(t,e),Low:Math.min(t,e),Volume:0,iqPrevClose:t!=e?t:null},y)a[r]||0===a[r]||(a[r]=y[r]);g.push(a)}if("L","o","w","H","i","gh",!e.length)return[];r||(r=[]),s=t.layout,n=t.chart,i.W$(11),o=-i.P6("1870594844",1),l=2;for(var T=1;i.K9(T.toString(),T.toString().length,38170)!==o;T++)+(h=n.state.aggregation)&&(h=n.state.aggregation={}),c=Math.min(919,e.length),l+=2;-304323929!==i.q$(l.toString(),l.toString().length,3748)&&(~(h=n.state.aggregation)&&(h=n.state.aggregation={}),c=Math.min(287,e.length)),(h=n.state.aggregation)||(h=n.state.aggregation={}),c=Math.min(300,e.length),h.minMax||(h.minMax=t.determineMinMax(e.slice(e.length-c),["Close","High","Low"])),i.W$(18);var M=i.X3(12,689,8,8,10);if(u=h.minMax[M]-h.minMax[0],!(d=t.panels[n.name].height))return[];i.p$(19);var A=i.P6(9,1e4,18e4);i.p$(20);var _=i.X3(345,43,12,9);i.W$(21);var F=i.P6(139775,15,9985);if(n.defaultChartStyleConfig.renko=Math.floor(A*u/(d/_))/F,null===a||isNaN(a)||a<=0){if(a=n.defaultChartStyleConfig.renko,null!==s.renko){"l","ayout",-1847113347,i.W$(0),p=-i.P6(0,"2110306364"),i.W$(22),m=i.P6("2",0);for(var P=1;-1847113347!==i.K9(P.toString(),P.toString().length,99094);P++)s.renko=1,m+=2;i.q$(m.toString(),m.toString().length,48856)!==p&&(s.renko=null),t.changeOccurred("layout")}}else i.p$(12),a=Math.max(a,i.P6(u,d)),s.renko!==a&&(s.renko=a,t.changeOccurred("layout"));if(g=[],f=null,v=null,y=null,r.length){f=(x=r[r.length-1]).Low-a,957301962,-704687451,b=2;for(var I=1;957301962!==i.q$(I.toString(),I.toString().length,69648);I++)v=x.High+a,b+=2;-704687451!==i.q$(b.toString(),b.toString().length,4682)&&(v=x.High*a)}for(var L=0;L<e.length;L++)if(S=e[L]){for(f||v||(C=S.Open||0===S.Open?S.Open:S.Close,w=Math.floor(C/a)*a,k=isNaN(w)?C:w,i.W$(0),f=i.P6(a,k),i.p$(3),v=i.X3(k,a));;)if(y||(y=S),S.Close<=f)i.p$(3),D(i.X3(f,a),f),i.W$(23),v=i.P6(f,0,"2",a),f-=a,y=null;else{if(!(S.Close>=v))break;i.p$(0),D(i.P6(a,v),v),i.p$(24),f=i.P6("2",v,a,1),v+=a,y=null}n.currentQuote=S}return f<e[e.length-1].Close&&f+a>e[e.length-1].Close?(i.W$(3),D(i.P6(f,a),e[e.length-1].Close)):v>e[e.length-1].Close&&v-a<e[e.length-1].Close&&(i.W$(0),D(i.P6(a,v),e[e.length-1].Close)),g},e.calculateRangeBars=function(t,e,a,r){var s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D;if(!e.length)return e;function T(t){var e;for(var i in(e={DT:v.DT,displayDate:v.displayDate,Date:v.Date,Open:Number(f.toFixed(8)),Close:Number(t.toFixed(8)),High:Number(m.toFixed(8)),Low:Number(g.toFixed(8)),Volume:0}).iqPrevClose=e.Open,v)e[i]||0===e[i]||(e[i]=v[i]);d.push(e)}r||(r=[]),s=t.layout,(o=(n=t.chart).state.aggregation)||(o=n.state.aggregation={}),l=Math.min(300,e.length),o.minMax||(o.minMax=t.determineMinMax(e.slice(e.length-l),["Close","High","Low"])),i.W$(5);var M=i.X3(6,7,0);function A(){i.p$(3),i.Q4(),m=i.P6(p,a),i.p$(0),g=i.X3(a,p),f=p}function _(t,e){for(;;){if(v||(v=t),p<e){if(p=Math.min(e,m),i.p$(0),g=Math.max(g,i.X3(a,p)),e<m)break}else if(p>=e&&(p=Math.max(e,g),i.p$(3),m=Math.min(m,i.X3(p,a)),e>g))break;if(void 0===p)return void console.log("Uh oh undefined in calculateRangeBars:processMove");T(p),v=null,A()}}if(h=o.minMax[M]-o.minMax[0],!(c=t.panels[n.name].height))return[];i.W$(8);var F=i.P6(2,16,17);i.W$(9);var P=i.P6(14,2,19,9997);if(n.defaultChartStyleConfig.range=Math.floor("10000"*F*h/(c/30))/P,null===a||isNaN(a)||a<0){if(a=n.defaultChartStyleConfig.range,null!==s.range){"l","a","yo","ut",-1590586359,732103387,u=2;for(var I=1;-1590586359!==i.K9(I.toString(),I.toString().length,80359);I++)s.range=1,u+=2;732103387!==i.K9(u.toString(),u.toString().length,90828)&&(s.range=null),t.changeOccurred("layout")}}else i.W$(12),a=Math.max(a,i.P6(h,c)),s.range!==a&&(s.range=a,t.changeOccurred("layout"));d=[],p=null,m=null,g=null,f=null,v=null;for(var L=0;L<e.length;L++)if(y=e[L]){if(i.W$(0),x=e[i.X3(1,L)],!L){if(!x){i.W$(25);var E=i.P6(13,14);x=r[r.length-E]}x&&((p=x.Close)||0===p)&&A()}x&&(b=y.Close,S=y.Open,C=y.High,w=y.Low,(b||0===b)&&(S=S||0===S?S:b,C=C||0===C?C:b,w=w||0===w?w:b,p||0===p||(k=Math.floor(S/a)*a,p=isNaN(k)?S:k,A(),_(x,S)),L&&_(y,S),C-S<S-w?(C&&_(y,C),w&&_(y,w)):(w&&_(y,w),C&&_(y,C)),_(y,b),L==e.length-1&&b!=f&&(D=m,i.W$(3),m=i.X3(g,a),i.W$(0),g=i.P6(a,D),T(b))))}return d},e.calculatePointFigure=function(t,a,r,s){var n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F;function P(t,e,i,a,r,s,n,o,l){return{DT:t.DT,Date:t.Date,pfOpen:o,pfClose:l,Open:e,Close:r,High:i,Low:a,Volume:s,iqPrevClose:n}}if(!a.length)return a;function I(t,e){for(var a in i.x5(),t)e[a]||0===e[a]||(e[a]=t[a]);for(var r=1;-827691818!==i.K9(r.toString(),r.toString().length,11822);r++)return e;return i.K9(2..toString(),2..toString().length,62641),e}if(s||(s=[]),n=t.layout,(l=(o=t.chart).state.aggregation)||(l=o.state.aggregation={}),o.defaultChartStyleConfig.box=1,i.p$(26),o.defaultChartStyleConfig.reversal=i.X3(0,"3"),r||(r={}),!(h=r.box)){if(n.pandf&&null!==n.pandf.box){n.pandf.box=null,2130009847,-459673545,c=2;for(var L=1;2130009847!==i.q$(L.toString(),L.toString().length,89751);L++)t.changeOccurred(""),c+=2;-459673545!==i.q$(c.toString(),c.toString().length,80579)&&t.changeOccurred("layout")}if(h=o.defaultChartStyleConfig.box,u=a[a.length-1].Close){i.W$(16),d=-i.P6(8,"1829046188"),-1382090985,p=2;for(var E=1;i.q$(E.toString(),E.toString().length,58618)!==d;E++)u>=9847?h=636944:u<=0?h=73844:u>=4?h=8666:u>=51?h=451:u>=338||u>=744?h=5:u>=243?(i.p$(26),h=i.P6(64,"5")):h=u>6003?7:u>21475?90:266,p+=2;-1382090985!==i.K9(p.toString(),p.toString().length,35796)&&(u>=9847?h=636944:u<=0?h=73844:u>=4?h=8666:u>=51?(i.W$(16),h=i.X3(3,"451")):u>=338||u>=744?h=5:u>=243?(i.p$(22),h=i.P6("5",0)):h=u>6003?7:u>21475?90:266),h=u<.25?.0625:u<1?.125:u<5?.25:u<20?.5:u<100?1:u<200?2:u<500?4:u<1e3?5:u<25e3?50:500}if(e.ChartEngine.isDailyInterval(n.interval)||(h/=10),e.Market.Symbology.isForexSymbol(o.symbol)){if(u){-178434979,713969295,m=2;for(var N=1;-178434979!==i.K9(N.toString(),N.toString().length,98896);N++)u>2?h=15636:u>3?h=86048:u<=78?h=3747:u>=206&&(h=425),m+=2;713969295!==i.K9(m.toString(),m.toString().length,19338)&&(u>2?h=15636:u>3?h=86048:u<=78?h=3747:u>=206&&(h=425)),u<1?h=.001:u<2?h=.002:u<50?h=.02:u<200&&(h=.2)}e.ChartEngine.isDailyInterval(n.interval)&&(h*=10)}o.defaultChartStyleConfig.box=h}function O(t,e,i,a,r){t.High=Math.max(e,t.High),t.Low=Math.min(i,t.Low),t.Close=a,t.Volume+=r}if(h=parseFloat(h),isNaN(h)||h<=0){if(n.pandf&&null!==n.pandf.box){-1304353240,-549707999,g=2;for(var H=1;-1304353240!==i.q$(H.toString(),H.toString().length,2098);H++)n.pandf.box=null,g+=2;-549707999!==i.q$(g.toString(),g.toString().length,19238)&&(n.pandf.box=1),t.changeOccurred("layout")}o.defaultChartStyleConfig.box=h=1}if((f=Math.ceil(parseFloat(r.reversal)))>0&&f>r.reversal)"l","a","yo","ut",n.pandf.reversal=f,t.changeOccurred("layout");else if(isNaN(f)||f<=0){n.pandf&&null!==n.pandf.reversal&&("lay","out",n.pandf.reversal=null,t.changeOccurred("layout")),861091602,-1228406799,v=2;for(var V=1;861091602!==i.q$(V.toString(),V.toString().length,90695);V++)f=o.defaultChartStyleConfig.reversal,v+=2;-1228406799!==i.K9(v.toString(),v.toString().length,28174)&&(f=o.defaultChartStyleConfig.reversal)}l.box=h,f*=h,y=1e-8,x=(h.toString()+".").split(".")[1].length,b=[],i.Q4(),S=0;for(var z=0;z<a.length;z++)if(w=a[z])if(S+=w.Volume,D=w.Close,T=(T=w.Open)||0===T?T:D,M=(M=w.High)||0===M?M:D,A=(A=w.Low)||0===A?A:D,b.length||s.length){i.p$(3);var R=i.X3(0,1);(k=b[b.length-R])||(k=e.clone(s[s.length-1])),"O"==k.pfTrend?(A<=k.pfClose-h?(k.pfClose=Number((Math.ceil(A/h-y)*h).toFixed(x)),"O"==k.pfStepBack&&(k.pfStepBack=null),O(k,M,A,D,S)):M>=k.pfClose+f?(_=k.pfClose+h,F=Number((Math.floor(M/h+y)*h).toFixed(x)),C=P(w,T,M,A,D,S,k.pfClose,_,F),_==F&&(C.pfStepBack="X"),"O"==k.pfStepBack?(k.pfOpen=_,k.pfClose=F,k.pfTrend="X",O(k,M,A,D,S)):((C=I(w,C)).pfTrend="X",b.push(C))):O(k,M,A,D,S),S=0):"X"==k.pfTrend&&(M>=k.pfClose+h?(k.pfClose=Number((Math.floor(M/h+y)*h).toFixed(x)),"X"!=k.pfStepBack&&"-"!=k.pfStepBack||(k.pfStepBack=null),O(k,M,A,D,S)):A<=k.pfClose-f?(_=k.pfClose-h,F=Number((Math.ceil(A/h-y)*h).toFixed(x)),C=P(w,T,M,A,D,S,k.pfClose,_,F),_==F&&(C.pfStepBack="O"),"X"==k.pfStepBack||"-"==k.pfStepBack?(k.pfOpen=_,k.pfClose=F,k.pfTrend="O",O(k,M,A,D,S),_!=F&&"-"==k.pfStepBack&&(k.pfStepBack=null)):((C=I(w,C)).pfTrend="O",b.push(C))):O(k,M,A,D,S),S=0)}else(C=I(w,P(w,T,M,A,D,S,M+h,Number((Math.ceil(A/h-y)*h).toFixed(x)),Number((Math.floor(M/h+y)*h).toFixed(x))))).pfTrend="X",C.pfOpen==C.pfClose&&(C.pfStepBack="-"),b.push(C),i.p$(22),S=i.X3("0",0);return b}};let St={CIQ:a.CIQ,SplinePlotter:a.SplinePlotter,timezoneJS:a.timezoneJS,$$:a.$$,$$$:a.$$$};"undefined"!=typeof __TREE_SHAKE__&&__TREE_SHAKE__||St.CIQ.activateImports(xt,r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O,H,V,z,R,B,Q,W,U,j,q,Y,$,X,Z,K,G,J,tt,et,it,at,rt,st,nt,ot,lt,ht,ct,ut,dt,pt,mt,gt,ft,null)},"./chartiq/development/js/deprecated.js":(t,e,i)=>{i.r(e);var a=i("./chartiq/development/js/chartiq.js"),r=null;a.CIQ.deprecationWarning=function(t){r||(r={},setInterval((function(){for(var t in r)console.warn(t+" ("+r[t]+" occurrences)"),delete r[t]}),1e4)),r[t]?r[t]++:r[t]=1};var s=a.CIQ.deprecationWarning;Function.prototype.ciqInheritsFrom||(Function.prototype.ciqInheritsFrom=function(t,e){s("Function.prototype.ciqInheritsFrom() has been deprecated.  Use CIQ.inheritsFrom(me, ctor, autosuper) instead."),a.CIQ.inheritsFrom(this,t,e)},Function.prototype.stxInheritsFrom=Function.prototype.ciqInheritsFrom),String.prototype.capitalize=function(){return s("String.prototype.capitalize() has been deprecated.  Use CIQ.capitalize(string) instead."),a.CIQ.capitalize(this)},CanvasRenderingContext2D.prototype.dashedLineTo=function(t,e,i,a,r){if(s("CanvasRenderingContext2D.prototype.dashedLineTo() has been deprecated.  Use native CanvasRenderingContext2D methods such as moveTo(), lineTo() and setLineDash() instead."),!(r instanceof Array))return r&&console.log('WARNING: Unsupported drawing pattern "'+r+'"; defaulting to "solid"'),void this.stxLine(t,e,i,a,this.strokeStyle,this.globalAlpha,this.lineWidth);if(e!==1/0&&t!==1/0&&a!==1/0&&i!==1/0){var n=function(t,e){return t-e<=1e-8},o=function(t,e){return t-e>=-1e-8},l=function(t,e){return Math.min(t,e)},h=function(t,e){return Math.max(t,e)},c={thereYet:o,cap:l},u={thereYet:o,cap:l};if(e-a>0&&(u.thereYet=n,u.cap=h),t-i>0&&(c.thereYet=n,c.cap=h),this.moveTo(t,e),!isNaN(t)&&!isNaN(e))for(var d=t,p=e,m=0,g=!0;!c.thereYet(d,i)||!u.thereYet(p,a);){var f=Math.atan2(a-e,i-t),v=r[m];d=c.cap(i,d+Math.cos(f)*v),p=u.cap(a,p+Math.sin(f)*v),g?this.lineTo(d,p):this.moveTo(d,p),m=(m+1)%r.length,g=!g}}},CanvasRenderingContext2D.prototype.stxLine=function(t,e,i,a,r,n,o,l){s("CanvasRenderingContext2D.prototype.stxLine() has been deprecated.  Use native CanvasRenderingContext2D methods such as moveTo() and lineTo() instead."),this.beginPath(),this.lineWidth=o,this.strokeStyle=r,this.globalAlpha=n,l&&l.length?this.dashedLineTo(t,e,i,a,l):(this.moveTo(t,e),this.lineTo(i,a)),this.stroke(),this.closePath(),this.lineWidth=1},CanvasRenderingContext2D.prototype.stxCircle=function(t,e,i,a){s("CanvasRenderingContext2D.prototype.stxCircle() has been deprecated.  Use native CanvasRenderingContext2D methods such as arc() instead."),this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),a&&this.fill(),this.stroke(),this.closePath()},a.CIQ.getAjaxServer=function(t){return s("CIQ.getAjaxServer() has been deprecated.  Use `new XMLHttpRequest` instead."),new XMLHttpRequest},a.CIQ.convertClickToTouchEnd=function(t){s("CIQ.convertClickToTouchEnd() has been deprecated.  Use CIQ.safeClickTouch() instead.");var e=document.getElementById(t),i=e.getAttribute("onClick");i&&(e.removeAttribute("onClick"),e.setAttribute("onTouchEnd",i))},a.CIQ.standardUTCDate=function(t){s("CIQ.standardUTCDate(dt) has been deprecated.  Use dt.toISOString() instead.");var e=t.getUTCMonth()+1;e<10&&(e="0"+e);var i=t.getUTCDate();i<10&&(i="0"+i);var a=t.getUTCHours();a<10&&(a="0"+a);var r=t.getUTCMinutes();r<10&&(r="0"+r);var n=t.getUTCSeconds();return n<10&&(n="0"+n),t.getUTCFullYear()+"-"+e+"-"+i+"T"+a+":"+r+":"+n+"Z"},a.CIQ.isDST=function(t){s("CIQ.isDST() has been deprecated.  Use dt.toISOString() instead."),t||(t=new Date);var e=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear(),6,1),a=Math.max(e.getTimezoneOffset(),i.getTimezoneOffset());return t.getTimezoneOffset()!=a},a.CIQ.getEventDOM=function(t){return s("CIQ.getEventDOM() has been deprecated.  Use `e.target` instead."),t?t.target:window.event.srcElement},a.CIQ.outerWidth=function(t){s("CIQ.outerWidth() has been deprecated.  Use `CIQ.elementDimensions(node, {margin:1, padding:1, border:1}).width` instead.");var e=t.offsetWidth;return e+=a.CIQ.stripPX(getComputedStyle(t).marginLeft),e+=a.CIQ.stripPX(getComputedStyle(t).marginRight)},a.CIQ.clearNode=function(t){if(s("CIQ.clearNode() has been deprecated.  Use `node.innerHTML=''` instead."),t.hasChildNodes())for(;t.childNodes.length>=1;)t.removeChild(t.firstChild)},a.CIQ.findClosestParent=function(t,e){var i,a;if(s("CIQ.findClosestParent() has been deprecated.  Use `Element.parentElement.prototype.closest()` instead."),["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some((function(t){return"function"==typeof document.body[t]&&(i=t,!0)})),!i)return!1;for(;t;){if((a=t.parentElement)&&a[i](e))return a;t=a}return null},a.CIQ.appendClassName=function(t,e){if(s("CIQ.appendClassName() has been deprecated.  Use `node.classList.add(className)` instead."),t&&t.className!=e){for(var i=t.className.split(" "),a=0;a<i.length;a++)if(i[a]==e)return;t.className?t.className+=" "+e:t.className=e}},a.CIQ.unappendClassName=function(t,e){if(s("CIQ.unappendClassName() has been deprecated.  Use `node.classList.remove(className)` instead."),t&&-1!=t.className.indexOf(e))if(t.className==e)t.className="";else{for(var i=t.className.split(" "),a="",r=0;r<i.length;r++)i[r]!=e&&(""!==a&&(a+=" "),a+=i[r]);t.className=a}},a.CIQ.swapClassName=function(t,e,i){s("CIQ.swapClassName() has been deprecated.  Use `node.classList.replace(oldClassName, newClassName)` instead."),a.CIQ.unappendClassName(t,i),a.CIQ.appendClassName(t,e)},a.CIQ.hasClassName=function(t,e){return s("CIQ.hasClassName() has been deprecated.  Use `node.classList.contains(className)` instead."),!!t&&(" "+t.className+" ").indexOf(" "+e+" ")>-1},a.CIQ.toggleClassName=function(t,e){s("CIQ.toggleClassName() has been deprecated.  Use `node.classList.toggle(className)` instead."),a.CIQ.hasClassName(t,e)?a.CIQ.unappendClassName(t,e):a.CIQ.appendClassName(t,e)},function(){var t,e,i=document.attachEvent,r=navigator.userAgent.match(/Trident/),n=(t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,20)},function(e){return t(e)}),o=(e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout,function(t){return e(t)});function l(t){var e=t.target||t.srcElement;e.__resizeRAF__&&o(e.__resizeRAF__),e.__resizeRAF__=n((function(){var i=e.__resizeTrigger__;i.__resizeListeners__.forEach((function(e){e.call(i,t)}))}))}function h(t){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",l)}a.CIQ.addResizeListener=function(t,e){s("CIQ.addResizeListener() has been deprecated.  Use CIQ.UI.addResizeListener() instead.");var a=document.querySelector("cq-ui-manager");if(a.length>0&&(a=a[0]).registerForResize(t),!t.__resizeListeners__)if(t.__resizeListeners__=[],i)t.__resizeTrigger__=t,t.attachEvent("onresize",l);else{var n=t.__resizeTrigger__=document.createElement("object");n.setAttribute("style","visibility:hidden; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1; border:0px;"),n.__resizeElement__=t,n.onload=h,n.type="text/html",r&&t.appendChild(n),n.data="about:blank",r||t.appendChild(n)}t.__resizeListeners__.push(e)},a.CIQ.removeResizeListener=function(t,e){s("CIQ.removeResizeListener() has been deprecated.  Use CIQ.UI.removeResizeListener() instead.");var a=document.querySelector("cq-ui-manager");a.length>0&&(a=a[0]).unregisterForResize(t),t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(i?t.detachEvent("onresize",l):(t.__resizeTrigger__.contentDocument.defaultView.removeEventListener("resize",l),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)))}}(),a.CIQ.Renderer.prototype.performCalculations=function(){s("CIQ.Renderer.prototype.performCalculations has been deprecated.  Use CIQ.Renderer.prototype.adjustYAxis instead.")},a.CIQ.ChartEngine.hideDates=function(){return s("CIQ.Renderer.hideDates is no longer supported.  To hide an axis, set its noDraw property.  To hide the floating date label, set stxx.controls.floatDate=null."),!1},a.CIQ.ChartEngine.chartShowsHighs=function(t){return s("CIQ.ChartEngine.prototype.chartShowsHighs has been deprecated.  Use CIQ.ChartEngine.Chart.prototype.highLowBars instead."),1!={line:1,colored_line:1,mountain:1,colored_mountain:1,baseline_delta:1,baseline_delta_mountain:1,histogram:1,scatterplot:1,step:1,colored_step:1}[t]},a.CIQ.ChartEngine.prototype.createBlock=function(t,e,i,a,r,n){s("CIQ.ChartEngine.prototype.createBlock has been deprecated.  Use native canvas context operation fillRect instead."),n||(n=this.chart.context),void 0!==a&&(this.canvasColor(r,n),n.fillRect(t,i,e,a),n.globalAlpha=1)},a.CIQ.ChartEngine.prototype.setVolumeUnderlay=function(t){s("CIQ.ChartEngine.prototype.setVolumeUnderlay is no longer supported.  To enable a volume underlay, use CIQ.Studies.addStudy(stxx, 'vol undr').  To disable, use CIQ.Studies.removeStudy."),this.layout.volumeUnderlay=t,this.chart.canvas&&this.draw(),this.changeOccurred("layout")},a.CIQ.ChartEngine.prototype.serializeDrawings=function(){return s("CIQ.ChartEngine.prototype.serializeDrawings has been deprecated.  Use CIQ.ChartEngine.prototype.exportDrawings instead."),this.exportDrawings()},a.CIQ.ChartEngine.prototype.reconstructDrawings=function(t){s("CIQ.ChartEngine.prototype.reconstructDrawings has been deprecated.  Use CIQ.ChartEngine.prototype.importDrawings instead."),this.importDrawings(t)},a.CIQ.ChartEngine.prototype.computePosition=function(t,e){return s("CIQ.ChartEngine.prototype.computePosition has been deprecated.  Use CIQ.ChartEngine.prototype.pixelFromBar instead."),void 0===e&&(e=0),t*this.layout.candleWidth+e+this.micropixels},a.CIQ.ChartEngine.prototype.computeColor=function(t,e){return s("CIQ.ChartEngine.prototype.computeColor has been deprecated.  There is no suggested alternative."),t<e?"stx_candle_up":t>e?"stx_candle_down":"stx_candle_shadow"},a.CIQ.ChartEngine.prototype.computeLength=function(t,e){s("CIQ.ChartEngine.prototype.computeLength has been deprecated.  Use CIQ.ChartEngine.prototype.pixelFromPrice to compute values and find the difference.");var i=this.pixelFromPrice(t);return this.pixelFromPrice(e)-i},a.CIQ.ChartEngine.prototype.setCrosshairColors=function(){s("CIQ.ChartEngine.prototype.setCrosshairColors is no longer supported.  Use CSS to set the crosshair color")},a.CIQ.ChartEngine.prototype.valueFromPixelUntransform=function(t,e,i){return s("CIQ.ChartEngine.prototype.valueFromPixelUntransform has been deprecated.  Use CIQ.ChartEngine.prototype.valueFromPixel instead."),this.valueFromPixel(t,e,i)},a.CIQ.ChartEngine.prototype.pixelFromPriceTransform=function(t,e,i){return s("CIQ.ChartEngine.prototype.pixelFromPriceTransform has been deprecated.  Use CIQ.ChartEngine.prototype.pixelFromPrice instead."),this.pixelFromPrice(t,e,i)},a.CIQ.ChartEngine.prototype.isDailyInterval=function(t){return s("CIQ.ChartEngine.prototype.isDailyInterval has been deprecated. Use CIQ.ChartEngine.isDailyInterval instead."),a.CIQ.ChartEngine.isDailyInterval(t)},a.CIQ.ChartEngine.prototype.newChart=function(t,e,i,r,n){s("CIQ.ChartEngine.prototype.newChart has been deprecated. Use CIQ.ChartEngine.prototype.loadChart instead.");var o={masterData:e,chart:i};return a.CIQ.extend(o,n,!0),this.loadChart(t,o,r)},a.CIQ.ChartEngine.prototype.streamTrade=function(t,e,i,a){s("CIQ.ChartEngine.prototype.streamTrade has been deprecated. Use CIQ.ChartEngine.prototype.updateChartData instead.");var r=this.chart;a||(a={}),a.chart&&(r=a.chart),a.fillGaps=this.streamParameters.fillGaps;var n="object"==typeof t,o=n?t.last:arguments[0],l=n?t.volume:arguments[1],h=n?t.bid:null,c=n?t.ask:null;n||(e=arguments[2],i=arguments[3]),i&&(a.secondarySeries=i);var u={DT:e,Last:o,Volume:l,Bid:h,Ask:c};this.updateChartData(u,r,a)},a.CIQ.ChartEngine.prototype.appendMasterData=function(t,e,i){s("CIQ.ChartEngine.prototype.appendMasterData has been deprecated. Use CIQ.ChartEngine.prototype.updateChartData instead."),this.updateChartData(t,e,i)},a.CIQ.ChartEngine.prototype.setPeriodicityV2=function(t,e,i,a){s("CIQ.ChartEngine.prototype.setPeriodicityV2 has been deprecated. Use CIQ.ChartEngine.prototype.setPeriodicity instead."),"function"==typeof i&&(a=i,i=null),this.runPrepend("setPeriodicityV2",arguments)||(this.setPeriodicity(t,e,i,a),this.runAppend("setPeriodicityV2",arguments))},a.CIQ.ChartEngine.prototype.addChart=function(t,e){s("CIQ.ChartEngine.prototype.addChart has been deprecated. Add manually to stxx.charts object instead."),e.name=t,this.charts[t]=e};var n=a.CIQ.ChartEngine.prototype.changeOccurred;a.CIQ.ChartEngine.prototype.changeOccurred=function(t){this.currentlyImporting||(this.changeCallback&&this.changeCallback(this,t),n.call(this,t))};var o=a.CIQ.ChartEngine.prototype.construct;if(a.CIQ.ChartEngine.prototype.construct=function(){function t(t,e,i){return t._deprecatedPropertyValues||(t._deprecatedPropertyValues={}),e in t._deprecatedPropertyValues||(t._deprecatedPropertyValues[e]=i),t._deprecatedPropertyValues[e]}function e(t,e,i){t._deprecatedPropertyValues||(t._deprecatedPropertyValues={}),t._deprecatedPropertyValues[e]=i}function i(e,i,a){return function(){return s("CIQ.ChartEngine.prototype.callbacks have been deprecated.  Iterate through CIQ.ChartEngine.prototype.callbackListeners instead."),t(this,e,a||null)}}function a(t,e){return function(i){s("CIQ.ChartEngine.prototype.callbacks have been deprecated.  Utilize CIQ.ChartEngine.prototype.addEventListener to add a callback, and/or CIQ.ChartEngine.prototype.removeEventListener to remove one."),this._deprecatedPropertyValues||(this._deprecatedPropertyValues={});var a=this._deprecatedPropertyValues[t];a&&e.removeEventListener(t,a),i&&e.addEventListener(t,i),this._deprecatedPropertyValues[t]=i}}var r;o.call(this),Object.defineProperties(this,{changeCallback:{enumerable:!0,get:function(){return t(this,"changeCallback",null)},set:function(t){s("CIQ.ChartEngine.prototype.changeCallback has been deprecated.  Use CIQ.ChartEngine.prototype.addEventListener instead."),e(this,"changeCallback",t)}},highLowBars:{enumerable:!0,get:function(){return s("CIQ.ChartEngine.prototype.highLowBars is no longer supported.  Use CIQ.ChartEngine.Chart.prototype.highLowBars instead."),t(this,"highLowBars",{bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,wave:!0,rangechannel:!0,none:!0})},set:function(t){s("CIQ.ChartEngine.prototype.highLowBars is no longer supported.  Use CIQ.ChartEngine.Chart.prototype.highLowBars instead."),e(this,"highLowBars",t)}},standaloneBars:{enumerable:!0,get:function(){return s("CIQ.ChartEngine.prototype.standaloneBars is no longer supported.  Use CIQ.ChartEngine.Chart.prototype.standaloneBars instead."),t(this,"standaloneBars",{bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0})},set:function(t){s("CIQ.ChartEngine.prototype.standaloneBars is no longer supported.  Use CIQ.ChartEngine.Chart.prototype.standaloneBars instead."),e(this,"standaloneBars",t)}},barsHaveWidth:{enumerable:!0,get:function(){return s("CIQ.ChartEngine.prototype.barsHaveWidth is no longer supported.  Use CIQ.ChartEngine.Chart.prototype.barsHaveWidth instead."),t(this,"barsHaveWidth",{bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0,wave:!0})},set:function(t){s("CIQ.ChartEngine.prototype.barsHaveWidth is no longer supported.  Use CIQ.ChartEngine.Chart.prototype.barsHaveWidth instead."),e(this,"barsHaveWidth",t)}}}),this.callbacks={},Object.defineProperties(this.callbacks,{studyOverlayEdit:{enumerable:!0,get:i("studyOverlayEdit"),set:a("studyOverlayEdit",this)},studyPanelEdit:{enumerable:!0,get:i("studyPanelEdit"),set:a("studyPanelEdit",this)},tap:{enumerable:!0,get:i("tap"),set:a("tap",this)},rightClick:{enumerable:!0,get:i("rightClick"),set:a("rightClick",this)},longhold:{enumerable:!0,get:i("longHold"),set:a("longHold",this)},move:{enumerable:!0,get:i("move"),set:a("move",this)},layout:{enumerable:!0,get:i("layout"),set:a("layout",this)},drawing:{enumerable:!0,get:i("drawing"),set:a("drawing",this)},drawingEdit:{enumerable:!0,get:i("drawingEdit"),set:a("drawingEdit",this)},preferences:{enumerable:!0,get:i("preferences"),set:a("preferences",this)},theme:{enumerable:!0,get:i("theme"),set:a("theme",this)},symbolChange:{enumerable:!0,get:i("symbolChange"),set:a("symbolChange",this)},symbolImport:{enumerable:!0,get:i("symbolImport"),set:a("symbolImport",this)},calculateTradingDecimalPlaces:{enumerable:!0,get:(r=this,function(){return s("CIQ.ChartEngine.prototype.callbacks.calculateTradingDecimalPlaces has been deprecated.  Utilize CIQ.ChartEngine.Chart.prototype.calculateTradingDecimalPlaces instead."),t(this,"calculateTradingDecimalPlaces",r.chart.calculateTradingDecimalPlaces)}),set:function(t){return function(i){s("CIQ.ChartEngine.prototype.callbacks.calculateTradingDecimalPlaces has been deprecated.  Utilize CIQ.ChartEngine.Chart.prototype.calculateTradingDecimalPlaces instead."),e(this,"calculateTradingDecimalPlaces",i),t.chart.calculateTradingDecimalPlaces=i}}(this)}}),Object.defineProperty(this.streamParameters,"fillGaps",{enumerable:!0,get:function(){return s("CIQ.ChartEngine.prototype.streamParameters.fillGaps has been deprecated.  Use CIQ.ChartEngine.prototype.updateChartData instead, with params.fillGaps=true or rely on cleanupGaps as default behavior."),t(this,"fillGaps",!0)},set:function(t){s("CIQ.ChartEngine.prototype.streamParameters.fillGaps has been deprecated.  Use CIQ.ChartEngine.prototype.updateChartData instead, with params.fillGaps=true or rely on cleanupGaps as default behavior."),e(this,"fillGaps",t)}})},"undefined"!=typeof window&&Object.defineProperties(window,{STX:{enumerable:!0,get:function(){return s("STX namespace has been deprecated.  Use CIQ namespace instead."),a.CIQ}},STXChart:{enumerable:!0,get:function(){return s("STXChart namespace has been deprecated.  Use CIQ.ChartEngine namespace instead."),a.CIQ.ChartEngine}}}),a.CIQ.ChartEngine.prototype.attachEngineQuoteFeed=function(t,e){s("CIQ.ChartEngine.prototype.attachEngineQuoteFeed has been deprecated. Use CIQ.ChartEngine.prototype.attachQuoteFeed instead."),this.attachQuoteFeed(t,e)},a.CIQ.ChartEngine.prototype.dragPlot=function(t){s("CIQ.ChartEngine.prototype.dragPlot is no longer supported.  Use CIQ.ChartEngine.prototype.dragPlotOrAxis instead.")},a.CIQ.ChartEngine.prototype.dragYAxis=function(t){s("CIQ.ChartEngine.prototype.dragYAxis is no longer supported.  Use CIQ.ChartEngine.prototype.dragPlotOrAxis instead.")},a.CIQ.Drawing=a.CIQ.Drawing||function(){this.chartsOnly=!1,this.penDown=!1},a.CIQ.Drawing.prototype.setLineColor=function(){if(s("CIQ.Drawing.prototype.setLineColor has been deprecated.  Use CIQ.Drawing.prototype.setLineColor instead."),a.CIQ.Drawing.prototype.getLineColor)return a.CIQ.Drawing.prototype.getLineColor.apply(this,arguments)},a.CIQ.Studies=a.CIQ.Studies||function(){},a.CIQ.Studies.quickAddStudy=function(){if(s("CIQ.Studies.quickAddStudy has been deprecated.  Use CIQ.Studies.addStudy instead."),a.CIQ.Studies.addStudy)return a.CIQ.Studies.addStudy.apply(null,arguments)},a.CIQ.Studies.overZones=function(){if(s("CIQ.Studies.overZones has been deprecated.  Use CIQ.Studies.drawZones instead."),a.CIQ.Studies.drawZones)return a.CIQ.Studies.drawZones.apply(null,arguments)},a.CIQ.Studies.volUnderlay=function(){s("CIQ.Studies.volUnderlay has been deprecated.  Use CIQ.Studies.createVolumeChart instead."),a.CIQ.Studies.createVolumeChart&&a.CIQ.Studies.createVolumeChart.apply(null,arguments)},a.CIQ.Studies.determineMinMax=function(t,e,i){s("CIQ.Studies.determineMinMax is no longer supported.  The calculation is done automatically elsewhere.")},a.CIQ.Studies.createYAxis=function(t,e,i,a){s("CIQ.Studies.createYAxis is no longer supported.  The action is done automatically elsewhere.")},a.CIQ.Studies.volumeChart=function(t,e,i,a){s("CIQ.Studies.volumeChart has been deprecated.  Use CIQ.ChartEngine.prototype.drawHistogram instead.");var r,n,o=-1*Number.MAX_VALUE;for(r in i)for(var l=0;l<i[r].length;l++)(n=i[r][l])&&n>o&&(o=n);var h=t.panels[e.panel],c=Math.floor(h.yAxis.bottom)+.5,u=c-(Math.floor(h.yAxis.top)+.5),d=t.layout.candleWidth,p=null;e.parameters&&e.parameters.displayBorder||(a=null);var m=0;a||(m=(d-t.chart.tmpWidth)/2);var g=e.getContext(t);for(r in g.lineWidth=1,t.startClip(e.panel),i){a&&(p=a[r]),g.fillStyle=r,p&&(g.strokeStyle=p),g.beginPath();for(var f,v=c+.5,y=Math.floor(t.pixelFromBar(0,h.chart)),x=0;x<i[r].length;x++)if(t.chart.dataSegment[x]&&t.chart.dataSegment[x].candleWidth?(d=t.chart.dataSegment[x].candleWidth,a||(m=d/4)):(d=t.layout.candleWidth,a||(m=(d-t.chart.tmpWidth)/2)),0===x&&(f=y-=d/2),n=i[r][x]){var b,S,C=n*(u/o),w=Math.min(Math.floor(c-u+(u-C))+.5,c);b=Math.floor(f+m),S=Math.floor(f+d-m),b=Math.max(b,y),g.moveTo(b,c),g.lineTo(S,c),g.lineTo(S,w),g.lineTo(b,w),a?(v>w||0===x)&&g.lineTo(b,v):g.lineTo(b,c),v=w,f+=d}else v=c,f+=d;g.fill(),g.strokeStyle=p,a&&t.layout.candleWidth>=2&&g.stroke(),g.closePath()}t.endClip()},"undefined"!=typeof window&&Object.defineProperty(window,"STXSocial",{enumerable:!0,get:function(){return s("STXSocial namespace has been deprecated.  Use CIQ.Share namespace instead."),a.CIQ.Share}}),"function"==typeof $&&$.fn){$.fn.extend($.expr[":"],{trulyvisible:function(t,e,i){s("Use of jQuery has been deprecated. Use CIQ.trulyVisible() to return element visibility instead of custom pseudo-selector :trulyvisible.");var a=$(t).parents();a=a.add(t);for(var r=0;r<a.length;r++){var n=$(a[r]);if("0"===n.css("opacity"))return!1;if("hidden"===n.css("visibility"))return!1;if("0px"===n.css("height")&&"hidden"==n.css("overflow-y"))return!1;if(!n.is(":visible"))return!1}return!0}});$.fn.extend({stxtap:function(t,e){return s("Use of jQuery has been deprecated. Use CIQ.UI.stxtap() to attach a listener instead of $.fn.stxtap()."),this.each((function(){a.CIQ.installTapEvent(this),"string"==typeof t?$(this).on("stxtap",t,(function(t){e.call(this,t)})):$(this).on("stxtap",(function(e){t.call(this,e)}))}))},parentsAndMe:function(t){s("Use of jQuery has been deprecated. Use CIQ.climbUpDomTree() instead of $.fn.parentsAndMe().");var e=$(this).parents();return e=e.add($(this)).get().reverse()},cqvirtual:function(t){s("Use of jQuery has been deprecated. Use CIQ.cqvirtual() instead of $.fn.cqvirtual().");var e=this.clone(!0);return e.empty(),e.original=this,e},cqrender:function(t){if(s("Use of jQuery has been deprecated. Use CIQ.cqrender() instead of $.fn.cqrender()."),this[0].innerHTML==this.original[0].innerHTML)return this.original;this.original.children(":not(template)").remove();var e=this.children();if(e.length){var i=e.detach();this.original.append(i)}return this.original},guaranteedWidth:function(){s("Use of jQuery has been deprecated. Use CIQ.guaranteedSize() instead of $.fn.guaranteedWidth().");for(var t=this,e=t.width();!e;){if("BODY"===(t=t.parent())[0].tagName||t[0]===window)return window.innerWidth;e=t.width()}return e},guaranteedHeight:function(){s("Use of jQuery has been deprecated. Use CIQ.guaranteedSize() instead of $.fn.guaranteedHeight().");for(var t=this,e=t.height();!e;){if("BODY"===(t=t.parent())[0].tagName||t[0]===window)return window.innerHeight;e=t.height()}return e},emptyExceptTemplate:function(){return s("Use of jQuery has been deprecated. Use CIQ.removeChildIfNot(node, 'template') instead of $.fn.emptyExceptTemplate()."),this.children().not("template").remove(),this},truthyAttr:function(t){s("Use of jQuery has been deprecated. Use ['false','0',null,undefined].indexOf(this.getAttribute('...'))==-1 instead of $.fn.truthyAttr().");var e=this.attr(t);return void 0!==e&&("false"!=e.toLowerCase()&&"0"!=e)},attrBetter:function(t,e){return s("Use of jQuery has been deprecated. check attribute value before setting instead of $.fn.attrBetter()."),this.attr(t,(function(t,i){if(void 0===e&&(e="true"),e!==i)return e}))},removeAttrBetter:function(t){s("Use of jQuery has been deprecated. check hasAttribute before removing instead of $.fn.removeAttrBetter().");var e=this.attr(t);return!(!e&&""!==e)&&(this.removeAttr(t),!0)},textBetter:function(t){return s("Use of jQuery has been deprecated. check innerText before setting instead of $.fn.textBetter()."),this.text()!==t&&(this.text(t),!0)}}),$.queryString=function(t){s("Use of jQuery has been deprecated. Use CIQ.qs() to return an object containing querystring tokens instead of $.querystring().");for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var a=e[i].split("=");if(a[0]==t)return a[1]}return null}}a.CIQ.UI||(a.CIQ.UI={}),a.CIQ.UI.allContexts=function(){return s("CIQ.UI.allContexts has been deprecated. Use document.querySelectorAll('cq-context,*[cq-context]') instead."),$("cq-context,*[cq-context]")},a.CIQ.UI.observe=function(t){if(s("CIQ.UI.observe has been deprecated.  Use CIQ.UI.observeProperty instead."),Object.observe){if("function"==typeof $&&$.fn){var e=this,i=function(t){t.forEach(a)};return Object.observe(t.obj,i,["update","add","delete"]),a({name:t.member}),i}s("You must include jQuery in your project to use CIQ.UI.observe.")}else s("You must include thirdparty/object-observe.js in your project to use CIQ.UI.observe.");function a(i){var a=!1;if(t.member){if(i.name===t.member)a=!0;else if(t.member.constructor==Array)for(var r=0;r<t.member.length;r++)i.name===t.member[r]&&(a=!0)}else a=!0;if(a){var s=$(t.selector);if(!s.length&&"callback"===t.action)return void t.value.call(e,t);"class"===t.action&&s.removeClass(t.value),s.each((function(){var i=!1;t.member&&(t.condition?t.obj[t.member]===t.condition&&(i=!0):i=t.obj[t.member]),"class"===t.action&&i&&s.addClass(t.value),"callback"===t.action&&t.value.call(e,t,this),"value"===t.action&&(t.value?this.value=t.value:t.obj[t.member]?this.value=t.obj[t.member]:this.value="")}))}}},a.CIQ.UI.unobserve=function(t){s("CIQ.UI.unobserve has been deprecated.  Use CIQ.UI.unobserveProperty instead."),Object.unobserve&&Object.unobserve(t.obj,t.handler)},a.CIQ.UI.trulyVisible=function(t){return s("CIQ.UI.trulyVisible has been deprecated.  Use CIQ.trulyVisible instead."),a.CIQ.trulyVisible(t)},a.CIQ.UI.Lookup=function(){},a.CIQ.UI.Lookup.Driver=function(){this.deprecated=!0},a.CIQ.UI.Lookup.Driver.prototype.acceptText=function(t,e,i,a){this.cb},a.CIQ.UI.Lookup.Driver.ChartIQ=function(t){s("CIQ.UI.Lookup.Driver.ChartIQ has been deprecated.  Use CIQ.ChartEngine.Driver.Lookup.ChartIQ instead."),this.exchanges=t,this.exchanges||(this.exchanges=["XNYS","XASE","XNAS","XASX","INDCBSX","INDXASE","INDXNAS","IND_DJI","ARCX","INDARCX","forex"]),this.url="https://symbols.chartiq.com/chiq.symbolserver.SymbolLookup.service",this.requestCounter=0},a.CIQ.inheritsFrom(a.CIQ.UI.Lookup.Driver.ChartIQ,a.CIQ.UI.Lookup.Driver),a.CIQ.UI.Lookup.Driver.ChartIQ.prototype.acceptText=function(t,e,i,r){"FX"==e&&(e="FOREX"),isNaN(parseInt(i,10))&&(i=100);var s=this.url+"?t="+encodeURIComponent(t)+"&m="+i+"&x=[";this.exchanges&&(s+=this.exchanges.join(",")),s+="]",e&&"ALL"!=e.toUpperCase()&&(s+="&e="+e);var n=++this.requestCounter,o=this;a.CIQ.postAjax({url:s,cb:function(t,e){if(!(n<o.requestCounter)&&200==t)try{for(var i=(e=JSON.parse(e)).payload.symbols,a=[],s=0;s<i.length;s++){var l=i[s].split("|"),h={symbol:l[0],name:l[1],exchDisp:l[2]};a.push({display:[h.symbol,h.name,h.exchDisp],data:h})}r(a)}catch(t){}}})},a.CIQ.UI.BaseComponent&&(a.CIQ.UI.BaseComponent.bind=function(t,e){s("CIQ.UI.BaseComponent.bind has been deprecated. Use CIQ.UI.BaseComponent.bindNode() instead."),a.CIQ.UI.BaseComponent.bindNode(t,e)})},"./chartiq/development/js/standard.js":(t,e,i)=>{i.r(e),i.d(e,{$$:()=>a.$$,$$$:()=>a.$$$,CIQ:()=>a.CIQ,SplinePlotter:()=>a.SplinePlotter,createEngine:()=>r,customCharts:()=>N,drawing:()=>s,easeMachine:()=>n,equations:()=>o,i18n:()=>l,interaction:()=>h,markers:()=>c,market:()=>u,medianPrice:()=>w,momentum:()=>k,movement:()=>L,nameValueStore:()=>d,priceRelative:()=>D,quoteFeed:()=>p,series:()=>m,share:()=>g,span:()=>f,storage:()=>v,studies:()=>y,symbolLookupBase:()=>x,theme:()=>b,timezone:()=>S,timezoneJS:()=>a.timezoneJS,touch:()=>F,visualization:()=>C,vwap:()=>T,zigzag:()=>M});var a=i("./chartiq/development/js/chartiq.js");let r=t=>{var e,i="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class a{get(t,e){e("no storage defined")}set(t,e){}remove(t){}}i.ChartEngine.create=function(){let{container:t,config:r,deferLoad:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t||(t=document.querySelector(".chartContainer")||document.body),r||(r={});const n=new this(Object.assign({container:t},r.chartEngineParams)),{quoteFeeds:o,marketFactory:l,addOns:h,chartId:c,onChartReady:u}=r;o&&n.attachQuoteFeed&&o.forEach((t=>{let{quoteFeed:e,behavior:i,filter:a}=t;n.attachQuoteFeed(e,i,a)})),l&&n.setMarketFactory(l),h&&Object.entries(h).filter((t=>{let[,e]=t;return!!e})).forEach((t=>{let[e,a]=t;if(!r.enabledAddOns[e])return;const s=a.moduleName||i.capitalize(e);if(i[s]){const{cssRequired:t}=new i[s](Object.assign({stx:n},a,{config:r}));t&&i.UI&&i.UI.activatePluginUI(n,s)}else i.debug&&console.log(`${s} not available for addons with params:`,a)}));const d=i.ensureDefaults(r.callbacks||{},{layout:this.getSaveLayout(r),symbolChange:this.getSaveLayout(r),drawing:this.getSaveDrawings(r),preferences:this.getSavePreferences(r),newChart:this.getRetoggleEvents(r)});for(let t in d)d[t]&&n.addEventListener(t,d[t]);return e=new(e=r.nameValueStore||i.NameValueStore||a),s||(r.restore?(this.restorePreferences(n,c),this.restoreLayout(n,(t=>{!n.chart.symbol&&r.initialSymbol?p():m()}),c)):p()),n;function p(){n.loadChart(r.initialSymbol,{masterData:r.initialData},m),n.draw()}function m(){u&&setTimeout((()=>u(n)))}},i.ChartEngine.getSaveLayout=function(t){return function(i){let{stx:a}=i;if(t.restore&&a.exportLayout){var r=JSON.stringify(a.exportLayout(!0));e.set("myChartLayout"+(t.chartId||""),r)}}},i.ChartEngine.restoreLayout=function(t,i,a){const{restoreDrawings:r}=this;function s(){r(t,t.chart.symbol,a),i&&i()}a||(a=""),e.get("myChartLayout"+a,(function(e,i){if(!e){try{i=JSON.parse(i)}catch(t){}t.importLayout&&t.importLayout(i,{managePeriodicity:!0,cb:s}),t.termStructure&&t.setCandleWidth(1)}}))},i.ChartEngine.getSaveDrawings=function(t){return function(i){let{stx:a,symbol:r}=i;if(t.restore&&a.exportDrawings){var s=a.exportDrawings(),n=t.chartId?t.chartId+"~"+r:r;0===s.length?e.remove(n):e.set(n,JSON.stringify(s))}}},i.ChartEngine.restoreDrawings=function(t,a,r){if(!i.Drawing)return;const s=r?r+"~"+a:a;e.get(s,(function(e,i){if(!e){try{i=JSON.parse(i)}catch(t){}i&&(t.importDrawings(i),t.draw())}}))},i.ChartEngine.getSavePreferences=function(t){return function(i){let{stx:a}=i;if(t.restore&&a.exportPreferences){var r=JSON.stringify(a.exportPreferences());e.set("myChartPreferences"+(t.chartId||""),r)}}},i.ChartEngine.restorePreferences=function(t,i){i||(i=""),e.get("myChartPreferences"+i,(function(e,i){if(!e){try{i=JSON.parse(i)}catch(t){}i&&t.importPreferences&&t.importPreferences(i)}}))},i.ChartEngine.getRetoggleEvents=function(t){return function(e){let{stx:a}=e;var r=document.getElementById(t.chartId);r||(r=(i.getFn("UI.getMyContext")(a.container)||{}).topNode),r||(r=document);r.querySelectorAll(`${t.selector.markersMenuItem}.ciq-active:not(.span-event)`).forEach((function(t){t.dispatchEvent(new Event("stxtap"))}))}}},s=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,i="undefined"!=typeof _timezoneJS?_timezoneJS:t.timezoneJS;e.ChartEngine.drawingTools={},e.ChartEngine.currentVectorParameters={vectorType:null,pattern:"solid",lineWidth:1,fillColor:"#7DA6F5",currentColor:"auto",axisLabel:!0,fibonacci:{trend:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},fibs:[{level:-.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:0,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:1.272,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:1.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:2.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:4.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}],extendLeft:!1,printLevels:!0,printValues:!1,timezone:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}},annotation:{font:{style:null,size:null,weight:null,family:null}}},e.ChartEngine.registerDrawingTool=function(t,i){e.ChartEngine.drawingTools[t]=i},e.ChartEngine.prototype.setDrawingContainer=function(t){this.drawingContainer=t},e.ChartEngine.prototype.exportDrawings=function(){for(var t=[],e=0;e<this.drawingObjects.length;e++)t.push(this.drawingObjects[e].serialize());return t},e.ChartEngine.prototype.abortDrawings=function(t){!1!==t&&(t=!0);for(var e=this.drawingObjects.length-1;e>=0;e--){var i=this.drawingObjects[e];i.abort(!0),!t&&i.permanent||this.drawingObjects.splice(e,1)}},e.ChartEngine.prototype.importDrawings=function(t){if(e.Drawing)for(var i=0;i<t.length;i++){var a=t[i];"fibonacci"==a.name&&(a.name="retracement");var r=e.ChartEngine.drawingTools[a.name];if(r||e.Drawing[a.name]&&(r=e.Drawing[a.name],e.ChartEngine.registerDrawingTool(a.name,r)),r){var s=new r;s.reconstruct(this,a),this.drawingObjects.push(s)}}},e.ChartEngine.prototype.clearDrawings=function(t,i){!1!==i&&(i=!0);var a=this.exportDrawings();this.abortDrawings(i),t?this.undoStamps=[]:this.undoStamp(a,this.exportDrawings()),this.changeOccurred("vector"),this.cancelTouchSingleClick=!0,e.clearCanvas(this.chart.tempCanvas,this),this.draw();var r=this.controls.mSticky;r&&(r.style.display="none",r.children[0].innerHTML="")},e.ChartEngine.prototype.createDrawing=function(t,i){if(e.Drawing){var a=new e.Drawing[t];a.reconstruct(this,i);var r=new e.Drawing[t];for(var s in r.stx=this,r.copyConfig(),r)a[s]=a[s]||r[s];return this.drawingObjects.push(a),this.draw(),a}},e.ChartEngine.prototype.removeDrawing=function(t){for(var e=0;e<this.drawingObjects.length;e++)if(this.drawingObjects[e]==t)return this.drawingObjects.splice(e,1),this.changeOccurred("vector"),void this.draw()},e.ChartEngine.prototype.undo=function(){this.runPrepend("undo",arguments)||(this.activeDrawing&&(this.activeDrawing.abort(),this.activeDrawing.hidden=!1,this.drawingSnapshot=null,this.activateDrawing(null),e.clearCanvas(this.chart.tempCanvas,this),this.draw(),this.controls.crossX.classList.replace("stx_crosshair_drawing","stx_crosshair"),this.controls.crossY.classList.replace("stx_crosshair_drawing","stx_crosshair"),e.ChartEngine.drawingLine=!1),this.runAppend("undo",arguments))},e.ChartEngine.prototype.undoStamp=function(t,e){this.undoStamps.push(t),this.dispatch("undoStamp",{before:t,after:e,stx:this})},e.ChartEngine.prototype.undoLast=function(){this.activeDrawing?this.undo():this.undoStamps.length&&(this.drawingObjects=[],this.importDrawings(this.undoStamps.pop()),this.changeOccurred("vector"),this.draw())},e.ChartEngine.prototype.addDrawing=function(t){var e=this.exportDrawings();this.drawingObjects.push(t),this.undoStamp(e,this.exportDrawings())},e.ChartEngine.prototype.repositionDrawing=function(t,i){var a=this.panels[t.panelName],r=this.adjustIfNecessary(a,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),a)),s=this.chart.tempCanvas;e.clearCanvas(s,this),i?(this.drawingSnapshot=this.exportDrawings(),t.render(s.context)):(t.reposition(s.context,t.repositioner,this.crosshairTick,r),this.drawingSnapshot&&this.undoStamp(e.shallowClone(this.drawingSnapshot),this.exportDrawings()),this.drawingSnapshot=null),t.measure&&t.measure()},e.ChartEngine.prototype.activateRepositioning=function(t){this.repositioningDrawing=t;t&&(this.draw(),this.repositionDrawing(t,!0)),this.chart.tempCanvas.style.display=t?"block":"none"},e.ChartEngine.prototype.activateDrawing=function(t,i){function a(t){if(t.layout.studies){var e=t.layout.studies[i.name];e&&!e.overlay&&delete t.overlays[e.name]}}if(i||(i=this.currentPanel),!t)return this.activeDrawing=null,this.chart.tempCanvas.style.display="none",a(this),!1;var r=e.ChartEngine.drawingTools[t];return r||e.Drawing[t]&&(r=e.Drawing[t],e.ChartEngine.registerDrawingTool(t,r)),r&&(this.activeDrawing=new r,this.activeDrawing.construct(this,i),!this.charts[i.name]&&this.activeDrawing.chartsOnly)?(this.activeDrawing=null,a(this),!1):(this.chart.tempCanvas.style.display="block",this.controls.drawOk&&(this.controls.drawOk.style.display="none"),a(this),!0)},e.ChartEngine.prototype.drawingClick=function(t,i,a){if(e.Drawing&&t&&""===this.openDialog&&(this.activeDrawing||this.activateDrawing(this.currentVectorParameters.vectorType,t))){if(this.activeDrawing){if(this.userPointerDown&&!this.activeDrawing.dragToDraw)return void(e.ChartEngine.drawingLine||this.activateDrawing(null));var r=this.tickFromPixel(i,t.chart),s=this.panels[this.activeDrawing.panelName],n=this.adjustIfNecessary(s,r,this.valueFromPixel(a,s));return this.magnetizedPrice&&(n=this.adjustIfNecessary(s,r,this.magnetizedPrice)),this.activeDrawing.click(this.chart.tempCanvas.context,r,n)?this.activeDrawing&&(e.ChartEngine.drawingLine=!1,e.clearCanvas(this.chart.tempCanvas,this),this.addDrawing(this.activeDrawing),this.activateDrawing(null),this.adjustDrawings(),this.draw(),this.changeOccurred("vector"),this.controls.crossX.classList.replace("stx_crosshair_drawing","stx_crosshair"),this.controls.crossY.classList.replace("stx_crosshair_drawing","stx_crosshair")):(this.changeOccurred("drawing"),e.ChartEngine.drawingLine=!0,this.controls.crossX.classList.replace("stx_crosshair","stx_crosshair_drawing"),this.controls.crossY.classList.replace("stx_crosshair","stx_crosshair_drawing")),!0}return!1}},e.ChartEngine.prototype.rightClickDrawing=function(t,e){if(!this.runPrepend("rightClickDrawing",arguments)&&!t.permanent){if(this.callbackListeners.drawingEdit.length)this.dispatch("drawingEdit",{stx:this,drawing:t,forceEdit:e});else{if(!t.abort()){var i=this.exportDrawings();this.removeDrawing(t),this.undoStamp(i,this.exportDrawings())}this.changeOccurred("vector")}this.runAppend("rightClickDrawing",arguments)}},e.ChartEngine.prototype.magnetize=function(){if(this.magnetizedPrice=null,this.preferences.magnet&&!this.runPrepend("magnetize",arguments)&&!this.repositioningDrawing){var t=this.currentVectorParameters.vectorType;if(t&&"projection"!=t&&"freeform"!=t&&("annotation"!=t&&"callout"!=t||!e.ChartEngine.drawingLine)){var i=this.currentPanel,a=i.chart,r=this.crosshairTick;if(!(r>a.dataSet.length)){var s=a.dataSet[r];if(s){var n,o=a.transformFunc&&i.yAxis===a.yAxis;o&&s.transform&&(s=s.transform);var l=this.getRenderedItems(),h=["Open","High","Low","Close"];this.magneticHold&&this.activeDrawing&&this.activeDrawing.penDown?l=-1!=h.indexOf(this.magneticHold)&&-1!=l.indexOf("High")?h:[this.magneticHold]:this.magneticHold=null;for(var c=1e9,u=parseFloat(this.preferences.magnet),d=0;d<l.length;d++){var p=s[l[d]],m=this.getYAxisByField(i,l[d]),g=e.existsInObjectChain(s,l[d]);if(g&&(p=g.obj[g.member]),p||0===p){var f=this.pixelFromTransformedValue(p,i,m);if(Math.abs(this.cy-f)<c){if(c=Math.abs(this.cy-f),u&&u<=c)continue;this.magnetizedPrice=o?this.valueFromPixel(f,i):p,n=f,this.magneticHold=l[d]}}}var v=this.pixelFromTick(r,a),y=n;e.clearCanvas(a.tempCanvas,this);var x=a.tempCanvas.context;x.beginPath(),x.lineWidth=1;var b=Math.max(this.layout.candleWidth,12)/3;x.arc(v,y,Math.min(b,8),0,2*Math.PI,!1),x.fillStyle="#398dff",x.strokeStyle="#398dff",x.fill(),x.stroke(),x.closePath(),a.tempCanvas.style.display="block",this.anyHighlighted&&this.container.classList.remove("stx-draggable"),this.activeDrawing&&this.activeDrawing.move(x,this.crosshairTick,this.magnetizedPrice),this.runAppend("magnetize",arguments)}}}}},e.ChartEngine.prototype.changeVectorType=function(t){this.currentVectorParameters.vectorType=t,e.Drawing&&e.Drawing.initializeSettings(this,t),e.ChartEngine.drawingLine&&this.undo(),this.insideChart&&this.doDisplayCrosshairs()},e.ChartEngine.prototype.changeVectorParameter=function(t,e){"axisLabel"==t?e="true"===e.toString()||Number(e):"lineWidth"==t?e=Number(e):"fontSize"==t&&(e=parseInt(e,10)+"px");var i=this.currentVectorParameters;return(void 0!==i[t]||"font"==t.substr(0,4)&&("family"==(t=t.substr(4).toLowerCase())&&"default"==e.toLowerCase()&&(e=null),void 0!==(i=i.annotation.font)[t]))&&(i[t]=e,!0)},e.ChartEngine.prototype.drawVectors=function(){if(!this.vectorsShowing&&!this.runPrepend("drawVectors",arguments)){if(this.vectorsShowing=!0,!this.chart.hideDrawings&&!this.highlightedDraggable){var t,e,i={};for(e=0;e<this.drawingObjects.length;e++){var a=this.drawingObjects[e];a.hidden||this.repositioningDrawing!==a&&(t=a.panelName,this.panels[a.panelName]&&!this.panels[a.panelName].hidden&&(i[t]||(i[t]=[]),i[t].push(a)))}for(t in i){this.startClip(t);var r=i[t];for(e=0;e<r.length;e++)r[e].render(this.chart.context);this.endClip()}}this.runAppend("drawVectors",arguments)}},e.ChartEngine.prototype.adjustDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++){var e=this.drawingObjects[t];this.panels[e.panelName]&&e.adjust()}},e.Drawing=e.Drawing||function(){this.chartsOnly=!1,this.penDown=!1},e.Drawing.getDrawingParameters=function(t,i){var a;try{a=new e.Drawing[i]}catch(t){}if(!a)return null;a.stx=t,a.copyConfig(!0);for(var r={},s=a.configs,n=0;n<s.length;n++)r[s[n]]=a[s[n]];var o=t.canvasStyle("stx_annotation");return o&&r.font&&(r.font.size=o.fontSize,r.font.family=o.fontFamily,r.font.style=o.fontStyle,r.font.weight=o.fontWeight),r},e.Drawing.saveConfig=function(t,i){if(i){var a=t.preferences;a.drawings||(a.drawings={}),a.drawings[i]={};var r=new e.Drawing[i];r.stx=t,e.Drawing.copyConfig(r),r.configs.forEach((function(t){a.drawings[i][t]=r[t]})),t.changeOccurred("preferences")}},e.Drawing.restoreDefaultConfig=function(t,i,a){a?t.preferences.drawings=null:t.preferences.drawings[i]=null,t.changeOccurred("preferences"),t.currentVectorParameters=e.clone(e.ChartEngine.currentVectorParameters),t.currentVectorParameters.vectorType=i},e.Drawing.initializeSettings=function(t,i){var a=e.Drawing[i];if(a){var r=new a;r.initializeSettings&&r.initializeSettings(t)}},e.Drawing.updateSource=function(t,e,i,a){if(e){var r=!1;for(var s in t.drawingObjects){var n=t.drawingObjects[s];n.field&&(i?n.field==e?(n.field=i,r=!0):n.field.indexOf(e)>-1&&-1==n.field.indexOf(e+"-")&&(n.field=n.field.replace(e,i),r=!0):n.field.split("--\x3e")[0]!=e&&n.panelName!=e||(n.panelName=a,r=!0))}r&&t.changeOccurred("vector")}},e.Drawing.prototype.copyConfig=function(t){e.Drawing.copyConfig(this,t)},e.Drawing.copyConfig=function(t,i){var a,r,s=t.stx.currentVectorParameters,n=t.configs;for(a=0;a<n.length;a++)"color"==(r=n[a])?t.color=s.currentColor:"parameters"==r?t.parameters=e.clone(s.fibonacci):"font"==r?t.font=e.clone(s.annotation.font):t[r]=s[r];if(i){var o=t.stx.preferences;if(o&&o.drawings)for(e.extend(t,o.drawings[s.vectorType]),a=0;a<n.length;a++)"color"==(r=n[a])?s.currentColor=t.color:"parameters"==r?s.fibonacci=e.clone(t.parameters):"font"==r?s.annotation.font=e.clone(t.font):s[r]=t[r]}},e.Drawing.prototype.dragToDraw=!1,e.Drawing.prototype.permanent=!1,e.Drawing.prototype.chartsOnly=!1,e.Drawing.prototype.abort=function(t){},e.Drawing.prototype.measure=function(){},e.Drawing.prototype.construct=function(t,e){this.stx=t,this.panelName=e.name},e.Drawing.prototype.render=function(t){console.warn("must implement render function!")},e.Drawing.prototype.click=function(t,e,i){console.warn("must implement click function!")},e.Drawing.prototype.move=function(t,e,i){console.warn("must implement move function!")},e.Drawing.prototype.reposition=function(t,e,i,a){},e.Drawing.prototype.intersected=function(t,e,i){console.warn("must implement intersected function!")},e.Drawing.prototype.reconstruct=function(t,e){console.warn("must implement reconstruct function!")},e.Drawing.prototype.serialize=function(){console.warn("must implement serialize function!")},e.Drawing.prototype.adjust=function(){console.warn("must implement adjust function!")},e.Drawing.prototype.highlight=function(t){return(t&&!this.highlighted||!t&&this.highlighted)&&(this.highlighted=t),this.highlighted},e.Drawing.prototype.littleCircleRadius=function(){return 6},e.Drawing.prototype.littleCircle=function(t,i,a,r){if(!this.permanent){var s=this.stx.defaultColor,n=e.chooseForegroundColor(s);t.beginPath(),t.lineWidth=1,t.arc(i,a,this.littleCircleRadius(),0,2*Math.PI,!1),t.fillStyle=r?s:n,t.strokeStyle=s,t.setLineDash([]),t.fill(),t.stroke(),t.closePath()}},e.Drawing.prototype.rotator=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),s=this.stx.defaultColor;t.beginPath(),t.lineWidth=2,a||(t.globalAlpha=.5);var n=4+r;t.arc(e,i,n,0,3*Math.PI/2,!1),t.moveTo(e+2+n,i+2),t.lineTo(e+n,i),t.lineTo(e-2+n,i+2),t.moveTo(e-2,i+2-n),t.lineTo(e,i-n),t.lineTo(e-2,i-2-n),t.strokeStyle=s,t.stroke(),t.closePath(),t.globalAlpha=1}},e.Drawing.prototype.mover=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),s=this.stx.defaultColor,n=r+1;t.save(),t.lineWidth=2,t.strokeStyle=s,t.translate(e,i),a||(t.globalAlpha=.5);for(var o=0;o<4;o++)t.rotate(Math.PI/2),t.beginPath(),t.moveTo(0,n),t.lineTo(0,n+5),t.moveTo(-2,n+5-2),t.lineTo(0,n+5),t.lineTo(2,n+5-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()}},e.Drawing.prototype.resizer=function(t,e,i,a){if(!this.permanent){var r=this.littleCircleRadius(),s=this.stx.defaultColor,n=5*Math.sqrt(2),o=r+1;t.save(),t.lineWidth=2,t.strokeStyle=s,t.translate(e,i),t.rotate(-e*i/Math.abs(e*i)*Math.PI/4),a||(t.globalAlpha=.5);for(var l=0;l<2;l++)t.rotate(Math.PI),t.beginPath(),t.moveTo(0,o),t.lineTo(0,o+n),t.moveTo(-2,o+n-2),t.lineTo(0,o+n),t.lineTo(2,o+n-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()}},e.Drawing.prototype.pointIntersection=function(t,e,i,a){if(!this.stx.panels[this.panelName])return!1;if(a){if(t>=i.cx0&&t<=i.cx1&&e>=i.cy0&&e<=i.cy1)return!0}else if(t>=i.x0&&t<=i.x1&&e>=Math.min(i.y0,i.y1)&&e<=Math.max(i.y0,i.y1))return!0;return!1},e.Drawing.prototype.setPoint=function(t,i,a,r){var s,n=null,o=null;if("number"==typeof i?n=i:i.length>=8?o=i:n=Number(i),(a||0===a)&&(this["v"+t]=a),null!==n)s=this.stx.dateFromTick(n,r,!0),this["tzo"+t]=s.getTimezoneOffset(),this["d"+t]=e.yyyymmddhhmmssmmm(s),this["p"+t]=[n,a];else if(null!==o){s=e.strToDateTime(o),this["tzo"+t]||0===this["tzo"+t]||(this["tzo"+t]=s.getTimezoneOffset()),this["d"+t]=o;var l=this["tzo"+t]-s.getTimezoneOffset();s.setMinutes(s.getMinutes()+l);var h=!1;"freeform"==this.name||e.ChartEngine.isDailyInterval(this.stx.layout.interval)||s.getHours()||s.getMinutes()||s.getSeconds()||s.getMilliseconds()||(h=!0),this["p"+t]=[this.stx.tickFromDate(e.yyyymmddhhmmssmmm(s),r,null,h),a]}},e.Drawing.prototype.getLineColor=function(t){t||(t=this.color);var i=this.stx,a=t;if(this.highlighted)a=i.getCanvasColor("stx_highlight_vector");else if(e.isTransparent(a))a=i.defaultColor;else if("auto"==a&&(a=i.defaultColor,this.field)){var r,s;for(r in i.layout.studies){var n=i.layout.studies[r],o=n.outputs[n.outputMap[this.field]];if(o){a=o.color||o;break}}for(r in i.chart.seriesRenderers)for(var l=i.chart.seriesRenderers[r],h=0;h<l.seriesParams.length;h++){var c=l.seriesParams[h],u=c.field;if(u||l.highLowBars||(u=this.defaultPlotField||"Close"),c.symbol&&c.subField&&(u+="--\x3e"+c.subField),this.field==u){a=c.color;break}c.field&&c.field==this.field.split("--\x3e")[0]&&(s=c.color)}s&&(a=s)}return"auto"==a&&(a=i.defaultColor),a},e.Drawing.BaseTwoPoint=function(){this.p0=null,this.p1=null,this.color=""},e.inheritsFrom(e.Drawing.BaseTwoPoint,e.Drawing),e.Drawing.BaseTwoPoint.prototype.configs=[],e.Drawing.BaseTwoPoint.prototype.lineIntersection=function(t,i,a,r,s,n,o){s||(s=this.p0),n||(n=this.p1);var l=this.stx;if(!s||!n)return!1;var h=e.convertBoxToPixels(l,this.panelName,a);if(void 0===h.x0)return!1;var c={x0:s[0],x1:n[0],y0:s[1],y1:n[1]};return o||(c=e.convertBoxToPixels(l,this.panelName,c)),e.boxIntersects(h.x0,h.y0,h.x1,h.y1,c.x0,c.y0,c.x1,c.y1,r)},e.Drawing.BaseTwoPoint.prototype.boxIntersection=function(t,e,i){return!(!this.p0||!this.p1)&&(!(i.x0>Math.max(this.p0[0],this.p1[0])||i.x1<Math.min(this.p0[0],this.p1[0]))&&!(i.y1>Math.max(this.p0[1],this.p1[1])||i.y0<Math.min(this.p0[1],this.p1[1])))},e.Drawing.BaseTwoPoint.prototype.accidentalClick=function(t,e){var i=this.stx.panels[this.panelName],a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(t,i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,t,e),o=Math.abs(r-a),l=Math.abs(n-s);if(Math.sqrt(o*o+l*l)<10)return this.penDown=!1,this.dragToDraw&&this.stx.undo(),!0},e.Drawing.BaseTwoPoint.prototype.click=function(t,e,i){this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.BaseTwoPoint.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart))},e.Drawing.BaseTwoPoint.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p1=[e,i],this.render(t))},e.Drawing.BaseTwoPoint.prototype.measure=function(){if(this.p0&&this.p1){this.stx.setMeasure(this.p0[1],this.p1[1],this.p0[0],this.p1[0],!0,this.name);var t=this.stx.controls.mSticky,i=t&&t.querySelector(".mStickyInterior");if(i){var a=[];a.push(e.capitalize(this.name)),this.getYValue&&a.push(this.field||this.stx.defaultPlotField||"Close"),a.push(i.innerHTML),i.innerHTML=a.join("<br>")}}},e.Drawing.BaseTwoPoint.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.setPoint(1,e.p1[0]-s,e.p1[1]-n,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.render(t))}},e.Drawing.BaseTwoPoint.prototype.drawDropZone=function(t,e,i,a,r){var s=this.stx.panels[this.panelName];if(s){var n=s.left,o=s.width;(a||0===a)&&(n=this.stx.pixelFromTick(a,s.chart)),(r||0===r)&&(o=this.stx.pixelFromTick(r,s.chart));var l=this.stx.pixelFromPrice(e,s),h=this.stx.pixelFromPrice(i,s);t.fillStyle="#008000",t.globalAlpha=.2,t.fillRect(n,l,o-n,h-l),t.globalAlpha=1}},e.Drawing.annotation=function(){this.name="annotation",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={}},e.inheritsFrom(e.Drawing.annotation,e.Drawing.BaseTwoPoint),e.Drawing.annotation.prototype.getFontString=function(){this.fontDef={style:null,weight:null,size:"12px",family:null};var t=this.stx.canvasStyle("stx_annotation");t&&(t.fontStyle&&(this.fontDef.style=t.fontStyle),t.fontWeight&&(this.fontDef.weight=t.fontWeight),t.fontSize&&(this.fontDef.size=t.fontSize),t.fontFamily&&(this.fontDef.family=t.fontFamily)),this.font.style&&(this.fontDef.style=this.font.style),this.font.weight&&(this.fontDef.weight=this.font.weight),this.font.size&&(this.fontDef.size=this.font.size),this.font.family&&(this.fontDef.family=this.font.family),this.fontString="";var e=!0;for(var i in this.fontDef)this.fontDef[i]&&(e?e=!1:this.fontString+=" ",this.fontString+=this.fontDef[i])},e.Drawing.annotation.prototype.configs=["color","font"],e.Drawing.annotation.prototype.measure=function(){},e.Drawing.annotation.prototype.render=function(t){if(!this.ta){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);t.font=this.fontString,t.textBaseline="middle";var r,s,n,o,l=i,h=a,c=this.w,u=this.h,d=this.getLineColor();if(this.stem)this.stem.d?(r=this.stx.pixelFromTick(this.stem.t),n=this.stx.pixelFromValueAdjusted(e,this.stem.t,this.stem.v),s=l+c/2,o=h+u/2):this.stem.x&&(r=l,n=h,s=(l+=this.stem.x)+c/2,o=(h+=this.stem.y)+u/2),t.beginPath(),this.borderColor?t.strokeStyle=this.borderColor:t.strokeStyle=d,t.moveTo(r,n),t.lineTo(s,o),t.stroke();var p=t.lineWidth;if(this.highlighted?(this.stx.canvasColor("stx_annotation_highlight_bg",t),t.fillRect(l-p,h-u/2-p,c+2*p,u+2*p)):this.fillColor?(t.fillStyle=this.fillColor,t.fillRect(l,h-u/2,c,u)):this.stem&&(t.fillStyle=this.stx.containerColor,t.fillRect(l,h-u/2,c,u)),this.borderColor&&(t.beginPath(),t.strokeStyle=this.highlighted?this.stx.getCanvasColor("stx_highlight_vector"):this.borderColor,t.rect(l-p,h-u/2-p,c+2*p,u+2*p),t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=d,h+=this.padding/2,!this.ta)for(var m=0;m<this.arr.length;m++)t.fillText(this.arr[m],l+this.padding,h-u/2+this.fontSize/2),h+=this.fontSize+2;t.textBaseline="alphabetic"}}},e.Drawing.annotation.prototype.onChange=function(t){},e.Drawing.annotation.prototype.edit=function(t,i){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.controls.annotationSave,s=this.stx.controls.annotationCancel;if(r&&s){var n=this.stx,o=this.ta;n.editingAnnotation=!0,n.undisplayCrosshairs(),n.openDialog="annotation",o||((o=this.ta=document.createElement("TEXTAREA")).className="stx_annotation",o.onkeyup=m(this),o.onmouseup=function(t){return function(i){t.manageTouchAndMouse&&e.ChartEngine.drawingLine&&t.mouseup(i)}}(n),o.setAttribute("wrap","hard"),e.isIOS7or8&&o.setAttribute("placeholder","Enter Text"),n.chart.container.appendChild(o),o.style.position="absolute",o.style.width="100px",o.style.height="20px",o.value=this.text,e.touchDevice&&(o.ontouchstart=function(t){t.stopPropagation()}));var l=this;if(o.oninput=function(t){"historyUndo"!=t.inputType&&"historyRedo"!=t.inputType&&l.onChange(t)},o.style.font=this.fontString,this.color)if("transparent"==this.color||"auto"==this.color){var h=getComputedStyle(o);h&&e.isTransparent(h.backgroundColor)?o.style.color=n.defaultColor:o.style.color="#000"}else o.style.color=this.color;var c=n.pixelFromTick(this.p0[0],a.chart),u=n.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]);if(o.style.left=c+140<n.chart.canvasRight?c+"px":n.chart.canvasRight-200+"px",o.style.top=u+60<n.chart.canvasHeight?u-(isNaN(this.h)?this.defaultHeight:this.h/2)+"px":u-60+"px","callout"==this.name&&(o.style.left=e.stripPX(o.style.left)-(isNaN(this.w)?this.defaultWidth:this.w/2)+"px"),e.safeClickTouch(r,function(t){return function(i){if(""!==t.ta.value){t.text=t.ta.value;var a=t.stx;a.editingAnnotation=!1,t.adjust(),a.drawingSnapshot?a.undoStamp(e.shallowClone(a.drawingSnapshot),a.exportDrawings()):a.addDrawing(t),a.undo(),a.cancelTouchSingleClick=!0,a.changeOccurred("vector")}}}(this)),e.safeClickTouch(s,function(t){return function(e){var i=t.stx;i.editingAnnotation=!1,i.undo(),i.cancelTouchSingleClick=!0}}(this)),m(this)(),r.style.display="inline-block",s.style.display="inline-block",i&&(n.drawingSnapshot=n.exportDrawings(),this.hidden=!0,n.draw(),n.activeDrawing=this,e.ChartEngine.drawingLine=!0,t=n.chart.tempCanvas.context,n.chart.tempCanvas.style.display="block",this.w=o.clientWidth,this.h=o.clientHeight,e.clearCanvas(t.canvas,n),this.render(t),this.edit(t)),o.focus(),e.isAndroid&&!e.is_chrome&&!e.isFF){this.priorBottom=n.chart.container.style.bottom;var d=n.resolveY(u)+100;if(d>e.pageHeight()-400){var p=400-(e.pageHeight()-d);n.chart.container.style.bottom=p+"px"}}}}function m(t){return function(i){if(i&&27===i.keyCode)return void t.stx.undo();var a=t.stx,n=t.ta,o=n.value.split("\n"),l=0;a.chart.context.font=t.fontString;for(var h=0;h<o.length;h++){var c=a.chart.context.measureText(o[h]).width;c>l&&(l=c)}var u=(o.length+1)*(t.fontSize+3);l<50&&(l=50),n.style.width=l+30+"px",n.style.height=u+"px";var d=parseInt(e.stripPX(n.style.top),10),p=e.stripPX(n.style.left);l=n.clientWidth,u=n.clientHeight,p+l+100<t.stx.chart.canvasWidth?(r.style.top=d+"px",s.style.top=d+"px",r.style.left=p+l+10+"px",s.style.left=p+l+60+"px"):d+u+30<t.stx.chart.canvasHeight?(r.style.top=d+u+10+"px",s.style.top=d+u+10+"px",r.style.left=p+"px",s.style.left=p+50+"px"):(r.style.top=d-35+"px",s.style.top=d-35+"px",r.style.left=p+"px",s.style.left=p+50+"px")}}},e.Drawing.annotation.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.adjust(),this.edit(t),!1}},e.Drawing.annotation.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],s=e.tick-i,n=e.value-a;this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.render(t)}},e.Drawing.annotation.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(!this.p0)return null;var s=this.stx.pixelFromTick(this.p0[0],r.chart),n=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1])-this.h/2,o=s+this.w,l=n+this.h;this.stem&&this.stem.x&&(s+=this.stem.x,o+=this.stem.x,n+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,r.chart),c=this.stx.pixelFromValueAdjusted(r,t,i);return h+a.r>=s&&h-a.r<=o&&c+a.r>=n&&c-a.r<=l&&(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.annotation.prototype.abort=function(){var t=this.stx.controls.annotationSave,i=this.stx.controls.annotationCancel;t&&(t.style.display="none"),i&&(i.style.display="none"),this.ta&&this.stx.chart.container.removeChild(this.ta),this.ta=null,this.stx.openDialog="",this.stx.showCrosshairs(),this.stx.editingAnnotation=!1,e.clearCanvas(this.stx.chart.tempCanvas,this.stx),!e.isAndroid||e.is_chrome||e.isFF||(this.stx.chart.container.style.bottom=this.priorBottom),e.fixScreen()},e.Drawing.annotation.prototype.reconstruct=function(t,i){this.stx=t,this.color=i.col,this.panelName=i.pnl,this.d0=i.d0,this.tzo0=i.tzo0,this.v0=i.v0,this.text=t.escapeOnSerialize?decodeURIComponent(i.text):i.text,this.stem=i.stem,this.borderColor=i.bc,this.fillColor=i.bg,this.lineWidth=i.lw,this.pattern=i.ptrn,this.font=e.replaceFields(i.fnt,{st:"style",sz:"size",wt:"weight",fl:"family"}),this.font||(this.font={}),this.adjust()},e.Drawing.annotation.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,d0:this.d0,tzo0:this.tzo0,v0:this.v0,text:this.stx.escapeOnSerialize?encodeURIComponent(this.text):this.text};if(this.font){var i=e.removeNullValues(e.replaceFields(this.font,{style:"st",size:"sz",weight:"wt",family:"fl"}));e.isEmpty(i)||(t.fnt=i)}return this.stem&&(t.stem={d:this.stem.d,v:this.stem.v,x:this.stem.x,y:this.stem.y}),this.borderColor&&(t.bc=this.borderColor),this.fillColor&&(t.bg=this.fillColor),this.lineWidth&&(t.lw=this.lineWidth),this.pattern&&(t.ptrn=this.pattern),t},e.Drawing.annotation.prototype.renderText=function(){this.getFontString();var t=this.stx.panels[this.panelName];if(t){this.arr=this.text.split("\n");var i=0;this.stx.chart.context.font=this.fontString;for(var a=0;a<this.arr.length;a++){var r=this.stx.chart.context.measureText(this.arr[a]).width;r>i&&(i=r)}0===i&&(i=2*this.defaultWidth),this.fontSize=e.stripPX(this.fontDef.size);var s=this.arr.length*(this.fontSize+2);e.touchDevice&&(s+=5),this.w=i+2*this.padding,this.h=s+2*this.padding;var n=this.stx.pixelFromTick(this.p0[0],t.chart)+i,o=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1])+s;this.p1=[this.stx.tickFromPixel(n,t.chart),this.stx.valueFromPixel(o,t)],this.stem&&this.stem.d&&(this.stem.t=this.stx.tickFromDate(this.stem.d,t.chart))}},e.Drawing.annotation.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.renderText())},e.Drawing.segment=function(){this.name="segment"},e.inheritsFrom(e.Drawing.segment,e.Drawing.BaseTwoPoint),e.Drawing.segment.prototype.render=function(t){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.pixelFromTick(this.p0[0],a.chart),s=this.stx.pixelFromTick(this.p1[0],a.chart),n=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(a,this.p1[0],this.p1[1]),l=this.lineWidth,h=this.getLineColor(),c={pattern:this.pattern,lineWidth:l};if("none"==c.pattern&&(c.pattern="solid"),this.stx.plotLine(r,s,n,o,h,this.name,t,a,c),this.axisLabel&&!this.repositioner)if("horizontal"==this.name){this.stx.endClip();var u=this.p0[1];a.chart.transformFunc&&(u=a.chart.transformFunc(this.stx,a.chart,u)),u=a.yAxis.priceFormatter?a.yAxis.priceFormatter(this.stx,a,u):this.stx.formatYAxisPrice(u,a),this.stx.createYAxisLabel(a,u,n,h),this.stx.startClip(a.name)}else if("vertical"==this.name&&this.p0[0]>=0&&!this.stx.chart.xAxis.noDraw){var d,p;if(d=this.stx.dateFromTick(this.p0[0],a.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))d.setHours(0,0,0,0);else{var m=1e3*d.getSeconds()+d.getMilliseconds();i.Date&&this.stx.displayZone&&(p=new i.Date(d.getTime(),this.stx.displayZone),d=new Date(p.getFullYear(),p.getMonth(),p.getDate(),p.getHours(),p.getMinutes()),d=new Date(d.getTime()+m))}var g=e.mmddhhmm(e.yyyymmddhhmm(d));if(a.chart.xAxis.formatter)g=a.chart.xAxis.formatter(d,this.name,null,null,g);else if(this.stx.internationalizer){var f;0!==d.getHours()||0!==d.getMinutes()?(f=this.stx.internationalizer.monthDay.format(d),f+=" "+this.stx.internationalizer.hourMinute.format(d)):f=this.stx.internationalizer.yearMonthDay.format(d),g=f}this.stx.endClip(),this.stx.createXAxisLabel({panel:a,txt:g,x:r,backgroundColor:h,color:null,pointed:!0,padding:2}),this.stx.startClip(a.name)}if(this.highlighted&&"horizontal"!=this.name&&"vertical"!=this.name){var v="p0"==this.highlighted,y="p1"==this.highlighted;this.littleCircle(t,r,n,v),this.littleCircle(t,s,o,y)}}},e.Drawing.segment.prototype.abort=function(){this.stx.setMeasure(null,null,null,null,!1)},e.Drawing.segment.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r=this.name;if("horizontal"!=r&&"vertical"!=r&&"gartley"!=r){var s={0:this.p0,1:this.p1};for(var n in s)if(this.pointIntersection(s[n][0],s[n][1],a))return this.highlighted="p"+n,{action:"drag",point:"p"+n}}return"horizontal"!=r&&"vertical"!=r||(r="line"),this.lineIntersection(t,i,a,r)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},e.Drawing.segment.prototype.configs=["color","lineWidth","pattern"],e.Drawing.segment.prototype.copyConfig=function(t){e.Drawing.copyConfig(this,t),"none"==this.pattern&&-1==this.configs.indexOf("fillColor")&&(this.pattern="solid")},e.Drawing.segment.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.segment.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.line=function(){this.name="line"},e.inheritsFrom(e.Drawing.line,e.Drawing.segment),e.Drawing.line.prototype.dragToDraw=!1,e.Drawing.line.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]};i.x0>i.x1&&(i={x0:this.p1[0],y0:this.p1[1],x1:this.p0[0],y1:this.p0[1]});var a=i.x0-1e3,r=i.x1+1e3;this.v0B=e.yIntersection(i,a),this.v1B=e.yIntersection(i,r),this.d0B=this.stx.dateFromTick(a,t.chart),this.d1B=this.stx.dateFromTick(r,t.chart)}},e.Drawing.line.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.calculateOuterSet(a),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.line.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.v1=e.v1,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,e.d0B&&(this.d0B=e.d0B,this.d1B=e.d1B,this.v0B=e.v0B,this.v1B=e.v1B),this.adjust()},e.Drawing.line.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1};return this.d0B&&(t.d0B=this.d0B,t.d1B=this.d1B,t.v0B=this.v0B,t.v1B=this.v1B),t},e.Drawing.line.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&(this.setPoint(0,this.d0B,this.v0B,t.chart),this.setPoint(1,this.d1B,this.v1B,t.chart)))},e.Drawing.horizontal=function(){this.name="horizontal"},e.inheritsFrom(e.Drawing.horizontal,e.Drawing.segment),e.Drawing.horizontal.prototype.dragToDraw=!1,e.Drawing.horizontal.prototype.measure=function(){},e.Drawing.horizontal.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.setPoint(0,e,i,a.chart),!0},e.Drawing.horizontal.prototype.intersected=function(t,e,i){if(this.lineIntersection(t,e,i,"line")){var a=this.stx.chart.dataSet.length,r=this.p0[1];return this.highlighted=!0,{action:"move",p0:[a-2,r],p1:[a-1,r],tick:t,value:e}}return null},e.Drawing.horizontal.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.d0=e.d0,this.tzo0=e.tzo0,this.axisLabel=e.al,this.adjust()},e.Drawing.horizontal.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,v0:this.v0,d0:this.d0,tzo0:this.tzo0,al:this.axisLabel}},e.Drawing.horizontal.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0]+100,this.p0[1]])},e.Drawing.horizontal.prototype.configs=["color","lineWidth","pattern","axisLabel"],e.Drawing.vertical=function(){this.name="vertical"},e.inheritsFrom(e.Drawing.vertical,e.Drawing.horizontal),e.Drawing.vertical.prototype.measure=function(){},e.Drawing.vertical.prototype.intersected=e.Drawing.segment.prototype.intersected,e.Drawing.vertical.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0],this.p0[1]+1])},e.Drawing.measure=function(){this.name="measure"},e.inheritsFrom(e.Drawing.measure,e.Drawing.segment),e.Drawing.measure.prototype.click=function(t,e,i){return this.copyConfig(),this.penDown?(this.stx.undo(),this.penDown=!1,!0):(this.p0=[e,i],this.penDown=!0,!1)},e.Drawing.rectangle=function(){this.name="rectangle"},e.inheritsFrom(e.Drawing.rectangle,e.Drawing.BaseTwoPoint),e.Drawing.rectangle.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=Math.round(Math.min(a,r))+.5,l=Math.min(s,n),h=Math.max(a,r)-o,c=Math.max(s,n)-l,u=this.color;this.highlighted&&(u=this.stx.getCanvasColor("stx_highlight_vector"));var d=this.fillColor;d&&!e.isTransparent(d)&&"auto"!=d&&(t.beginPath(),t.rect(o,l,h,c),t.fillStyle=d,t.globalAlpha=.2,t.fill(),t.closePath(),t.globalAlpha=1);var p={pattern:this.pattern,lineWidth:this.lineWidth};if(this.highlighted&&"none"==p.pattern&&(p.pattern="solid",.1==p.lineWidth&&(p.lineWidth=1)),this.stx.plotLine(a,r,s,s,u,"segment",t,i,p),this.stx.plotLine(r,r,s-.5,n+.5,u,"segment",t,i,p),this.stx.plotLine(r,a,n,n,u,"segment",t,i,p),this.stx.plotLine(a,a,n+.5,s-.5,u,"segment",t,i,p),this.highlighted){var m="p0"==this.highlighted,g="p1"==this.highlighted;this.littleCircle(t,a,s,m),this.littleCircle(t,r,n,g)}}},e.Drawing.rectangle.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r={0:this.p0,1:this.p1};for(var s in r)if(this.pointIntersection(r[s][0],r[s][1],a))return this.highlighted="p"+s,{action:"drag",point:"p"+s};return this.boxIntersection(t,i,a)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},e.Drawing.rectangle.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.rectangle.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.rectangle.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.shape=function(){this.name="shape",this.radians=0,this.a=0,this.rotating=!1,this.textMeasure=!1,this.configurator="shape",this.dimension=[0,0],this.points=[]},e.inheritsFrom(e.Drawing.shape,e.Drawing.BaseTwoPoint),e.Drawing.shape.prototype.setRotationOnInitialDraw=!1,e.Drawing.shape.prototype.measure=function(){},e.Drawing.shape.prototype.render=function(t){if(this.points.length){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(this.p1){var s=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);t.globalAlpha=.5,t.fillStyle="#000000",this.rotating?(this.radians=Math.atan((n-r)/(s-a)),s<a?this.radians+=Math.PI:n<r&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.a%=360,this.radians=this.a*Math.PI/180,this.textMeasure&&t.fillText(this.a+"°",s+10,n+10)):this.penDown&&(this.sx=Math.max(1,parseFloat(Math.abs(2*(s-a)/this.dimension[0]).toFixed(1))),s<a&&(this.sx*=-1),this.sy=Math.max(1,parseFloat(Math.abs(2*(n-r)/this.dimension[1]).toFixed(1))),n<r&&(this.sy*=-1),this.textMeasure&&t.fillText(this.sx+"x,"+this.sy+"x",s+this.sx+5,n+this.sy+5)),t.globalAlpha=1}void 0===this.sx&&(this.sx=this.sy=1);var o=this.lineWidth;o||(o=1.1);var l={pattern:this.pattern,lineWidth:o};this.highlighted&&"none"==l.pattern&&(l.pattern="solid",.1==l.lineWidth&&(l.lineWidth=1));var h=this.color;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),this.highlighted&&(h=this.stx.getCanvasColor("stx_highlight_vector"),.1==o&&(o=1.1));var c,u,d=this.fillColor;o/=2*Math.abs(this.sx*this.sy)/(Math.abs(this.sx)+Math.abs(this.sy)),t.save(),t.translate(a,r),t.rotate(this.radians),t.scale(this.sx,i.yAxis.flipped?-this.sy:this.sy);var p=(this.dimension[0]-1)/2,m=(this.dimension[1]-1)/2;for(c=0;c<this.points.length;c++){for(t.beginPath(),u=0;u<this.points[c].length;u++){var g,f,v,y,x,b;"M"==this.points[c][u]?(g=this.points[c][++u]-p,f=this.points[c][++u]-m,t.moveTo(g,f)):"L"==this.points[c][u]?(g=this.points[c][++u]-p,f=this.points[c][++u]-m,t.lineTo(g,f)):"Q"==this.points[c][u]?(v=this.points[c][++u]-p,x=this.points[c][++u]-m,g=this.points[c][++u]-p,f=this.points[c][++u]-m,t.quadraticCurveTo(v,x,g,f)):"B"==this.points[c][u]&&(v=this.points[c][++u]-p,x=this.points[c][++u]-m,y=this.points[c][++u]-p,b=this.points[c][++u]-m,g=this.points[c][++u]-p,f=this.points[c][++u]-m,t.bezierCurveTo(v,x,y,b,g,f))}t.closePath(),d&&!e.isTransparent(d)&&"auto"!=d&&(t.fillStyle=d,t.fill()),h&&"none"!=this.pattern&&(t.strokeStyle=h,t.lineWidth=o,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(o,this.pattern)),t.lineDashOffset=0),t.stroke())}if(t.restore(),t.save(),t.translate(a,r),t.rotate(this.radians),this.highlighted){var S="p0"==this.highlighted,C="p1"==this.highlighted,w="p2"==this.highlighted;this.littleCircle(t,0,0,S),this.mover(t,0,0,S),this.littleCircle(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,C),this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,C),this.littleCircle(t,this.sx*this.dimension[0]/2,0,w),this.rotator(t,this.sx*this.dimension[0]/2,0,w),t.globalAlpha=.5,t.fillStyle="#000000",this.textMeasure&&(t.fillText(this.sx+"x,"+this.sy+"x",this.sx*this.dimension[0]/2+12,this.sy*this.dimension[1]/2+5),t.fillText(this.a+"°",this.sx*this.dimension[0]/2+12,5)),t.globalAlpha=1}else this.penDown&&(this.rotating?this.rotator(t,this.sx*this.dimension[0]/2,0,!0):this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,!0));t.restore()}}},e.Drawing.shape.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName];if("move"==e.action){var s=e.tick-i,n=e.value-a;this.setPoint(0,e.p0[0]-s,e.p0[1]-n,r.chart),this.render(t)}else{var o=this.stx.pixelFromTick(this.p0[0],r.chart),l=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),h=this.stx.pixelFromTick(i,r.chart),c=this.stx.pixelFromValueAdjusted(r,i,a);"scale"==e.action?(this[e.point]=[i,a],this.sx=parseFloat((((h-o)*Math.cos(this.radians)+(c-l)*Math.sin(this.radians))/(this.dimension[0]/2)).toFixed(1)),Math.abs(this.sx)<1&&(this.sx/=Math.abs(this.sy)),this.sy=parseFloat((((c-l)*Math.cos(this.radians)-(h-o)*Math.sin(this.radians))/(this.dimension[1]/2)).toFixed(1)),Math.abs(this.sy)<1&&(this.sy/=Math.abs(this.sy)),this.render(t)):"rotate"==e.action&&(this[e.point]=[i,a],this.radians=Math.atan((c-l)/(h-o)),h<o?this.radians+=Math.PI:c<l&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.sx<0&&(this.a=this.a+180),this.a%=360,this.radians=this.a*Math.PI/180,this.render(t))}}},e.Drawing.shape.prototype.intersected=function(t,i,a){if(!this.p0)return null;if(this.stx.repositioningDrawing==this&&this.stx.repositioningDrawing.repositioner)return this.stx.repositioningDrawing.repositioner;var r=this.stx.panels[this.panelName],s=this.stx.pixelFromTick(this.p0[0],r.chart),n=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),o=this.stx.pixelFromTick(t,r.chart),l=this.stx.pixelFromValueAdjusted(r,t,i),h=l-=n,c=o-=s;o=Math.cos(this.radians)*c+Math.sin(this.radians)*h,l=Math.cos(this.radians)*h-Math.sin(this.radians)*c,o/=this.sx,l/=this.sy,this.padding=e.ensureDefaults(this.padding||{},{left:0,right:0,top:0,bottom:0});var u=this.padding.right+this.padding.left,d=this.padding.bottom+this.padding.top,p=Math.pow(e.touchDevice?25:5+this.littleCircleRadius(),2),m=Math.abs(p/(this.sx*this.sy)),g=Math.pow((this.dimension[0]-u+3)/2,2)+Math.pow((this.dimension[1]-d+3)/2,2)>Math.pow(o-u/2,2)+Math.pow(l-d/2,2),f=(p-(Math.pow(o*this.sx,2)+Math.pow(l*this.sy,2)))/Math.abs(this.sx*this.sy),v=m-Math.pow(o-this.dimension[0]/2,2)-Math.pow(l-this.dimension[1]/2,2),y=m-Math.pow(o-this.dimension[0]/2,2)-Math.pow(l,2);return g?v>=y&&v>=f&&v>-1?(this.highlighted="p1",{action:"scale"}):y>=v&&y>=f&&y>-1?(this.highlighted="p2",{action:"rotate"}):(this.highlighted=!(f>-1)||"p0",{action:"move",p0:e.clone(this.p0),tick:t,value:i}):null},e.Drawing.shape.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.shape.prototype.littleCircleRadius=function(){return 3},e.Drawing.shape.prototype.click=function(t,e,i){if(!this.points.length)return!1;this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?(this.setPoint(1,e,i,a.chart),this.rotating||!this.setRotationOnInitialDraw?(this.penDown=!1,this.rotating=!1,!0):(this.rotating=!0,!1)):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.shape.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t){var i=this.name+"_v"+(this.version||0);if(e.Drawing[i]){var a=new e.Drawing[i];this.name=a.name,this.dimension=a.dimension,this.padding=a.padding,this.points=a.points,this.version=a.version}this.setPoint(0,this.d0,this.v0,t.chart),this.radians=Math.round(this.a/5)*Math.PI/36}},e.Drawing.shape.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.v0=e.v0,this.tzo0=e.tzo0,this.a=e.a,this.sx=e.sx,this.sy=e.sy,this.version=e.ver,this.adjust()},e.Drawing.shape.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,v0:this.v0,tzo0:this.tzo0,a:this.a,sx:this.sx,sy:this.sy,ver:this.version}},e.Drawing.arrow=function(){this.name="arrow",this.version=1,this.dimension=[11,22],this.padding={left:0,right:0,top:11,bottom:0},this.points=[["M",3,21,"L",7,21,"L",7,16,"L",10,16,"L",5,11,"L",0,16,"L",3,16,"L",3,21]]},e.inheritsFrom(e.Drawing.arrow,e.Drawing.shape),e.Drawing.getDrawingToolList=function(t){var i={},a={arrow_v0:!0,BaseTwoPoint:!0,fibonacci:!0,shape:!0};for(var r in e.extend(a,t),e.Drawing)!a[r]&&e.Drawing[r].prototype.render&&(i[(new e.Drawing[r]).name]=r);return i}},n=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.EaseMachine=function(t,e,i,a){this.fc=t,this.ms=e,(i||0===i)&&this.reset(i,a)},e.EaseMachine.prototype.reset=function(t,e){for(var i in t||0===t||(t=this.currentValues),this.hasCompleted=!1,this.running=!1,this.okayToRun=!0,this.useNameValuePairs="object"==typeof e,this.startTime=Date.now(),this.useNameValuePairs?(this.startValues=t,this.endValues=e):(this.startValues={default:t},this.endValues={default:e}),this.changeValues={},this.currentValues={},this.startValues)this.changeValues[i]=this.endValues[i]-this.startValues[i]},e.EaseMachine.prototype.next=function(){var t=Date.now();for(var e in t>=this.startTime+this.ms&&(t=this.startTime+this.ms,this.hasCompleted=!0,this.running=!1),this.currentValues={},this.changeValues)this.currentValues[e]=this.fc(t-this.startTime,this.startValues[e],this.changeValues[e],this.ms);return this.useNameValuePairs?this.currentValues:this.currentValues.default},e.EaseMachine.prototype.hasCompleted=!0,e.EaseMachine.prototype.run=function(t,e,i,a){this.afid&&cancelAnimationFrame(this.afid),e||0===e?this.reset(e,i):(i||0===i)&&this.reset(this.currentValues,i);var r=this;function s(){if(r.afid=null,r.okayToRun){var e=r.next();t(e),r.hasCompleted||(r.afid=requestAnimationFrame(s))}}this.running=!0,a?this.afid=requestAnimationFrame(s):s()},e.EaseMachine.prototype.stop=function(){return this.afid&&cancelAnimationFrame(this.afid),this.afid=null,this.okayToRun=!1,this.hasCompleted=!0,this.running=!1,void 0===this.useNameValuePairs?{}:this.useNameValuePairs?this.currentValues:this.currentValues.default},e.ChartEngine.prototype.animations.zoom.isStub&&(e.ChartEngine.prototype.animations.zoom=new e.EaseMachine(Math.easeOutCubic,400))},o=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.computeEquationChart=function(t,i){t=t.replace(/[:]/,"/");var a=0;for(var r in i){var s=new RegExp("\\["+r.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/[+\-*/%()]/g,"\\$&")+"\\]","g");t=t.replace(s,"symbol"+a),a++}var n,o=function(){function t(t){function e(){}return e.prototype=t,new e}var i=0,a=1,r=2,s=3,n=4;function o(t,e,o,l){this.type_=t,this.index_=e||0,this.prio_=o||0,this.number_=null!=l?l:0,this.toString=function(){switch(this.type_){case i:return this.number_;case a:case r:case s:return this.index_;case n:return"CALL";default:return"Invalid Token"}}}function l(t,e,i,a){this.tokens=t,this.ops1=e,this.ops2=i,this.functions=a}var h=/[\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function u(t,e){return Number(t)+Number(e)}function d(t,e){return t-e}function p(t,e){return t*e}function m(t,e){return t/e}function g(t,e){return t%e}function f(t,e){return""+t+e}function v(t,e){return t==e}function y(t,e){return t!=e}function x(t,e){return t>e}function b(t,e){return t<e}function S(t,e){return t>=e}function C(t,e){return t<=e}function w(t,e){return Boolean(t&&e)}function k(t,e){return Boolean(t||e)}function D(t){return Math.sinh?Math.sinh(t):(Math.exp(t)-Math.exp(-t))/2}function T(t){return Math.cosh?Math.cosh(t):(Math.exp(t)+Math.exp(-t))/2}function M(t){return Math.tanh?Math.tanh(t):t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function A(t){return Math.asinh?Math.asinh(t):t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function _(t){return Math.acosh?Math.acosh(t):Math.log(t+Math.sqrt(t*t-1))}function F(t){return Math.atanh?Math.atanh(t):Math.log((1+t)/(1-t))/2}function P(t){return Math.log(t)*Math.LOG10E}function I(t){return-t}function L(t){return Math.trunc?Math.trunc(t):t<0?Math.ceil(t):Math.floor(t)}function E(t){return Math.random()*(t||1)}function N(t){for(var e=t=Math.floor(t);t>1;)e*=--t;return e}function O(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var t=0,e=arguments.length,i=0;i<e;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;t+=arguments[i]*arguments[i]}return Math.sqrt(t)}function H(t,e,i){return t?e:i}function V(t,e){return"[object Array]"!=Object.prototype.toString.call(t)?[t,e]:((t=t.slice()).push(e),t)}function z(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:D,cosh:T,tanh:M,asinh:A,acosh:_,atanh:F,sqrt:Math.sqrt,log:Math.log,lg:P,log10:P,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:L,"-":I,exp:Math.exp},this.ops2={"+":u,"-":d,"*":p,"/":m,"%":g,"^":Math.pow,",":V,"||":f,"==":v,"!=":y,">":x,"<":b,">=":S,"<=":C,and:w,or:k},this.functions={random:E,fac:N,min:Math.min,max:Math.max,hypot:O,pyt:O,pow:Math.pow,atan2:Math.atan2,if:H},this.consts={E:Math.E,PI:Math.PI}}e.extend(l.prototype,{simplify:function(e){e=e||{};var n,h,c,u,d=[],p=[],m=this.tokens.length,g=0;for(g=0;g<m;g++){var f=(u=this.tokens[g]).type_;if(f===i)d.push(u);else if(f===s&&u.index_ in e)u=new o(i,0,0,e[u.index_]),d.push(u);else if(f===r&&d.length>1)h=d.pop(),n=d.pop(),c=this.ops2[u.index_],u=new o(i,0,0,c(n.number_,h.number_)),d.push(u);else if(f===a&&d.length>0)n=d.pop(),c=this.ops1[u.index_],u=new o(i,0,0,c(n.number_)),d.push(u);else{for(;d.length>0;)p.push(d.shift());p.push(u)}}for(;d.length>0;)p.push(d.shift());return new l(p,t(this.ops1),t(this.ops2),t(this.functions))},substitute:function(e,i){i instanceof l||(i=(new z).parse(String(i)));var a,r=[],n=this.tokens.length,h=0;for(h=0;h<n;h++)if((a=this.tokens[h]).type_===s&&a.index_===e)for(var c=0;c<i.tokens.length;c++){var u=i.tokens[c],d=new o(u.type_,u.index_,u.prio_,u.number_);r.push(d)}else r.push(a);return new l(r,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t){t=t||{};var e,o,l,h,c=[],u=this.tokens.length,d=0;for(d=0;d<u;d++){var p=(h=this.tokens[d]).type_;if(p===i)c.push(h.number_);else if(p===r)o=c.pop(),e=c.pop(),l=this.ops2[h.index_],c.push(l(e,o));else if(p===s)if(h.index_ in t)c.push(t[h.index_]);else{if(!(h.index_ in this.functions))throw new Error("undefined variable: "+h.index_);c.push(this.functions[h.index_])}else if(p===a)e=c.pop(),l=this.ops1[h.index_],c.push(l(e));else{if(p!==n)throw new Error("invalid Expression");if(e=c.pop(),!(l=c.pop()).apply||!l.call)throw new Error(l+" is not a function");"[object Array]"==Object.prototype.toString.call(e)?c.push(l.apply(void 0,e)):c.push(l.call(void 0,e))}}if(c.length>1)throw new Error("invalid Expression (parity)");return c[0]},toString:function(t){var e,o,l,u,d,p=[],m=this.tokens.length,g=0;for(g=0;g<m;g++){var f=(u=this.tokens[g]).type_;if(f===i)p.push("string"==typeof(d=u.number_)?(h.lastIndex=0,h.test(d)?"'"+d.replace(h,(function(t){var e=c[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))+"'":"'"+d+"'"):d);else if(f===r)o=p.pop(),e=p.pop(),l=u.index_,t&&"^"==l?p.push("Math.pow("+e+","+o+")"):p.push("("+e+l+o+")");else if(f===s)p.push(u.index_);else if(f===a)e=p.pop(),"-"===(l=u.index_)?p.push("("+l+e+")"):p.push(l+"("+e+")");else{if(f!==n)throw new Error("invalid Expression");e=p.pop(),l=p.pop(),p.push(l+"("+e+")")}}if(p.length>1)throw new Error("invalid Expression (parity)");return p[0]},variables:function(){for(var t=this.tokens.length,e=[],i=0;i<t;i++){var a=this.tokens[i];a.type_===s&&-1==e.indexOf(a.index_)&&e.push(a.index_)}return e}},!0),z.parse=function(t){return(new z).parse(t)},z.evaluate=function(t,e){return z.parse(t).evaluate(e)},z.Expression=l,z.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:D,cosh:T,tanh:M,asinh:A,acosh:_,atanh:F,sqrt:Math.sqrt,log:Math.log,lg:P,log10:P,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:L,random:E,fac:N,exp:Math.exp,min:Math.min,max:Math.max,hypot:O,pyt:O,pow:Math.pow,atan2:Math.atan2,if:H,E:Math.E,PI:Math.PI};var R=16,B=32,Q=64;return e.extend(z.prototype,{parse:function(e){this.errormsg="",this.success=!0;var h=[],c=[];this.tmpprio=0;var u=77,d=0;for(this.expression=e,this.pos=0;this.pos<this.expression.length;){var p;if(this.isOperator())this.isSign()&&u&Q?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",d++,this.addfunc(c,h,a)),u=77):this.isComment()||(0==(2&u)&&this.error_parsing(this.pos,"unexpected operator"),d+=2,this.addfunc(c,h,r),u=77);else if(this.isNumber())0==(1&u)&&this.error_parsing(this.pos,"unexpected number"),p=new o(i,0,0,this.tokennumber),c.push(p),u=50;else if(this.isString())0==(1&u)&&this.error_parsing(this.pos,"unexpected string"),p=new o(i,0,0,this.tokennumber),c.push(p),u=50;else if(this.isLeftParenth())0==(8&u)&&this.error_parsing(this.pos,'unexpected "("'),128&u&&(d+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(c,h,n)),u=333;else if(this.isRightParenth())256&u?(p=new o(i,0,0,[]),c.push(p)):0==(u&R)&&this.error_parsing(this.pos,'unexpected ")"'),u=186;else if(this.isComma())0==(u&B)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(c,h,r),d+=2,u=77;else if(this.isConst()){0==(1&u)&&this.error_parsing(this.pos,"unexpected constant");var m=new o(i,0,0,this.tokennumber);c.push(m),u=50}else if(this.isOp2())0==(4&u)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(c,h,r),d+=2,u=8;else if(this.isOp1())0==(4&u)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(c,h,a),d++,u=8;else if(this.isVar()){0==(1&u)&&this.error_parsing(this.pos,"unexpected variable");var g=new o(s,this.tokenindex,0,0);c.push(g),u=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg))}for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');h.length>0;){var f=h.pop();c.push(f)}return d+1!==c.length&&this.error_parsing(this.pos,"parity"),new l(c,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t,e){return this.parse(t).evaluate(e)},error_parsing:function(t,e){throw this.success=!1,this.errormsg="parse error [column "+t+"]: "+e,this.column=t,new Error(this.errormsg)},addfunc:function(t,e,i){for(var a=new o(i,this.tokenindex,this.tokenprio+this.tmpprio,0);e.length>0&&a.prio_<=e[e.length-1].prio_;)t.push(e.pop());e.push(a)},isNumber:function(){for(var t=!1,e="";this.pos<this.expression.length;){var i=this.expression.charCodeAt(this.pos);if(!(i>=48&&i<=57||46===i))break;e+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(e),t=!0}return t},unescape:function(t,e){for(var i=[],a=!1,r=0;r<t.length;r++){var s=t.charAt(r);if(a){switch(s){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":var n=parseInt(t.substring(r+1,r+5),16);i.push(String.fromCharCode(n)),r+=4;break;default:throw this.error_parsing(e+r,"Illegal escape sequence: '\\"+s+"'")}a=!1}else"\\"==s?a=!0:i.push(s)}return i.join("")},isString:function(){var t=!1,e="",i=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=e.slice(-1)){this.pos++,this.tokennumber=this.unescape(e,i),t=!0;break}e+=this.expression.charAt(this.pos),this.pos++}return t},isConst:function(){for(var t in this.consts){var e=t.length;if(t===this.expression.substr(this.pos,e))return this.tokennumber=this.consts[t],this.pos+=e,!0}return!1},isOperator:function(){var t=this.expression.charCodeAt(this.pos);if(43===t)this.tokenprio=2,this.tokenindex="+";else if(45===t)this.tokenprio=2,this.tokenindex="-";else if(62===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex=">="):(this.tokenprio=1,this.tokenindex=">");else if(60===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex="<="):(this.tokenprio=1,this.tokenindex="<");else if(124===t){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="||"}else if(61===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="=="}else if(33===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="!="}else if(97===t){if(110!==this.expression.charCodeAt(this.pos+1)||100!==this.expression.charCodeAt(this.pos+2))return!1;this.pos++,this.pos++,this.tokenprio=0,this.tokenindex="and"}else if(111===t){if(114!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="or"}else if(42===t||8729===t||8226===t)this.tokenprio=3,this.tokenindex="*";else if(47===t)this.tokenprio=4,this.tokenindex="/";else if(37===t)this.tokenprio=4,this.tokenindex="%";else{if(94!==t)return!1;this.tokenprio=5,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var t=this.expression.charCodeAt(this.pos-1);return 45===t||43===t},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var t=this.expression.charCodeAt(this.pos);return(32===t||9===t||10===t||13===t)&&(this.pos++,!0)},isOp1:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops1&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isOp2:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops2&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isVar:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&(this.tokenindex=t,this.tokenprio=4,this.pos+=t.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},!0),z}().parse(t),l=[],h={},c=0,u=null,d=!1,p=[];for(r in i){var m={sym:r,map:i[r]};i[r]?p.unshift(m):p.push(m)}for(var g=0;g<p.length;g++){var f=p[g];h[f.sym]={i:0,s:f.sym},f.map?(c++,n=f.map[0]):1==c&&(d=f.sym),n.DT||(n.DT=e.strToDateTime(n.Date)),h[f.sym].d=n.DT,u||(u=h[f.sym])}var v=0===c,y=1==c&&-1==t.indexOf("%");function x(t){if(t.i++,i[t.s]){if(t.i>=i[t.s].length)return 0;n=i[t.s][t.i]}return n.DT||(n.DT=e.strToDateTime(n.Date)),t.d=n.DT,1}function b(){var t=null,e=null;for(var i in h)e?h[i].d.getTime()<e.d.getTime()?t=e=h[i]:h[i].d.getTime()>e.d.getTime()&&(t=e):e=h[i];return t?x(t)?-1:0:1}t:for(;;){var S=b();if(!S)break;if(1==S){var C;if(d){var w=i[u.s][u.i][d];w&&(w.Close||0===w.Close)&&(w=w.Close);var k=o.evaluate({symbol0:i[u.s][u.i].Close,symbol1:w});k=Number(k.toFixed(8)),(C={DT:u.d,Close:k,Adj_Close:k})[u.s]=i[u.s][u.i].Close,isNaN(k)||k==1/0||l.push(C)}else{if(v){var D=o.evaluate({});throw e.alert(t+"="+D),{name:"NoException",message:""}}a=0;var T={Adj_Close:{},Close:{},Open:{},High:{},Low:{},Volume:{}};for(r in i){for(var M in T)T[M]["symbol"+a]=i[r][h[r].i][M];a++}(C={DT:u.d}).Adj_Close=o.evaluate(T.Adj_Close),C.Close=o.evaluate(T.Close),C.Open=o.evaluate(T.Open),C.Volume=o.evaluate(T.Volume),isNaN(C.Volume)&&(C.Volume=0),y?(C.High=o.evaluate(T.High),C.Low=o.evaluate(T.Low)):(C.High=Math.max(C.Open,C.Close),C.Low=Math.min(C.Open,C.Close)),isNaN(C.Close)||C.Close==1/0||l.push(C),isNaN(C.High)||(C.High=Number(C.High.toFixed(8))),isNaN(C.Low)||(C.Low=Number(C.Low.toFixed(8))),isNaN(C.Open)||(C.Open=Number(C.Open.toFixed(8))),isNaN(C.Close)||(C.Close=Number(C.Close.toFixed(8))),isNaN(C.Adj_Close)?C.Adj_Close=C.Close:C.Adj_Close=Number(C.Adj_Close.toFixed(8))}for(r in i)if(!x(h[r]))break t}}return l}},l=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ChartEngine.prototype.setLocale=function(t,i){if("undefined"!=typeof Intl&&this.locale!=t){this.locale=t;var a,r=this.internationalizer={};for(r.hourMinute=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",hourCycle:"h23"}),r.hourMinuteSecond=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23"}),r.mdhm=new Intl.DateTimeFormat(this.locale,{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),r.monthDay=new Intl.DateTimeFormat(this.locale,{month:"numeric",day:"numeric"}),r.yearMonthDay=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric",day:"numeric"}),r.yearMonth=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric"}),r.month=new Intl.DateTimeFormat(this.locale,{month:"short"}),r.numbers=new Intl.NumberFormat(this.locale),r.priceFormatters=[],i||(i=8),a=0;a<i+1;a++)r.priceFormatters.push(new Intl.NumberFormat(this.locale,{maximumFractionDigits:a,minimumFractionDigits:a}));for(a=0;a<5;a++){var s=a,n=a;a||(s="",n=2),r["percent"+s]=new Intl.NumberFormat(this.locale,{style:"percent",minimumFractionDigits:n,maximumFractionDigits:n})}e.I18N.createMonthArrays&&e.I18N.createMonthArrays(this,r.month,this.locale)}},e.I18N=function(){},e.I18N.hereDoc=function(t){return t.toString().replace(/^[^/]+\/\*!?/,"").replace(/\*\/[^/]+$/,"")},e.I18N.language="en",e.I18N.longMonths={zh:!0},e.I18N.reverseColorsByLocale={zh:!0,ja:!0},e.I18N.findAllTextNodes=function(t){if(t||(t=document.body),t==document.body&&!document.querySelector(".ciq_stashed_texts")){var i=document.createElement("div");i.className="ciq_stashed_texts",i.style.display="none",t.appendChild(i);for(var a=document.querySelectorAll("input,textarea,.editable_content"),r=0;r<a.length;r++){var s=a[r].getAttribute("placeholder");if(s){var n=i.appendChild(document.createElement("translate"));n.setAttribute("original",s),n.placeholderFor=a[r],n.appendChild(document.createTextNode(s))}}}for(var o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),l=o.nextNode(),h=new RegExp("^\\s*$"),c=new RegExp("\n|\t|\f","g"),u={},d={SCRIPT:!0,STYLE:!0,TEXTAREA:!0};l;){var p=l.nodeValue;if(!h.test(p)){var m=l.parentNode,g=l.nextSibling,f=m.tagName;if(!d[f]){if("TRANSLATE"!=f){var v=document.createElement("translate");v.setAttribute("original",p),v.appendChild(l),m.insertBefore(v,g)}else p=m.getAttribute("original");c.test(p)&&(p=p.replace(c,"")),u[p]||(u[p]=[]),u[p].push(l)}}l=o.nextNode()}if(t==document.body){var y=e.Studies?e.Studies.studyLibrary:null;if(y)for(var x in y){null===u[x]&&(u[x]=[]);var b=y[x];if(b.inputs)for(var S in b.inputs)u[S]||(u[S]=[]);if(b.outputs)for(var C in b.outputs)u[C]||(u[C]=[])}}return u},e.I18N.missingWordList=function(t){t||(t=e.I18N.language);var i=e.I18N.findAllTextNodes(),a={},r=e.I18N.wordLists[t];r||(r={});var s,n,o=function(t){void 0===r[t]&&(a[t]="")};for(var l in i)o(l);if(!e.Studies||!e.Studies.studyLibrary)return a;for(var h in e.Studies.studyLibrary){for(var c in o((s=e.Studies.studyLibrary[h]).name),s.inputs)switch(o(c),n=s.inputs[c],Object.prototype.toString.call(n)){case"[object String]":o(n);break;case"[object Array]":for(var u=0;u<n.length;++u)o(n[u])}for(var d in s.outputs)o(d)}return o("Show Zones"),o("OverBought"),o("OverSold"),o("Panel"),o("Show as Underlay"),o("Y-Axis"),o("Invert Y-Axis"),a},e.I18N.printableMissingWordList=function(t){var i=JSON.stringify(e.I18N.missingWordList(t));return i=i.replace(/","/g,'",\n"')},e.I18N.translateUI=function(t,i){if("pu"==t&&(t="pt"),e.I18N.wordLists){t||(t=e.I18N.language);var a=e.I18N.findAllTextNodes(i),r=e.I18N.wordLists[t];if(r)for(var s in a)for(var n=e.I18N.translateSections(s,r),o=a[s],l=0;l<o.length;l++){var h=o[l],c=h.parentNode,u=c.getAttribute("original");","!==n&&n||(n=u);var d=c.placeholderFor;d?d.placeholder=n:h.data=n}}},e.I18N.translate=function(t,i){if(i||(i=e.I18N.language),!e.I18N.wordLists)return console.log("Must include translations.js in order to use CIQ.I18N.translate()"),t;var a=e.I18N.wordLists[i],r=null;return a&&(r=e.I18N.translateSections(t,a)||t),","===r?t:r},e.I18N.translateSections=function(t,e){var i="‌";if("string"==typeof t&&-1!=t.indexOf(i)){var a=(t=t.replace(/([(),])/g,"‌$1‌")).split(i);return a.forEach((function(t,i,a){var r=t.match(/^(\s*).*\S(\s*)$/),s=e[t.trim()];s&&(r&&(s=r[1]+s+r[2]),a[i]=s)})),a.join("")}return e[t]},e.I18N.convertCSV=function(t){var i=new RegExp("[“”]|[‘’]","g"),a=new RegExp('^(")|(")$',"g"),r=e.I18N.wordLists;if(t||(t=e.I18N.csv),t){for(var s=t.split("\n"),n=s[0].split(","),o=0;o<n.length;o++){var l=n[o];r[l]||(r[l]={})}for(var h=1;h<s.length;h++){var c=s[h].match(/(".*?"|[^",]+)(?=\s*,|\s*$)|(,(?=,))/g)||[],u=c[0];a.test(u)&&(u=u.replace(a,"")),i.test(u)&&(u=u.replace(i,'"'));for(var d=1;d<c.length;d++){var p=c[d];a.test(p)&&(p=p.replace(a,"")),r[n[d]][u]=p}}}},e.I18N.setLanguage=function(t,i,a,r,s){s||(s=(t.uiContext||{}).topNode||document.body),"pu"==i&&(i="pt"),e.I18N.convertCSV(r),e.I18N.language=i,e.I18N.translateUI(i,s),a||(a=e.I18N.translate),t.translationCallback=a},e.I18N.setLocale=function(t,i,a,r,s){if(e.xor(this.reverseColorsByLocale[i],this.reverseColorsByLocale[t.locale])&&this.reverseCandles(t),"undefined"==typeof Intl||!Intl.__addLocaleData)return t.setLocale(i,s),void(a&&a(null));var n=(r=void 0===r?"locale-data/jsonp":r)+"/"+i+".js",o=document.createElement("SCRIPT");o.async=!0,o.src=n;var l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(o,l.nextSibling),o.onload=function(){t.setLocale(i,s),a&&a(null)},o.onerror=function(){a&&a("cannot load script")}},e.I18N.createMonthArrays=function(t,i,a){t.monthAbv=[],t.monthLetters=[];var r=new Date,s=!0;e.I18N.longMonths&&e.I18N.longMonths[a]&&(s=!1);for(var n=0;n<12;n++){r.setDate(1),r.setMonth(n);var o=i.format(r);if(s){for(var l="",h=0;h<o.length;h++){var c=o.charAt(h);c.charCodeAt(0)<65||(l+=c)}t.monthAbv[n]=l,t.monthLetters[n]=l[0]}else t.monthAbv[n]=o,t.monthLetters[n]=o}},e.I18N.localize=function(t,e){this.setLocale(t,e),this.setLanguage(t,e)},e.I18N.reverseCandles=function(t){var e=t.styles,i=t.cloneStyle(e.stx_candle_down),a=t.cloneStyle(e.stx_candle_up);e.stx_candle_up=i,e.stx_candle_down=a},e.I18N.wordLists={en:{}},e.I18N.languages={en:"English"}},h=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ChartEngine.prototype.pointerEvents={down:[],up:[]},e.ChartEngine.prototype.manageTouchAndMouse=!0,e.ChartEngine.prototype.registerTouchAndMouseEvents=function(){if(!this.touchAndMouseEventsRegistered){this.touchAndMouseEventsRegistered=!0;var t=this.controls.chartControls||document,i=t.querySelector(".stx-zoom-in"),a=t.querySelector(".stx-zoom-out"),r=this.chart.container,s=this,n=function(t,e,i){s.addDomEventListener(r,t,(function(t){s.mainSeriesRenderer&&s.mainSeriesRenderer.nonInteractive||e(t)}),i)};e.touchDevice?e.isSurface?(n("mousemove",(function(t){s.msMouseMoveProxy(t)})),n("mouseenter",(function(t){s.msMouseMoveProxy(t)})),n("mousedown",(function(t){s.msMouseDownProxy(t)})),n("mouseup",(function(t){s.msMouseUpProxy(t)})),n("pointerdown",(function(t){return s.startProxy(t)})),n("pointermove",(function(t){s.moveProxy(t)})),n("pointerenter",(function(t){return s.moveProxy(t)})),n("pointerup",(function(t){return s.endProxy(t)}))):(e.isMobile||(n("mousemove",(function(t){s.iosMouseMoveProxy(t)})),n("mouseenter",(function(t){s.iosMouseMoveProxy(t)})),n("mousedown",(function(t){s.iosMouseDownProxy(t)})),n("mouseup",(function(t){s.iosMouseUpProxy(t)}))),n("touchstart",(function(t){s.touchstart(t)})),n("touchmove",(function(t){s.touchmove(t)})),n("touchend",(function(t){s.touchend(t)})),n("pointerdown",(function(t){s.touchPointerType=t.pointerType})),i&&(i.removeAttribute("onMouseOver"),i.removeAttribute("onMouseOut")),a&&(a.removeAttribute("onMouseOver"),a.removeAttribute("onMouseOut"))):(n("mousemove",(function(t){s.mousemove(t)})),n("mouseenter",(function(t){s.mousemove(t)})),n("mousedown",(function(t){s.mousedown(t)})),n("mouseup",(function(t){s.mouseup(t)})));var o=e.wheelEvent;this.captureMouseWheelEvents&&n(o,(function(t){s.mouseWheel(t)}),{passive:!1})}},e.ChartEngine.prototype.mousedown=function(t){if(this.runPrepend("mousedown",arguments))return;if(this.grabOverrideClick=!1,!this.displayInitialized)return;if(!this.displayCrosshairs)return;if(this.repositioningDrawing)return;if(this.editingAnnotation)return;if(t.button&&t.button>=2)return;var i=this.container.getBoundingClientRect();if(this.top=i.top,this.left=i.left,this.right=this.left+this.width,this.bottom=this.top+this.height,!(t.clientX>=this.left&&t.clientX<=this.right&&t.clientY>=this.top&&t.clientY<=this.bottom))return void(this.insideChart=!1);if(this.insideChart=!0,!this.currentPanel)return;this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.hasDragged=!1,this.userPointerDown=!0,""===this.openDialog&&this.registerPointerEvent({x:t.clientX,y:t.clientY,time:this.mouseTimer},"down");for(var a=this.currentPanel.chart,r=0;r<this.drawingObjects.length;r++){var s=this.drawingObjects[r];if(s.highlighted&&!s.permanent){if(this.cloneDrawing){var n=new(0,e.ChartEngine.drawingTools[s.name]);return n.reconstruct(this,s.serialize()),this.drawingObjects.push(n),this.activateRepositioning(n),void(n.repositioner=s.repositioner)}var o=this.currentVectorParameters.vectorType;if(!(e.Drawing&&o&&e.Drawing[o]&&(new e.Drawing[o]).dragToDraw))return void this.activateRepositioning(s)}}this.mainSeriesRenderer;const{baselineHelper:l}=this;if(!l.size||!this.findBaselineHandle(t,!0)){if(this.controls.anchorHandles){const{anchorHandles:t}=this.controls;for(let e in t){let{handle:i,sd:a,highlighted:r}=t[e];if(r)return this.repositioningAnchorSelector={sd:a},void i.classList.add("stx-grab")}}this.drawingClick&&(this.currentPanel.subholder===t.target&&this.drawingClick(this.currentPanel,this.cx,this.cy),this.activeDrawing&&this.activeDrawing.dragToDraw)||(this.grabbingScreen=!0,a.spanLock=!1,this.yToleranceBroken=!1,this.grabStartX=t.clientX,this.grabStartY=t.clientY,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=a.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(this.currentPanel),this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,this.grabStartPanel=this.currentPanel,setTimeout(function(t){return function(){t.grabbingHand()}}(this),100),this.swipeStart&&this.swipeStart(a),(this.longHoldTime||0===this.longHoldTime)&&this.startLongHoldTimer(),this.runAppend("mousedown",arguments))}},e.ChartEngine.prototype.mousemove=function(t){var i=t;e.ChartEngine.crosshairX=i.clientX,e.ChartEngine.crosshairY=i.clientY,i.type.toLowerCase().indexOf("enter")>-1?this.positionCrosshairsAtPointer():this.runPrepend("mousemove",arguments)||this.displayInitialized&&""===this.openDialog&&(this.baselineHelper.size&&this.findBaselineHandle(i),this.grabbingScreen&&1!==i.buttons&&(this.cancelLongHold=!0,this.displayDragOK(),this.grabbingScreen=!1,this.findHighlights(!1,!0)),this.mousemoveinner(i.clientX,i.clientY),this.runAppend("mousemove",arguments))},e.ChartEngine.prototype.mouseup=function(t){if(!this.runPrepend("mouseup",arguments)){if(this.swipe.end=!0,this.cancelLongHold=!0,this.repositioningDrawing){if(!this.currentVectorParameters.vectorType||Date.now()-this.mouseTimer>250)return this.changeOccurred("vector"),e.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.adjustDrawings(),void this.draw();this.activateRepositioning(null)}if(this.repositioningBaseline){const{handle:t}=this.repositioningBaseline;this.repositioningBaseline=null,t.classList.remove("stx-grab");var i=this.mainSeriesRenderer||{};return i.params&&i.params.baseline&&i.params.type,void this.draw()}if(this.repositioningAnchorSelector)return e.Studies.repositionAnchor(this,this.repositioningAnchorSelector.sd),this.repositioningAnchorSelector=null,Object.values(this.controls.anchorHandles).forEach((t=>{let{handle:e}=t;return e.classList.remove("stx-grab")})),void this.findHighlights();var a=this.userPointerDown;if(this.userPointerDown=!1,this.displayInitialized){var r=this.backOutY(t.clientY),s=this.backOutX(t.clientX),n=t.which&&t.which>=2||t.button&&t.button>=2;""!==this.openDialog||n||this.registerPointerEvent({x:t.clientX,y:t.clientY,time:Date.now()},"up");var o=this.isDoubleClick();this.grabbingScreen=!1,this.highlightedDraggable&&(this.dragPlotOrAxis&&this.dragPlotOrAxis(s,r),this.currentPanel=this.whichPanel(r));var l=this.currentPanel;if(this.grabStartYAxis=null,this.displayDragOK(),""===this.openDialog){if(this.grabOverrideClick)return this.overXAxis||this.overYAxis||!this.swipeRelease||this.swipeRelease(),this.container.classList.remove("stx-drag-chart"),this.grabOverrideClick=!1,this.doDisplayCrosshairs(),void this.updateChartAccessories();if(this.insideChart&&this.container.classList.remove("stx-drag-chart"),e.ChartEngine.resizingPanel)this.releaseHandle();else{if(n||t.ctrlKey)return this.anyHighlighted&&!0!==this.bypassRightClick?(this.rightClickHighlighted(),t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t.stopPropagation(),!1):(this.dispatch("rightClick",{stx:this,panel:l,x:s,y:r}),!0);if(!(t.clientX<this.left||t.clientX>this.right||t.clientY<this.top||t.clientY>this.bottom)){var h=l&&l.subholder===t.target;o&&(h||this.overYAxis||this.overXAxis)?this.doubleClick({button:t.button,x:s,y:r}):(a&&h&&(this.longHoldTookEffect&&!this.activeDrawing||this.drawingClick(l,s,r),!this.longHoldTookEffect&&this.activeMarker&&this.activeMarker.click({cx:s,cy:r,panel:l})),this.longHoldTookEffect||this.activeDrawing||this.dispatch("tap",{stx:this,panel:l,x:s,y:r})),this.runAppend("mouseup",arguments)}}}else this.insideChart&&this.container.classList.remove("stx-drag-chart")}}},e.ChartEngine.prototype.registerPointerEvent=function(t,e){this.pointerEvents[e].length>1&&this.pointerEvents[e].pop(),this.pointerEvents[e].unshift(t)},e.ChartEngine.prototype.resetPointerEvent=function(t){this.pointerEvents[t].splice(0)},e.ChartEngine.prototype.isDoubleClick=function(t){const e=t?1200:400,{up:i,down:a}=this.pointerEvents;if(this.cancelTouchSingleClick=!1,i.length<2||a.length<2)return!1;const r=a[0].time-i[1].time<this.doubleClickTime&&Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)<=e&&i[1].time-a[1].time<this.longHoldTime&&i[0].time-a[0].time<this.longHoldTime;return r&&(this.resetPointerEvent("up"),this.resetPointerEvent("down"),this.cancelTouchSingleClick=!0),r},e.ChartEngine.prototype.doubleClick=function(t,i,a){if(this.runPrepend("doubleClick",arguments))return;if(this.editingAnnotation)return;if(e.ChartEngine.drawingLine)return this.undo();if(this.activeDrawing)return;this.activeMarker&&this.activeMarker.doubleClick({cx:i,cy:a,panel:this.currentPanel})||this.dispatch("doubleClick",{stx:this,button:t,x:i,y:a}),this.runAppend("doubleClick",arguments)},e.ChartEngine.prototype.handleMouseOut=function(t){if(t=t||window.event,!e.withinElement(this.chart.container,t.pageX,t.pageY)){if(this.runPrepend("handleMouseOut",arguments))return;if(this.grabbingScreen||this.findHighlights(null,!0),this.undisplayCrosshairs(),this.touches=[],this.touching=!1,this.activeDrawing&&this.userPointerDown){this.userPointerDown=!1,this.drawingLine=!1;var i=this.backOutY(t.pageY),a=this.backOutX(t.pageX);this.drawingClick(this.currentPanel,a,i)}this.repositioningAnchorSelector&&(this.repositioningAnchorSelector=null),this.insideChart=!1,this.overYAxis=!1,this.overXAxis=!1,this.displaySticky(),this.runAppend("handleMouseOut",arguments)}},e.ChartEngine.prototype.startLongHoldTimer=function(){var t=this;this.cancelLongHold=!1,this.longHoldTimeout&&clearTimeout(this.longHoldTimeout);var e=function(){t.cancelLongHold||(t.longHoldTookEffect=!0,t.dispatch("longhold",{stx:t,panel:t.currentPanel,x:t.cx,y:t.cy}),t.displayDragOK())};this.longHoldTime?this.longHoldTimeout=setTimeout(e,this.longHoldTime):0===this.longHoldTime&&e()},e.ChartEngine.prototype.grabHandle=function(t){this.runPrepend("grabHandle",arguments)||t&&(e.ChartEngine.crosshairY=t.top+this.top,e.ChartEngine.resizingPanel=t,t.handle.classList.add("stx-grab"),this.runAppend("grabHandle",arguments))},e.ChartEngine.prototype.grabbingHand=function(){this.allowScroll&&this.grabbingScreen&&(e.touchDevice||this.container.classList.add("stx-drag-chart"))},e.ChartEngine.prototype.releaseHandle=function(){if(this.runPrepend("releaseHandle",arguments))return!0;e.clearCanvas(this.chart.tempCanvas,this),this.resizePanels(),e.ChartEngine.resizingPanel&&e.ChartEngine.resizingPanel.handle.classList.remove("stx-grab"),e.ChartEngine.resizingPanel=null,this.runAppend("releaseHandle",arguments)},e.ChartEngine.prototype.findHighlights=function(t,i){var a=this.preferences[t?"highlightsTapRadius":"highlightsRadius"];this.highlightViaTap=t;var{cx:r,cy:s}=this;if(this.anyHighlighted=!1,this.currentPanel){var{chart:n}=this.currentPanel;this.activeDrawing&&(i=!0);var o=!1,l=null,h=i?{}:{forceShow:!0,type:"drawing"},c={x0:this.tickFromPixel(r-a,n),x1:this.tickFromPixel(r+a,n),y0:this.valueFromPixel(s-a,this.currentPanel),y1:this.valueFromPixel(s+a,this.currentPanel),cx0:r-a,cx1:r+a,cy0:s-a,cy1:s+a,r:a};this.repositioningDrawing&&c.x1-c.x0<2?(c.x1++,c.x0--):c.x1==c.x0&&(c.x0-=.5,c.x1+=.5);var u,d,p,m,g,f,v=this.markerHelper&&this.markerHelper.chartMap[n.name]&&this.markerHelper.chartMap[n.name].markers;if(!n.hideDrawings)for(var y=this.drawingObjects.length-1;y>=0;y--){var x=this.drawingObjects[y];if(this.panels[x.panelName]&&(!this.repositioningDrawing||this.repositioningDrawing==x)){var b=x.highlighted,S=x.panelName==this.currentPanel.name;x.repositioner=x.intersected(this.crosshairTick,this.crosshairValue,c),S=S&&x.repositioner,!i&&S?(b?(l=x,this.anyHighlighted&&this.singleDrawingHighlight&&(x.highlighted=!1),x.highlighted&&x.highlighted!=b&&(o=!0)):b!=x.highlight(!0)&&(l||(l=x),this.anyHighlighted&&this.singleDrawingHighlight&&(x.highlighted=!1),o=!0),this.anyHighlighted=!0):b!=x.highlight(!1)&&(o=!0),x.highlighted&&(h.noDelete=x.permanent,h.noEdit=!this.callbackListeners.drawingEdit.length)}}for(u in this.layout.studies)(d=this.layout.studies[u]).prev=d.highlight,d.highlight=this.yaxisMatches(d,this.grabStartYAxis);for(u in n.seriesRenderers){var C=n.seriesRenderers[u];C.params.highlight=this.yaxisMatches(C,this.grabStartYAxis);for(var w=0;w<C.seriesParams.length;w++)(g=C.seriesParams[w]).prev=g.highlight,g.highlight=C.params.highlight}for(p=0;v&&p<v.length;p++)(m=v[p]).params.box&&(this.activeMarker=null,m.prev=v[p].highlight,m.highlight=!1);if(this.markerHelper&&(this.markerHelper.highlighted=[]),this.highlightedDataSetField=null,this.highlightedDraggable=null,!i&&!this.anyHighlighted&&this.controls.anchorHandles)for(let t in this.controls.anchorHandles){const i=this.controls.anchorHandles[t],{handle:a,sd:n}=i,l=this.resolveX(r),c=this.resolveY(s);if(a){const{left:t,top:r,right:s,bottom:u}=a.getBoundingClientRect();if(e.boxIntersects(t,r,s,u,l,c,l,c)){i.highlighted=!0,this.anyHighlighted=!0,o=!0,h={message:n.name,type:"anchorHandle"};continue}!0===i.highlighted&&(i.highlighted=!1,o=!0)}}if(!i&&!this.anyHighlighted&&n.dataSegment){var k=this.barFromPixel(r);if(k>=0&&k<n.dataSegment.length){var D;for(u in this.overlays){if((d=this.overlays[u]).panel==this.currentPanel.name)if(!1!==d.study.isHighlighted)if("function"!=typeof d.study.isHighlighted){if(n.dataSegment[k]){for(var T in d.outputMap)if($.call(this,k,c,T,d.getYAxis(this))){d.name!=d.panel&&(this.anyHighlighted=!0),d.highlight=T;break}if(d.highlight){this.highlightedDataSetField=T;break}}}else d.study.isHighlighted(this,r,s)&&(d.highlight=!0,this.anyHighlighted=!0)}for(u in n.seriesRenderers){if(this.highlightedDataSetField)break;var M=n.seriesRenderers[u],A=M.params.panel;if(M!=this.mainSeriesRenderer&&((M.params.highlightable||this.currentVectorParameters.vectorType)&&A==this.currentPanel.name))for(p=0;p<M.seriesParams.length;p++){var _=(g=M.seriesParams[p]).field;_||M.highLowBars||(_=this.defaultPlotField||"Close"),g.symbol&&g.subField&&(_+="--\x3e"+g.subField);var F=M.params.yAxis;if(!F&&A&&(F=this.panels[A].yAxis),M.params.step&&k>0){if(!M.caches[g.id])continue;if(!(D=M.caches[g.id][k])&&0!==D)continue;var P=M.caches[g.id][k-1];((P||0===P)&&s+a>=D&&s-a<=P||s-a<=D&&s+a>=P)&&(g.highlight=!0,this.anyHighlighted=!0)}else $.call(this,k,c,_,F,M,g.id)&&(g.highlight=!0,this.anyHighlighted=!0);if(g.highlight){this.highlightedDataSetField=_;break}}}}}var I,L=this.preferences.dragging;for(u in this.overlays){if((d=this.overlays[u]).highlight){this.anyHighlighted=!0;var E=d.inputs.display||d.name;h={message:E=this.translateIf(E),noDelete:d.permanent,noEdit:!d.editFunction,type:"study"},l=null,(!0===L||L&&L.study)&&(f=d),I=d.getYAxis(this)}d.prev!=d.highlight&&(o=!0)}for(u in n.seriesRenderers)for(var N=n.seriesRenderers[u],O=N.params.yAxis?N.params.yAxis.textStyle:null,H=0;H<N.seriesParams.length;H++){if(g=N.seriesParams[H],N.params.highlightable&&g.highlight){this.anyHighlighted=!0;var V=g.color||O;"auto"==V&&(V=this.defaultColor),g.opacity&&1!==g.opacity&&(V=e.hexToRgba(e.colorToHex(V),parseFloat(g.opacity))),h={message:g.display||g.symbol,backgroundColor:V,noDelete:g.permanent,type:"series"},l=null,(!0===L||L&&L.series)&&(f=N,N.params.highlight=!0),I=N.getYAxis(this)}g.prev!=g.highlight&&(o=!0)}for(u in this.plugins){var z=this.plugins[u],R={};z.findHighlights&&((R=z.findHighlights(this,t,i)).somethingChanged&&(o=!0),R.anyHighlighted&&(this.anyHighlighted=!0,h=R.stickyArgs||{}))}var B=this.whichPanel(s),Q=this.whichYAxis(B,r);I||(I=Q),this.currentBaseline&&(I=this.currentBaseline.getYAxis(this)),I&&(I.highlight||(o=!0),I.highlight=!0);var W=[];for(var U in this.panels)W=W.concat(this.panels[U].yaxisLHS).concat(this.panels[U].yaxisRHS);for(u=0;u<W.length;u++)(I!=W[u]||i)&&(W[u].highlight&&(o=!0),W[u].highlight=!1);for(p=0;v&&p<v.length;p++){var j=(m=v[p]).params.box;if(j&&m.params.panelName===this.currentPanel.name){var q=e.convertBoxToPixels(this,this.currentPanel.name,c);e.boxIntersects(q.x0,q.y0,q.x1,q.y1,j.x0,j.y0,j.x1,j.y1)&&(this.activeMarker=m,m.highlight=!0,this.markerHelper.highlighted.push(m)),m.prev!=m.highlight&&(o=!0)}}if(o&&(this.draw(),h.panel=B,this.anyHighlighted&&!this.grabStartYAxis?h.panel=B:h={},this.displaySticky(h),this.clearMeasure(),l&&l.measure()),(!0===L||L&&L.yaxis)&&Q&&!Q.noDraw&&(this.anyHighlight=!0,f=Q),this.anyHighlighted||this.setMeasure(),f&&!B.noDrag){if(this.longHoldTookEffect&&!this.cancelLongHold){if(f.params)for(u in f.params.dependentOf&&((f=n.seriesRenderers[f.params.dependentOf]).params.highlight=!0),n.seriesRenderers)n.seriesRenderers[u].params.dependentOf==f.params.name&&(n.seriesRenderers[u].params.highlight=!0);if(this.highlightedDraggable=f,f.getDependents){var Y=f.getDependents(this,!0);for(u in this.overlays)d=this.overlays[u],Y.indexOf(d)>-1&&(d.highlight=!0)}}this.container.classList.add("stx-draggable")}else this.container.classList.remove("stx-draggable");this.highlightedDataSetField=this.adjustHighlightedDataSetField(this.highlightedDataSetField),this.displayDrawOK()}function $(t,i,a,r,s,n){var o=this.chart,l=this.currentPanel;r||(r=l.yAxis);var h=a.split("--\x3e"),c=h[0],u=h[1];function d(t){if(!t)return null;var e=t[c];return e&&(e[u]||0===e[u])&&(e=e[u]),s&&s.getBasis&&(e+=s.getBasis(t,c,u)),o.transformFunc&&r==o.yAxis?t.transform&&c in t.transform?((e=t.transform[c])&&(e[u]||0===e[u])&&(e=e[u]),e):o.transformFunc(this,o,e):e}u||(u="Close");var p,m,g,f,v,y=o.dataSegment[k],x=null,b=null,S=null,C=new Array(3),w=s&&s.caches[n];if(y&&w){var D;for(g=w[k],x=y.tick,(g||0===g)&&(C[0]=1),D=k-1;D>=0;D--)if(w[D]||0===w[D]){f=w[D],b=x-(k-D),C[1]=1;break}for(D=k+1;D<o.dataSegment.length;D++)if(w[D]||0===w[D]){v=w[D],S=x-(k-D),C[2]=1;break}}if(null===b&&(p=this.getPreviousBar.call(this,o,a,k))&&(b=p.tick,f=d(p)),null===S&&(m=this.getNextBar.call(this,o,a,k))&&(S=m.tick,v=d(m)),null===b&&null===S)return!1;w||(g=d(y),f=d(p),v=d(m),x=y.tick,p&&(b=p.tick),m&&(S=m.tick)),f||0===f||(f=0,b=0),v||0===v||(g||0===g?(v=g,C[2]=C[0]):(v=f,C[2]=C[1]),S=n&&o.series[n].parameters.extendToEndOfDataSet?o.dataSet.length-1:b),g||0===g||(g=v,x=S,C[0]=C[2],0===f&&0===b&&(f=g,b=x,C[1]=C[0]));var T=this.pixelFromTransformedValue.bind(this),M=this.valueFromPixel.bind(this);g=M(C[0]?g:T(g,l,r),l),f=M(C[1]?f:T(f,l,r),l),v=M(C[2]?v:T(v,l,r),l);var A=e.convertBoxToPixels(this,l.name,i),_=e.convertBoxToPixels(this,l.name,{x0:b,y0:f,x1:x,y1:g}),F=e.convertBoxToPixels(this,l.name,{x0:x,y0:g,x1:S,y1:v});return!(!e.boxIntersects(A.x0,A.y0,A.x1,A.y1,_.x0,_.y0,_.x1,_.y1,"segment")&&!e.boxIntersects(A.x0,A.y0,A.x1,A.y1,F.x0,F.y0,F.x1,F.y1,"segment"))}},e.ChartEngine.prototype.rightClickHighlighted=function(){this.runPrepend("rightClickHighlighted",arguments)||(this.deleteHighlighted(!0),this.runAppend("rightClickHighlighted",arguments))},e.ChartEngine.prototype.deleteHighlighted=function(t,i){if(!this.runPrepend("deleteHighlighted",arguments)){this.cancelTouchSingleClick=!0,e.clearCanvas(this.chart.tempCanvas,this);var a=!1===this.bypassRightClick;if(a||!this.bypassRightClick.drawing)for(var r=this.drawingObjects.length-1;r>=0;r--){var s=this.drawingObjects[r];if(s.highlighted)if(t)this.rightClickDrawing(s,i);else if(!s.permanent){if(!s.abort()){var n=this.exportDrawings();this.drawingObjects.splice(r,1),this.undoStamp(n,this.exportDrawings())}this.changeOccurred("vector")}}if(a||!this.bypassRightClick.study)for(var o in this.overlays){var l=this.overlays[o];(l.overlay||l.underlay)&&l.highlight&&!l.permanent&&(t||i?this.rightClickOverlay(o,i):this.removeOverlay(o))}var h=this.currentPanel.chart;if(a||!this.bypassRightClick.series)for(var c in h.seriesRenderers){var u=h.seriesRenderers[c];if(u.params.highlightable)for(var d=this.panels[u.params.panel],p=d&&d.yAxis.name,m=u.seriesParams.length-1;m>=0;m--){var g=u.seriesParams[m];if((u.params.highlight||g.highlight)&&!g.permanent&&(u.removeSeries(g.id),u.seriesParams.length<1))if(this.removeSeriesRenderer(u),u.params.name==p)this.electNewPanelOwner(u.params.panel);else{this.checkForEmptyPanel(u.params.panel);var f=this.getYAxisByName(d,u.params.name);f&&(f.name=f.studies[0]||f.renderers[1])}}}this.draw(),this.resizeChart(),this.clearMeasure();var v=this.controls.mSticky;v&&(v.style.display="none",v.children[0].innerHTML=""),this.runAppend("deleteHighlighted",arguments)}},e.ChartEngine.prototype.displayDragOK=function(t){function e(t){var e=this.translateIf(t.querySelector(".field").getAttribute("text")),i=this.whichYAxis(this.whichPanel(this.cy),this.cx,this.cy);i&&"all"==i.dropzone&&(e+="--\x3e"+this.translateIf(i.name)),t.querySelector(".field").innerHTML=e}var i=this.controls.dragOk;if(i){t||this.tapForHighlighting&&this.touchingEvent&&!this.anyHighlighted||this.findHighlights(this.highlightViaTap);var a=this.highlightedDraggable,r=a&&a.undraggable&&a.undraggable(this),s=this.cx,n=this.cy;if(!t){if(a&&!r&&this.longHoldTookEffect&&!this.cancelLongHold){var o=a.inputs&&a.inputs.display||a.params&&(a.params.display||a.params.name)||a.name;i.querySelector(".field").setAttribute("text",o),e.call(this,i),i.style.display="inline-block",this.draw(),this.displaySticky(),this.grabStartYAxis?this.container.classList.replace("stx-drag-chart","stx-drag-axis"):this.container.classList.replace("stx-drag-chart","stx-drag-series")}else for(var l in i.style.display="none",this.draw(),this.container.classList.remove("stx-drag-series"),this.container.classList.remove("stx-drag-axis"),this.panels){var h,c=this.panels[l].subholder.classList;for(c.remove("dropzone"),c.remove("all"),c.remove("left"),c.remove("right"),c.remove("top"),c.remove("bottom"),h=0;h<this.panels[l].yaxisLHS.length;h++)this.panels[l].yaxisLHS[h].dropzone=null;for(h=0;h<this.panels[l].yaxisRHS.length;h++)this.panels[l].yaxisRHS[h].dropzone=null}this.draw()}if(a){var u=n+i.offsetHeight,d=Math.max(0,s-i.offsetWidth);i.style.top=u+"px",i.style.left=d+"px",e.call(this,i)}}},e.ChartEngine.prototype.displayDrawOK=function(){var t=this.controls.drawOk;if(t&&e.Drawing){var i=e.Drawing[this.currentVectorParameters.vectorType];if(i&&(i=new i),this.highlightedDataSetField&&i&&i.getYValue){t.style.display="inline-block";var a=this.cy+t.offsetHeight,r=this.cx-t.offsetWidth;t.style.top=a+"px",t.style.left=r+"px",t.querySelector(".field").innerHTML=this.translateIf(this.highlightedDataSetField)}else t.style.display="none"}},e.ChartEngine.prototype.mouseWheel=function(t){if(!this.runPrepend("mouseWheel",arguments)&&(t.preventDefault&&t.preventDefault(),""===this.openDialog)){var i=t.deltaX,a=t.deltaY;if(Math.abs(a)>Math.abs(i)?i=0:a=0,this.lastMouseWheelEvent=Date.now(),0!==Math.abs(i)||0!==Math.abs(a)){if(this.allowSideswipe&&0!==i){this.lastMove="horizontal";var r=i;return r>50&&(r=50),r<-50&&(r=-50),this.grabbingScreen=!0,this.currentPanel||(this.currentPanel=this.chart.panel),this.grabStartX=e.ChartEngine.crosshairX,this.grabStartY=e.ChartEngine.crosshairY,this.grabStartScrollX=this.chart.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartMicropixels=this.micropixels,this.grabStartPanel=this.currentPanel,this.mousemoveinner(e.ChartEngine.crosshairX-r,e.ChartEngine.crosshairY),this.updateChartAccessories(),void(this.grabbingScreen=!1)}if(this.lastMove="vertical",this.allowZoom&&this.displayInitialized){a||("mousewheel"==e.wheelEvent?(a=-1/40*t.wheelDelta,t.wheelDeltaX&&(i=-1/40*t.wheelDeltaX)):a=t.detail),void 0===t.deltaMode&&(t.deltaMode="MozMousePixelScroll"==t.type?0:1);var s=-a;1==t.deltaMode&&(s*=33);var n=null,o=null;if(this.mouseWheelAcceleration){var l=Math.max(Math.pow(Math.abs(s),.3),1);n=1-.1*l,o=1+.2*l}if(this.zoomInitiatedByMouseWheel=!0,s>0?this.reverseMouseWheel?this.zoomOut(null,o):this.zoomIn(null,n):s<0&&(this.reverseMouseWheel?this.zoomIn(null,n):this.zoomOut(null,o)),!this.runAppend("mouseWheel",arguments))return!1}}}},e.ChartEngine.handleContextMenu=function(t){for(var i=0;i<e.ChartEngine.registeredContainers.length;i++){var a=e.ChartEngine.registeredContainers[i].stx;if(a&&a.anyHighlighted)return t.preventDefault&&t.preventDefault(),!1}},"undefined"!=typeof document&&document.addEventListener("contextmenu",e.ChartEngine.handleContextMenu),e.ChartEngine.htmlControls={annotationSave:'<span class="stx-btn stx_annotation_save" style="display: none;">save</span>',annotationCancel:'<span class="stx-btn stx_annotation_cancel" style="display: none; margin-left:10px;">cancel</span>',mSticky:'<div class="stx_sticky"> <span class="mStickyInterior"></span> <span class="mStickyRightClick"><span class="overlayEdit stx-btn" style="display:none"><span>&nbsp;</span></span> <span class="overlayTrashCan stx-btn" style="display:none"><span>&nbsp;</span></span> <span class="mouseDeleteInstructions"><span>(</span><span class="mouseDeleteText">right-click to delete</span><span class="mouseManageText">right-click to manage</span><span class="dragAnchorText">drag to change anchor time</span><span>)</span></span></span><span class="stickyLongPressText">(long-press to drag)</span></div>',drawOk:'<div class="stx_draw_ok"><div class="icon"></div><div class="field"></div></div>',dragOk:'<div class="stx_drag_ok"><div class="icon"></div><div class="field"></div></div>',crossX:'<div class="stx_crosshair stx_crosshair_x" style="display: none;"></div>',crossY:'<div class="stx_crosshair stx_crosshair_y" style="display: none;"></div>',chartControls:'<div class="stx_chart_controls" style="display: none; bottom: 22px;"><div class="chartSize"><span class="stx-zoom-out"></span><span class="stx-zoom-in"></span></div></div>',home:'<div class="stx_jump_today" style="display:none"><span></span></div>',floatDate:'<div class="stx-float-date" style="visibility: hidden;"></div>',handleTemplate:'<div class="stx-ico-handle" style="display: none;"><span></span></div> ',iconsTemplate:'<div class="stx-panel-control"><div class="stx-panel-title"></div><div class="stx-panel-legend"></div><div class="stx-btn-panel"><span class="stx-ico-up"></span></div><div class="stx-btn-panel"><span class="stx-ico-focus"></span></div><div class="stx-btn-panel"><span class="stx-ico-down"></span></div><div class="stx-btn-panel"><span class="stx-ico-edit"></span></div><div class="stx-btn-panel"><span class="stx-ico-close"></span></div></div>',baselineHandle:'<div class="stx-baseline-handle" style="display: none;"></div>',notificationTray:'<div class="stx_notification_tray"><template><div><span class="icon"></span><span class="message"></span></div></template></div>'},e.ChartEngine.prototype.registerChartControl=function(t,i,a){var r=this.controls;if(r&&r.chartControls&&!r.chartControls.querySelector("."+t)){var s=null,n=r.chartControls.querySelector(".stx-zoom-in");return n?((s=document.createElement("span")).innerHTML='<span class="stx-tooltip">'+i+"</span>",s.className="stx-chart-control-button "+t,n.parentNode.appendChild(s),a&&e.safeClickTouch(s,a),e.touchDevice||this.makeModal(s),s):void 0}},e.ChartEngine.prototype.zoomOut=function(t,e){if(!this.runPrepend("zoomOut",arguments)){this.preferences.zoomOutSpeed?e=this.preferences.zoomOutSpeed:e||(e=1/.7),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var i=this;for(var a in this.charts){var r=this.charts[a],s=r.width*e/this.layout.candleWidth;!1===r.allowScrollFuture&&!1===r.allowScrollPast&&s>r.dataSet.length&&(s=r.dataSet.length);var n=this.chart.width/s;this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(o(r),this.layout.candleWidth,n)}}function o(t){return function(e){if(i.zoomSet(e,t),i.animations.zoom.hasCompleted){if(i.runAppend("zoomOut",arguments))return;i.changeOccurred("layout"),i.continuousZoom&&i.continuousZoom.execute(!0)}}}},e.ChartEngine.prototype.zoomIn=function(t,e){if(!this.runPrepend("zoomIn",arguments)){this.preferences.zoomInSpeed?e=this.preferences.zoomInSpeed:e||(e=.7),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var i=this;for(var a in this.charts){var r=this.charts[a],s=r.width*e/this.layout.candleWidth;r.maxTicks-s<1&&(s=r.maxTicks-1),s<this.minimumZoomTicks&&(s=this.minimumZoomTicks);var n=this.chart.width/s;this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(o(r),this.layout.candleWidth,n)}}function o(t){return function(e){if(i.zoomSet(e,t),i.animations.zoom.hasCompleted){if(i.runAppend("zoomIn",arguments))return;i.changeOccurred("layout"),i.continuousZoom&&i.continuousZoom.execute()}}}},e.ChartEngine.prototype.createCrosshairs=function(){if(!this.runPrepend("createCrosshairs",arguments)&&!(!this.manageTouchAndMouse||this.mainSeriesRenderer&&this.mainSeriesRenderer.nonInteractive)){var t=this.controls.crossX,e=this.controls.crossY;t&&(t.onmousedown||(t.onmousedown=function(t){return t.preventDefault&&t.preventDefault(),!1})),e&&(e.onmousedown||(e.onmousedown=function(t){return t.preventDefault&&t.preventDefault(),!1})),this.runAppend("createCrosshairs",arguments)}};let i=!1;e.ChartEngine.prototype.mousemoveinner=e.ChartEngine.prototype.mousemoveinner||function(t,e){i||console.error("interaction feature requires activating movement feature."),i=!0}},c=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Marker||(e.ChartEngine.helpersToRegister.push((function(t){t.markerHelper={chartMap:{},classMap:{},domMarkers:[],highlighted:[]}})),e.ChartEngine.prototype.addToHolder=function(t){var i=this.panels[t.params.panelName];if(i){var a=t.params,r=t.node,s=t.stxNodeCreator;s&&s.prepareForHolder&&(r=s.prepareForHolder(t)),a.chartContainer?this.container.appendChild(t.node):a.includeAxis?i.holder.appendChild(t.node):i.subholder.appendChild(r),t.chart=i.chart,s&&s.addToHolder&&s.addToHolder(t),s&&s.expand&&e.Marker.initializeScrollBehavior(s)}},e.ChartEngine.prototype.getMarkerArray=function(t,e){var i=[];for(var a in this.markers)for(var r=0;r<this.markers[a].length;r++){var s=this.markers[a][r];"panelName"==t?s.params.panelName==e&&i.push(s):"label"==t?a==e&&i.push(s):"all"==t&&i.push(s)}return i},e.ChartEngine.prototype.removeFromHolder=function(t){var e=this.panels[t.params.panelName];e&&(t.node.parentNode==e.holder?e.holder.removeChild(t.node):t.node.parentNode==e.subholder?e.subholder.removeChild(t.node):t.node.parentNode==this.container&&this.container.removeChild(t.node));var i=this.markers[t.params.label];if(i){var a;for(a=0;a<i.length;a++)if(i[a]===t){i.splice(a,1);break}var r=this.markerHelper.chartMap[t.chart.name];if(r)for(a=0;a<r.markers.length;a++)if(r.markers[a]===t){r.markers.splice(a,1);break}var s=this.markerHelper.classMap[t.className];if(s){var n=s[t.params.panelName];if(n)for(a=0;a<n.length;a++)if(n[a]===t){n.splice(a,1);break}}}},e.ChartEngine.prototype.moveMarkers=function(t,e){for(var i=this.getMarkerArray("panelName",t),a=0;a<i.length;a++)i[a].params.panelName=e;for(var r in this.markerHelper.classMap){var s=this.markerHelper.classMap[r][t];s&&(this.markerHelper.classMap[r][e]=s,delete this.markerHelper.classMap[r][t])}},e.ChartEngine.prototype.establishMarkerTicks=function(){var t=this.markerHelper.chartMap;for(var e in t){var i=t[e];if(i.dataSetLength!=this.charts[e].dataSet.length)for(var a=0;a<i.markers.length;a++)this.setMarkerTick(i.markers[a])}},e.ChartEngine.prototype.futureTickIfDisplayed=function(t){var e=t.chart;if(!(e.dataSet.length<1)){var i=e.xaxis[e.xaxis.length-1].DT;if(i=new Date(i.getTime()-6e4*this.timeZoneOffset),!(t.params.x>i))for(var a,r,s=e.maxTicks-e.dataSegment.length,n=e.dataSet.length+s,o=new Date(+e.dataSet[e.dataSet.length-1].DT),l=this.standardMarketIterator(o,null,e),h=t.params.x.getTime(),c=e.dataSet.length;c<n;c++){if(a=o.getTime(),(r=(o=l.next()).getTime())==h)return void(t.tick=c);if(r>h&&a<h)return void(t.tick=Math.max(c-1,0))}}},e.ChartEngine.prototype.setMarkerTick=function(t){var e=t.chart;if("master"==t.params.xPositioner&&t.params.x)t.tick=Math.floor(t.params.x/this.layout.periodicity);else if("date"==t.params.xPositioner&&t.params.x){for(var i,a,r=t.params.x.getTime(),s=0;s<e.dataSet.length;s++){if(i=a=e.dataSet[s].DT.getTime(),s>0&&(i=e.dataSet[s-1].DT.getTime()),a==r)return void(t.tick=s);if(a>r&&i<r)return void(t.tick=Math.max(s-1,0));if(r<a)return void(t.tick=null)}if(e.dataSet.length<1)return;new Date(+e.dataSet[s-1].DT).getTime()<r&&(t.params.future=!0),t.tick=null}},e.ChartEngine.prototype.positionMarkers=function(){var t=this,e=this.chart;if(t.markerHelper){this.markerDelay||0===this.markerDelay?this.markerTimeout||(this.markerTimeout=setTimeout(l,this.markerDelay)):l();var i=this.getFirstLastDataRecord(e.dataSegment,"tick"),a=this.getFirstLastDataRecord(e.dataSegment,"tick",!0);if(i&&a)for(var r=this.getMarkerArray("all"),s=0;s<r.length;s++){var n=r[s],o=n.stxNodeCreator;i.tick<=n.tick&&n.tick<=a.tick?o&&o.drawMarker&&o.drawMarker(n):n.attached&&o.expand&&(o.expand.style.visibility="hidden")}}function l(){if(!t.runPrepend("positionMarkers",arguments)){for(var e in t.markerTimeout=null,t.markerHelper.classMap)for(var i in t.markerHelper.classMap[e]){var a=t.markerHelper.classMap[e][i],r=t.panels[i];if(a.length){var s={stx:t,arr:a,panel:r};s.firstTick=r.chart.dataSet.length-r.chart.scroll,s.lastTick=s.firstTick+r.chart.dataSegment.length;var n=a[0].constructor.placementFunction;n?n(s):t.defaultMarkerPlacement(s)}}t.runAppend("positionMarkers",arguments)}}},e.Marker=e.Marker||function(t){this.params={xPositioner:"date",yPositioner:"value",panelName:"chart",permanent:!1,label:"generic",includeAxis:!1},e.extend(this.params,t),this.params.node||(this.params.node=document.createElement("DIV"));var i=this.params.stx;if(i){this.className||(this.className="CIQ.Marker"),e.derivedFrom(this.params.node,e.Marker.NodeCreator)?(this.stxNodeCreator=this.params.node,this.node=this.stxNodeCreator.node):this.node=this.params.node;var a=this.params.label;i.markers[a]||(i.markers[a]=[]),i.markers[a].push(this);var r=i.panels[this.params.panelName];this.chart=r.chart,i.markerHelper.chartMap[this.chart.name]||(i.markerHelper.chartMap[this.chart.name]={dataSetLength:0,markers:[]}),i.markerHelper.chartMap[this.chart.name].markers.push(this);var s=i.markerHelper.classMap[this.className];s||(s=i.markerHelper.classMap[this.className]={}),s[this.params.panelName]||(s[this.params.panelName]=[]),s[this.params.panelName].push(this),this.stxNodeCreator&&this.stxNodeCreator.deferAttach||i.addToHolder(this),i.setMarkerTick(this),this.stxNodeCreator&&this.stxNodeCreator.drawMarker&&this.stxNodeCreator.drawMarker(this)}else console.log("Marker created without specifying stx")},e.Marker.prototype.remove=function(){this.params.stx.removeFromHolder(this)},e.Marker.prototype.click=function(t){"number"==typeof arguments[0]&&(t={cx:arguments[0],cy:arguments[1],panel:arguments[3]});let{cx:e,cy:i,panel:a}=t;if(this.params.stx){var r=this.params.node;r.click&&r.click(e,i,this,a)}},e.Marker.prototype.doubleClick=function(t){let{cx:e,cy:i,panel:a}=t;return!1},e.Marker.prototype.render=function(){var t=[this],e={stx:this.params.stx,arr:t,panel:this.params.stx.panels[this.params.panelName],showClass:this.showClass};this.constructor.placementFunction(e)},e.Marker.removeByLabel=function(t,e){for(var i=t.getMarkerArray("label",e),a=0;a<i.length;a++){var r=i[a];t.removeFromHolder(r),r.stxNodeCreator&&r.stxNodeCreator.remove&&r.stxNodeCreator.remove(r)}t.draw()},e.Marker.positionContentVerticalAndHorizontal=function(t){var i=t.querySelectorAll(".stx-marker-expand")[0];if(i&&e.trulyVisible(i)){var a=i.offsetHeight,r=i.style;r.left=r.right="",r.bottom=r.top="";var s=getComputedStyle(i),n=s.left,o=s.bottom,l=t.offsetLeft+parseInt(n,10),h=parseInt(o,10),c=t.offsetTop-(h+a-t.offsetHeight),u=t.parentNode.offsetWidth,d=t.parentNode.offsetHeight;l+i.offsetWidth>u&&(r.right=n,r.left="auto"),t.offsetTop<=d?c>d-a&&(r.top=d-t.offsetTop-a+"px",r.bottom="auto"):r.top=d+"px",t.offsetTop+t.offsetHeight>=0?c<0&&(r.top=-t.offsetTop+"px",r.bottom="auto"):r.bottom="0px"}},e.Marker.initializeScrollBehavior=function(t){const{expand:i}=t;if(!i)return;i.addEventListener(e.wheelEvent,(t=>t.stopPropagation()));const{scrollbarStyling:a}=e.UI||{};a?a.refresh(i):i.style.overflowY="scroll"},e.ChartEngine.prototype.getBarBounds=function(t){var e,i,a,r;this.layout.chartType;return e="pandf"==this.layout.aggregationType?{high:Math.max(t.pfOpen,t.pfClose),low:Math.min(t.pfOpen,t.pfClose)}:{high:t.High,low:t.Low},t.markerHigh&&(e.high=t.markerHigh),t.markerLow&&(e.low=t.markerLow),void 0===t.Open&&(i=t.Close),void 0===t.High&&(a=Math.max(t.Open||i,t.Close)),void 0===t.Low&&(r=Math.min(t.Open||i,t.Close)),e.high||0===e.high||(e.high=a),e.low||0===e.low||(e.low=r),e},e.ChartEngine.prototype.defaultMarkerPlacement=function(t){var i=t.panel,a=t.yAxis?t.yAxis:t.panel.yAxis,r=i.chart,s=t.stx,n=s.chart.highLowBars,o=r.defaultPlotField;o&&!n||(o="Close");for(var l={},h=0;h<t.arr.length;h++){var c=t.arr[h],u=c.params;if(!c.params.box){var d=c.node;c.clientWidth||(c.clientWidth=d.clientWidth),c.clientHeight||(c.clientHeight=d.clientHeight);var p=null,m=u.xPositioner,g=u.yPositioner,f=c.tick,v=r.dataSet,y=c.clientWidth;if("none"!=m){if("bar"==m&&u.x){if(u.x<r.xaxis.length){var x=r.xaxis[u.x];x&&(p=x.data)}d.style.left=Math.round(s.pixelFromBar(u.x,r)-y/2)+1+"px"}else{if(!f&&0!==f){if(!(u.future&&r.scroll<r.maxTicks)){d.style.left="-1000px";continue}if(s.futureTickIfDisplayed(c),!(f=c.tick)&&0!==f){d.style.left="-1000px";continue}}if(f<v.length&&(p=v[f]),c.leftpx=Math.round(s.pixelFromTick(f,r)-r.left-y/2),c.rightEdge=c.leftpx+y,d.style.left=c.leftpx+"px",f<t.firstTick&&c.rightEdge<r.left-50)continue}p||(p=v[v.length-1])}else if(g.indexOf("candle")>-1){var b=getComputedStyle(d).left;if(b){var S=s.barFromPixel(parseInt(b,10),r);S>=0&&((p=r.xaxis[S].data)||(p=v[v.length-1]))}}d.style.top="auto";var C,w=u.y,k=c.clientHeight;if("none"!=g){var D,T=g+"-"+d.style.left,M=u.chartContainer?s.height:i.yAxis.bottom,A=0;void 0===l[T]&&(l[T]=0),D=l[T],l[T]+=k,"value"!=g||!w&&0!==w?"below_candle"!=g&&"under_candle"!=g||!p?"on_candle"==g&&p?(C=p[o],n&&(C=(p.Low+p.High)/2),A=Math.round(M-s.pixelFromPrice(C,i,a)-k/2-D)+"px"):"top"==g?A=Math.round(M-k-D-i.top)+"px":"bottom"==g?A=Math.round(D)+"px":p&&(C=p[o],n&&(C=s.getBarBounds(p)[a.flipped?"low":"high"]),A=Math.round(M-s.pixelFromPrice(C,i,a)+D)+"px"):(C=p[o],n&&(C=s.getBarBounds(p)[a.flipped?"high":"low"]),A=Math.round(M-s.pixelFromPrice(C,i,a)-k-D)+"px"):A=Math.round(M-s.pixelFromPrice(w,i,a)-k/2)+"px",d.style.bottom!=A&&(d.style.bottom=A)}e.Marker.positionContentVerticalAndHorizontal(d)}}},e.Marker.NodeCreator=function(){},e.Marker.NodeCreator.toNode=function(){return this.node},e.Marker.Simple=function(t){var i=this.node=document.createElement("div");i.className="stx-marker",i.classList.add(t.type),t.category&&i.classList.add(t.category);var a,r=e.newChild(i,"div","stx-visual");if(e.newChild(i,"div","stx-stem"),"callout"==t.type){var s=e.newChild(r,"div","stx-marker-content");e.newChild(s,"h4",null,t.headline),a=e.newChild(s,"div","stx-marker-expand"),e.newChild(a,"p",null,t.story)}else a=e.newChild(i,"div","stx-marker-expand"),e.newChild(a,"h4",null,t.headline),e.newChild(a,"p",null,t.story),e.safeClickTouch(a,(function(t){i.classList.toggle("highlight")}));function n(){e.Marker.positionContentVerticalAndHorizontal(i)}e.safeClickTouch(r,(function(t){i.classList.toggle("highlight"),setTimeout(n,10)})),this.nodeType="Simple",this.expand=a},e.inheritsFrom(e.Marker.Simple,e.Marker.NodeCreator,!1))},u=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,i="undefined"!=typeof _timezoneJS?_timezoneJS:t.timezoneJS,a=36e5,r=864e5,s=e.Market;e.Market=function(t){this.market_def=!1,this.rules=!1,this.normalHours=[],this.extraHours=[],this.class_name="Market",i.Date?this.tz_lib=i.Date:this.tz_lib=Date,this.market_tz="",this.hour_aligned=!1,this.convertOnDaily=!1,this.enabled_by_default=!1,void 0!==t&&t&&!e.isEmpty(t)&&(t.market_definition&&(t=t.market_definition),t.rules&&(this.rules=t.rules),t.market_tz&&(this.market_tz=t.market_tz),t.convertOnDaily&&(this.convertOnDaily=t.convertOnDaily),t.hour_aligned,this.hour_aligned=t.hour_aligned,void 0!==t.beginningDayOfWeek&&(this.beginningDayOfWeek=t.beginningDayOfWeek),void 0!==t.enabled_by_default&&t.enabled_by_default instanceof Array&&(this.enabled_by_default=t.enabled_by_default),this.market_def=t,void 0===this.market_def.name&&(this.market_def.name="no market name specified"),e.Market._createTimeSegments(this),this.getSessionNames())},e.Market.Symbology=function(){},e.Market.Symbology.isForeignSymbol=function(t){return!1},e.Market.Symbology.isFuturesSymbol=function(t){return!1},e.Market.Symbology.isRateSymbol=function(t){return!1},e.Market.Symbology.isForexSymbol=function(t){return!1},e.Market.Symbology.isForexMetal=function(t,e){return!1},e.Market.Symbology.isForexFuturesSymbol=function(t){return!!e.Market.Symbology.isForexSymbol(t)||!!e.Market.Symbology.isFuturesSymbol(t)},e.Market.Symbology.factory=function(t){return null},e.Market.Symbology.encodeTermStructureInstrumentSymbol=function(t,e){console.warn("You are trying to call `CIQ.Market.Symbology.encodeTermStructureInstrumentSymbol` but have not implemented it.")},s&&e.extend(e.Market,s),e.Market.prototype.sessions=null,e.Market.prototype.beginningDayOfWeek=0,e.Market.prototype.getSessionNames=function(){if(this.rules){if(!this.sessions){var t=[],e=[];this.rules.map((function(i){i.name&&-1===t.indexOf(i.name)&&(t.push(i.name),e.push({name:i.name,enabled:!!i.enabled&&i.enabled}))})),this.sessions=e}}else this.sessions=[];return this.sessions.slice()},e.Market.prototype._find_next_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz});if(this._wasOpenIntraDay(i)){var r=this.zseg_match.close_parts.hours,s=this.zseg_match.close_parts.minutes;i.setHours(r),i.setMinutes(s),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})}return a.next()},e.Market.prototype._find_prev_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz}),r=this._wasOpenIntraDay(i);if(null===r?(i=new Date(i-6e4),r=this._wasOpenIntraDay(i)):(e&&i.getHours()===this.zseg_match.open_parts.hours&&i.getMinutes()===this.zseg_match.open_parts.minutes||!e&&i.getHours()===this.zseg_match.close_parts.hours&&i.getMinutes()===this.zseg_match.close_parts.minutes)&&(i=a.previous()),r){var s=this.zseg_match.open_parts.hours,n=this.zseg_match.open_parts.minutes;return i.setHours(s),i.setMinutes(n),i=(a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})).previous(),this.zseg_match.close_parts.hours===s&&this.zseg_match.close_parts.minutes===n?e?a.next():i:this.zseg_match.adjacent_child?i:e?a.next():i}return a.previous()},e.Market.prototype.disableSession=function(t,e){var i=!1;if(void 0!==e&&e&&(i=!0),t){for(var a=0;a<this.normalHours.length;a++)this.normalHours[a].name===t&&(this.normalHours[a].enabled=i);for(a=0;a<this.extraHours.length;a++)this.extraHours[a].name===t&&(this.extraHours[a].enabled=i)}},e.Market.prototype.enableSession=function(t){this.disableSession(t,"enable_instead")},e.Market.prototype.enableAllAvailableSessions=function(){for(var t=this.getSessionNames(),e=0;e<t.length;e++)this.enableSession(t[e].name)},e.Market.prototype.getClose=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name===e)return r.setHours(this.zseg_match.close_parts.hours,this.zseg_match.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var s=this.zseg_match;s.child_;)s=s.child_;for(;!s.enabled;)s=s.parent_;return r.setHours(s.close_parts.hours,s.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},e.Market.prototype.getNextClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;(t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),this._wasOpenIntraDay(a))||(a=this.newIterator({begin:a,interval:1,inZone:this.market_tz,outZone:this.market_tz}).next());for(var r=a.getDate(),s=this.zseg_match;s.adjacent_child;)s=s.adjacent_child,r+=1;return a.setDate(r),a.setHours(s.close_parts.hours,s.close_parts.minutes,0,0),a=this._convertFromMarketTZ(a,i)},e.Market.prototype.getNextOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_next_segment(a),this.zseg_match.adjacent_parent?(a=this.getNextOpen(a,this.market_tz,this.market_tz),a=this._convertFromMarketTZ(a,i)):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getOpen=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name==e)return r.setHours(this.zseg_match.open_parts.hours,this.zseg_match.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var s=this.zseg_match;s.parent_;)s=s.parent_;for(;!s.enabled;)s=s.child_;return r.setHours(s.open_parts.hours,s.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},e.Market.prototype.getNormalOpen=function(){const{market_def:t,rules:e}=this;return t&&e?t.normal_daily_open?t.normal_daily_open:"FOREX"===t.name?"17:00":e.find((t=>{let{name:e}=t;return!e||""===e})).open:"00:00"},e.Market.prototype.getNormalClose=function(){const{market_def:t,rules:e}=this;return t&&e?t.normal_daily_close?t.normal_daily_close:"FOREX"===t.name?"17:00":e.filter((t=>{let{dayofweek:e,name:i}=t;return e&&(!i||""===i)})).pop().close:"24:00"},e.Market.prototype.getPreviousClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!1),this.zseg_match.adjacent_child?this.getPreviousClose(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.close_parts.hours),a.setMinutes(this.zseg_match.close_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getPreviousOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!0),this.zseg_match.adjacent_parent?this.getPreviousOpen(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getSession=function(t,e){return t=this._convertToMarketTZ(t,e),this._wasOpenIntraDay(t)&&this.zseg_match?this.zseg_match.name:null},e.Market.prototype.marketZoneNow=function(){return this._convertToMarketTZ(new Date)},e.Market.prototype.isHourAligned=function(){return this.hour_aligned},e.Market.prototype.isOpen=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenIntraDay(t)},e.Market.prototype.isMarketDay=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenDaily(t)},e.Market.prototype.isMarketDate=function(t){return this._wasOpenDaily(t)},e.Market.prototype.newIterator=function(t){var i=!1;t.periodicity?i=t.periodicity:t.multiple&&(i=t.multiple);var a=t.interval;return a||(a="minute"),"hour"==a&&(a=60),i||(i=1),t.begin||(t.begin=new Date,t.inZone=null),a==parseInt(a,10)&&(a=parseInt(a,10),t.periodicity<1/60?(i=i*a*6e4,a="millisecond"):t.periodicity<1?(i=i*a*60,a="second"):(i*=a,a="minute")),t.timeUnit&&("millisecond"===t.timeUnit||"second"===t.timeUnit?a=t.timeUnit:"tick"===t.timeUnit&&(a="second")),"tick"==a&&(a="second"),t.interval=a,t.multiple=i,t.market=this,new e.Market.Iterator(t)},e.Market.prototype._wasOpenDaily=function(t){return this._was_open(t,!1)},e.Market.prototype._wasOpenIntraDay=function(t){return this._was_open(t,!0)},e.Market.prototype._was_open=function(t,e){var i=this.zseg_match;if(this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null,!this.market_def||!this.rules)return this.zclose_hour=24,!0;var a,r,s=!1,n=!1,o=t.getFullYear(),l=t.getMonth()+1,h=t.getDay(),c=t.getDate(),u=60*t.getHours()*60+60*t.getMinutes()+t.getSeconds();for(void 0===e&&(e=!0),r=0;r<this.normalHours.length;r++)if((a=this.normalHours[r]).enabled&&((s=a.dayofweek===h)&&e&&(s=u>=a.open&&u<a.close),s)){if(!e&&this.zseg_match&&(a.open_parts.hours>this.zopen_hour||a.open_parts.hours==this.zopen_hour&&a.open_parts.minutes>this.zopen_minute))continue;if(a===i||a.adjacent_parent||a.adjacent_child||(this.shouldResetToBeginningOfSegment=!0),this.zopen_hour=a.open_parts.hours,this.zopen_minute=a.open_parts.minutes,this.zclose_hour=a.close_parts.hours,this.zclose_minute=a.close_parts.minutes,this.zmatch_open=u===a.open,this.zseg_match=a,e)break}for(r=0;r<this.extraHours.length;r++)if((a=this.extraHours[r]).enabled&&("*"===a.year||o===a.year)&&l===a.month&&c===a.day&&(!(n=!e&&a.open||u>=a.open&&u<a.close)&&this.zseg_match&&(s=!1,this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null),n)){if(!e&&this.zseg_match&&(a.open_parts.hours>this.zopen_hour||a.open_parts.hours==this.zopen_hour&&a.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=a.open_parts.hours,this.zopen_minute=a.open_parts.minutes,this.zclose_hour=a.close_parts.hours,this.zclose_minute=a.close_parts.minutes,this.zmatch_open=u===a.open,this.zseg_match=a,e)break}return this.zseg_match},e.Market.prototype._wasClosed=function(t){return!this._was_open(t,!0)},e.Market.prototype._wasOpen=function(t){return this._was_open(t,!0)},e.Market.prototype._tzDifferenceMillis=function(t,e,i){var a=t;return 60*(t.getTimezoneOffset()-a.getTimezoneOffset())*1e3},e.Market._createTimeSegments=function(t){for(var e,i=function(t,i){if(24===t.close_parts.hours&&0===i.open_parts.hours&&0===i.open_parts.minutes){if(e.dayofweek===s.dayofweek-1)return!0;if(6===e.dayofweek&&0===s.dayofweek)return!0}return!1},a=0;a<t.rules.length;a++){var r=JSON.parse(JSON.stringify(t.rules[a]));void 0===r.open&&void 0===r.close&&(r.open="00:00",r.close="00:00"),r.hasOwnProperty("name")||(r.name="");try{var s;if(void 0!==r.dayofweek?(r.year="*",s=n._createDayOfWeekSegment(t,r),e&&(e.dayofweek===s.dayofweek?(e.child_=s,s.parent_=e):i(e,s)&&(e.adjacent_child=s,s.adjacent_parent=e)),e=s):void 0!==r.date?(r.isDayOfWeek=!1,r.dayofweek=-1,s=n._createDateTimeSegment(t,r)):console.log("Error, unknown rule type "+r),t.enabled_by_default)for(var o=0;o<t.enabled_by_default.length;o++){var l=t.enabled_by_default[o];if(s.name===l){s.enabled=!0;break}}}catch(t){console.log("Error, creating market rules "+t)}}},e.Market._timeSegment={};var n=e.Market._timeSegment;n.re_wild_card_iso=/^(\*)-(\d\d)-(\d\d)$/,n.re_regular_iso=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,n.re_split_hours_minutes=/^(\d\d):(\d\d)$/,n.re_split_hour_minutes=/^(\d):(\d\d)$/,n._hashCode=function(t){var e,i,a=0;if(0===t.length)return a;for(e=0,i=t.length;e<i;e++)a=(a<<5)-a+t.charCodeAt(e),a|=0;return a},n._splitHoursMinutes=function(t){var e=n.re_split_hour_minutes.exec(t),i={hours:NaN,minutes:NaN};return null===e&&null===(e=n.re_split_hours_minutes.exec(t))||(i.hours=parseInt(e[1],10),i.minutes=parseInt(e[2],10)),i},n._createDayOfWeekSegment=function(t,e){var i={name:e.name,isDayOfWeek:!0,dayofweek:e.dayofweek,date_str:"*",open_parts:n._splitHoursMinutes(e.open),close_parts:n._splitHoursMinutes(e.close),open:n._secSinceMidnight(t,e.open,!0),close:n._secSinceMidnight(t,e.close,!1),child_:!1,parent_:!1,adjacent_child:!1,adjacent_parent:!1,enabled:!1};return""===i.name&&(i.enabled=!0),i.hash_code=this._hashCode((i.open+i.close).toString()),t.normalHours.push(i),i},n._createDateTimeSegment=function(t,e){var i,a=this.re_regular_iso.exec(e.date);if(null===a){if(null===(a=this.re_wild_card_iso.exec(e.date)))return void console.log("Warning: invalid date format on rule -> "+e.date);i="*"}else i=parseInt(a[1],10);var r={name:e.name,isDayOfWeek:!1,dayofweek:-1,year:i,month:parseInt(a[2],10),day:parseInt(a[3],10),date_str:e.date,open_parts:n._splitHoursMinutes(e.open),close_parts:n._splitHoursMinutes(e.close),open:n._secSinceMidnight(t,e.open,!0),close:n._secSinceMidnight(t,e.close,!1),enabled:!1};return""===r.name&&(r.enabled=!0),r.hash_key=this._hashCode(r.date_str+r.open+r.close),t.extraHours.push(r),r},n._secSinceMidnight=function(t,e,i){var a=e.split(":"),r=parseInt(a[0],10),s=60*r*60+60*parseInt(a[1],10);return i||24===r&&(s=60*r*60+1),s},e.Market.prototype._convertToMarketTZ=function(t,e){var i;return(i=e?new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e):new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())).setTimezone&&i.setTimezone(this.market_tz),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())},e.Market.prototype._convertFromMarketTZ=function(t,e){var i=new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),this.market_tz);return e?(i.setTimezone&&i.setTimezone(e),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):new Date(i.getTime())},e.Market.Iterator=function(t){this.market=t.market,this.begin=t.begin,this.interval=t.interval,this.multiple=t.multiple,this.inZone=t.inZone,this.outZone=t.outZone,this.clock=new e.Market.Iterator._Clock(t.market,t.interval,t.multiple),this.intraDay=this.clock.intra_day,this.intraDay&&(this.begin=this.market._convertToMarketTZ(this.begin,t.inZone)),this.clock._setStart(this.begin),this.clock.minutes_aligned=!1},e.Market.Iterator.prototype.date=function(){return this.clock._date()},e.Market.Iterator.prototype.futureTick=function(t){this.clock.skip=1;var e,i=0;e=this.intraDay?this.market._convertToMarketTZ(t.end,this.inZone).getTime():t.end.getTime();var a=this.clock.ctime;if(e===a)return i;var r=2,s=0;t.sample_size&&(r=t.sample_size);var n,o=(new Date).getTime();if(e>a){for(this.clock.forward=!0;this.clock.ctime<e;)if(i+=1,s+=1,this.clock._findNext(),1e3===s&&(s=0,(new Date).getTime()-o>=r)){n=(this.clock.ctime-a)/i,i=Math.floor((e-a)/n);break}this.clock.ctime>e&&i--}else for(this.clock.forward=!1;this.clock.ctime>e;)if(i+=1,s+=1,this.clock._findPrevious(),1e3===s&&(s=0,(new Date).getTime()-o>=r)){n=(a-this.clock.ctime)/i,i=Math.floor((a-e)/n);break}return i},e.Market.Iterator.prototype.isHourAligned=function(){return!this.intraDay||this.market.isHourAligned()},e.Market.Iterator.prototype.isOpen=function(){return this.market.isOpen()},e.Market.Iterator.prototype.next=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!0;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findNext();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator.prototype.peek=function(){return this.clock._peek()},e.Market.Iterator.prototype.previous=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!1;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findPrevious();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator._Clock=function(t,e,i){i%60==0&&"second"===e&&(e="minute",i/=60),this.market=t,this.interval=e,this.multiple=i,this.intra_day=!1,this.intervals=[],this.max_iters=10080;var s=r,n=this._dayImpl;"millisecond"===e?(n=this._millisImpl,s=1):"second"===e?(n=this._secondImpl,s=1e3):"minute"===e?(n=this._minuteImpl,s=6e4):"hour"===e?(n=this._hourImpl,s=a):"day"===e?(n=this._dayImpl,s=r):"week"===e?(n=this._weekImpl,s=6048e5):"month"===e?(n=this._monthImpl,s=2592e6):console.log('Periodicity ERROR: "'+e+'" is not a valid interval. Please see setPeriodicity() for details.'),this.tick_time=s*i,this.intra_day=this.tick_time<r,this._findPrevious=this._findNext=n};var o=e.Market.Iterator._Clock.prototype;o._total_minutes=function(t,e,i,a){return 60*(i-t)-e+a},o._alignMinutes=function(){if(!this.market.market_def||void 0===this.market.zopen_minute)return[];var t=this.market.zopen_minute,e=this.market.zseg_match;e&&e.adjacent_parent?t=e.adjacent_parent.open/60-1440:this.market.isHourAligned()&&this.multiple%60==0&&(t=0);for(var i=this._total_minutes(this.market.zopen_hour,t,this.market.zclose_hour,this.market.zclose_minute),a=[],r=0;r<i;)a.push(t+r),r+=this.multiple;return a},o._alignBaseZero=function(t){for(var e=0,i=[e];!((e+=this.multiple)>=t);)i.push(e);return i},o._date=function(){var t=Math.round(this.ctime),e=new Date(t);return this.intra_day?this.display_date=new Date(t+this.shift_millis):this.display_date=e,e},o._alignToBoundary=function(t,e){for(var i=0,a=0,r=e,s=0;s<t.length-1&&(i=t[s],a=t[s+1],e!==i&&e!==a);s++){if(e>i&&e<a){r=i;break}s+1===t.length-1&&(r=a)}return r},o._peek=function(){return this._date().toString()},o._seekHr=function(){this.forward?this.ctime-=a:this.ctime+=a},o._setStart=function(t){var e=this.market._tzDifferenceMillis(t),i=new Date(t.getTime()+e);this.shift_millis=e,this.ctime=i.getTime(),this.shift_millis=0,this.ctime=t.getTime()},o._tickTock=function(){this.forward?this.ctime+=this.tick_time:this.ctime-=this.tick_time},o._tockTick=function(){this.forward?this.ctime-=this.tick_time:this.ctime+=this.tick_time},o._tickTock24=function(){this.ctime+=r},o._tockTick24=function(){this.ctime-=r},o._windMaybe=function(t,e){for(var i=0,a=new Date(this.ctime),r=!1;!t.call(this.market,a);)if(e.call(this),r=!0,a=new Date(this.ctime),(i+=1)>this.max_iters){var s="Warning! max iterations ("+this.max_iters;s+=") reached with no rule match.",console.log(s);break}return r},o._millisImpl=function(){var t=!1;if(!this.mperiods_aligned){var e=this._alignBaseZero(1e3),i=new Date(this.ctime),a=i.getMilliseconds();a=this._alignToBoundary(e,a),i.setMilliseconds(0),this.ctime=i.getTime()+a,this.mperiods_aligned=!0,t=!0}var r=this._date().getMinutes();this._tickTock();var s=this._date().getMinutes();if((t||r!=s)&&!this.market._wasOpenIntraDay(this._date())){var n=this._date().getSeconds(),o=this._date().getMilliseconds(),l=this.tick_time;this.tick_time=6e4;var h=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=l,this.multiple=h,this.ctime+=1e3*n+o}return this._date()},o._secondImpl=function(){var t=!1;if(!this.speriod_aligned){var e=this._alignBaseZero(60),i=new Date(this.ctime),a=i.getSeconds();a=this._alignToBoundary(e,a),i.setSeconds(a),i.setMilliseconds(0),this.ctime=i.getTime(),this.speriod_aligned=!0,t=!0}var r=this._date().getMinutes();this._tickTock();var s=this._date().getMinutes();if((t||r!=s)&&!this.market._wasOpenIntraDay(this._date())){var n=this._date().getSeconds(),o=this.tick_time;this.tick_time=6e4;var l=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=o,this.multiple=l,this.ctime+=1e3*n}return this._date()},o._minuteImpl=function(){var t=this._windMaybe(this.market._wasOpenIntraDay,this._tockTick),e=new Date(this.ctime),i=e.getTimezoneOffset(),a=e.getMinutes(),r=e.getHours(),s=this._alignMinutes(),n=this._total_minutes(this.market.zopen_hour,this.market.zopen_minute,r,a)+this.market.zopen_minute;n=t?this.forward?s[s.length-1]:s[0]:this._alignToBoundary(s,n),r=Math.floor(n/60)+this.market.zopen_hour,e.setHours(r,n%60,0,0);var o=e.getTimezoneOffset()-i;(this.forward&&o<0||!this.forward&&o>0)&&e.setTime(e.getTime()-6e4*o),this.ctime=e.getTime(),this._tickTock();var l=this.market.hour_aligned&&this.multiple%60==0;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!l&&this.shouldResetToBeginningOfSegment){if(e=new Date(this.ctime),this.forward)e.setMinutes(this.market.zopen_minute),e.setHours(this.market.zopen_hour);else{var h=(s=this._alignMinutes())[s.length-1];e.setMinutes(h%60),e.setHours(Math.floor(h/60)+this.market.zopen_hour)}this.ctime=e.getTime()}return this._date()},o._hourImpl=function(){this._windMaybe(this.market._wasOpenIntraDay,this._tockTick);var t=new Date(this.ctime);this.market.isHourAligned()?t.setMinutes(0):t.setMinutes(this.market.zopen_minute),t.setSeconds(0),t.setMilliseconds(0),this.ctime=t.getTime(),this._tickTock();var e=this.market.zseg_match;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!this.market.hour_aligned&&e!=this.market.zseg_match){var i=new Date(this.ctime);if(this.forward)i.setMinutes(this.market.zopen_minute),i.setHours(this.market.zopen_hour);else{var a=this._alignMinutes(),r=a[a.length-1];i.setMinutes(r%60),i.setHours(Math.floor(r/60)+this.market.zopen_hour)}this.ctime=i.getTime()}return this._date()},o._dayImpl=function(){this._windMaybe(this.market._wasOpenDaily,this._seekHr);var t=new Date(this.ctime);t.setHours(12,0,0,0),this.ctime=t.getTime();for(var e=0;e<this.multiple;)this.forward?this._tickTock24():this._tockTick24(),this.market._wasOpenDaily(this._date())&&(e+=1);return(t=new Date(this.ctime)).setHours(0),this.ctime=t.getTime(),this._date()},o._weekImpl=function(){var t=this.market,e=new Date(this.ctime);for(e.setHours(12),this.ctime=e.getTime(),this._tickTock(),e=new Date(this.ctime);e.getDay()!==t.beginningDayOfWeek;)this._tockTick24(),e=new Date(this.ctime);return this._windMaybe(t._wasOpenDaily,this._tickTock24),(e=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=e.getTime(),this._date()},o._monthImpl=function(){var t=new Date(this.ctime);return t.setDate(15),this.ctime=t.getTime(),this._tickTock(),(t=new Date(this.ctime)).setDate(1),t.setHours(12),this.ctime=t.getTime(),this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},o._findNext=null,o._findPrevious=null},d=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.NameValueStore=e.NameValueStore||function(){},e.NameValueStore.prototype.toJSONIfNecessary=function(t){if(t.constructor==String)return t;try{return JSON.stringify(t)}catch(e){return console.log("Cannot convert to JSON: "+t),null}},e.NameValueStore.prototype.fromJSONIfNecessary=function(t){try{return JSON.parse(t)}catch(e){return t}},e.NameValueStore.prototype.get=function(t,i){var a=e.localStorage.getItem(t);i(null,this.fromJSONIfNecessary(a))},e.NameValueStore.prototype.set=function(t,i,a){e.localStorageSetItem(t,this.toJSONIfNecessary(i)),a&&a(null)},e.NameValueStore.prototype.remove=function(t,i){e.localStorage.removeItem(t),i&&i(null)}},p=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;function i(){}e.ChartEngine||(e.ChartEngine=function(){}),i.fetchInitialData=function(t,e,i,a,r){},i.fetchUpdateData=function(t,e,i,a){},i.fetchPaginationData=function(t,e,i,a,r){},i.subscribe=function(t){},i.unsubscribe=function(t){},e.QuoteFeed=e.QuoteFeed||function(){},e.QuoteFeed.prototype.fetch=function(t,e){this.v2QuoteFeed||console.log("You must implement CIQ.QuoteFeed.[yourfeedname].prototype.fetch()")},e.QuoteFeed.prototype.announceError=function(t,i){t.suppressErrors||i.suppressAlert||t.startDate||t.endDate||i.error&&e.alert("Error fetching quote:"+i.error)},e.QuoteFeed.prototype.multiFetch=function(t,e){return 0===t.length&&e([]),t[0].stx.driver.multiFetch(t,e)},e.QuoteFeed.Subscriptions=function(){this.subscriptions=[]},e.inheritsFrom(e.QuoteFeed.Subscriptions,e.QuoteFeed),e.QuoteFeed.Subscriptions.prototype.checkSubscriptions=function(t){var e,i,a=t.getSymbols({"breakout-equations":!0}),r=this;a=a.filter((function(e){var i=t.quoteDriver.getQuoteFeed(e);return i&&i.engine==r}));for(var s=0;s<this.subscriptions.length;s++)this.subscriptions[s].match=!1;for(var n=0;n<a.length;n++){var o=(i=a[n]).interval;for("month"!=o&&"week"!=o||t.dontRoll||(o="day"),i.interval=o,i.period=1,i.match=!1,isNaN(i.interval)||(i.period=i.interval,i.interval=i.timeUnit,i.interval||(i.interval="minute")),delete i.periodicity,delete i.timeUnit,delete i.setSpan,s=0;s<this.subscriptions.length;s++){if((e=this.subscriptions[s]).symbol==i.symbol&&e.period==i.period&&e.interval==i.interval){i.match=!0,e.match=!0;break}e.symbol!=i.symbol?("period"!=i.reason&&(i.reason="symbol"),e.reason="symbol"):(i.reason="period",e.reason="period")}}this.subscriptions=this.subscriptions.filter((function(e){return e.match||(e.stx||(e.stx=t),r.unsubscribe(e)),e.match})),a.forEach((function(e){e.match||(e.stx||(e.stx=t),e.reason||(e.reason="initialize"),e.symbol!==t.chart.symbol&&(e.series=!0),r.subscribe(e),r.subscriptions.push(e))}))},e.QuoteFeed.Subscriptions.prototype.fetch=function(t,e){var i=this;this.fetchFromSource(t,(function(a){a.error||i.checkSubscriptions(t.stx),e(a)}))},e.QuoteFeed.Subscriptions.prototype.subscribe=function(t){console.log("subscribe",t)},e.QuoteFeed.Subscriptions.prototype.unsubscribe=function(t){console.log("unsubscribe",t)},e.QuoteFeed.Subscriptions.prototype.fetchFromSource=function(t,e){console.log("Please provide implementation of fetchFromSource")},e.QuoteFeed.prototype.requiresImmediateRefresh=function(t){return!1},e.ChartEngine.prototype.attachQuoteFeed=function(t,i,a){if(i||(i={}),"function"!=typeof t.fetchInitialData&&"function"!=typeof t.fetchUpdateData&&"function"!=typeof t.fetchPaginationData||("function"!=typeof t.fetchPaginationData&&"function"!=typeof t.fetchUpdateData&&(i.noLoadMore=!0),t.v2QuoteFeed=!0,["multiFetch","announceError","requiresImmediateRefresh"].forEach((function(i){t[i]||!1===t[i]||(t[i]=e.QuoteFeed.prototype[i])})),"function"==typeof t.subscribe&&(t.checkSubscriptions=e.QuoteFeed.Subscriptions.prototype.checkSubscriptions,t.subscriptions=[])),i.maximumTicks||(i.maximumTicks=t.maxTicks?t.maxTicks:2e4),(!i.bufferSize||i.bufferSize<0)&&(i.bufferSize=0),i.bufferSize=Math.round(i.bufferSize),i.intervalTimer=null,this.quoteDriver)if(!a&&this.quoteDriver.hasUnfilteredQuoteFeed)this.detachQuoteFeed();else{var r=this.quoteDriver.hasUnfilteredQuoteFeed&&this.quoteDriver.quoteFeeds.pop();this.quoteDriver.quoteFeeds.push({engine:t,behavior:i,filter:a}),r&&this.quoteDriver.quoteFeeds.push(r),this.quoteDriver.updateChartLoop(null,i)}this.quoteDriver||(this.quoteDriver=new e.ChartEngine.Driver(this,t,i,a)),a||(this.quoteDriver.hasUnfilteredQuoteFeed=!0)},e.ChartEngine.prototype.detachQuoteFeed=function(t){var e=this.quoteDriver;if(e){for(var i=e.quoteFeeds.length-1;i>=0;i--)t&&e.quoteFeeds[i].quoteFeed!=t||(e.die(e.quoteFeeds[i]),e.quoteFeeds.splice(i,1));e.quoteFeeds.length?t==e.quoteFeed&&(e.quoteFeed=e.quoteFeeds[0].quoteFeed,e.behavior=e.quoteFeeds[0].behavior):e=this.quoteDriver=null}},e.ChartEngine.Driver=function(t,i,a,r){this.stx=t,a||(a={}),this.quoteFeeds=[{engine:i,behavior:a,filter:r}],this.id=e.uniqueID(!0),this.behavior=a,this.quoteFeed=i,this.loadingNewChart=!1,this.updatingChart=!1,r||(this.hasUnfilteredQuoteFeed=!0),this.updateChartLoop()},e.ChartEngine.Driver.prototype.die=function(t){for(var e=0;e<this.quoteFeeds.length;e++)if(!t||this.quoteFeeds[e]==t){var i=this.quoteFeeds[e].behavior;i.intervalTimer&&(clearInterval(i.intervalTimer),i.intervalTimer=-1)}},e.ChartEngine.Driver.prototype.getQuoteFeed=function(t){t.symbolObject||(t.symbolObject={symbol:t.symbol});for(var e=0;e<this.quoteFeeds.length;e++){var i=this.quoteFeeds[e];if(i.behavior.generator==t.symbolObject.generator&&(!i.filter||i.filter(t)))return i}return null},e.ChartEngine.Driver.prototype.multiFetch=function(t,i){0===t.length&&i([]);var a={counter:0,finished:t.length,results:[]};function r(t,e,i){return function(a){if(e.results.push({dataCallback:a,params:t}),e.counter++,e.counter>=e.finished){var r=e.results;e.results=[],i(r)}}}for(var s=0;s<t.length;s++){var n=t[s];if(n.stx.isEquationChart(n.symbol))e.fetchEquationChart(n,r(n,a,i));else{var o=this.getQuoteFeed(n);o&&e.ChartEngine.Driver.fetchData(e.QuoteFeed.SERIES,o.engine,n,r(n,a,i))}}},e.ChartEngine.Driver.prototype.updateSubscriptions=function(){for(var t=0;t<this.quoteFeeds.length;t++)this.quoteFeeds[t].checkSubscriptions&&this.quoteFeeds[t].checkSubscriptions(this.stx)},e.ChartEngine.Driver.prototype.loadDependents=function(t,i,a,r){var s,n=this;if(!r){var o=0,l=[],h=[],c=function(t){i&&++o>=n.quoteFeeds.length&&i(null)},u=function(e){++o<l.length||(h.length||c(),h.forEach((function(e){n.loadDependents(t,c,a,e.behavior)})))};return n.quoteFeeds.forEach((function(t){t.behavior.generator?h.push(t):l.push(t)})),void l.forEach((function(e){n.loadDependents(t,u,a,e.behavior)}))}var d,p,m=t.stx,g=t.chart,f=g.series,v=(m.masterData,[]),y={},x=a==e.QuoteFeed.UPDATE,b=a==e.QuoteFeed.PAGINATION,S=e.shallowClone(t);for(s in f){var C=(d=f[s]).parameters;if(!x){if(!t.future&&!1===d.moreAvailable)continue;if(t.future&&!0===d.upToDate)continue}if(!d.loading&&(!1!==C.loadData&&(!x&&!b||d.endPoints&&Object.keys(d.endPoints).length)&&(!C.data||C.data.useDefaultQuoteFeed)&&(p=C.symbolObject).symbol&&p.generator==r.generator)){S.symbolObject=p,S.symbol=p.symbol;var w=this.getQuoteFeed(S);if(r==(w&&w.behavior)){var k=!0;x||(d.loading=!0);for(var D=0;D<v.length;D++)e.symbolEqual(v[D],p)&&(k=!1);k&&(v.push(p),y[p.symbol]=d.endPoints)}}}for(var T=[],M=0;M<v.length;M++){p=v[M];var A=e.shallowClone(t.originalState);A.symbol=p.symbol,A.symbolObject=p,A.update||A.future?(A.endDate||(A.endDate=t.endDate),A.startDate=y[p.symbol].end):(A.startDate||(A.startDate=t.startDate),A.endDate=b&&!t.future?y[p.symbol].begin:t.endDate,A.ticks=t.ticks),T.push(A)}if(!T.length&&x){var _={appending:t.appending||t.originalState.update};return _.appending&&(_.appendToDate=t.startDate),m.createDataSet(null,null,_),t.nodraw||m.draw(),void(i&&i(null))}this.multiFetch(T,function(s){return function(o){for(var l=null,h=0;h<o.length;h++){var c=o[h],u=c.dataCallback.error;if(!u&&0!==u){var p=c.params.symbolObject,f=c.dataCallback,v=f.quotes,y=f.moreAvailable,x=f.upToDate,b=[];m.getSeries&&(b=m.getSeries({symbolObject:p}));for(var S=!1,C=0;C<b.length;C++)d=b[C],s||(t.future?(d.upToDate=!0===x||(x||v.length<=(c.params.startDate?1:0)),m.isHistoricalModeSet&&v.length<2&&(d.mostRecentForwardAttempt=new Date)):d.moreAvailable=!1!==y&&(y||v.length>(c.params.endDate?1:0)),d.loading=!1),S=d.parameters.fillGaps||S;v=n.cleanup(m,d,v,a,t,S),m.updateChartData(v,g,{secondarySeries:p.symbol,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),v&&v.length&&(!l||l>v[0].DT)&&(l=v[0].DT)}}o.length&&(m.createDataSet(null,null,{appending:t.originalState.update||t.future,appendToDate:l}),t.nodraw||m.draw(),a==e.QuoteFeed.INITIAL&&n.resetRefreshInterval(r.refreshInterval,r)),i&&i(null)}}(x))},e.ChartEngine.Driver.prototype.cleanup=function(t,i,a,r,s,n){if(t.doCleanupDates(a,t.layout.interval),!s.missingBarsCreated&&a&&a.length&&t.cleanupGaps&&!1!==n){var o,l,h=s.chart;if(i?(h=i,l=i.parameters.symbol||i.id):l=h.defaultPlotField,r!=e.QuoteFeed.PAGINATION||s.loadMoreReplace){if(r==e.QuoteFeed.UPDATE&&h.endPoints.end&&h.endPoints.end<a[0].DT){var c=t.getFirstLastDataRecord(t.masterData,l,!0);i&&(c=c[l]),a.unshift(c),o="shift"}}else if(h.endPoints.begin&&h.endPoints.begin>a[a.length-1].DT){var u=t.getFirstLastDataRecord(t.masterData,l,!1);i&&(u=u[l]),a.push(u),o="pop"}a=t.doCleanupGaps(a,s.chart,{cleanupGaps:n,noCleanupDates:!0}),o&&a[o]()}return a},e.ChartEngine.Driver.prototype.updateChart=function(t){if(!this.updatingChart&&!this.loadingNewChart){var i=Object.keys(this.stx.charts).length,a=0,r=this.stx,s=r.layout.interval,n=r.layout.timeUnit;for(var o in r.charts){var l=r.charts[o];if(l.symbol){var h=this.makeParams(l.symbol,l.symbolObject,l),c=this.getQuoteFeed(h);if(l.masterData&&l.masterData.length&&(h.startDate=l.endPoints.end),h.update=!0,h.originalState=e.shallowClone(h),t&&t!=h.behavior)this.loadDependents(h,null,e.QuoteFeed.UPDATE,t);else{this.updatingChart=!0;var u=d(this,h,l.symbol,c);r.isEquationChart(h.symbol)?e.fetchEquationChart(h,u):c&&e.ChartEngine.Driver.fetchData(e.QuoteFeed.UPDATE,c.engine,h,u)}}}}function d(t,o,l,h){return o.behavior.prefetchAction&&o.behavior.prefetchAction("updateChart"),function(c){a++;var u=o.chart;u.masterData;if(l!=u.symbol||s!=r.layout.interval||n!=r.layout.timeUnit||r.isHistoricalMode())t.updatingChart=!1;else{if(c.error)h&&h.engine.announceError(o.originalState,c);else{var d=c.quotes;d=t.cleanup(r,null,d,e.QuoteFeed.UPDATE,o),r.updateChartData(d,u,{noCreateDataSet:!0,noCleanupDates:!0}),u.attribution=c.attribution}a==i&&(t.updatingChart=!1),o.behavior.callback&&o.behavior.callback(o),t.loadDependents(o,null,e.QuoteFeed.UPDATE,o.behavior)}}}},e.ChartEngine.Driver.prototype.updateChartLoop=function(t,e){if(e||(e=this.behavior),-1!=e.intervalTimer){e.intervalTimer&&clearInterval(e.intervalTimer);for(var i=function(t,e){return function(){e.noUpdate||t.updateChart(e)}},a=0;a<this.quoteFeeds.length;a++){var r=this.quoteFeeds[a].behavior;e!=r||r.noUpdate||(t||0===t||(t=r.refreshInterval),t&&(e.intervalTimer=setInterval(i(this,r),1e3*t)))}}},e.ChartEngine.Driver.prototype.resetRefreshInterval=function(t,e){(e||this.behavior).refreshInterval=t,this.updateChartLoop(null,e)},e.ChartEngine.Driver.prototype.loadAll=function(t,e){var i=this,a=0;!function r(){return function(s){s?e(s):!t.moreAvailable&&t.upToDate?e(null):++a>20?e("error, moreAvailable not implemented correctly in QuoteFeed"):(t.loadingMore=!1,i.checkLoadMore(t,!0,!0,r(),!0))}}()()},e.ChartEngine.Driver.prototype.checkLoadMore=function(t,i,a,r,s){var n=this.stx;if(t.loadingMore||this.loadingNewChart)return t.initialScroll=t.scroll,void(r&&r(null));n.isHistoricalMode()||(n.isHistoricalModeSet=!1);var o=this.makeParams(t.symbol,t.symbolObject,t);if(n.currentlyImporting)r&&r(null);else{var l,h=o.behavior,c=t.dataSet,u=1e3*(h.forwardPaginationRetryInterval||5),d=!1,p=!1;if(t.dataSet.length)for(var m in t.series){var g=t.series[m];g.loading||!1!==g.parameters.loadData&&(l=!g.mostRecentForwardAttempt||g.mostRecentForwardAttempt.getTime()+u<Date.now(),!1!==g.moreAvailable&&M(g)&&(d=!0),l&&!g.upToDate&&A(g)&&(p=!0))}l=!t.mostRecentForwardAttempt||t.mostRecentForwardAttempt.getTime()+u<Date.now();var f=(M(t)||i)&&!1!==t.moreAvailable,v=(A(t)||i)&&!t.upToDate&&l,y=f||d,x=n.isHistoricalModeSet&&!y&&(v||p),b=n.layout.interval,S=n.layout.timeUnit,C=!1,w=h.findHeadOfData||t.masterData&&t.masterData.length;if(!h.noLoadMore&&w&&(x||!n.maxDataSetSize||t.dataSet.length<n.maxDataSetSize)&&(y||x)){var k;if(t.initialScroll=t.scroll,t.loadingMore=!0,(o=this.makeParams(t.symbol,t.symbolObject,t)).pagination=!0,o.future=x,t.masterData&&t.masterData.length)x?o.startDate=t.endPoints.end:o.endDate=t.endPoints.begin,x&&!o.startDate?(k=n.getFirstLastDataRecord(t.masterData,"DT",!0))&&(o.startDate=k.DT):y&&!o.endDate&&(k=n.getFirstLastDataRecord(t.masterData,"DT"))&&(o.endDate=k.DT);else o.endDate=new Date;if(o.originalState=e.shallowClone(o),o.nodraw=s,!f&&d||!v&&p)return this.loadingMore=!0,this.loadDependents(o,(function(e){t.loadingMore=!1,r&&r(e)}),e.QuoteFeed.PAGINATION),void(r&&r(null));n.fetchMaximumBars[n.layout.aggregationType]&&(o.fetchMaximumBars=!0,!n.maxMasterDataSize||h.maximumTicks<n.maxMasterDataSize?o.ticks=h.maximumTicks:o.ticks=n.maxMasterDataSize);var D=function(t,i){return h.prefetchAction&&h.prefetchAction("checkLoadMore"),function(a){var n=t.stx,o=i.chart;if(i.symbol==o.symbol&&b==n.layout.interval&&S==n.layout.timeUnit)if(i.loadMore||(i.chart.loadingMore=!1),a.error)t.quoteFeed.announceError(i.originalState,a),i.chart.loadingMore=!1,r&&r(a.error);else{a.quotes||(a.quotes=[]);var l=a.quotes,c=o.masterData;if((l=t.cleanup(n,null,l,e.QuoteFeed.PAGINATION,i)).length&&o.masterData&&o.masterData.length)if(i.future){var u=l[0];u.DT&&u.DT==o.masterData[o.masterData.length-1].DT&&c.pop()}else{var d=l[l.length-1];d.DT&&+d.DT==+o.masterData[0].DT&&l.pop()}i.future?(a.upToDate?o.upToDate=!0:(!1===a.upToDate||l.length>1)&&(o.upToDate=!1),n.isHistoricalModeSet&&l.length<2&&(o.mostRecentForwardAttempt=new Date)):a.moreAvailable||!1!==a.moreAvailable&&l.length?o.moreAvailable=!0:o.moreAvailable=!1,t.tickMultiplier=l.length?2:2*t.tickMultiplier;var p,m=l[0]?l[0].DT:i.startDate,g=l[0]?l[l.length-1].DT:i.endDate;(!o.endPoints.begin||o.endPoints.begin>m)&&(o.endPoints.begin=m),(!o.endPoints.end||o.endPoints.end<g)&&(o.endPoints.end=g),o.loadingMore=!1,i.loadMoreReplace?n.setMasterData(l,o,{noCleanupDates:!0}):i.future?n.updateChartData(l,o,{noCreateDataSet:!0,noCleanupDates:!0}):e.addMemberToMasterdata({stx:n,chart:o,data:l,fields:["*"],noCleanupDates:!0}),i.future&&(p={appending:!0,appendToDate:l[0]&&l[0].DT}),n.createDataSet(void 0,void 0,p),s||n.draw(),h.callback&&h.callback(i),t.loadDependents(i,r,e.QuoteFeed.PAGINATION)}}}(this,o);if(n.isEquationChart(o.symbol))e.fetchEquationChart(o,D);else{x&&(o.appending=!0);var T=this.getQuoteFeed(o);T&&e.ChartEngine.Driver.fetchData(e.QuoteFeed.PAGINATION,T.engine,o,D)}C=!0}!C&&r&&r(null)}function M(e){return!e.endPoints.begin||c.length-t.scroll<h.bufferSize||c.length-t.scroll-n.tickFromDate(e.endPoints.begin,t)<h.bufferSize}function A(e){return!e.endPoints.end||t.scroll-t.maxTicks+1<h.bufferSize||n.tickFromDate(e.endPoints.end,t,null,!0)-c.length+t.scroll-t.maxTicks+2<h.bufferSize}},e.ChartEngine.Driver.prototype.extendHistoricalData=function(t){let{from:i}=t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const{stx:r}=this,{chart:s,layout:n}=r,{masterData:o,dataSet:l}=s,{interval:h,timeUnit:c}=n,u=this.makeParams(s.symbol,s.symbolObject,s),d=this.getQuoteFeed(u);if(s.loadingMore||this.loadingNewChart||r.currentlyImporting||!o.length||!d||r.maxDataSetSize&&l.length>r.maxDataSetSize)return a(null);s.loadingMore=!0,u.originalState=Object.assign({},u),u.startDate=i,u.endDate=o[0].DT,e.ChartEngine.Driver.fetchData(e.QuoteFeed.PAGINATION,d.engine,u,function(t,i){return function(o){let{quotes:l,moreAvailable:u,error:d}=o;if(i.symbol===s.symbol&&h===n.interval&&c===n.timeUnit){if(s.loadingMore=!1,d)return a(d);l=t.cleanup(r,null,l,e.QuoteFeed.PAGINATION,i),s.moreAvailable="boolean"==typeof u?u:!!l.length,s.endPoints.begin=l[0].DT,e.addMemberToMasterdata({stx:r,chart:s,data:l,fields:["*"],noCleanupDates:!0}),r.createDataSet(),r.draw()}}}(this,u))},e.ChartEngine.Driver.prototype.barsToFetch=function(t){e.isValidNumber(this.tickMultiplier)||(this.tickMultiplier=2);var i=this.stx.layout.interval,a=t.stx.layout.periodicity;return"month"!=i&&"week"!=i||this.stx.dontRoll||(a*="week"==i?7:30),t.stx.chart.maxTicks*a*this.tickMultiplier},e.ChartEngine.Driver.determineStartDate=function(t,e,i){return this.determineStartOrEndDate(t,e,i,!0)},e.ChartEngine.Driver.determineStartOrEndDate=function(t,e,i,a){return a||t.fetchMaximumBars?t.startDate||e.previous(i):t.future?e.next(i):new Date},e.ChartEngine.Driver.prototype.makeParams=function(t,i,a){var r=this.stx,s=r.layout.interval,n=this.barsToFetch({stx:r});"month"!=s&&"week"!=s||r.dontRoll||(s="day");var o=this.getQuoteFeed({interval:s,symbol:t,symbolObject:i}),l=o&&o.behavior,h=e.shallowClone(l)||{};h.behavior=l;var c=!1,u=[];a.market&&a.market.getSessionNames&&(u=a.market.getSessionNames()),r.extendedHours?r.extendedHours.filter?c=!0:(c=r.layout.extended,u=u.filter((function(t){return t.enabled||r.layout.marketSessions[t.name]}))):u=u.filter((function(t){return t.enabled}));for(var d=0;d<u.length;d++)u[d]=u[d].name;return e.extend(h,{stx:r,symbol:t,symbolObject:i,chart:a,interval:s,extended:c,period:1,ticks:n,additionalSessions:u,quoteDriverID:this.id},!0),h.symbolObject||(h.symbolObject={symbol:t}),isNaN(h.interval)||(h.period=parseInt(h.interval,10),h.interval=r.layout.timeUnit,h.interval||(h.interval="minute")),h},e.ChartEngine.Driver.prototype.newChart=function(t,i){var a=this.stx,r=t.symbol,s=a.layout.interval,n=a.layout.timeUnit,o=t.chart;o.moreAvailable=null,o.upToDate=null,o.loadingMore=!1,o.attribution=null;var l=this.makeParams(r,t.symbolObject,o);e.extend(l,t,!0);var h=this.getQuoteFeed(l),c=l.behavior;(a.fetchMaximumBars[a.layout.aggregationType]||t.fetchMaximumBars)&&(!a.maxMasterDataSize||c.maximumTicks<a.maxMasterDataSize?l.ticks=c.maximumTicks:l.ticks=a.maxMasterDataSize,l.fetchMaximumBars=!0),this.loadingNewChart=!0,this.updatingChart=!1,l.originalState=e.shallowClone(l);var u=function(o,l){return c.prefetchAction&&c.prefetchAction("newChart"),function(u){var d=l.chart,p=u.quotes,m=!1;if(r==d.symbol&&s==a.layout.interval&&n==a.layout.timeUnit){for(var g in o.loadingNewChart=!1,u.error?h.engine.announceError(l.originalState,u):(p=o.cleanup(a,null,p,e.QuoteFeed.INITIAL,l),a.setMasterData(p,d,{noCleanupDates:!0}),d.endPoints={},d.endPoints.begin=p[0]?p[0].DT:l.startDate,d.endPoints.end=p[0]?p[p.length-1].DT:l.endDate,p?(d.moreAvailable=!1!==u.moreAvailable,d.upToDate=u.upToDate):(d.moreAvailable=!1,d.upToDate=!0),d.attribution=u.attribution,t.initializeChart&&a.initializeChart(),a.createDataSet(),m=!0),d.series)d.series[g].endPoints={},d.series[g].moreAvailable=null,d.series[g].upToDate=null;var f=d.masterData;f&&f.length&&(l.startDate=f[0].DT,l.endDate=f[f.length-1].DT),c.callback&&c.callback(l),o.loadDependents(l,(function(){m&&!l.nodraw&&o.stx.home(),i&&i(u.error),o.stx.dispatch("newChart",{stx:o.stx,symbol:o.stx.chart.symbol,symbolObject:o.stx.chart.symbolObject,moreAvailable:o.stx.chart.moreAvailable,upToDate:o.stx.chart.upToDate,quoteDriver:o}),o.resetRefreshInterval(c.refreshInterval,c)}),e.QuoteFeed.INITIAL)}else i&&i("orphaned")}}(this,l);this.stx.isEquationChart(l.symbol)?e.fetchEquationChart(l,u):h&&e.ChartEngine.Driver.fetchData(e.QuoteFeed.INITIAL,h.engine,l,u)},e.QuoteFeed.INITIAL=1,e.QuoteFeed.UPDATE=2,e.QuoteFeed.PAGINATION=3,e.QuoteFeed.SERIES=4,e.ChartEngine.Driver.fetchData=function(t,i,a,r){if(!a.symbol)return r({quotes:[]});i.v2QuoteFeed?"function"!=typeof i.subscribe?e.ChartEngine.Driver.fetchDataInContext(t,i,a,r):e.ChartEngine.Driver.fetchDataInContext(t,i,a,function(t){t.error||this.checkSubscriptions(a.stx),r(t)}.bind(i)):(a.stx.convertToDataZone(a.startDate),a.stx.convertToDataZone(a.endDate),i.fetch(a,r))},e.ChartEngine.Driver.fetchDataInContext=function(t,i,a,r){var s,n,o,l,h=a.stx;if(h.chart.market.newIterator){t===e.QuoteFeed.SERIES&&(a.series=!0,t=e.QuoteFeed.INITIAL,a.endDate&&!a.startDate||a.future?t=e.QuoteFeed.PAGINATION:a.startDate&&!a.endDate&&(t=e.QuoteFeed.UPDATE));var c=Math.min(a.ticks,a.maximumTicks);i.maxTicks&&(c=Math.min(c,i.maxTicks));var u=a.symbolObject.masterSymbol||a.symbol;switch(t){case e.QuoteFeed.UPDATE:if(h.isHistoricalModeSet)return void(h.quoteDriver.updatingChart=!1);var d;a.startDate?d=a.startDate:(d=new Date).setHours(0,0,0,0),"function"==typeof i.fetchUpdateData&&i.fetchUpdateData(u,h.convertToDataZone(d),a,r);break;case e.QuoteFeed.INITIAL:s={begin:l=a.endDate||new Date,interval:a.interval,periodicity:"tick"==a.interval?h.chart.xAxis.futureTicksInterval:a.period,outZone:h.dataZone},n=h.chart.market.newIterator(s),o=e.ChartEngine.Driver.determineStartDate(a,n,c),a.endDate&&(l=a.endDate),"function"==typeof i.fetchInitialData&&i.fetchInitialData(u,o,h.convertToDataZone(l),a,r);break;case e.QuoteFeed.PAGINATION:s={begin:a.endDate||a.startDate,interval:a.interval,periodicity:"tick"==a.interval?h.chart.xAxis.futureTicksInterval:a.period,outZone:h.dataZone},n=h.chart.market.newIterator(s);var p=e.ChartEngine.Driver.determineStartOrEndDate(a,n,c,!a.future);if(o=a.startDate||p,l=a.endDate||p,a.startDate?a.stx.convertToDataZone(o):a.stx.convertToDataZone(l),"function"==typeof i.fetchPaginationData){if(h.maxMasterDataSize&&h.maxMasterDataSize<=h.masterData.length)return;i.fetchPaginationData(u,o,l,a,(function(t){l>=Date.now()&&(h.isHistoricalModeSet=!1),r&&r(t)}))}break;default:console.error("Illegal fetchData constant")}}else console.error("quoteFeed feature requires first activating market feature.")}},m=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ChartEngine.prototype.addSeries=function(t,i,a){var r=this.runPrepend("addSeries",arguments);if(r)return r;var s=t||null,n=t;t||(t=e.uniqueID()),i&&!0===i.panel&&(i.panel=t);var o={parameters:i?e.clone(i):{},yValueCache:[],display:s,id:t,loading:!i||!1!==i.loadData};o.parameters.yAxis=i&&i.yAxis,(i=o.parameters).symbol&&(n=i.symbol),i.isComparison&&(i.shareYAxis=!0),!i.yAxis||i.yAxis instanceof e.ChartEngine.YAxis||(i.yAxis=new e.ChartEngine.YAxis(i.yAxis)),e.ensureDefaults(i,{chartName:this.chart.name,symbolObject:{symbol:n},panel:this.chart.panel.name,fillGaps:!1,action:"add-series"}),"display"in i&&(o.display=i.display);var l=this.charts[i.chartName],h=i.symbolObject;n=i.symbol=h.symbol,o.display||(o.display=n||i.field),o.endPoints={},i.gapDisplayStyle||!1===i.gapDisplayStyle||(i.gapDisplayStyle=i.gaps),i.isComparison&&void 0===i.gapDisplayStyle&&(i.gapDisplayStyle="transparent");var c=this.getSeries({symbolObject:h,chart:l,includeMaster:!0}),u=i.panel;if(this.panels[u])i.yAxis||i.shareYAxis||(i.yAxis=new e.ChartEngine.YAxis({name:t,position:"none"}));else{var d=i.yAxis||new e.ChartEngine.YAxis;d.name=t,this.createPanel(t,u,null,null,d),this.preferences.dragging&&this.preferences.dragging.series||(i.highlightable=!1)}l.series[t]=o;var p=this,m=this.currentlyImporting;function g(a,r){var s=i.renderer||"Lines",n=i.name||t;if(!i.yAxis||i.yAxis instanceof e.ChartEngine.YAxis||m||(i.yAxis.name=n),i.renderer||i.name||i.color||i.chartType){var o=a.getSeriesRenderer(n);if(!o){let t={name:n,overChart:!1!==i.overChart,useChartLegend:!0};if(i.chartType?o=e.Renderer.produce(i.chartType,e.extend({highlightable:i.highlightable,dependentOf:i.dependentOf,panel:i.panel,yAxis:i.yAxis,baseline:i.baseline},t)):(e.ensureDefaults(i,t),o=new e.Renderer[s]({params:i})),!o)return;a.setSeriesRenderer(o)}o.attachSeries(t,i),!1!==i.loadData&&o.ready(),a.layout.symbols=a.getSymbols({"include-parameters":!0,"exclude-studies":!0}),a.changeOccurred("layout")}}function f(t){return function(e){if(!e.error){var r=e.quotes,s=i.fillGaps;p.cleanupGaps||(s=!1),r=p.doCleanupGaps(r,p.chart,{cleanupGaps:s}),p.updateChartData(r,p.chart,{secondarySeries:n,noCreateDataSet:!0,noCleanupDates:!0,allowReplaceOHL:!0}),o.loading=!1,o.moreAvailable=e.moreAvailable,o.upToDate=e.upToDate,g(p)}null===i.action||c.length||p.dispatch(m?"symbolImport":"symbolChange",{stx:p,symbol:t.symbol,symbolObject:t.symbolObject,action:i.action,id:o.id,parameters:i}),a&&a.call(p,e.error,o)}}!i.isComparison||!l.forcePercentComparison||i.panel!=l.panel.name||i.yAxis&&i.yAxis!=l.yAxis||this.setChartScale("percent");var v=l.masterData;v||(v=l.masterData=this.masterData=[]);var y=v.length;if(i.data&&!i.data.useDefaultQuoteFeed)f({symbol:n,symbolObject:h,action:i.action})({quotes:i.data});else if(c.length)o.endPoints=c[0].endPoints,o.loading=c[0].loading,g(this),a&&setTimeout((function(){a.call(p,null,o)}),0);else if(this.quoteDriver&&!1!==i.loadData){var x=this.quoteDriver,b=x.makeParams(n,h,l);if(y&&(b.startDate=v[0].DT,b.endDate=this.isHistoricalMode()?v[v.length-1].DT:new Date),b.stx.isEquationChart(b.symbol))e.fetchEquationChart(b,f(b));else{var S=x.getQuoteFeed(b);S&&e.ChartEngine.Driver.fetchData(4,S.engine,b,f(b))}}else g(this),a&&a.call(this,null,o);return this.runAppend("addSeries",arguments),o},e.ChartEngine.prototype.getSeries=function(t){var i=t.chart?t.chart:this.chart,a=i.series,r=t.symbolObject;r||(r={symbol:t.symbol});var s=[];for(var n in a){var o=a[n];e.symbolEqual(r,o.parameters.symbolObject)&&s.push(o)}return t.includeMaster&&e.symbolEqual(r,i.symbolObject)&&s.push({}),s},e.ChartEngine.prototype.modifySeries=function(t,i,a){var r,s,n;if(!this.runPrepend("modifySeries",arguments)&&(i&&("string"==typeof t?(s=t,r=(n=i.chartName?this.charts[i.chartName]:this.chart).series[s]):(s=(r=t).id,n=this.charts[r.parameters.chartName]),r))){e.extend(r.parameters,i,!0),this.getRendererFromSeries(s).modifyRenderer(i);var o,l=r.parameters;for(var h in n.seriesRenderers)for(var c=n.seriesRenderers[h],u=c.params,d=c.seriesParams,p=0;p<d.length;++p){var m=d[p],g=this.panels[m.panel],f=g&&g.yAxis.name;if(m.id===r.id){if(!0===l.panel&&(l.panel=l.dependentOf||l.name),u.panel=l.panel,i.yAxis&&(i.yAxis instanceof e.ChartEngine.YAxis||(i.yAxis=new e.ChartEngine.YAxis(i.yAxis)),u.yAxis=i.yAxis),l.panel!=m.panel&&u.name==f)this.electNewPanelOwner(m.panel);else{var v=this.getYAxisByName(l.panel,u.name);v&&l.yAxis&&v.name!==l.yAxis.name&&(v.name=this.electNewYAxisOwner(v))}l.field||(l.field=null),c.attachSeries(s,e.ensureDefaults(l,m)),l.field||(l.field=l.subField),delete l.subField,!l.isComparison||!n.forcePercentComparison||l.panel!=n.panel.name||r.parameters.yAxis&&l.yAxis.name!=n.yAxis.name||this.setChartScale("percent"),o=c;break}}if(this.changeOccurred("layout"),e.getFn("Drawing.updateSource")(this,r.parameters.symbol||s,null,r.parameters.panel),this.runAppend("modifySeries",arguments),!0!==a){for(var y=o.getDependents(this),x=0;x<y.length;x++)this.modifySeries(y[x].params.name,{panel:o.params.panel,yAxis:r.parameters.yAxis},!0);var b=n.seriesRenderers[o.params.dependentOf];b&&(b.params.yAxis==r.parameters.yAxis&&b.params.panel==o.params.panel||this.modifySeries(o.params.dependentOf,{panel:o.params.panel,yAxis:r.parameters.yAxis},!0))}return this.draw(),r}},e.ChartEngine.prototype.deleteSeries=function(t,e,i){if(!this.runPrepend("deleteSeries",arguments)){var a,r=(i=i||{}).action?i.action:"remove-series";"object"==typeof t?(a=t.id,e=e||this.charts[t.parameters.chartName]):(a=t,e=e||this.chart);var s=e.series[a];if(s){var n=s.parameters.loadData,o=s.parameters.symbolObject;delete e.series[a];var l=this.getSeries({symbolObject:o,includeMaster:!0});!1===n&&l.push(a),l.length||this.cleanMasterData(o,e);var h=this.panels[s.parameters.panel];h&&this.checkForEmptyPanel(h),this.createDataSet(),l.length||this.dispatch(this.currentlyImporting?"symbolImport":"symbolChange",{stx:this,symbol:o.symbol,symbolObject:o,id:a,action:r}),this.quoteDriver&&this.quoteDriver.updateSubscriptions(),this.runAppend("deleteSeries",arguments)}}},e.ChartEngine.prototype.removeSeries=function(t,e){if(!this.runPrepend("removeSeries",arguments)){var i,a=!1;for(var r in"object"==typeof t?(i=t.id,e=e||this.charts[t.parameters.chartName]):(i=t,e=e||this.chart),e.seriesRenderers)for(var s=e.seriesRenderers[r],n=this.panels[s.params.panel],o=n&&n.yAxis.name,l=s.seriesParams.length-1;l>=0;l--){if(s.seriesParams[l].id===i){if(s.removeSeries(i),s.seriesParams.length<1)if(this.removeSeriesRenderer(s),s.params.name==o)this.electNewPanelOwner(s.params.panel);else if(!this.checkForEmptyPanel(s.params.panel)){var h=this.getYAxisByName(n,s.params.name);h&&(h.name=h.studies[0]||h.renderers[1])}a=!0}}a||this.deleteSeries(i,e),this.resetDynamicYAxis(),this.draw(),this.resizeChart(),this.runAppend("removeSeries",arguments)}},e.Comparison=e.Comparison||function(){},e.Comparison.initialPrice=100,e.Comparison.getInitialPrice=function(t){if(t.initialComparisonPrice)return t.initialComparisonPrice;t.initialComparisonPrice=100;var i=e.Comparison.initialPrice;if("number"==typeof i&&(t.initialComparisonPrice=i),"string"==typeof i&&(t.series[i]||""===i)){var a="Close";t.defaultPlotField&&(t.highLowBars||(a=t.defaultPlotField));for(var r=t.dataSet.length-t.scroll-1;r<t.dataSet.length;r++){var s=t.dataSet[r];if(s){if(s[i]&&s[i][a]){t.initialComparisonPrice=s[i][a];break}if(""===i&&s[a]){t.initialComparisonPrice=s[a];break}}}}return t.initialComparisonPrice},e.Comparison.priceToPercent=function(t,i,a){var r=e.Comparison.baseline||a;return Math.round((a-r)/r*100*1e4)/1e4},e.Comparison.percentToPrice=function(t,i,a){return(e.Comparison.baseline||1)*(1+a/100)},e.Comparison.priceToRelative=function(t,i,a){var r=e.Comparison.baseline||a;return e.Comparison.getInitialPrice(i)*a/r},e.Comparison.relativeToPrice=function(t,i,a){return(e.Comparison.baseline||1)*a/e.Comparison.getInitialPrice(i)},e.Comparison.createComparisonSegmentInner=function(t,i){var a,r,s,n=[];for(a in i.series){var o=i.series[a].parameters;o.isComparison&&n.push(o.symbol)}var l=["Close","Open","High","Low","iqPrevClose"],h=t.chart.highLowBars;i.defaultPlotField&&!h&&l.unshift(i.defaultPlotField);var c=l[0],u=t.layout.studies;for(var d in u){var p=u[d];if(r=t.panels[p.panel],s=p.getYAxis(t),r&&r.yAxis==s){for(a in p.outputMap)l.push(a);for(var m=0;m<=2;m++)l.push(p.name+"_hist"+(m||""));p.referenceOutput&&l.push(p.referenceOutput+" "+p.name)}}for(var g in t.plugins){var f=t.plugins[g];if(f.transformOutputs)for(a in f.transformOutputs)l.push(a)}i.initialComparisonPrice=null,i.dataSegment=[];var v=null,y=i.dataSet.length-i.scroll-1;t.startComparisonsAtFirstVisibleBar&&(y+=1);for(var x=i.maxTicks+3,b=0;b<=x;b++){b==x&&(b=-1);var S=y+b;if(S<i.dataSet.length&&S>=0){var C,w=i.dataSet[S],k=w[c];if(!v){if(0===k||null===k){if(b<0)break;continue}v=e.clone(w)}for(w.transform||(w.transform={cache:{},DT:w.DT,Date:w.Date}),!e.Comparison.baseline&&k&&(v=e.clone(w)),e.Comparison.baseline=v[c],C=0;C<l.length;C++)(w[a=l[C]]||0===w[a])&&(w.transform[a]=i.transformFunc(t,i,w[a]));for(C=0;C<n.length;C++){a=n[C];var D=i.series[a];if(-1==b&&D&&D.parameters.isComparison)delete w.transform[a];else for(var T=w[a],M=0;T&&M<l.length;M++){var A=T[l[M]];if(A||0===A){var _=v[a]&&v[a][l[0]];if(_||0===_||(v[a]||(v[a]={}),v[a][l[M]]=_=A*e.Comparison.baseline/w[c]),0!==_){var F=A*((e.Comparison.baseline||1)/_);w.transform[a]||(w.transform[a]={}),w.transform[a][l[M]]=i.transformFunc(t,i,F)}}}}i.dataSegment.push(w)}else S<0&&i.dataSegment.push(null);if(b<0)break}},e.Comparison.priceFormat=function(t,e,i){if(null==i||isNaN(i))return"";var a=e.yAxis.priceTick,r=t.internationalizer;return i=r?a>=5?r.percent.format(i/100):a>=.5?r.percent1.format(i/100):a>=.05?r.percent2.format(i/100):a>=.005?r.percent3.format(i/100):r.percent4.format(i/100):a>=5?i.toFixed(0)+"%":a>=.5?i.toFixed(1)+"%":a>=.05?i.toFixed(2)+"%":a>=.005?i.toFixed(3)+"%":i.toFixed(4)+"%",0===parseFloat(i)&&"-"==i.charAt(0)&&(i=i.substring(1)),i},e.ChartEngine.prototype.setComparison=function(t,i,a){if(i||(i=this.chart),"string"==typeof i&&(i=this.charts[i]),(a||""===a)&&(e.Comparison.initialPrice=a),!0===t){if(i.isComparison)return;t="percent"}this.resetDynamicYAxis();var r=i.panel.yAxis,s=r.priceFormatter==e.Comparison.priceFormat;switch(t){case"relative":this.setTransform(i,e.Comparison.priceToRelative,e.Comparison.relativeToPrice),s&&(r.priceFormatter=r.originalPriceFormatter?r.originalPriceFormatter.func:null,r.originalPriceFormatter=null),r.whichSet="dataSegment",i.isComparison=!0;break;case"percent":this.setTransform(i,e.Comparison.priceToPercent,e.Comparison.percentToPrice),s||(r.originalPriceFormatter={func:r.priceFormatter},r.priceFormatter=e.Comparison.priceFormat),r.whichSet="dataSegment",i.isComparison=!0;break;default:this.unsetTransform(i),s&&(r.priceFormatter=r.originalPriceFormatter?r.originalPriceFormatter.func:null,r.originalPriceFormatter=null),r.whichSet="dataSet",i.isComparison=!1}},e.ChartEngine.prototype.setChartScale=function(t){var i=this.chart,a={percent:!0,relative:!0};t||(t="linear"),a[t]?this.setComparison(t,i,e.Comparison.initialPrice):a[this.layout.chartScale]&&this.setComparison(!1,i),this.layout.chartScale=t,i.canvas&&this.draw(),this.changeOccurred("layout")}},g=t=>{var e,i="undefined"!=typeof _CIQ?_CIQ:t.CIQ;function a(t){if(t.style){var e=getComputedStyle(t);for(var i in["alignment-baseline","dominant-baseline","fill","fill-opacity","font-family","font-size","font-variant","font-weight","text-align","text-anchor"].forEach((function(i){!t.style[i]&&e[i]&&(t.style[i]=e[i])})),t.children)a(t.children[i])}}function r(t,i,r){i||(i={});var s=document.querySelector("body");if(i.hide&&i.hide instanceof Array)for(var n=i.hide.join(", "),o=document.querySelectorAll(n),l=0;l<o.length;l++)o[l].classList.add("ciq-no-share");s.classList.add("sharing");for(var h=t.chart.container.getElementsByTagName("svg"),c=[],u=0;u<h.length;u++){var d=h[u];c.push(d.innerHTML),a(d)}e(t.chart.container,{allowTaint:!1,logging:!1,width:i.width||null,height:i.height||null,backgroundColor:i.background||null,useCORS:!0}).then((function(t){for(r&&r(null,i.data?t.toDataURL("image/png"):t),u=0;u<h.length;u++)h[u].innerHTML=c[u];s.classList.remove("sharing")})).catch((function(t){for(r&&r(t),u=0;u<h.length;u++)h[u].innerHTML=c[u];s.classList.remove("sharing")}))}i.Share=i.Share||function(){},i.Share.FullChart2PNG=function(t,a,s){if(t&&t.chart){if("undefined"==typeof html2canvas)return function(t){if("undefined"!=typeof html2canvas)return e=html2canvas,t();if("undefined"!=typeof requirejs)try{return requirejs(["html2canvas.min.js"],(function(i){return e=i,t()}))}catch(t){console.warn("Require loading has failed, attempting to load html2canvas manually.")}i.loadScript(function(){if(i.Share.html2canvasLocation)return i.Share.html2canvasLocation;for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var a=t[e];if(a.src&&a.src.indexOf("share.js")>-1)return a.src.replace(/standard\/share\.js/,"")+"thirdparty/"}return"js/thirdparty/"}()+"html2canvas.min.js",(function(){return e=html2canvas,t()}))}((function(){return r(t,a,s)}));e=html2canvas,r(t,a,s)}},i.Share.createImage=function(t,e,a){var r=[].slice.call(arguments);a=r.pop(),null!==e&&"object"==typeof e||(e={widthPX:r[1],heightPX:r[2],imageType:r[3]});var s=e.widthPX,n=e.heightPX,o=e.imageType,l=t.chart.canvas.height,h=t.chart.canvas.width;t.chart.canvas.style.height&&(l=i.stripPX(t.chart.canvas.style.height),h=i.stripPX(t.chart.canvas.style.width)),s&&n?(l=n,h=s):n?h=t.chart.canvas.width*(l/t.chart.canvas.height):s&&(h=s,l=t.chart.canvas.height*(s/t.chart.canvas.width));var c=o?"image/"+o:"image/png",u=document.createElement("img");u.onload=function(){i.Share.FullChart2PNG(t,{image:this,width:h,height:l,hide:e.hide},(function(t,e){if(t)console.warn("Error producing canvas snapshot: "+t);else try{a(e.toDataURL(c))}catch(t){console.warn("Safari devices do not handle CORS enabled images. Using the charts' canvas as a fallback."),a(u.src)}}))},u.src=t.chart.canvas.toDataURL(c)},i.Share.uploadImage=function(t,e,a,r){a||(a={}),a.image=t,i.postAjax(e,JSON.stringify(a),(function(t,e){200==t?r(null,e):r(t,null)}))||r(0,null)},i.Share.shareChart=function(t,e,a){i.Share.createImage(t,{},(function(r){var s=i.uniqueID(),n="https://share.chartiq.com",o=n+"/upload/"+s;e&&(e.host&&(n=e.host),e.path&&(o=n+e.path+"/"+s));var l=t.getStartDateOffset(),h={id:s,image:r,config:{layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:l,startDate:t.chart.dataSegment[l].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:s,symbol:t.chart.symbol}};i.Share.uploadImage(r,o,h,(function(t,e){null!==t?i.alert("error sharing chart: ",t):a(n+e)}))}))}},f=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ChartEngine.prototype.setRange=function(t,i){e.isEmpty(t)&&(t={dtLeft:arguments[0],dtRight:arguments[1],padding:arguments[2],chart:arguments[3]},i=arguments[4]),this.staticRange&&(t.goIntoPast=t.goIntoFuture=!0),t.chart||(t.chart=this.chart),void 0===t.padding&&(t.padding=0);var a,r=!1,s=t.chart,n="string"==typeof t.dtLeft?new Date(t.dtLeft):t.dtLeft,o=new Date;t.dtRight&&(o="string"==typeof t.dtRight?new Date(t.dtRight):t.dtRight),n||(a=this.standardMarketIterator(o,null,s),n=a.previous(s.maxTicks),t.periodicity||(r=!0)),s.inflectionPoint=n,this.layout.range={dtLeft:n,dtRight:o};var l=this;function h(e){void 0===e&&(e=null);var a=0,h=0,c=new Date,u=t.base,d=t.periodicity,p=l.layout;if(t.goIntoFuture&&(!s.masterData.length||n>s.masterData[s.masterData.length-1].DT)){var m=s.masterData.length?s.masterData.pop():{DT:n},g=l.doCleanupGaps([m,{DT:o}],s,{cleanupGaps:"gap",noCleanupDates:!0});l.setMasterData(s.masterData.concat(g),s,{noCleanupDates:!0}),l.createDataSet(null,null,{appending:!0})}var f=s.dataSet,v=f.length;if(f&&0!==v){var y;if("day"===u&&d&&"day"===d.interval){var x=t.multiplier;a=v<x?0:v-x,h=v-1}else if("today"===u&&f[v-1].DT.getDate()<c.getDate()){var b=new Date(f[v-1].DT.getTime());b.getTime();y=0;for(var S=v-1;S>=0;S--)if(f[S]&&f[S].DT.getDate()!=b.getDate()){b=new Date(+f[S+1].DT),y=S+1;break}a=y,h=v-1}else a="all"!=t.base&&(n.getTime()>=f[0].DT.getTime()||t.goIntoPast)?l.tickFromDate(n,s,null,!0):0,"all"!=t.base&&(o.getTime()<=f[v-1].DT.getTime()||t.goIntoFuture)?(h=l.tickFromDate(o,s))>v-1&&h--:h=v-1;var C=h-a+1;if(C<1)i&&i(e);else{var w=t.padding||0;h<v-1&&(w=0);var k=(s.width-w)/C;for(var D in l.setCandleWidth(k,s),s.scroll=C-(h-v)-1,l.micropixels=1,l.panels)l.calculateYAxisMargins(l.panels[D].yAxis);t.dontSaveRangeToLayout?delete p.range:(delete t.chart,delete p.setSpan,p.range=t),l.draw(),l.changeOccurred("layout"),r||l.dispatch("periodicity",{stx:l,differentData:z,prevPeriodicity:{interval:O,periodicity:H,timeUnit:V}}),i&&i(e)}}else i&&i(e)}var c,u,d,p,m,g,f,v=0;function y(t){return t&&0===v?(s.scroll=E,l.setCandleWidth(N),l.layout.interval=O,l.layout.periodicity=H,l.layout.timeUnit=V,void(i&&i(t))):++v>10?(console.log("CIQ.ChartEngine.setRange(): Too many loads (10) from server. Stopping. Check periodicity logic."),void h()):void h()}if(this.quoteDriver){var x,b,S;if(r)x=this.layout.interval,S=this.layout.timeUnit,b=this.layout.periodicity;else if(t.periodicity){var C=e.cleanPeriodicity(t.periodicity.period,t.periodicity.interval,t.periodicity.timeUnit);x=C.interval,S=C.timeUnit,b=C.period}else{var w=o.getTime()-n.getTime();if(this.autoPickCandleWidth.turnOn){var k=0;k=this.autoPickCandleWidth.candleWidth?this.autoPickCandleWidth.candleWidth:this.chart.barsHaveWidth?5:2;var D,T=s.width/k,M=this.dynamicRangePeriodicityMap;x=M[0].interval,b=1;for(var A=0;A<M.length;A++){var _=w/M[A].rangeInMS;if(_<T){M[A-1]?(x=M[A-1].interval,S=M[A-1].timeUnit,b=Math.ceil(D/T)):(x=M[A].interval,S=M[A].timeUnit,b=1);break}D=_}}else{for(var F=this.staticRangePeriodicityMap,P=null,I=0;I<F.length;I++){var L=F[I];if(w/L.rangeInMS<1.001){P=L;break}}x=P.interval,b=P.periodicity,S=P.timeUnit}}var E=this.chart.scroll,N=this.layout.candleWidth,O=this.layout.interval,H=this.layout.periodicity,V=this.layout.timeUnit;this.chart.scroll=this.chart.maxTicks=(c=o.getTime(),u=n.getTime(),d=x,p=b,m=S,this.dontRoll,g=0,f=c-u,e.ChartEngine.isDailyInterval(d)?g="month"==d?f/e.MONTH/p:"week"==d?f/e.WEEK/p:f/e.DAY/p:isNaN(d)||(g="millisecond"==m?f/(p*d):"second"==m?f/e.SECOND/(p*d):f/e.MINUTE/(p*d)),Math.round(g)),this.layout.candleWidth=this.chart.width/this.chart.maxTicks;var z=this.needDifferentData({period:b,interval:x,timeUnit:S});if(Object.keys(this.chart.endPoints).length&&(this.chart.endPoints.begin>n||this.chart.endPoints.end<o)&&(z=!0),!this.chart.masterData||!this.chart.masterData.length||z||t.forceLoad){this.layout.interval=x,this.layout.periodicity=b,this.layout.timeUnit=S,this.layout.timeUnit||(e.ChartEngine.isDailyInterval(this.layout.interval)?this.layout.timeUnit=null:"second"==this.layout.interval?this.layout.timeUnit="second":"tick"!=this.layout.interval&&(this.layout.timeUnit="minute"));var R={symbol:s.symbol,symbolObject:s.symbolObject,chart:s,nodraw:!0};"tick"==this.layout.interval&&(R.startDate=n,R.endDate=o),this.displayInitialized||(R.initializeChart=!0);var B={symbol:s.symbol,symbolObject:s.symbolObject,interval:this.layout.interval};"month"!=B.interval&&"week"!=B.interval||this.dontRoll||(B.interval="day");var Q=Math.max(this.quoteDriver.getQuoteFeed(B).behavior.bufferSize+50,200);a=this.standardMarketIterator(n,null,s),R.startDate=new Date(a.previous(Q).getTime()),a=this.standardMarketIterator(o,null,s),R.endDate=new Date(a.next(Q).getTime()),R.endDate<Date.now()&&(this.isHistoricalModeSet=!0),this.clearCurrentMarketData(this.chart),clearTimeout(this.streamParameters.timeout),this.quoteDriver.newChart(R,y)}else this.layout.interval==x&&this.layout.periodicity==b&&this.layout.timeUnit==S&&this.chart.dataSegment&&this.chart.dataSegment[0]&&this.chart.dataSegment[0].DT==s.inflectionPoint||(this.layout.interval=x,this.layout.periodicity=b,this.layout.timeUnit=S,this.createDataSet()),y()}else h()},e.ChartEngine.prototype.setSpan=function(t,i){var a=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];"object"==typeof t?(a=t.period?t.period:t.multiplier?t.multiplier:1,r=t.interval?t.interval:t.base?t.base:t.span?t.span:t.period,s=t.padding,n=t.chart):(t={period:a,interval:r,padding:s,chart:n},i=arguments[5]),n||(n=this.chart);var o,l=n.market;if("all"==(r=r.toLowerCase()))return t.dontSaveRangeToLayout=!0,void this.displayAll(t,i);var h=r,c=1;"today"==r?h="day":"year"==r&&(h="month",c=12);var u=e.shallowClone(t),d={begin:l.marketZoneNow(),interval:h,period:c},p=d.begin;function m(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}var g=e.Market.Symbology.isForexSymbol(n.symbol);function f(t,e){if(!g)return t;return e?t.setHours(t.getHours()+7):(t.setHours(t.getHours()-7),l.isMarketDate(t)||t.setDate(t.getDate()-2)),t}if("ytd"===r)(p=m(p)).setMonth(0),p.setDate(1);else if("month"===r)(p=m(new Date)).setMonth(p.getMonth()-a);else if("year"===r)(p=m(new Date)).setFullYear(p.getFullYear()-a);else if("week"===r)(p=m(new Date)).setDate(p.getDate()-7*a);else if("day"===r&&1==a&&l.isMarketDay()){var v=p.getHours(),y=p.getMinutes(),x=p.getSeconds(),b=p.getMilliseconds();(p=(o=l.newIterator(d)).previous()).setHours(v,y,x,b),p=l._convertFromMarketTZ(p)}else"today"===r?(d.begin=f(p,!0),o=l.newIterator(d),(l.isOpen()||l.getPreviousOpen().getDate()==p.getDate())&&o.next(),f(p=o.previous()),u.goIntoFuture=!0,u.dtRight=new Date(+p),u.dtRight.setDate(p.getDate()+1),u.dtRight=l._convertFromMarketTZ(u.dtRight),g||(p.setHours(o.market.zopen_hour),p.setMinutes(o.market.zopen_minute),p.setSeconds(0)),p=l._convertFromMarketTZ(p)):("day"==r&&(d.begin=f(p,!0)),1==a&&a++,p=(o=l.newIterator(d)).previous(a-1),"day"==r&&(p=l._convertFromMarketTZ(f(p))));u.dtLeft=p,u.maintainPeriodicity&&(u.periodicity={},u.periodicity.interval=this.layout.interval,u.periodicity.period=this.layout.periodicity),n.spanLock=!1,u.dontSaveRangeToLayout=!0;var S=this;this.setRange(u,(function(e){S.layout.setSpan=t,S.changeOccurred("layout"),"today"==r&&(n.spanLock=!0),i&&i(e)}))},e.ChartEngine.prototype.getSpanCandleWidth=function(t){if(t&&t.base&&t.multiplier){var e=parseFloat(t.multiplier),i=t.base,a=new Date,r=new Date;"year"==i?r.setFullYear(r.getFullYear()-e):"month"==i?r.setMonth(r.getMonth()-e):"day"==i?r.setDate(r.getDate()-e):"week"==i?r.setDate(r.getDate()-7*e):"YTD"==i&&(r.setMonth(0),r.setDate(1));var s=(a.getTime()-r.getTime())/1e3/60/60/24;return s=5*s/7,this.chart.width/s}},e.ChartEngine.prototype.displayAll=function(t,i){var{chart:a,layout:r}=this;t&&t.chart&&(a=t.chart);const s=this;function n(){if(a.masterData&&a.masterData.length){var n=e.clone(t);n.dtLeft=a.endPoints.begin.DT,n.dtRight=a.endPoints.end.DT,n.periodicity={},n.periodicity.interval=r.interval,n.periodicity.period=r.periodicity,n.periodicity.timeUnit=r.timeUnit,s.setRange(n,(function(e){for(var a in s.layout.setSpan={base:t.base,multiplier:t.multiplier},s.changeOccurred("layout"),s.panels)s.calculateYAxisMargins(s.panels[a].yAxis);s.draw(),i&&i(e)}))}}function o(t){t||s.quoteDriver.loadAll(a,n)}if(this.quoteDriver){var l=t.maintainPeriodicity?{period:r.periodicity,interval:r.interval,timeUnit:r.timeUnit}:{period:1,interval:"month",timeUnit:null};l=t.periodicity?t.periodicity:l,l=e.cleanPeriodicity(l.period,l.interval,l.timeUnit);var h=this.needDifferentData(l);this.layout.periodicity=l.period,this.layout.interval=l.interval,this.layout.timeUnit=l.timeUnit,t.forceLoad||h?(this.clearCurrentMarketData(this.chart),this.quoteDriver.newChart({noDraw:!0,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,chart:this.chart,initializeChart:!0,fetchMaximumBars:!0},o)):a.moreAvailable||!a.upToDate?o():(this.createDataSet(),n())}else n()}},v=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ChartEngine.prototype.importLayout=function(t,i){if(t){var a=this,r=[];"object"!=typeof i&&(i={managePeriodicity:arguments[1],preserveTicksAndCandleWidth:arguments[2]});var s=this.layout,n=e.shallowClone(s),o=i.managePeriodicity,l=i.cb,h=i.seriesCB,c=i.noDataLoad,u=i.preserveTicksAndCandleWidth,d=null;for(var p in this.exportDrawings&&(d=this.exportDrawings(),this.abortDrawings()),this.currentlyImporting=!0,s.studies){var m=s.studies[p];e.getFn("Studies.removeStudy")(this,m)}this.overlays={};var g=e.shallowClone(this.panels);this.panels={};var f=e.clone(t);s.periodicity=n.periodicity,s.interval=n.interval,s.timeUnit=n.timeUnit,s.setSpan=n.setSpan,s.range=n.range,u?s.candleWidth=n.candleWidth:s.candleWidth||(s.candleWidth=8),this.setCandleWidth(s.candleWidth),s.flipped&&this.flipChart(s.flipped);var v,y,x,b=f.panels,S=function(t,e){return t.index<e.index?-1:1};for(v in b)"index"in b[v]||(S=null),(y=b[v]).name=v,r.push(y);s.panels={};var C=null;if(r.length>0){S&&r.sort(S);for(var w=0;w<r.length;++w)x=(y=r[w]).yAxis?new e.ChartEngine.YAxis(y.yAxis):null,this.stackPanel(y.display,y.name,y.percent,y.chartName,x),y.soloing&&(C=this.panels[y.name])}for(var k in e.isEmpty(b)&&this.stackPanel("chart","chart",1,"chart"),this.resizeCanvas(),g){var D=g[k],T=this.panels[k];if(T){this.container.removeChild(T.holder),D.handle&&this.container.removeChild(D.handle);for(var M in{holder:!0,subholder:!0,display:!0,icons:!0})T[M]=D[M];this.configurePanelControls(T),D.chart.panel==D&&(D.chart.panel=T)}else this.privateDeletePanel(D)}this.chart.panel=this.panels.chart,H(this.panels),e.dataBindSafeAssignment(s,e.clone(f));var A=e.clone(s.studies);for(var _ in delete s.studies,A){var F=A[_];e.getFn("Studies.addStudy")(this,F.type,F.inputs,F.outputs,F.parameters,F.panel)}if(this.extendedHours&&this.extendedHours.prepare(s.extended,s.marketSessions),void 0===s.chartType&&(s.chartType="line"),this.setMainSeriesRenderer(),C&&this.panelSolo(C),this.adjustPanelPositions(),H(this.panels),this.storePanels(),!c){if(f.symbols&&f.symbols.length){var P={chart:this.chart};!u&&o&&f.range&&Object.keys(f.range).length?P.range=f.range:!u&&o&&f.setSpan&&Object.keys(f.setSpan).length?P.span=f.setSpan:o&&f.interval?P.periodicity={interval:f.interval,period:f.periodicity,timeUnit:f.timeUnit}:P.periodicity={interval:n.interval,period:n.periodicity,timeUnit:n.timeUnit};var I=f.symbols[0].symbolObject||f.symbols[0].symbol;return void this.loadChart(I,P,(function(t){if(!t){for(var i,r=1;r<f.symbols.length&&a.addSeries;++r){(i=f.symbols[r]).parameters||(i.parameters={});var s=e.clone(i.parameters);this.panels[s.panel]?a.addSeries(i.id,s,z):console.warn('Warning: Series "'+i.id+'" could not be imported due to a missing corresponding panel "'+s.panel+'"')}f.chartScale&&a.setChartScale(f.chartScale)}V(t),l&&l.apply(null,arguments)}))}if(o){if(!u&&this.setRange){var L=f.range;if(L&&Object.keys(L).length&&this.chart.symbol)return void this.setRange(L,(function(){V(),l&&l()}));if(f.setSpan&&Object.keys(f.setSpan).length&&this.chart.symbol)return void this.setSpan(f.setSpan,(function(){V(),l&&l()}))}var E=f.interval,N=f.periodicity,O=f.timeUnit;return isNaN(N)&&(N=1),E||(E="day"),void this.setPeriodicity({period:N,interval:E,timeUnit:O},(function(){V(),l&&l()}))}}o&&(s.periodicity=f.periodicity,s.interval=f.interval,s.timeUnit=f.timeUnit,s.setSpan=f.setSpan),this.createDataSet(),u||this.home(),V(),l&&l()}else i.cb&&i.cb();function H(t){function e(t){return!!t}function i(i,a){if(i[a]&&i[a].length){var r=t[i.name];if(r){for(var s=r[a],n=new Array(s.length),o=0;o<s.length;o++){var l=i[a].indexOf(s[o].name);l>-1?n[l]=s[o]:n.push(s[o])}n.length&&(r[a]=n.filter(e))}}}for(var s=0;s<r.length;s++){var n=r[s];i(n,"yaxisLHS"),i(n,"yaxisRHS")}a.chart.yAxis=a.chart.panel.yAxis}function V(t){if(d&&a.importDrawings(d),a.currentlyImporting=!1,!t){var e,i,r=[];for(var s in a.chart.series){if(!a.removeSeries)break;"study"==(i=a.chart.series[s]).parameters.bucket&&(e=!0,a.removeSeries(i),r.push(i))}for(var n=0;n<r.length;n++)i=r[n],a.addSeries(i.id,i.parameters,o);e||a.draw(),a.updateListeners("layout"),a.changeOccurred("layout")}function o(){a.createDataSet(),H(a.panels),a.calculateYAxisPositions(),a.draw()}}function z(){a.calculateYAxisPositions(),H(a.panels),h&&h()}},e.ChartEngine.prototype.exportLayout=function(t){var i={};for(var a in this.layout)"studies"!=a&&"panels"!=a&&"drawing"!=a?i[a]=e.clone(this.layout[a]):"studies"==a?i.studies={}:"panels"==a&&(i.panels={});function r(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].name);return e}var s=0;for(var n in this.panels){var o=this.panels[n];if(!1!==o.exportable){var l=i.panels[n]={};l.percent=o.percent,l.display=o.display,l.chartName=o.chart.name,l.soloing=o.soloing,l.index=s++,l.yAxis={name:o.yAxis.name,position:o.yAxis.position},o.yaxisLHS&&(l.yaxisLHS=r(o.yaxisLHS)),o.yaxisRHS&&(l.yaxisRHS=r(o.yaxisRHS))}}for(var h in this.layout.studies){var c=i.studies[h]={},u=this.layout.studies[h];c.type=u.type,c.inputs=e.clone(u.inputs),c.outputs=e.clone(u.outputs),c.panel=u.panel,c.parameters=e.clone(u.parameters)}return t?i.symbols=this.getSymbols({"include-parameters":!0,"exclude-studies":!0,"exclude-generated":!0}):delete i.symbols,i},e.ChartEngine.prototype.importPreferences=function(t){e.extend(this.preferences,t),t.timeZone&&this.setTimeZone(this.dataZone,t.timeZone),t.language&&e.I18N&&e.I18N.localize(this,t.language),this.changeOccurred("preferences")},e.ChartEngine.prototype.exportPreferences=function(){return this.preferences}},y=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,i="undefined"!=typeof _timezoneJS?_timezoneJS:t.timezoneJS;e.ChartEngine&&(e.ChartEngine.prototype.rightClickOverlay=function(t,e){if(!this.runPrepend("rightClickOverlay",arguments)){var i=this.overlays[t];i.editFunction?i.editFunction(e):this.removeOverlay(t),this.runAppend("rightClickOverlay",arguments)}},e.ChartEngine.prototype.addOverlay=function(t){this.runPrepend("addOverlay",arguments)||(this.overlays[t.name]=t,this.runAppend("addOverlay",arguments))},e.ChartEngine.prototype.removeOverlay=function(t){if(!this.runPrepend("removeOverlay",arguments)){var i=this.overlays[t];for(var a in this.overlays){var r=this.overlays[a],s=["Field"];e.Studies&&(s=e.Studies.getFieldInputs(r));for(var n=0;n<s.length;n++)i.outputMap[r.inputs[s[n]]]&&this.removeOverlay(r.name)}if(i){this.cleanupRemovedStudy(i);this.panels[i.panel];delete this.overlays[t],this.checkForEmptyPanel(i.panel)}this.currentlyImporting||(this.displaySticky(),this.createDataSet(),this.changeOccurred("layout")),this.resetDynamicYAxis(),this.runAppend("removeOverlay",arguments)}},e.ChartEngine.prototype.cleanupRemovedStudy=function(t){if(t){for(var i in t.study.removeFN&&t.study.removeFN(this,t),this.plugins)i.indexOf("{"+t.id+"}")>-1&&delete this.plugins[i];this.layout.studies&&delete this.layout.studies[t.name],delete this.overlays[t.name],e.Studies&&e.Studies.removeStudySymbols(t,this),this.quoteDriver&&this.quoteDriver.updateSubscriptions()}}),e.Studies=e.Studies||function(){},e.Studies.DEFAULT_INPUTS={Period:14},e.Studies.DEFAULT_OUTPUTS={Result:"auto"},e.Studies.sortForProcessing=t=>{let e=[];const i=t.layout.studies;return i&&function e(i,a){i.forEach((i=>{if(-1==a.indexOf(i)){let r=i.getDependents(t);r.length&&e(r,a),a.unshift(i)}}))}(Object.values(i),e),e},e.Studies.StudyDescriptor=function(t,i,a,r,s,n){this.name=t,this.type=i,this.panel=a,this.inputs=r,this.outputs=s,this.parameters=n,this.outputMap={},this.min=null,this.max=null,this.startFrom=0,this.subField="Close";var o=e.Studies.studyLibrary[i];o||(o={},("chart"==a||!a&&n&&"chart"==n.chartName)&&(this.overlay=!0)),void 0===o.inputs&&(o.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===o.outputs&&(o.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS)),this.study=o,this.libraryEntry=o},e.Studies.StudyDescriptor.prototype.getYAxis=function(t){var e,i=this.yAxis;if(this.parameters&&(e=this.parameters.yaxisDisplayValue),!i){var a=t.panels[this.panel];a&&(i=t.getYAxisByName(a,e)||t.getYAxisByName(a,this.name)||a.yAxis)}return i||(i=t.getYAxisByName(t.chart.panel,e)||t.chart.panel.yAxis),i},e.Studies.StudyDescriptor.prototype.getContext=function(t){return t.chart.context},e.Studies.StudyDescriptor.prototype.getDependents=function(t,i){var a=[];for(var r in t.layout.studies){var s=t.layout.studies[r];if(s!=this)for(var n=e.Studies.getFieldInputs(s),o=0;o<n.length;o++)if(s.inputs[n[o]].includes(this.name)){if(i&&s.parameters&&s.parameters.panelName)continue;a.push(s),a=a.concat(s.getDependents(t,i));break}}return a},e.Studies.StudyDescriptor.prototype.undraggable=function(t){var e=this.study.attributes;if(e){if(e.panelName&&e.panelName.hidden)return!0;if(e.yaxisDisplayValue&&e.yaxisDisplayValue.hidden)return!0}return!1},e.Studies.StudyDescriptor.prototype.appendFutureTicks=function(t,e){var i=t.chart.scrubbed;if(i.length){var a,r,s=t.standardMarketIterator(i[i.length-1].DT);for(a=e.length-1;a>=0;a--){for(var n in r=e[a])if(r[n]||0===r[n]){a=-1;break}if(-1==a)break;e.pop()}for(a=0;a<e.length;a++)(r=e[a]).DT||(r.DT=s.next()),r.displayDate||t.setDisplayDate(r),r.futureTick=!0,i.push(r)}},e.Studies.generateID=function(t,i,a,r,s){var n=e.Studies.studyLibrary[i],o="‌"+(s||i)+"‌";if(n&&n.customRemoval)return o;if(!e.isEmpty(a)){var l=!0;for(var h in a)if(!["id","display","Shading","Anchor Selector"].includes(h)){var c=a[h];"field"!=c&&(c=c.toString(),void 0!==e.Studies.prettify[c]&&(c=e.Studies.prettify[c]),l?(l=!1,o+=" ("):c&&(o+=","),o+=c)}l||(o+=")")}if(r&&0===r.indexOf(o))return r;if(t.layout.studies&&t.layout.studies[o])for(var u=2;u<50;u++){var d=o+"-"+u;if(!t.layout.studies[d]){o=d;break}}return o},e.Studies.DialogHelper=function(t){var i=this.stx=t.stx,a=this.sd=t.sd;this.name=a?a.type:t.name,this.signal=1,this.inputs=[],this.outputs=[],this.parameters=[];var r=this.libraryEntry=a?a.study:e.Studies.studyLibrary[t.name];void 0===r.inputs&&(r.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===r.outputs&&(r.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS));var s=a&&i.panels[a.panel]?i.panels[a.panel]:i.chart.panel,n=s.chart;for(var o in this.title=i.translateIf(r.name),this.attributes=e.clone(r.attributes),this.attributes||(this.attributes={}),this.attributes){var l=this.attributes[o];for(var h in l)"function"==typeof l[h]&&(l[h]=l[h].call(a))}function c(t,e){this.attributes[t]||(this.attributes[t]={}),e&&(this.attributes[t].hidden=!0)}var u=[],d=i.layout.studies,p=[];for(var m in a&&(p=Array.prototype.concat(a,a.getDependents(i))),d)if(!(p.indexOf(d[m])>-1))for(var g in d[m].outputMap)u.push(g);for(var f in r.inputs){var v={};this.inputs.push(v),v.name=f,v.heading=i.translateIf(f);var y=r.inputs[f];if(a&&a.inputs&&void 0!==a.inputs[f]&&null!==a.inputs[f]?v.value=a.inputs[f]:v.value=r.inputs[f],v.defaultInput=r.inputs[f],this.attributes[f]||(this.attributes[f]=e.Studies.inputAttributeDefaultGenerator(v.defaultInput)),y.constructor==Number)v.type="number";else if(y.constructor==String){var x=e.Studies.movingAverageHelper(i,v.defaultInput);if(x){v.type="select",v.defaultInput=x;var b=e.Studies.movingAverageHelper(i,v.value);b||(b=v.value),v.value=b,v.options=e.Studies.movingAverageHelper(i,"options")}else if("field"==y){v.type="select",v.options={};for(var S=["Open","High","Low","Close","Adj_Close","hl/2","hlc/3","hlcc/4","ohlc/4",n.defaultPlotField].concat(u),C=0;C<S.length;C++){var w=S[C];v.options[w]=i.translateIf(w)}"field"==v.value&&(v.value="Close"),"field"==v.defaultInput&&(v.defaultInput="Close")}else v.type="text","yyyy-mm-dd"==this.attributes[f].placeholder?v.type="date":"hh:mm:ss"==this.attributes[f].placeholder&&(v.type="time")}else if(y.constructor==Boolean)v.type="checkbox",!0!==v.value&&"true"!=v.value&&"on"!=v.value||(v.value=!0);else if(y.constructor==Array){v.type="select",v.options={};for(var k=0;k<y.length;k++)v.options[y[k]]=i.translateIf(y[k]);v.value.constructor==Array&&(v.value=v.value[0]),this.attributes[f].defaultSelected?v.defaultInput=this.attributes[f].defaultSelected:v.defaultInput=y[0]}}this.dateTimeInputs=[];for(var D=0;D<this.inputs.length;D++){var T=this.inputs[D];if("date"==T.type)for(var M=T.name.substring(0,T.name.indexOf(" Date")),A=0;A<this.inputs.length;A++){var _=this.inputs[A];if("time"==_.type&&_.name==M+" Time"){this.dateTimeInputs.push(M);break}}}for(f in this.adjustInputTimesForDisplayZone(),r.outputs){var F={name:f,heading:i.translateIf(f)};F.color=F.defaultOutput=r.outputs[f],a&&a.outputs&&a.outputs[f]&&(F.color=a.outputs[f]),"auto"==F.color&&(F.color=i.defaultColor),this.outputs.push(F)}var P=a?a.parameters:null;if(r.parameters){var I,L=r.parameters.init;if(L)void 0!==L.studyOverZonesEnabled&&(I={name:"studyOverZones",heading:i.translateIf("Show Zones"),defaultValue:L.studyOverZonesEnabled,value:L.studyOverZonesEnabled},P&&(P.studyOverZonesEnabled||!1===P.studyOverZonesEnabled)&&(I.value=P.studyOverZonesEnabled),I.type="checkbox",this.parameters.push(I)),void 0!==L.studyOverBoughtValue&&(I={name:"studyOverBought",heading:i.translateIf("OverBought"),defaultValue:L.studyOverBoughtValue,value:L.studyOverBoughtValue,defaultColor:L.studyOverBoughtColor,color:L.studyOverBoughtColor},P&&P.studyOverBoughtValue&&(I.value=P.studyOverBoughtValue),P&&P.studyOverBoughtColor&&(I.color=P.studyOverBoughtColor),"auto"==I.color&&(I.color=i.defaultColor),I.type="text",this.parameters.push(I)),void 0!==L.studyOverSoldValue&&(I={name:"studyOverSold",heading:i.translateIf("OverSold"),defaultValue:L.studyOverSoldValue,value:L.studyOverSoldValue,defaultColor:L.studyOverSoldColor,color:L.studyOverSoldColor},P&&P.studyOverSoldValue&&(I.value=P.studyOverSoldValue),P&&P.studyOverSoldColor&&(I.color=P.studyOverSoldColor),"auto"==I.color&&(I.color=i.defaultColor),I.type="text",this.parameters.push(I)),this.attributes.studyOverBoughtValue||(this.attributes.studyOverBoughtValue={}),this.attributes.studyOverSoldValue||(this.attributes.studyOverSoldValue={})}function E(t){for(var e={},a=t.defaults,r={name:t.name,heading:i.translateIf(t.label),defaultValue:a[0],value:t.value,options:e,type:"select"},s=0;s<a.length;s++)e[a[s]]=i.translateIf(a[s]);return void 0!==t.color&&(r.defaultColor=i.defaultColor,r.color=t.color),r}function N(t){return{name:t.name,heading:i.translateIf(t.label),defaultValue:t.defaults,value:t.value,type:"checkbox"}}var O=this.panelSelect=t.panelSelect,H=this.axisSelect=t.axisSelect;function V(t){function e(t,e){return"Panel "+e.toString()}if("alias"==O){var a=1;for(var r in i.panels){if(r==t)return e(0,a);a++}}return t}if(t.addWhenDone&&(H=O=!1),H||O){a||(a=e.Studies.addStudy(i,t.name,null,null,{calculateOnly:!0}),e.Studies.removeStudy(i,a)),O&&this.parameters.push(E({label:"Panel",name:"panelName",defaults:function(){var t=[];for(var e in t.push("Auto"),i.panels)e==a.panel&&P&&P.panelName||t.push(V(e));return i.checkForEmptyPanel(a.panel,!0,a)||t.push("New panel"),t}(),value:P&&P.panelName?V(P.panelName):"Auto"}),N({label:"Show as Underlay",name:"underlay",defaults:!1,value:a.underlay||a.parameters&&a.parameters.underlayEnabled}));var z=i.getYAxisByName(s,a.name);H&&this.parameters.push(E({label:"Y-Axis",name:"yaxisDisplay",defaults:function(){var t=s.yaxisLHS.concat(s.yaxisRHS),e=[];e.push("default","right","left","none","shared");for(var i=0;i<t.length;i++)t[i]!=z&&e.push(t[i].name);return e}(),value:P&&P.yaxisDisplayValue||z&&z.position||(a.panel!=a.name?"shared":s.yAxis.position||"default"),color:z&&z.textStyle?z.textStyle:"auto"}),N({label:"Invert Y-Axis",name:"flipped",defaults:!1,value:P?P.flippedEnabled:!!z&&z.flipped})),c.call(this,"flippedEnabled",!z&&a.panel!=a.name),c.call(this,"underlayEnabled",r.underlay),c.call(this,"panelName",null===r.seriesFN),c.call(this,"yaxisDisplayValue",null===r.seriesFN||r.yAxis&&r.yAxis.noDraw)}},e.Studies.DialogHelper.prototype.updateStudy=function(t){var i={},a=this.sd,r=this.libraryEntry;r||(r={}),a||(a=r),i.inputs=e.clone(a.inputs),i.outputs=e.clone(a.outputs),i.parameters=e.clone(a.parameters),this.adjustInputTimesForDisplayZone(t),t.parameters&&t.parameters.panelName&&(t.parameters.panelName=function(t){if("alias"==this.panelSelect){var e=function(t){var e=t.match(/.* (\d)/);return e&&e[1]}(t);if(e)for(var i in this.stx.panels)if(!--e)return i}return t}.call(this,t.parameters.panelName)),e.extend(i,t),i.parameters||(i.parameters={}),a=i.inputs&&i.inputs.id?e.Studies.replaceStudy(this.stx,i.inputs.id,this.name,i.inputs,i.outputs,i.parameters,null,a.study):e.Studies.addStudy(this.stx,this.name,i.inputs,i.outputs,i.parameters,null,a.study);var s=new e.Studies.DialogHelper({stx:this.stx,sd:a,axisSelect:this.axisSelect,panelSelect:this.panelSelect});for(var n in s)"signal"!=n&&(this[n]=s[n]);this.signal*=-1},e.Studies.DialogHelper.prototype.adjustInputTimesForDisplayZone=function(t){if(this.stx.displayZone)for(var i=0;i<this.dateTimeInputs.length;i++){var a,r,s,n,o=this.dateTimeInputs[i],l="";for(t&&t.inputs&&((r=t.inputs[o+" Date"])&&(l=r),(s=t.inputs[o+" Time"])&&(l+=s)),a=0;a<this.inputs.length;a++)n=this.inputs[a],r||""===r||n.name!=o+" Date"?s||""===s||n.name!=o+" Time"||(l+=n.value):l=n.value+l;if((l=l.replace(/\D/g,"")).length<12)return;var h,c=e.strToDateTime(l);if(!isNaN(c.valueOf()))if(t)t.inputs||(t.inputs={}),h=e.convertTimeZone(c,this.stx.displayZone),t.inputs[o+" Date"]=e.yyyymmdd(h),t.inputs[o+" Time"]=e.hhmmss(h);else for(h=e.convertTimeZone(c,null,this.stx.displayZone),a=0;a<this.inputs.length;a++)(n=this.inputs[a]).name==o+" Date"&&(n.value=e.yyyymmdd(h)),n.name==o+" Time"&&(n.value=e.hhmmss(h))}},e.Studies.prepareStudy=function(t,i,a){if(void 0===i.calculateFN&&(i.useRawValues=!0),e.isEmpty(a.outputMap))for(var r in a.outputs)i.useRawValues?a.outputMap[r]=r:a.outputMap[r+" "+a.name]=r},e.Studies.rejiggerDerivedStudies=function(t,i,a){for(var r=i.name,s=(i.panel,i.getDependents(t)),n=0;n<s.length;n++){var o=s[n],l=e.clone(o.inputs),h=l.id;if(h){for(var c=e.Studies.getFieldInputs(o),u=0;u<c.length;u++)l[c[u]]=l[c[u]].replace(r,a);delete e.Studies.replaceStudy(t,h,o.type,l,o.outputs,e.extend(o.parameters,{rejiggering:!0}),null,o.study).parameters.rejiggering}}},e.Studies.removeStudySymbols=function(t,e){if(t.series)for(var i in t.series)e.deleteSeries(t.series[i],null,{action:"remove-study"})},e.Studies.replaceStudy=function(t,i,a,r,s,n,o,l){n||(n={}),i&&(n.replaceID=i),i=n.replaceID;var h,c=t.layout.studies[i];e.Studies.removeStudySymbols(c,t),c.attribution&&t.removeFromHolder(c.attribution.marker),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),r&&(r.id==r.display&&delete r.display,delete r.id),(h=e.Studies.addStudy(t,a,r,s,n,o,l)).highlight=c.highlight,h.uniqueId=c.uniqueId;var u,d={};for(u in t.layout.studies)u==i?d[h.name]=h:d[u]=t.layout.studies[u];for(u in t.layout.studies=d,d={},t.overlays)u==i?(h.overlay||h.underlay)&&(d[h.name]=h):d[u]=t.overlays[u];return t.overlays=d,t.overlays[h.name]||!h.overlay&&!h.underlay||t.addOverlay(h),t.checkForEmptyPanel(c.panel),n.rejiggering||(t.initializeDisplay(t.chart),e.Studies.rejiggerDerivedStudies(t,c,h.inputs.id,h.panel),t.changeOccurred("layout"),t.currentlyImporting||n.calculateOnly||!h.chart.dataSet||t.createDataSet(null,h.chart),t.draw()),e.transferObject(c,h),t.layout.studies[h.name]=c,t.overlays[h.name]=c,t.chart.state.studies.sorted=null,c},e.Studies.addStudy=function(t,i,a,r,s,n,o){var l=o||e.Studies.studyLibrary[i];if(s||(s={}),l){if(l.inputs){var h=e.clone(l.inputs);for(var c in h)h[c]instanceof Array&&(l.attributes&&l.attributes[c]&&l.attributes[c].defaultSelected?h[c]=l.attributes[c].defaultSelected:h[c]=h[c][0]);a=e.extend(h,a)}l.outputs&&(r=e.extend(e.clone(l.outputs),r));var u=l.parameters;u&&u.init&&(s=e.extend(e.clone(u.init),s)),u&&!s.display&&(s.display=u.display)}a||(a=e.clone(e.Studies.DEFAULT_INPUTS)),r||(r=e.clone(e.Studies.DEFAULT_OUTPUTS)),s.chartName||(s.chartName="chart"),"Auto"!=s.panelName&&"Default panel"!=s.panelName||(s.panelName=""),a.Period<1&&(a.Period=1);var d=null;if(t.layout.studies||(t.layout.studies={}),d=l&&l.initializeFN?l.initializeFN(t,i,a,r,s,n,o):e.Studies.initializeFN(t,i,a,r,s,n,o)){o=d.study,d.chart=t.charts[s.chartName],d.type=i,d.permanent=o.permanent,d.customLegend=o.customLegend,d.uniqueId=e.uniqueID(),e.Studies.prepareStudy(t,o,d);var p,m=t.chart.state.studies;if(m||(m=t.chart.state.studies={}),m.sorted=null,s.replaceID?(p=!0,delete s.replaceID):(t.layout.studies[d.inputs.id]=d,(d.overlay||d.underlay)&&t.addOverlay(d),t.currentlyImporting||s.calculateOnly||!d.chart.dataSet||t.createDataSet(null,d.chart)),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),s.calculateOnly)return t.changeOccurred("layout"),d;var g=t.panels[d.panel],f=!1,v=!(d.overlay||d.underlay);if(v&&o.horizontalCrosshairFieldFN&&(g.horizontalCrosshairField=o.horizontalCrosshairFieldFN(t,d)),t.editCallback?f=!0:v?t.callbackListeners.studyPanelEdit&&t.callbackListeners.studyPanelEdit.length&&(f=!0):t.callbackListeners.studyOverlayEdit&&t.callbackListeners.studyOverlayEdit.length&&(f=!0),f){s.editMode=!0;var y,x=!1;for(var b in d.inputs)if("id"!=b&&"display"!=b){x=!0;break}if(!x)for(var S in d.outputs){x=!0;break}if(x)void 0!==d.study.edit?d.study.edit&&(y=function(t,i,a,r){return function(){e.clearCanvas(t.chart.tempCanvas,t),i.study.edit(i,{stx:t,inputs:a,outputs:r,parameters:s})}}(t,d,a,r),t.setPanelEdit(g,y),d.editFunction=y):v?t.editCallback?(y=function(t,a,r,n){return function(){var o=t.editCallback(t,a);e.clearCanvas(t.chart.tempCanvas,t),e.Studies.studyDialog(t,i,o,{inputs:r,outputs:n,parameters:s})}}(t,d,a,r),"chart"!=g.name&&t.setPanelEdit(g,y)):(y=function(t,i,a,r,s){return function(){e.clearCanvas(t.chart.tempCanvas,t),t.dispatch("studyPanelEdit",{stx:t,sd:i,inputs:a,outputs:r,parameters:s})}}(t,d,a,r,s),"chart"!=g.name&&(t.setPanelEdit(g,y),d.editFunction=y)):(y=function(t,i,a,r,s){return function(n){e.clearCanvas(t.chart.tempCanvas,t),t.dispatch("studyOverlayEdit",{stx:t,sd:i,inputs:a,outputs:r,parameters:s,forceEdit:n})}}(t,d,a,r,s),d.editFunction=y)}return t.changeOccurred("layout"),p||t.draw(),d}console.log("CIQ.Studies.addStudy: initializeFN() returned null for "+i)},e.Studies.removeStudy=function(t,e){var i=t.panels[e.panel],a=i&&i.yAxis.name;(e.overlay||e.underlay)&&t.removeOverlay(e.name);var r=t.panels[e.panel];if(e.attribution&&t.removeFromHolder(e.attribution.marker),delete t.layout.studies[e.name],r&&!t.checkForEmptyPanel(r)){a==e.name&&t.electNewPanelOwner(r);var s=t.getYAxisByName(e.panel,e.name);s&&(s.name=s.studies[1]||s.renderers[0])}t.draw(),t.resizeChart()},e.Studies.getPanelFromFieldName=function(t,i){var a=e.Studies.getFieldInputs(i);if(!a.length)return null;var r=t.layout.studies;if(!r)return null;var s={};for(var n in r)for(var o in r[n].outputMap)s[o]=r[n].panel;for(var l=0;l<a.length;l++){var h=i.inputs[a[l]];if(h){var c=s[h];if(c)return c}}return null},e.Studies.createLibraryHash=function(){return Object.keys(e.Studies.studyLibrary).join("|")},e.Studies.displayStudies=function(t,i,a){a&&(i.studyLibraryHash=e.Studies.createLibraryHash());var r=t.layout.studies;if(r){var s={};for(var n in s[i.name]=!0,r){var o=r[n],l=o.study;if(l){var h=o.underlay||o.parameters&&o.parameters.underlayEnabled;if(!(a&&!h||!a&&h)){var c=e.clone(l.renderer);!c||c instanceof Array||(c=[c]);var u=t.panels[o.panel];if(u){if(u.chart==i&&!u.hidden){if(!s[u.name]){var d=o.permanent||!t.manageTouchAndMouse;u.closeX?d&&(u.closeX.style.display="none"):u.close&&d&&(u.close.style.display="none"),u.edit&&d&&(u.edit.style.display="none"),s[u.name]=d}var p=o.chart.dataSegment;if(!(o.panel!=o.parameters.chartName||o.parameters&&o.parameters.panelName)){var m=e.Studies.getPanelFromFieldName(t,o);m&&o.panel!=m&&(o.panel=m)}if(void 0===l.seriesFN){if(c){o.overlay||e.Studies.createYAxis(t,o,p,u);for(var g=0;g<c.length;g++){var f=c[g];for(var v in o.outputMap)o.outputMap[v]==f.field&&(f.field=v);if(f.field){f.panel=o.panel;var y=f.binding;if(y)for(var x in y){var b=e.Studies.determineColor(o.outputs[y[x]]);b&&"auto"!=b&&(f[x]=b)}f.yAxis=null;var S=e.Renderer.produce(f.type,f);S.stx=t,S.attachSeries(null,f).draw()}}}else e.Studies.displaySeriesAsLine(t,o,p);u&&e.Studies.displayError(t,o)}else l.seriesFN&&u&&(l.seriesFN(t,o,p),e.Studies.displayError(t,o))}}else t.currentlyImporting&&delete r[n]}}}}},e.Studies.displayError=function(t,e,i){if(e.error){var a=i&&i.panel?i.panel:e.panel,r=!0===e.error?t.translateIf("Not enough data to compute ")+t.translateIf(e.study.name):t.translateIf(e.error);!i||"center"===i.h&&"bottom"===i.v?t.displayErrorAsWatermark(a,r):t.watermark(a,i)}},e.Studies.calculateMinMaxForDataPoint=function(t,e,i){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,s=0;s<i.length;s++){var n=i[s][e];null!=n&&(isNaN(n)||(a=Math.min(n,a),r=Math.max(n,r)))}return{min:a,max:r}},e.Studies.getYAxisParameters=function(t,e){var i={},a=t.layout.studies&&t.layout.studies[e.name];if(a){var r=a.study;r.yaxis||r.yAxisFN?i.noDraw=!0:(r.parameters&&r.parameters.excludeYAxis&&(i.noDraw=!0),i.ground=r.yAxis&&r.yAxis.ground,e&&("bypass"!=r.range&&("0 to 100"==r.range?i.range=[0,100]:"-1 to 1"==r.range?i.range=[-1,1]:"0 to max"==r.range?i.range=[0,Math.max(0,e.high)]:(r.centerline||0===r.centerline)&&(i.range=[Math.min(r.centerline,e.low),Math.max(r.centerline,e.high)])),i.range&&(e.low=i.range[0],e.high=i.range[1]),a.min&&(e.min=a.min),a.max&&(e.max=a.max),a.parameters&&a.parameters.studyOverZonesEnabled&&(i.noDraw=!0)))}return i},e.Studies.doPostDrawYAxis=function(t,i){for(var a in t.layout.studies){var r=t.layout.studies[a],s=t.panels[r.panel];if(s&&!s.hidden)if(r.getYAxis(t)==i){var n=r.study;if(i.name==r.name&&(n.yaxis&&n.yaxis(t,r),n.yAxisFN&&n.yAxisFN(t,r)),e.Studies.drawZones(t,r),!r.error){var o=n.centerline;(o||0===o||null!==o&&i.highValue>0&&i.lowValue<0)&&e.Studies.drawHorizontal(t,r,null,o||0,i)}}}},e.Studies.displaySeriesAsLine=function(t,i,a){if(a.length){var r=t.panels[i.panel];if(r&&!r.hidden)for(var s in i.outputMap)e.Studies.displayIndividualSeriesAsLine(t,i,r,s,a)}},e.Studies.displaySeriesAsHistogram=function(t,e,i){if(i.length){var a=t.panels[e.panel];if(a&&!a.hidden){var r=[];for(var s in e.outputMap){var n=e.outputs[e.outputMap[s]];if(n){var o=.3;"object"==typeof n&&(o=n.opacity,n=n.color);var l={field:s,fill_color_up:n,border_color_up:n,fill_color_down:n,border_color_down:n};e.underlay&&(l.opacity_up=l.opacity_down=o||.3),r.push(l)}}var h=e.getYAxis(t),c=e.inputs,u=c.WidthFactor;if(e.study&&e.study.parameters){var d=e.study.parameters;void 0!==d.widthFactor&&(u=d.widthFactor)}var p={name:e.name,type:c.HistogramType?c.HistogramType:"overlaid",panel:e.panel,yAxis:h,widthFactor:u||.5,bindToYAxis:!0,highlight:e.highlight};t.drawHistogram(p,r)}}},e.Studies.displayIndividualSeriesAsLine=function(t,i,a,r,s){a.height||(a.height=a.bottom-a.top);var n=i.getContext(t),o=i.outputs[i.outputMap[r]];if(o){n.save(),"string"==typeof o&&(o={color:o,width:1}),n.lineWidth=o.width||1;var l=o.color;"auto"==l&&(l=t.defaultColor),n.strokeStyle=l;var h=o.pattern;n.setLineDash(e.borderPatternToArray(n.lineWidth,h)),n.lineDashOffset=0;var c=0,u=i.study,d=i.getYAxis(t);c=t.decimalPlacesFromPriceTick(d.priceTick),(i.overlay||i.underlay)&&(c=null),(d.decimalPlaces||0===d.decimalPlaces)&&(c=d.decimalPlaces);var p=null;i.parameters&&(p=i.parameters.label);var m=u.parameters;m||(m={});var g="step"==m.plotType;if(i.series)for(var f in i.series){var v=i.series[f].parameters.type;v&&(g="step"==v)}m.noLabels&&(p=!1),i.noSlopes||!1===i.noSlopes||(i.noSlopes=m.noSlopes),i.extendToEnd||!1===i.extendToEnd||(i.extendToEnd=m.extendToEnd);var y=p||t.preferences.labels&&!1!==p,x=i.gaplines;!1===x&&(x="transparent");var b=i.inputs.Symbol,S=x?t.getGapColorFunction(b,r,o,x):null;t.plotDataSegmentAsLine(r,a,{yAxis:d,skipTransform:t.panels[i.panel].name!=i.chart.name,label:y,labelDecimalPlaces:c,noSlopes:i.noSlopes,step:g,alignStepToSide:i.alignStepToSide,extendToEndOfLastBar:i.extendToEndOfLastBar,width:i.lineWidth,extendToEndOfDataSet:i.extendToEnd,gapDisplayStyle:x,highlight:i.highlight},S),u.appendDisplaySeriesAsLine&&u.appendDisplaySeriesAsLine(t,i,s,r,a),n.restore()}},e.Studies.drawHorizontal=function(t,e,i,a,r,s){var n=t.panels[e.panel],o=t.getBackgroundCanvas().context;if(n){s||(s=r.textStyle);var l=t.pixelFromPrice(a,n,r);l>r.top&&l<r.bottom&&t.plotLine(n.left,n.right,l,l,s,"segment",o,!1,{opacity:s&&s.opacity?s.opacity:.5})}},e.Studies.displayHistogramWithSeries=function(t,i,a){t.panels[i.panel];var r=.5;i.underlay&&(r=.3),e.Studies.createHistogram(t,i,a,!1,r),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.drawZones=function(t,i,a){if(i.parameters&&i.parameters.studyOverZonesEnabled){var r=parseFloat(i.parameters.studyOverSoldValue),s=parseFloat(i.parameters.studyOverBoughtValue),n=i.parameters.studyOverSoldColor,o=i.parameters.studyOverBoughtColor,l=i.zoneOutput;l||(l="Result");var h=e.Studies.determineColor(i.outputs[l]);h&&"auto"!=h&&!e.isTransparent(h)||(h=t.defaultColor),n||(n=h),n&&"auto"!=n&&!e.isTransparent(n)||(n=t.defaultColor),o||(o=h),o&&"auto"!=o&&!e.isTransparent(o)||(o=t.defaultColor);var c=t.panels[i.panel],u=i.getYAxis(t),d=u.displayBorder;!1===t.axisBorders&&(d=!1),!0===t.axisBorders&&(d=!0),0===u.width&&(d=!1);var p="left"==t.getYAxisCurrentPosition(u,c),m=u.justifyRight;m||!1===m||(m=t.chart.yAxis.justifyRight||!1===t.chart.yAxis.justifyRight?t.chart.yAxis.justifyRight:p);var g=Math.round(u.left+(p?u.width:0))+.5,f=d?3:0,v=t.getBackgroundCanvas().context,y=v.fillStyle;v.globalAlpha=.2,t.startClip(c.name,!0),v.beginPath();var x=Math.round(t.pixelFromPrice(s,c,u))+.5;v.strokeStyle=o,v.moveTo(c.left,x),v.lineTo(c.right,x),v.stroke(),v.closePath(),v.beginPath();var b=Math.round(t.pixelFromPrice(r,c,u))+.5;v.strokeStyle=n,v.moveTo(c.left,b),v.lineTo(c.right,b),v.stroke(),v.closePath();var S=new e.Plotter;if(S.newSeries("border","stroke",t.canvasStyle("stx_grid_border")),d){var C=p?g-f:g-.5,w=p?g+.5:g+f;S.moveTo("border",C,x),S.lineTo("border",w,x),S.moveTo("border",C,b),S.lineTo("border",w,b)}v.fillStyle=y;var k={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:l+" "+i.name,yAxis:u,opacity:.3};if(!i.highlight&&t.highlightedDraggable&&(k.opacity*=.3),e.preparePeakValleyFill(t,e.extend(k,{threshold:s,direction:u.flipped?-1:1,color:o})),e.preparePeakValleyFill(t,e.extend(k,{threshold:r,direction:u.flipped?1:-1,color:n})),v.globalAlpha=1,!i.study||!i.study.yaxis){if(d){var D=Math.round(u.bottom)+.5;S.moveTo("border",g,u.top),S.lineTo("border",g,D),S.draw(v,"border")}var T;if(0!==u.width)t.canvasFont("stx_yaxis",v),t.canvasColor("stx_yaxis",v),v.textAlign=m?"right":"left",p?(T=u.left+3,m&&(T=u.left+u.width-f-3)):(T=u.left+f+3,m&&(T=u.left+u.width)),v.fillStyle=o,v.fillText(s,T,x),v.fillStyle=n,v.fillText(r,T,b),v.fillStyle=y}t.endClip(),v.globalAlpha=1,u.name==i.name&&(u.yAxisPlotter=new e.Plotter)}},e.Studies.createHistogram=function(t,i,a,r,s){var n=t.panels[i.panel],o=i.getContext(t),l=i.getYAxis(t);t.startClip(n.name);var h=t.layout.candleWidth-2;h<2&&(h=1);var c=t.pixelFromPrice(0,n,l);l.min>0&&(c=t.pixelFromPrice(l.min,n,l)),r&&(c=Math.floor(n.top+n.height/2));var u=i.name+"_hist";t.canvasColor("stx_histogram");var d=o.fillStyle;(s||0===s)&&(o.globalAlpha=s),!i.highlight&&t.highlightedDraggable&&(o.globalAlpha*=.3);for(var p=null,m=null,g=i.outputs,f=0;f<a.length;f++){var v=a[f];if(v){v.candleWidth&&(h=Math.floor(Math.max(1,v.candleWidth-2)));var y=Math.floor(t.pixelFromBar(f,n.chart)-h/2),x=Math.floor(h);if(null===p){var b=t.tickFromPixel(y,n.chart)-1;p=b<0?m:t.pixelFromPrice(t.chart.dataSet[b][u],n,l)-c}else p=m;m=t.pixelFromPrice(v[u],n,l)-c;var S=e.Studies.determineColor(g["Decreasing Bar"]),C=e.Studies.determineColor(g["Increasing Bar"]),w=e.Studies.determineColor(g["Positive Bar"]),k=e.Studies.determineColor(g["Negative Bar"]),D=l.flipped;o.fillStyle=d,S&&(D?m<p:m>p)?o.fillStyle=S:C&&(D?m>p:m<p)?o.fillStyle=C:w&&(D?m>0:m<0)?o.fillStyle=w:k&&(D?m<0:m>0)&&(o.fillStyle=k),o.fillRect(y,c,x,Math.floor(m))}}o.globalAlpha=1,t.endClip()},e.Studies.prettify={Close:"C",Open:"O",High:"H",Low:"L",simple:"ma",exponential:"ema",triangular:"tma",VIDYA:"vdma",weighted:"wma","welles wilder":"smma",true:"y",false:"n"},e.Studies.prettyRE=/^.*\((.*?)\).*$/,e.Studies.prettyDisplay=function(t){var i=e.Studies.prettyRE.exec(t);if(!i)return t;var a=i[1];if(a){for(var r in e.Studies.prettify)a=a.replace(r,e.Studies.prettify[r]);t=t.replace(i[1],a)}return t},e.Studies.getFieldInputs=function(t){var e=[],i=t.study.inputs;for(var a in i)"field"==i[a]&&e.push(a);return e},e.Studies.initializeFN=function(t,i,a,r,s,n,o){a||(a={}),s||(s={}),a.id||(a.id=e.Studies.generateID(t,i,a,s.replaceID,s.display)),a.display||(a.display=a.id);var l=new e.Studies.StudyDescriptor(a.id,i,a.id,a,r,s);a.Period&&(l.days=Math.max(1,parseInt(l.inputs.Period,10))),o?(o.inputs||(o.inputs=l.study.inputs),o.outputs||(o.outputs=l.study.outputs),l.study=o):o=l.study,o.display&&(a.display=o.display),"string"==typeof s.panelName&&(n=s.panelName),(n==a.id||n&&!t.panelExists(n))&&(l.underlay=l.overlay=!1),"Own panel"!=n&&"New panel"!=n||(n=null);var h=l.overlay||a.Overlay||!1!==l.overlay&&o.overlay,c=l.underlay||a.Underlay||!1!==l.underlay&&o.underlay;h&&s.underlayEnabled&&(c=!0),c&&(l.underlay=!0),!c&&t.chart.panel&&n==t.chart.panel.name&&(h=!0),h&&(l.overlay=!0);var u=t.preferences.dragging;if((!0===u||u&&u.study)&&(l.overlay=!0),n?s.panelName=n:h||c||(n=a.id),s.calculateOnly)return(h||c)&&(t.panels[s.panelName]?l.panel=s.panelName:l.panel=e.Studies.getPanelFromFieldName(t,l)||s.chartName),l;var d={},p=t.layout.studies[s.replaceID];if(p&&(d={outputMap:e.clone(p.outputMap),panel:p.panel}),l.panel="",n){var m=e.Studies.smartMovePanel(t,l.inputs,n,s.replaceID,"New panel"==s.panelName);m&&(l.panel=m.name)}else(h||c)&&(l.panel=e.Studies.getPanelFromFieldName(t,l)||s.chartName);if(!l.panel){var g=o.panelHeight||null,f=o.yAxis||{};f.name=l.inputs.id,l.panel=l.inputs.id,t.createPanel(l.inputs.display,l.panel,g,s.chartName,new e.ChartEngine.YAxis(f))}l.parameters&&l.parameters.panelName&&(l.parameters.panelName=l.panel);var v=t.panels[l.panel],y=e.Studies.smartCreateYAxis(t,v,l.inputs.id,s.yaxisDisplayValue,s.yAxis||o.yAxis),x=o?e.clone(o.yAxis):null,b=x||y;if(b&&(b.ground&&(b.initialMarginBottom=0),(b.initialMarginTop||0===b.initialMarginTop||b.initialMarginBottom||0===b.initialMarginBottom)&&t.calculateYAxisMargins(b),b.name==s.replaceID&&(b.name=l.inputs.id)),y&&(y.width="none"==y.position?0:e.ChartEngine.YAxis.prototype.width,"shared"==s.yaxisDisplayValue||"default"==s.yaxisDisplayValue?delete s.yaxisDisplayValue:x?e.ensureDefaults(y,x):y.name==l.name&&(s.yaxisDisplayColor&&"auto"!=s.yaxisDisplayColor?y.textStyle=e.colorToHex(s.yaxisDisplayColor):delete y.textStyle,y.justifyRight=null,y.flipped=s.flippedEnabled),y!=v.yAxis?y.displayGridLines=!1:y!=t.chart.yAxis&&(y.displayGridLines=t.displayGridLinesInStudies)),t.calculateYAxisPositions(),p){var S=!1;for(var C in t.drawingObjects){var w=t.drawingObjects[C];d.outputMap&&d.outputMap.hasOwnProperty(w.field)?(w.field=w.field.replace(s.replaceID,l.inputs.id),l.parameters&&l.parameters.panelName?w.panelName=l.parameters.panelName:w.panelName=l.panel,S=!0):d.panel&&d.panel==w.panelName&&(w.panelName=w.panelName.replace(s.replaceID,l.inputs.id),S=!0)}S&&t.changeOccurred("vector")}return l},e.Studies.smartMovePanel=function(t,e,i,a,r){var s,n=e.id;if(a&&(s=t.layout.studies[a]),s){var o=t.panels[s.panel];if(o&&o.yAxis.name==a)if(!r&&i==a||t.checkForEmptyPanel(o.name,!0,s))i!=a&&t.panels[i]||(n!=o.name&&t.modifyPanel(o,{name:n,display:e.display}),i=n);else{t.electNewPanelOwner(o);var l=s.getYAxis(t);l.name==a&&t.electNewYAxisOwner(l)}}return t.panels[i]},e.Studies.smartCreateYAxis=function(t,i,a,r,s){var n=t.getYAxisByName(i,a);if(!r&&s&&(r=s.position),"default"!=r&&"shared"!=r&&r!=i.yAxis.name||(r=""),["left","right","none"].indexOf(r)>-1){if(!n||n.isShared(t)){var o=s||{};if(e.extend(o,{name:a,position:r}),n||t.currentlyImporting||i==i.chart.panel||i.yAxis.studies.length||i.yAxis.renderers.length){var l=n==i.yAxis;n&&(n.name=t.electNewYAxisOwner(n)),n=t.addYAxis(i,new e.ChartEngine.YAxis(o)),l&&(i.yAxis=n)}else n=i.yAxis,e.extend(n,o)}else n.position=r;return n}if(r){var h=t.getYAxisByName(i,r);return h&&n==i.yAxis&&!n.isShared(t)&&(i.yAxis=h),n&&n.isShared(t)?n.name=t.electNewYAxisOwner(n):n!==i.yAxis&&t.deleteYAxisIfUnused(i,n),h}return n&&(n.isShared(t)?n.name=t.electNewYAxisOwner(n):(delete n.position,n!==i.yAxis&&t.deleteYAxisIfUnused(i,n))),t.resizeChart(),i.yAxis},e.Studies.calculateVolume=function(t,i){if("vol undr"==i.type){if(!t||!t.chart.dataSet)return;var a=t.layout,r=i.parameters.removeStudy,s=a.volumeUnderlay;a.volumeUnderlay=!r,s!=a.volumeUnderlay&&t.changeOccurred("layout"),r&&e.Studies.removeStudy(t,i)}i.outputMap={},i.outputMap.Volume=""},e.Studies.MA=function(t,i,a,r,s,n,o,l){var h=new e.Studies.StudyDescriptor(s+" "+o.name,"ma",o.panel);h.chart=o.chart,h.days=parseInt(i,10),h.startFrom=o.startFrom,l&&(h.subField=l),h.inputs={},t&&(h.inputs.Type=t),a&&(h.inputs.Field=a),r&&(h.inputs.Offset=parseInt(r,10)),e.Studies.calculateMovingAverage(n,h)},e.Studies.movingAverage={conversions:{ma:"simple",sma:"simple",ema:"exponential",tma:"triangular",vdma:"vidya",wma:"weighted",smma:"welles wilder"},translations:{simple:"Simple",exponential:"Exponential",triangular:"Triangular",vidya:"VIDYA",weighted:"Weighted","welles wilder":"Welles Wilder"},typeMap:{ema:"Exponential",exponential:"Exponential",tma:"Triangular",triangular:"Triangular",vdma:"VIDYA",vidya:"VIDYA",wma:"Weighted",weighted:"Weighted",smma:"Exponential","welles wilder":"Exponential"}},e.Studies.movingAverageHelper=function(t,i){if("options"==i){var a={};for(var r in e.Studies.movingAverage.translations)a[r]=t.translateIf(e.Studies.movingAverage.translations[r]);return a}return e.Studies.movingAverage.conversions[i]},e.Studies.createVolumeChart=function(t,i,a){var r=i.panel,s=(i.inputs,i.underlay),n=(i.overlay,e.Studies.determineColor(i.outputs["Up Volume"])),o=e.Studies.determineColor(i.outputs["Down Volume"]),l=s?"stx_volume_underlay":"stx_volume";t.setStyle(l+"_up","color",n),t.setStyle(l+"_down","color",o);var h=[{field:i.volumeField||"Volume",fill_color_up:t.canvasStyle(l+"_up").color,border_color_up:t.canvasStyle(l+"_up").borderLeftColor,opacity_up:t.canvasStyle(l+"_up").opacity,fill_color_down:t.canvasStyle(l+"_down").color,border_color_down:t.canvasStyle(l+"_down").borderLeftColor,opacity_down:t.canvasStyle(l+"_down").opacity,color_function:i.colorFunction}],c=h[0];s||"rgb(184, 44, 12)"!==c.border_color_down||(c.border_color_down="#000000",c.border_color_up="#000000");var u={name:"Volume",panel:r,yAxis:i.getYAxis(t),widthFactor:1,bindToYAxis:!0,highlight:i.highlight};e.extend(u,i.study.parameters),e.extend(u,i.parameters),t.colorByCandleDirection&&!i.colorFunction&&(c.color_function=function(t){var e=t.Open,i=t.Close;return{fill_color:e>i?c.fill_color_down:c.fill_color_up,border_color:e>i?c.border_color_down:c.border_color_up,opacity:e>i?c.opacity_down:c.opacity_up}}),t.drawHistogram(u,h)},e.Studies.calculateStandardDeviation=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=i.inputs["Moving Average Type"];s||(s=i.inputs.Type),e.Studies.MA(s,i.days,r,i.inputs.Offset,"_MA",t,i);var n=0,o=0,l=0,h=Number(i.inputs["Standard Deviations"]);h<0&&(h=2);var c,u,d,p=i.name;for(var m in i.outputs)p=m+" "+p;for(c=i.startFrom-1,d=0;c>=0&&d<i.days;c--,d++)(u=a[c][r])&&"object"==typeof u&&(u=u[i.subField]),isNaN(u)&&(u=0),n+=Math.pow(u,2),o+=u;for(c=i.startFrom;c<a.length;c++){var g=a[c];if((u=g[r])&&"object"==typeof u&&(u=u[i.subField]),u||0===u||(u=0),n+=Math.pow(u,2),o+=u,!(c<i.days-1)){if(c>=i.days){var f=a[c-i.days][r];f&&"object"==typeof f&&(f=f[i.subField]),isNaN(f)&&(f=0),n-=Math.pow(f,2),o-=f}((l=g["_MA "+i.name])||0===l)&&(g[p]=Math.sqrt((n+i.days*Math.pow(l,2)-2*l*o)/i.days)*h)}}}},e.Studies.calculateMovingAverage=function(t,i){if(i.chart.scrubbed){var a=i.inputs.Type;"ma"!=a&&"sma"!=a&&a||(a="simple");var r=e.Studies.movingAverage.typeMap;if(a in r)return e.Studies["calculateMovingAverage"+r[a]](t,i);if("simple"===a){var s=i.chart.scrubbed,n=0,o=[],l=i.name;for(var h in i.outputs)l=h+" "+l;var c=i.inputs.Field;c&&"field"!=c||(c="Close");var u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var d,p,m,g=i.startFrom,f=u;for(d=i.startFrom-1;d>=0;d--)if((p=s[d][c])&&"object"==typeof p&&(p=p[i.subField]),p||0===p)if(f>0)f--,g=d;else{if(o.length==i.days-1)break;n+=p,o.unshift(p)}o.length<i.days-1&&(o=[],g=0);var v=[];for(d=g;d<s.length;d++){(p=s[d][c])&&"object"==typeof p&&(p=p[i.subField]);var y=d+u>=0&&d+u<s.length?s[d+u]:null;if(p||0===p){n+=p,o.push(p),o.length>i.days&&(n-=o.shift());var x=o.length==i.days?n/i.days:null;y?y[l]=x:d+u>=s.length&&((m={})[l]=x,v.push(m))}else y?y[l]=null:d+u>=s.length&&((m={})[l]=null,v.push(m))}i.appendFutureTicks(t,v)}}},e.Studies.calculateMovingAverageExponential=function(t,e){var i=e.inputs.Type,a=e.chart.scrubbed,r=0,s=0,n=0,o=2/(e.days+1);"welles wilder"!==i&&"smma"!==i||(o=1/e.days);var l=null,h=e.name;for(var c in e.outputs)h=c+" "+h;var u=e.inputs.Field;u&&"field"!=u||(u="Close");var d,p,m=parseInt(e.inputs.Offset,10);isNaN(m)&&(m=0);var g=e.startFrom,f=m;for(d=e.startFrom-1;d>=0;d--)if((p=a[d][h])||0===p){if(null===l&&(l=p),n=e.days,f<=0)break;f--,g=d}null===l&&(l=g=0);var v=[];for(d=g;d<a.length;d++){(p=a[d][u])&&"object"==typeof p&&(p=p[e.subField]);var y,x=d+m>=0&&d+m<a.length?a[d+m]:null;if(p||0===p?(n==e.days-1?y=s=(r+=p)/e.days:n<e.days-1?(s=(r+=p)/(n+1),y=null):0===n?(s=r+=p,y=null):(l||0===l)&&(y=s=(p-l)*o+l),l=s,n++):y=null,x)x[h]=y;else if(d+m>=a.length){var b={};b[h]=y,v.push(b)}}e.appendFutureTicks(t,v)},e.Studies.calculateMovingAverageVIDYA=function(t,i){i.inputs.Type;var a=i.chart.scrubbed,r=2/(i.days+1),s=null,n=i.name;for(var o in i.outputs)n=o+" "+n;var l=i.inputs.Field;l&&"field"!=l||(l="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=5,i.std.startFrom=i.startFrom,i.std.inputs={Field:l,"Standard Deviations":1,Type:"ma"},i.std.outputs={_STD:null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.MA("ma",20,"_STD "+i.name,0,"_MASTD",t,i);var h,c,u,d=parseInt(i.inputs.Offset,10);isNaN(d)&&(d=0);var p=i.startFrom,m=d;for(h=i.startFrom-1;h>=0;h--)if((c=a[h][n])||0===c){if(null===s&&(s=c),m<=0)break;m--,p=h}null===s&&(s=p=0);var g=[];for(h=p;h<a.length;h++){var f=a[h];(c=f[l])&&"object"==typeof c&&(c=c[i.subField]);var v=h+d>=0&&h+d<a.length?a[h+d]:null;if(c||0===c){if(f["_MASTD "+i.name]||0===f["_MASTD "+i.name]){var y=f["_STD "+i.name]/f["_MASTD "+i.name],x=r*y*c+(1-r*y)*s;s=x,h<i.days&&(x=null),v?v[n]=x:h+d>=a.length&&((u={})[n]=x,g.push(u))}}else v?v[n]=null:h+d>=a.length&&((u={})[n]=null,g.push(u))}i.appendFutureTicks(t,g)},e.Studies.calculateMovingAverageTriangular=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var s=Math.ceil(i.days/2);e.Studies.MA("simple",s,r,0,"TRI1",t,i),i.days%2==0&&s++,e.Studies.MA("simple",s,"TRI1 "+i.name,0,"TRI2",t,i);var n=i.name;for(var o in i.outputs)n=o+" "+n;var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);for(var h=l,c=i.startFrom-1;c>=0;c--){var u=a[c][n];if(u||0===u){if(!(h>0))break;h--}}var d=[];for(c++;c<a.length;c++)if(c+l>=0)if(c+l<a.length)a[c+l][n]=a[c]["TRI2 "+i.name];else{var p={};p[n]=a[c]["TRI2 "+i.name],d.push(p)}i.appendFutureTicks(t,d)},e.Studies.calculateMovingAverageWeighted=function(t,e){var i=e.chart.scrubbed,a=0,r=0,s=e.inputs.Field;s&&"field"!=s||(s="Close");var n=e.days*(e.days+1)/2,o=e.name;for(var l in e.outputs)o=l+" "+o;var h,c,u,d=parseInt(e.inputs.Offset,10);isNaN(d)&&(d=0);var p=[],m=e.startFrom,g=d;for(h=e.startFrom-1;h>=0;h--)if((c=i[h][s])&&"object"==typeof c&&(c=c[e.subField]),c||0===c)if(g>0)g--,m=h;else{if(p.length==e.days-1)break;p.unshift(c)}for(p.length<e.days-1&&(p=[],m=0),h=0;h<p.length;h++)a+=(h+1)*p[h],r+=p[h];var f=[];for(h=m;h<i.length;h++){(c=i[h][s])&&"object"==typeof c&&(c=c[e.subField]);var v=h+d>=0&&h+d<i.length?i[h+d]:null;if(c||0===c){p.push(c),p.length>e.days&&(a-=r,r-=p.shift()),a+=p.length*c,r+=c;var y=h<e.days-1?null:a/n;v?v[o]=y:h+d>=i.length&&((u={})[o]=y,f.push(u))}else v?v[o]=null:h+d>=i.length&&((u={})[o]=null,f.push(u))}e.appendFutureTicks(t,f)},e.Studies.calculateStudyATR=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else for(var r=0,s=e.name,n=Math.max(e.startFrom,1);n<i.length;n++){var o=i[n],l=i[n-1],h=o.trueRange;l["Sum True Range "+s]&&(r=l["Sum True Range "+s]),r+=h,n>a&&(r-=i[n-a]["True Range "+s]),o["True Range "+s]=h,o["Sum True Range "+s]=r,n==a?o["ATR "+s]=r/a:n>a&&(o["ATR "+s]=(l["ATR "+s]*(a-1)+h)/a)}},e.Studies.displayPSAR2=function(t,i,a){var r=t.panels[i.panel],s=i.getYAxis(t),n=s==t.chart.panel.yAxis;t.startClip(r.name);var o=i.getContext(t),l="squarewave"==i.inputs["Plot Type"];for(var h in i.outputs){var c=h+" "+i.name;o.beginPath();for(var u=t.layout.candleWidth,d=Math.max(3,Math.floor(t.chart.tmpWidth/2)),p=0;p<a.length;p++){var m=a[p];if(m&&(m[c]||0===m[c])){m.candleWidth&&(u=m.candleWidth),n&&m.transform&&(m=m.transform);var g=t.pixelFromBar(p,r.chart);l&&(g-=u/2);var f=t.pixelFromTransformedValue(m[i.referenceOutput?i.referenceOutput+" "+i.name:c],r,s);if(0!==p&&a[p-1]&&(a[p-1][c]||0===a[p-1][c])||o.moveTo(g,f),l){if(o.lineTo(g,f),o.lineTo(g+u,f),a[p+1]){var v=a[p+1];n&&v.transform&&(v=v.transform),v[c]||0===v[c]||o.lineTo(g+u,t.pixelFromTransformedValue(v[i.referenceOutput?i.referenceOutput+" "+i.name:c],t.panels[i.panel],s))}}else o.moveTo(g-d/2,f),o.lineTo(g+d/2,f)}}o.lineWidth=1,i.highlight&&(o.lineWidth=3);var y=e.Studies.determineColor(i.outputs[h]);"auto"==y&&(y=t.defaultColor),o.strokeStyle=y,!i.highlight&&t.highlightedDraggable&&(o.globalAlpha*=.3),o.stroke(),o.closePath(),o.lineWidth=1}t.endClip()},e.Studies.inputAttributeDefaultGenerator=function(t){return(t||0===t)&&t.constructor==Number?Math.floor(t)==t?t>0?{min:1,step:1}:{step:1}:t>0?{min:0,step:.01}:{step:.01}:{}},e.Studies.getMarketOffset=function(t){let i,{stx:a,localQuoteDate:r,shiftToDateBoundary:s}=t;arguments.length>1&&(a=arguments[0],r=arguments[1],i=arguments[2]);const{symbol:n}=a.chart,o=e.getFn("Market.Symbology.isForexMetal")(n);let l;void 0===i&&(i=e.getFn("Market.Symbology.isForexSymbol")(n)),l=a.chart.market?i?"America/New_York":a.chart.market.market_tz:null;var h=new Date(r.getTime()+6e4*r.getTimezoneOffset());l&&-1!=l.indexOf("UTC")||(h=e.convertTimeZone(h,"UTC",l));let c=new Date(h.getFullYear(),h.getMonth(),h.getDate(),h.getHours(),h.getMinutes(),h.getSeconds(),h.getMilliseconds()).getTime()-r.getTime();return s&&i&&(c+=60*(o?6:7)*60*1e3),c},e.Studies.getStudyList=function(t){var i={},a={};for(var r in e.extend(a,t),e.Studies.studyLibrary)a[r]||(i[e.Studies.studyLibrary[r].name]=r);return i},e.Studies.determineColor=function(t){return t?"object"==typeof t?t.color:t:null},e.Studies.calculateGenericEnvelope=function(t,e,i,a,r,s){i||(i=0),s||(s=0),a&&"field"!=a||(a="Close"),r||(r=a);var n=e.chart.scrubbed,o=e.inputs.Field;o&&"field"!==o||(o="Close");for(var l=e.startFrom;n&&l<n.length;l++){var h=n[l];if(h&&h[a]){var c=h[o];c&&"object"==typeof c&&(c=c.Close);var u=h[a];u&&"object"==typeof u&&(u=u[e.subField]);var d=h[r];d&&"object"==typeof d&&(d=d[e.subField]);var p=i*d+s;h[e.type+" Top "+e.name]=u+p,h[e.type+" Bottom "+e.name]=u-p,h[e.type+" Median "+e.name]=u,h["Bandwidth "+e.name]=u?200*p/u:0,h["%b "+e.name]=50*((c-u)/p+1)}}},e.Studies.displayChannel=function(t,i,a){if(i.inputs["Channel Fill"]){var r={panelName:i.panel};for(var s in i.outputs){var n=s.split(" ").pop();"Top"==n||"High"==n?r.topBand=s+" "+i.name:"Bottom"==n||"Low"==n?r.bottomBand=s+" "+i.name:"Median"!=n&&"Channel"!=n||(r.color=e.Studies.determineColor(i.outputs[s]))}i.parameters&&i.parameters.opacity?r.opacity=i.parameters.opacity:r.opacity=.2;var o=t.panels[i.panel];r.skipTransform=o.name!=i.chart.name,r.yAxis=i.getYAxis(t),!i.highlight&&t.highlightedDraggable&&(r.opacity*=.3),e.prepareChannelFill(t,r)}e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.initAnchorHandle=function(t,e){let{handle:i}=e;i||(t.controls.anchorHandles||(t.controls.anchorHandles={}),t.controls.anchorHandles[e.uniqueId]?({handle:i}=t.controls.anchorHandles[e.uniqueId]):(i=document.createElement("div"),i.classList.add("stx_anchor_handle"),i.setAttribute(e.uniqueId,""),t.controls.anchorHandles[e.uniqueId]={handle:i,sd:e},t.controls.chartControls.parentElement.appendChild(i)),e.anchorHandle=i)},e.Studies.removeAnchorHandle=function(t,e){const{handle:i}=(t.controls.anchorHandles||{})[e.uniqueId]||{};i&&(delete t.controls.anchorHandles[e.uniqueId],i.remove())},e.Studies.repositionAnchor=function(t,a){const{currentAnchorTime:r,uniqueId:s}=a,{hoverTick:n}=t.repositioningAnchorSelector||{},{dataSet:o,market:l}=t.chart,{anchorHandles:h}=t.controls;let c={};if(n||0===n){if(n>=o.length)return;const s=!a.inputs["Anchor Date"];let h=o[n].DT;const u=e.Studies.getMarketOffset({stx:t,localQuoteDate:h,shiftToDateBoundary:!0});if(s&&new Date(h.getTime()+u).getDate()!==new Date(r.getTime()+u).getDate())return;l.market_def&&(h=new i.Date(h,l.market_def.market_tz));const d=!s&&e.dateToStr(h,"YYYY-MM-dd");c={"Anchor Time":e.dateToStr(h,"HH:mm:ss")},d&&(c["Anchor Date"]=d)}const u=e.Studies.replaceStudy(t,a.inputs.id,a.type,Object.assign(a.inputs,c),a.outputs,a.parameters,a.panel);h[s].sd=u,t.draw()},e.Studies.displayAnchorHandleAndLine=function(t,a,r){const s=(t.repositioningAnchorSelector||{}).sd===a,{hoverTick:n}=s&&t.repositioningAnchorSelector,{chart:o,panels:l,xaxisHeight:h}=t,{market:c={},symbol:u}=o,d=l[a.panel],{top:p,bottom:m,right:g,left:f,height:v}=d,{inputs:y,anchorHandle:x,currentAnchorTime:b}=a,{backgroundColor:S,borderLeftColor:C}=t.canvasStyle("stx_anchor_handle"),[w,k,D=0]=(y["Anchor Time"]||"").split(":"),T=!y["Anchor Date"],M=e.getFn("Market.Symbology.isForexSymbol")(u),A=(n||0===n)&&(t.chart.dataSet[n]||{}).DT,_=e.Studies.getMarketOffset({stx:t,localQuoteDate:r[r.length-1].DT,shiftToDateBoundary:!0}),F=A&&T&&new Date(A.getTime()+_).getDate()!==new Date(b.getTime()+_).getDate(),{highlighted:P}=t.controls.anchorHandles[a.uniqueId],[I,L]=c.getNormalOpen().split(":").map((t=>parseInt(t))),E=e=>{let i=e?t.tickFromDate(e,null,null,!0):n;return[t.pixelFromTick(i,o),i]};let N=T?new Date(r[r.length-1].DT):e.strToDate(y["Anchor Date"]);c.market_def&&(N=new i.Date(N,c.market_def.market_tz)),N.setHours(w,k,D);const O=M&&(N.getHours()>I||N.getHours()===I&&N.getMinutes()>=L);O&&N.setDate(N.getDate()-1);let[H]=E(),[V,z]=E(N),R=new Date(N);R.setHours(...c.getNormalClose().split(":")),O&&R.setDate(R.getDate()+1);const[B]=R&&E(R)||[];if(T&&(V>g||B>g)){let t=new Date(N);do{t.setDate(t.getDate()-1)}while(c&&!c.isMarketDate(t));let[e,i]=E(t);e>f&&(N=t,V=e,z=i)}const Q={y0:p,y1:m,type:"line",confineToPanel:d};t.plotLine(Object.assign(Q,{x0:V,x1:V,color:S,pattern:"solid",lineWidth:P?3:2,opacity:1})),t.plotLine(Object.assign(Q,{x0:H,x1:H,color:F?C:S,pattern:[6,6],lineWidth:2,opacity:F?.5:1})),x.style.height=[8,v/4,50].sort(((t,e)=>t-e))[1]+"px";const{height:W,width:U}=x.getBoundingClientRect(),j=10+(Math.round(m)===t.height?h:0)+("chart"===d.name?35:0)+W;x.style.top=m-j+"px",x.style.left=n||0===n?H:V-U/2+"px",a.currentAnchorTime=N,a.currentAnchorTick=z},e.Studies.studyScriptLibrary={},e.Studies.studyLibrary=e.Studies.studyLibrary||{},e.extend(e.Studies.studyLibrary,{ma:{name:"Moving Average",overlay:!0,calculateFN:e.Studies.calculateMovingAverage,inputs:{Period:50,Field:"field",Type:"ma",Offset:0},outputs:{MA:"#FF0000"}},"STD Dev":{name:"Standard Deviation",calculateFN:e.Studies.calculateStandardDeviation,inputs:{Period:14,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"True Range":{name:"True Range",calculateFN:e.Studies.calculateStudyATR,inputs:{},outputs:{"True Range":"auto"}},volume:{name:"Volume Chart",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,zoom:0},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"}}})},x=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ChartEngine.Driver?(e.ChartEngine.Driver.Lookup=function(t){},e.ChartEngine.Driver.Lookup.prototype.acceptText=function(t,e,i,a){this.cb}):console.error("symbolLookupBase feature requires first activating quoteFeed feature.")},b=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.ThemeHelper=e.ThemeHelper||function(t){this.params=t;var i=t.stx,a="#FFFFFF";i.chart.container&&(a=getComputedStyle(i.chart.container).backgroundColor,e.isTransparent(a)&&(a=i.containerColor)),this.settings.chart.Background.color=e.hexToRgba(a),this.settings.chart["Grid Lines"].color=e.hexToRgba(i.canvasStyle("stx_grid").color),this.settings.chart["Grid Dividers"].color=e.hexToRgba(i.canvasStyle("stx_grid_dark").color),this.settings.chart["Axis Text"].color=e.hexToRgba(i.canvasStyle("stx_xaxis").color),this.settings.chartTypes["Candle/Bar"].up.color=e.hexToRgba(i.canvasStyle("stx_candle_up").color),this.settings.chartTypes["Candle/Bar"].down.color=e.hexToRgba(i.canvasStyle("stx_candle_down").color),this.settings.chartTypes["Candle/Bar"].up.wick=e.hexToRgba(i.canvasStyle("stx_candle_shadow_up").color),this.settings.chartTypes["Candle/Bar"].down.wick=e.hexToRgba(i.canvasStyle("stx_candle_shadow_down").color),this.settings.chartTypes["Candle/Bar"].even.wick=e.hexToRgba(i.canvasStyle("stx_candle_shadow_even").color),this.settings.chartTypes["Candle/Bar"].up.border=e.hexToRgba(i.canvasStyle("stx_candle_up").borderLeftColor),this.settings.chartTypes["Candle/Bar"].down.border=e.hexToRgba(i.canvasStyle("stx_candle_down").borderLeftColor),e.isTransparent(i.canvasStyle("stx_candle_up").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].up.border=null),e.isTransparent(i.canvasStyle("stx_candle_down").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].down.border=null),this.settings.chartTypes.Line.color=e.hexToRgba(i.canvasStyle("stx_line_chart").color),this.settings.chartTypes.Mountain.color=e.hexToRgba(i.canvasStyle("stx_mountain_chart").backgroundColor),this.settings.chartTypes.Mountain.basecolor=e.hexToRgba(i.canvasStyle("stx_mountain_chart").color)},e.ThemeHelper.prototype.settings={chart:{Background:{color:null},"Grid Lines":{color:null},"Grid Dividers":{color:null},"Axis Text":{color:null}},chartTypes:{"Candle/Bar":{up:{color:null,wick:null,border:null},down:{color:null,wick:null,border:null},even:{color:null,wick:null,border:null}},Line:{color:null},Mountain:{color:null,basecolor:null}}},e.ThemeHelper.prototype.update=function(t){t||(t=this.params.stx);var i={stx_candle_up:{stx_candle_up:!0,stx_bar_up:!0,stx_hollow_candle_up:!0,stx_line_up:!0,stx_baseline_up:!0},stx_candle_down:{stx_candle_down:!0,stx_bar_down:!0,stx_hollow_candle_down:!0,stx_line_down:!0,stx_baseline_down:!0},stx_candle_even:{stx_hollow_candle_even:!0,stx_bar_even:!0},stx_shadow_up:{stx_candle_shadow_up:!0},stx_shadow_down:{stx_candle_shadow_down:!0},stx_shadow_even:{stx_candle_shadow_even:!0},stx_line_chart:{stx_bar_chart:!0,stx_line_chart:!0},stx_grid:{stx_grid:!0},stx_grid_dark:{stx_grid_dark:!0},stx_xaxis:{stx_xaxis_dark:!0,stx_xaxis:!0,stx_yaxis:!0,stx_yaxis_dark:!0,stx_grid_border:!0},stx_mountain_chart:{stx_mountain_chart:!0},stx_market_session:{stx_market_session:!0}};function a(e,a,r){var s=i[e];for(var n in s)t.setStyle(n,a,r)}t.chart.container.style.backgroundColor=this.settings.chart.Background.color,t.defaultColor="",a("stx_grid","color",this.settings.chart["Grid Lines"].color),a("stx_grid_dark","color",this.settings.chart["Grid Dividers"].color),a("stx_xaxis","color",this.settings.chart["Axis Text"].color);var r=this.settings.chartTypes["Candle/Bar"];r.even||(r.even={color:null,wick:e.hexToRgba(t.canvasStyle("stx_candle_shadow_even").color),border:null}),a("stx_candle_up","color",r.up.color),a("stx_candle_down","color",r.down.color),a("stx_candle_even","color",r.even.color),a("stx_shadow_up","color",r.up.wick),a("stx_shadow_down","color",r.down.wick),a("stx_shadow_even","color",r.even.wick),t.setStyle("stx_candle_up","borderLeftColor",r.up.border),t.setStyle("stx_candle_down","borderLeftColor",r.down.border),a("stx_line_chart","color",this.settings.chartTypes.Line.color),t.setStyle("stx_mountain_chart","borderTopColor",e.hexToRgba(this.settings.chartTypes.Mountain.color,1)),t.setStyle("stx_mountain_chart","backgroundColor",e.hexToRgba(this.settings.chartTypes.Mountain.color,.5)),t.setStyle("stx_mountain_chart","color",e.hexToRgba(this.settings.chartTypes.Mountain.basecolor,.01)),t.draw()},e.ChartEngine.prototype.setThemeSettings=function(t){if(this.styles={},this.chart.container.style.backgroundColor="",this.defaultColor="",t){var i=new e.ThemeHelper({stx:this});i.settings=t,i.update()}this.updateListeners("theme"),this.changeOccurred("theme"),this.displayInitialized&&(this.headsUpHR(),this.clearPixelCache(),this.updateListeners("theme"),this.draw())}},S=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,a="undefined"!=typeof _timezoneJS?_timezoneJS:t.timezoneJS;e.timeZoneMap={"(UTC-11:00) American Samoa, Midway Island":"Pacific/Pago_Pago","(UTC-10:00) Hawaii":"Pacific/Honolulu","(UTC-09:00) Alaska":"America/Juneau","(UTC-08:00) Pacific Time (US and Canada), Tijuana":"America/Los_Angeles","(UTC-07:00) Arizona":"America/Phoenix","(UTC-07:00) Chihuahua, Mazatlan":"America/Chihuahua","(UTC-07:00) Mountain Time (US and Canada)":"America/Denver","(UTC-06:00) Central America":"America/Costa_Rica","(UTC-06:00) Central Time (US and Canada)":"America/Chicago","(UTC-06:00) Guadalajara, Mexico City, Monterrey":"America/Mexico_City","(UTC-06:00) Saskatchewan":"America/Regina","(UTC-05:00) Bogota, Lima, Quito, Rio Branco":"America/Bogota","(UTC-05:00) Eastern Time (US and Canada)":"America/New_York","(UTC-05:00) Havana":"America/Havana","(UTC-05:00) Port-au-Prince":"America/Port-au-Prince","(UTC-04:00) Asuncion":"America/Asuncion","(UTC-04:00) Santiago":"America/Santiago","(UTC-04:00) Caracas":"America/Caracas","(UTC-04:00) Atlantic Time (Canada)":"America/Halifax","(UTC-04:00) Georgetown, La Paz, Manaus, San Juan":"America/Puerto_Rico","(UTC-03:30) Newfoundland and Labrador":"America/St_Johns","(UTC-03:00) Cancun, Jamaica, Panama":"America/Panama","(UTC-03:00) Buenos Aires":"America/Argentina/Buenos_Aires","(UTC-03:00) Punta Arenas":"America/Punta_Arenas","(UTC-03:00) Montevideo":"America/Montevideo","(UTC-03:00) Sao Paulo":"America/Sao_Paulo","(UTC-02:00) Mid-Atlantic":"Atlantic/South_Georgia","(UTC-01:00) Azores":"Atlantic/Azores","(UTC-01:00) Cape Verde Islands":"Atlantic/Cape_Verde","(UTC) Greenwich Mean Time, Reykjavik":"UTC","(UTC) Dublin":"Europe/Dublin","(UTC) Lisbon, London":"Europe/London","(UTC+01:00) Algiers, Tunis":"Africa/Tunis","(UTC+01:00) Casablanca":"Africa/Casablanca","(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna":"Europe/Amsterdam","(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague":"Europe/Belgrade","(UTC+01:00) Brussels, Copenhagen, Madrid, Paris":"Europe/Brussels","(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb":"Europe/Sarajevo","(UTC+02:00) Kaliningrad":"Europe/Kaliningrad","(UTC+02:00) Athens, Bucharest":"Europe/Bucharest","(UTC+02:00) Cairo":"Africa/Cairo","(UTC+02:00) Harare, Johannesburg":"Africa/Johannesburg","(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius":"Europe/Helsinki","(UTC+02:00) Cyprus":"Asia/Nicosia","(UTC+02:00) Beirut":"Asia/Beirut","(UTC+02:00) Damascus":"Asia/Damascus","(UTC+02:00) Jerusalem":"Asia/Jerusalem","(UTC+02:00) Amman":"Asia/Amman","(UTC+03:00) Istanbul":"Europe/Istanbul","(UTC+03:00) Baghdad, Kuwait, Qatar, Riyadh":"Asia/Riyadh","(UTC+03:00) Minsk, Moscow, Kirov, Simferopol":"Europe/Moscow","(UTC+03:00) Volgograd":"Europe/Volgograd","(UTC+03:00) Nairobi":"Africa/Nairobi","(UTC+03:30) Tehran":"Asia/Tehran","(UTC+04:00) Baku":"Asia/Baku","(UTC+04:00) Dubai, Muscat":"Asia/Dubai","(UTC+04:00) Astrakhan, Samara, Saratov, Ulyanovsk":"Europe/Samara","(UTC+04:30) Kabul":"Asia/Kabul","(UTC+05:00) Karachi, Tashkent":"Asia/Karachi","(UTC+05:00) Yekaterinburg":"Asia/Yekaterinburg","(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi":"Asia/Kolkata","(UTC+05:45) Kathmandu":"Asia/Kathmandu","(UTC+06:00) Almaty":"Asia/Almaty","(UTC+06:00) Omsk":"Asia/Omsk","(UTC+06:00) Astana, Dhaka":"Asia/Dhaka","(UTC+06:30) Yangon":"Asia/Yangon","(UTC+07:00) Bangkok, Jakarta, Vietnam":"Asia/Bangkok","(UTC+07:00) Hovd":"Asia/Hovd","(UTC+07:00) Krasnoyarsk":"Asia/Krasnoyarsk","(UTC+07:00) Novokuznetsk":"Asia/Novokuznetsk","(UTC+07:00) Barnaul, Novosibirsk, Tomsk":"Asia/Novosibirsk","(UTC+08:00) Beijing, Chongqing, Hong Kong SAR":"Asia/Hong_Kong","(UTC+08:00) Brunei, Kuala Lumpur, Singapore":"Asia/Kuala_Lumpur","(UTC+08:00) Irkutsk":"Asia/Irkutsk","(UTC+08:00) Choibalsan, Ulaanbaatar":"Asia/Ulaanbaatar","(UTC+08:00) Manila, Taipei":"Asia/Taipei","(UTC+08:00) Perth":"Australia/Perth","(UTC+08:45) Eucla":"Australia/Eucla","(UTC+09:00) Osaka, Sapporo, Tokyo":"Asia/Tokyo","(UTC+09:00) Pyongyang":"Asia/Pyongyang","(UTC+09:00) Seoul":"Asia/Seoul","(UTC+09:00) Chita, Khandyga, Yakutsk":"Asia/Yakutsk","(UTC+09:30) Adelaide":"Australia/Adelaide","(UTC+09:30) Darwin":"Australia/Darwin","(UTC+10:00) Brisbane":"Australia/Brisbane","(UTC+10:00) Canberra, Melbourne, Sydney":"Australia/Sydney","(UTC+10:00) Guam, Port Moresby":"Pacific/Guam","(UTC+10:00) Ust-Nera, Vladivostok":"Asia/Vladivostok","(UTC+11:00) Noumea, Solomon Islands":"Pacific/Noumea","(UTC+11:00) Magadan":"Asia/Magadan","(UTC+11:00) Sakhalin, Srednekolymsk":"Asia/Srednekolymsk","(UTC+12:00) Anadyr, Kamchatka":"Asia/Kamchatka","(UTC+12:00) Auckland, Wellington":"Pacific/Auckland","(UTC+12:00) Fiji":"Pacific/Fiji","(UTC+12:45) Chatham":"Pacific/Chatham","(UTC+13:00) Tonga":"Pacific/Tongatapu","(UTC+13:00) Samoa":"Pacific/Apia","(UTC+14:00) Kiritimati":"Pacific/Kiritimati"},function(){var t=("undefined"!=typeof window?window:null)||(void 0!==i.g?i.g:{});a.VERSION="0.4.11";for(var r=t.$||t.jQuery||t.Zepto,s=t.fleegix,n=a.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=a.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],l={},h={},c={},u=0;u<o.length;u++)l[o[u].substr(0,3)]=u;for(u=0;u<n.length;u++)h[n[u].substr(0,3)]=u;Array.prototype.indexOf;var d=function(t,e){if("number"!=typeof t)throw"not a number: "+t;var i=t>1e3,a=t.toString(),r=a.length;if(i&&r>e)return a.substr(r-e,r);for(a=[a];r<e;)a.unshift("0"),r++;return a.join("")},p=function(t){if(t){if(!t.url)throw new Error("URL must be specified");if("async"in t||(t.async=!0),!(s&&void 0!==s.xhr||r&&void 0!==r.ajax))throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");return t.async?s&&s.xhr?s.xhr.send({url:t.url,method:"get",handleSuccess:t.success,handleErr:t.error}):r.ajax({url:t.url,dataType:"text",method:"GET",error:t.error,success:t.success}):s&&s.xhr?s.xhr.doReq({url:t.url,async:!1}):r.ajax({url:t.url,async:!1,dataType:"text"}).responseText}};a.ruleCache={},a.Date=function(){if(this===a)throw"timezoneJS.Date object must be constructed with 'new'";var t=Array.prototype.slice.apply(arguments),e=null,i=null,r=[],s=!1;"[object Array]"===Object.prototype.toString.call(t[0])&&(t=t[0]),"string"==typeof t[t.length-1]&&(s=Date.parse(t[t.length-1].replace(/GMT[+-]\d+/,"")),(isNaN(s)||null===s)&&(i=t.pop()));var n=!1;switch(t.length){case 0:e=new Date;break;case 1:e=new Date(t[0]),"string"==typeof t[0]&&-1==t[0].search(/[+-][0-9]{4}/)&&-1==t[0].search(/Z/)&&-1==t[0].search(/T/)&&(n=!0);break;case 2:e=new Date(t[0],t[1]),n=!0;break;default:for(var o=0;o<7;o++)r[o]=t[o]||0;e=new Date(r[0],r[1],r[2],r[3],r[4],r[5],r[6]),n=!0}if(isNaN(e.getTime()))throw new Error("Invalid date");this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=i||null,n?this.setFromDateObjProxy(e):this.setFromTimeProxy(e.getTime(),i)},e.extend(a.Date.prototype,{getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+60*this.getTimezoneOffset()*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){return this._useCache?this._tzInfo:(t=this.timezone?"Etc/UTC"===this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:a.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=t,this._useCache=!0,t);var t},getUTCDateProxy:function(){var t=new Date(this._timeProxy);return t.setUTCMinutes(t.getUTCMinutes()+this.getTimezoneOffset()),t},setDate:function(t){return this.setAttribute("date",t),this.getTime()},setFullYear:function(t,e,i){return void 0!==i&&this.setAttribute("date",1),this.setAttribute("year",t),void 0!==e&&this.setAttribute("month",e),void 0!==i&&this.setAttribute("date",i),this.getTime()},setMonth:function(t,e){return this.setAttribute("month",t),void 0!==e&&this.setAttribute("date",e),this.getTime()},setYear:function(t){return 0<=(t=Number(t))&&t<=99&&(t+=1900),this.setUTCAttribute("year",t),this.getTime()},setHours:function(t,e,i,a){return this.setAttribute("hours",t),void 0!==e&&this.setAttribute("minutes",e),void 0!==i&&this.setAttribute("seconds",i),void 0!==a&&this.setAttribute("milliseconds",a),this.getTime()},setMinutes:function(t,e,i){return this.setAttribute("minutes",t),void 0!==e&&this.setAttribute("seconds",e),void 0!==i&&this.setAttribute("milliseconds",i),this.getTime()},setSeconds:function(t,e){return this.setAttribute("seconds",t),void 0!==e&&this.setAttribute("milliseconds",e),this.getTime()},setMilliseconds:function(t){return this.setAttribute("milliseconds",t),this.getTime()},setTime:function(t){if(isNaN(t))throw new Error("Units must be a number.");return this.setFromTimeProxy(t,this.timezone),this.getTime()},setUTCFullYear:function(t,e,i){return void 0!==i&&this.setUTCAttribute("date",1),this.setUTCAttribute("year",t),void 0!==e&&this.setUTCAttribute("month",e),void 0!==i&&this.setUTCAttribute("date",i),this.getTime()},setUTCMonth:function(t,e){return this.setUTCAttribute("month",t),void 0!==e&&this.setUTCAttribute("date",e),this.getTime()},setUTCDate:function(t){return this.setUTCAttribute("date",t),this.getTime()},setUTCHours:function(t,e,i,a){return this.setUTCAttribute("hours",t),void 0!==e&&this.setUTCAttribute("minutes",e),void 0!==i&&this.setUTCAttribute("seconds",i),void 0!==a&&this.setUTCAttribute("milliseconds",a),this.getTime()},setUTCMinutes:function(t,e,i){return this.setUTCAttribute("minutes",t),void 0!==e&&this.setUTCAttribute("seconds",e),void 0!==i&&this.setUTCAttribute("milliseconds",i),this.getTime()},setUTCSeconds:function(t,e){return this.setUTCAttribute("seconds",t),void 0!==e&&this.setUTCAttribute("milliseconds",e),this.getTime()},setUTCMilliseconds:function(t){return this.setUTCAttribute("milliseconds",t),this.getTime()},setFromDateObjProxy:function(t){this.year=t.getFullYear(),this.month=t.getMonth(),this.date=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds(),this._day=t.getDay(),this._dateProxy=t,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(t,e){var i=new Date(t),r=e?a.timezone.getTzInfo(t,e,!0).tzOffset:i.getTimezoneOffset();i.setTime(t+6e4*(i.getTimezoneOffset()-r)),this.setFromDateObjProxy(i)},setAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i=this._dateProxy;i["set"+("year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1))](e),this.setFromDateObjProxy(i)},setUTCAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i="year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1),a=this.getUTCDateProxy();a["setUTC"+i](e),a.setUTCMinutes(a.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(a.getTime()+6e4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(t){var e=this.getTimezoneInfo().tzOffset;this.timezone=t,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+e)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new a.Date(this.getTime(),this.timezone):new a.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleStringIntl:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toDateString:function(){return this.toString("EEE MMM dd yyyy")},toTimeString:function(){return this.toString("H:mm k")},toString:function(t,e){t||(t="yyyy-MM-ddTHH:mm:ss.SSS");var i=t,r=e?a.timezone.getTzInfo(this.getTime(),e):this.getTimezoneInfo(),s=this;e&&(s=this.clone()).setTimezone(e);var o=s.getHours();return i.replace(/a+/g,(function(){return"k"})).replace(/y+/g,(function(t){return d(s.getFullYear(),t.length)})).replace(/d+/g,(function(t){return d(s.getDate(),t.length)})).replace(/m+/g,(function(t){return d(s.getMinutes(),t.length)})).replace(/s+/g,(function(t){return d(s.getSeconds(),t.length)})).replace(/S+/g,(function(t){return d(s.getMilliseconds(),t.length)})).replace(/h+/g,(function(t){return d(o%12==0?12:o%12,t.length)})).replace(/M+/g,(function(t){var e=s.getMonth(),i=t.length;return i>3?a.Months[e]:i>2?a.Months[e].substring(0,i):d(e+1,i)})).replace(/k+/g,(function(){return o>=12?(o>12&&(o-=12),"PM"):"AM"})).replace(/H+/g,(function(t){return d(o,t.length)})).replace(/E+/g,(function(t){return n[s.getDay()].substring(0,t.length)})).replace(/Z+/gi,(function(){return r.tzAbbr}))},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(t,e,i){var a;++e>12&&(a=parseInt(e/12,10),e%=12,t+=a),e<=2&&(t-=1,e+=12);var r=2-(a=Math.floor(t/100))+Math.floor(a/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+i+r-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},!0),a.timezone=new function(){var t=this,e={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:["northamerica","southamerica"],Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},i={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Istanbul":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe",GMT:"etcetera","Europe/Nicosia":"asia"};function r(t){throw new Error("Timezone '"+t+"' is either incorrect, or not loaded in the timezone registry.")}function s(a){var n,o,l=i[a];if(l)return l;if(n=a.split("/")[0],o=e[n])return o;var h=t.zones[a];return"string"==typeof h?s(h):t.loadedZones.backward?void r(a):(t.loadZoneFile("backward"),s(a))}function n(t){var e=t.match(/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/);return e[1]=parseInt(e[1],10),e[2]=e[2]?parseInt(e[2],10):0,e[3]=e[3]?parseInt(e[3],10):0,e.slice(1,5)}function o(t){if(t[3]){var e=parseInt(t[3],10),i=11,a=31;t[4]&&(i=l[t[4].substr(0,3)],a=parseInt(t[5],10)||1);var r=t[6]?n(t[6]):[0,0,0];return[e,i,a,r[0],r[1],r[2]]}}function u(e,i){for(var a="number"==typeof e?e:new Date(+e).getTime(),s=i,n=t.zones[s];"string"==typeof n;)s=n,n=t.zones[s];if(!n){if(!t.loadedZones.backward)return t.loadZoneFile("backward"),u(e,i);if(s&&s!==i)return t.lazyLoadZoneFiles(s),u(e,s);r(s)}if(0===n.length)throw new Error("No Zone found for '"+i+"' on "+e);for(var o=n.length-1;o>=0;o--){var l=n[o];if(l[3]&&a>l[3])break}return n[o+1]}function d(t){var e=n(t);return(e=("-"===t.charAt(0)?-1:1)*(1e3*(60*(60*e[0]+e[1])+e[2])))/60/1e3}function m(t,e){return-Math.ceil(e-t)}this.zoneFileBasePath=null,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.getRegionForTimezone=s,this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(t){var e={async:!0},i=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica";for(var a in t)e[a]=t[a];return this.loadZoneFiles(i,e)},this.loadZoneFiles=function(t,e){var i,a=0;if("string"==typeof t)return this.loadZoneFile(t,e);i=(e=e||{}).callback,e.callback=function(){++a===t.length&&"function"==typeof i&&i()};for(var r=0;r<t.length;r++)this.loadZoneFile(t[r],e)},this.loadZoneFile=function(e,i){if(void 0===this.zoneFileBasePath)throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");if(!this.loadedZones[e])return this.loadedZones[e]=!0,function(e,i){var a=t.zoneFileBasePath+"/"+e;return i&&i.async?t.transport({async:!0,url:a,success:function(e){return t.parseZones(e)&&"function"==typeof i.callback&&i.callback()},error:function(){throw new Error("Error retrieving '"+a+"' zoneinfo files")}}):t.parseZones(t.transport({url:a,async:!1}))}(e,i)},this.loadZoneJSONData=function(e,i){var a=function(e){for(var i in(e=JSON.parse(e)).zones)t.zones[i]=e.zones[i];for(var a in e.rules)t.rules[a]=e.rules[a]};return i?a(t.transport({url:e,async:!1})):t.transport({url:e,success:a})},this.loadZoneDataFromObject=function(e){if(e){for(var i in e.zones)t.zones[i]=e.zones[i];for(var a in e.rules)t.rules[a]=e.rules[a]}},this.getAllZones=function(){var t=[];for(var e in this.zones)t.push(e);return t.sort()},this.parseZones=function(e){if(!e)return!1;for(var i,a=e.split("\n"),r=[],s=null,l=null,h=0;h<a.length;h++)if((i=a[h]).match(/^\s/)&&(i="Zone "+s+i),(i=i.split("#")[0]).length>3)switch((r=i.split(/\s+/)).shift()){case"Zone":if(s=r.shift(),t.zones[s]||(t.zones[s]=[]),r.length<3)break;r.splice(3,r.length,o(r)),r[3]&&(r[3]=Date.UTC.apply(null,r[3])),r[0]=-d(r[0]),t.zones[s].push(r);break;case"Rule":l=r.shift(),t.rules[l]||(t.rules[l]=[]),r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10)||r[1],r[5]=n(r[5]),r[6]=d(r[6]),t.rules[l].push(r);break;case"Link":if(t.zones[r[1]])throw new Error("Error with Link "+r[1]+". Cannot create link of a preexisted zone.");isNaN(r[0])?t.zones[r[1]]=r[0]:t.zones[r[1]]=parseInt(r[0],10)}return!0},this.transport=p,this.getTzInfo=function(e,i,r){this.lazyLoadZoneFiles(i);var s=u(e,i),n=+s[0],o=function(e,i,r,s){var n="number"==typeof e?new Date(e):e,o=i[1],u=i[0],d=o.match(/^([0-9]):([0-9][0-9])$/);if(d)return[-1e6,"max","-","Jan",1,[0,0,0],60*parseInt(d[1],10)+parseInt(d[2],10),"-"];var p,g,f=function(t,e,i){var a=0;if("u"===e||"g"===e||"z"===e)a=0;else if("s"===e)a=u;else{if("w"!==e&&e)throw new Error("unknown type "+e);a=m(u,i[6])}return a*=6e4,new Date(t.getTime()+a)},v=function(t,e){var i,a=t[0],r=t[1],s=r[5];if(c[a]||(c[a]={}),c[a][r])i=c[a][r];else{if(isNaN(r[4])){var n,o;"last"===r[4].substr(0,4)?(i=new Date(Date.UTC(a,l[r[3]]+1,1,s[0]-24,s[1],s[2],0)),n=h[r[4].substr(4,3)],o="<="):(i=new Date(Date.UTC(a,l[r[3]],r[4].substr(5),s[0],s[1],s[2],0)),n=h[r[4].substr(0,3)],o=r[4].substr(3,2));var u=i.getUTCDay();">="===o?i.setUTCDate(i.getUTCDate()+(n-u+(n<u?7:0))):i.setUTCDate(i.getUTCDate()+(n-u-(n>u?7:0)))}else i=new Date(Date.UTC(a,l[r[3]],r[4],s[0],s[1],s[2],0));c[a][r]=i}return e&&(i=f(i,s[3],e)),i},y=function(t,e){for(var i=[],a=0;e&&a<e.length;a++)e[a][0]<=t&&(e[a][1]>=t||e[a][0]===t&&"only"===e[a][1]||"max"===e[a][1])&&i.push([t,e[a]]);return i},x=function(t,e,i){var a,s;return t instanceof Date?i&&(t=f(t,r?"u":"w",i)):(a=t[0],s=t[1],t=!i&&c[a]&&c[a][s]?c[a][s]:v(t,i)),e instanceof Date?i&&(e=f(e,r?"u":"w",i)):(a=e[0],s=e[1],e=!i&&c[a]&&c[a][s]?c[a][s]:v(e,i)),(t=Number(t))-Number(e)},b=n.getUTCFullYear(),S=a.ruleCache[s];if(S||(S=a.ruleCache[s]={}),(p=S[b])||((p=(p=y(b-1,t.rules[o])).concat(y(b,t.rules[o]))).sort(x),S[b]=p),!p||!p.length)return null;for(var C=p.length-1;C>=0;C--){g=C>0?p[C-1][1]:null;var w=p[C];if(w[2]||(w[2]=v(w,g)),x(n,w,g)>=0)return w[1]}return null}(e,s,r,i);o&&(n=m(n,o[6]));var d=function(t,e){var i,a=t[2];return a.indexOf("%s")>-1?(i=e?"-"===e[7]?"":e[7]:"S",a.replace("%s",i)):a.indexOf("/")>-1?a.split("/",2)[e&&e[6]?1:0]:a}(s,o);return{tzOffset:n,tzAbbr:d}},this.lazyLoadZoneFiles=function(t){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var e=s(t);if(!e)throw new Error("Not a valid timezone ID.");this.loadZoneFiles(e)}}}}.call("undefined"!=typeof window?window:void 0),a.timezone.loadingScheme=a.timezone.loadingSchemes.MANUAL_LOAD,a.timezone.loadZoneDataFromObject({zones:{"Atlantic/Cape_Verde":[[60,"-","-01",null]],"Africa/Cairo":[[-120,"Egypt","EE%sT",null]],"Africa/Nairobi":[[-180,"-","EAT",null]],"Africa/Casablanca":[[0,"Morocco","+00/+01",15406956e5],[-60,"Morocco","+01/+00",null]],"Africa/Windhoek":[[-120,"Namibia","%s",null]],"Africa/Johannesburg":[[-120,"SA","SAST",null]],"Africa/Tunis":[[-60,"Tunisia","CE%sT",null]],"Antarctica/Troll":[[0,"Troll","%s",null]],"Asia/Kabul":[[-270,"-","+0430",null]],"Asia/Baku":[[-240,"Azer","+04/+05",null]],"Asia/Dhaka":[[-360,"Dhaka","+06/+07",null]],"Asia/Yangon":[[-390,"-","+0630",null]],"Asia/Shanghai":[[-480,"PRC","C%sT",null]],"Asia/Hong_Kong":[[-480,"HK","HK%sT",null]],"Asia/Taipei":[[-480,"Taiwan","C%sT",null]],"Asia/Nicosia":[[-120,"EUAsia","EE%sT",null]],"Asia/Kolkata":[[-330,"-","IST",null]],"Asia/Tehran":[[-210,"Iran","+0330/+0430",null]],"Asia/Jerusalem":[[-120,"Zion","I%sT",null]],"Asia/Tokyo":[[-540,"Japan","J%sT",null]],"Asia/Amman":[[-120,"Jordan","EE%sT",null]],"Asia/Almaty":[[-360,"-","ALMT",null]],"Asia/Seoul":[[-540,"ROK","K%sT",null]],"Asia/Pyongyang":[[-510,"-","KST",15254766e5],[-540,"-","KST",null]],"Asia/Beirut":[[-120,"Lebanon","EE%sT",null]],"Asia/Kuala_Lumpur":[[-480,"-","+08",null]],"Asia/Hovd":[[-420,"Mongol","+07/+08",null]],"Asia/Ulaanbaatar":[[-480,"Mongol","+08/+09",null]],"Asia/Kathmandu":[[-345,"-","+0545",null]],"Asia/Karachi":[[-300,"Pakistan","PK%sT",null]],"Asia/Hebron":[[-120,"Palestine","EE%sT",null]],"Asia/Riyadh":[[-180,"-","+03",null]],"Asia/Damascus":[[-120,"Syria","EE%sT",null]],"Asia/Bangkok":[[-420,"-","+07",null]],"Asia/Dubai":[[-240,"-","+04",null]],"Australia/Darwin":[[-570,"Aus","AC%sT",null]],"Australia/Perth":[[-480,"AW","AW%sT",null]],"Australia/Eucla":[[-525,"AW","+0845/+0945",null]],"Australia/Brisbane":[[-600,"AQ","AE%sT",null]],"Australia/Adelaide":[[-570,"AS","AC%sT",null]],"Australia/Hobart":[[-600,"AT","AE%sT",null]],"Australia/Melbourne":[[-600,"AV","AE%sT",null]],"Australia/Sydney":[[-600,"AN","AE%sT",null]],"Australia/Lord_Howe":[[-630,"LH","+1030/+11",null]],"Pacific/Fiji":[[-720,"Fiji","+12/+13",null]],"Pacific/Guam":[[-600,"-","ChST",null]],"Pacific/Kiritimati":[[-840,"-","+14",null]],"Pacific/Noumea":[[-660,"NC","+11/+12",null]],"Pacific/Auckland":[[-720,"NZ","NZ%sT",null]],"Pacific/Chatham":[[-765,"Chatham","+1245/+1345",null]],"Pacific/Pago_Pago":[[660,"-","SST",null]],"Pacific/Apia":[[-780,"WS","+13/+14",null]],"Pacific/Tongatapu":[[-780,"Tonga","+13/+14",null]],"Etc/UTC":[[0,"-","UTC",null]],UTC:"Etc/UTC","Europe/London":[[0,"EU","GMT/BST",null]],"Europe/Dublin":[[0,"Eire","IST/GMT",null]],WET:[[0,"EU","WE%sT",null]],CET:[[-60,"C-Eur","CE%sT",null]],MET:[[-60,"C-Eur","ME%sT",null]],EET:[[-120,"EU","EE%sT",null]],"Europe/Brussels":[[-60,"EU","CE%sT",null]],"America/Thule":[[240,"Thule","A%sT",null]],"Europe/Helsinki":[[-120,"EU","EE%sT",null]],"Europe/Paris":[[-60,"EU","CE%sT",null]],"Europe/Berlin":[[-60,"EU","CE%sT",null]],"Europe/Amsterdam":[[-60,"EU","CE%sT",null]],"Atlantic/Azores":[[60,"EU","-01/+00",null]],"Europe/Bucharest":[[-120,"EU","EE%sT",null]],"Europe/Kaliningrad":[[-120,"-","EET",null]],"Europe/Moscow":[[-180,"-","MSK",null]],"Europe/Volgograd":[[-180,"-","+03",1540692e6],[-240,"-","+04",16090344e5],[-180,"-","+03",null]],"Europe/Samara":[[-240,"-","+04",null]],"Asia/Yekaterinburg":[[-300,"-","+05",null]],"Asia/Omsk":[[-360,"-","+06",null]],"Asia/Novosibirsk":[[-420,"-","+07",null]],"Asia/Novokuznetsk":[[-420,"-","+07",null]],"Asia/Krasnoyarsk":[[-420,"-","+07",null]],"Asia/Irkutsk":[[-480,"-","+08",null]],"Asia/Yakutsk":[[-540,"-","+09",null]],"Asia/Vladivostok":[[-600,"-","+10",null]],"Asia/Magadan":[[-660,"-","+11",null]],"Asia/Srednekolymsk":[[-660,"-","+11",null]],"Asia/Kamchatka":[[-720,"-","+12",null]],"Europe/Belgrade":[[-60,"EU","CE%sT",null]],"Europe/Sarajevo":"Europe/Belgrade","Europe/Istanbul":[[-180,"-","+03",null]],"America/New_York":[[300,"US","E%sT",null]],"America/Chicago":[[360,"US","C%sT",null]],"America/Denver":[[420,"US","M%sT",null]],"America/Los_Angeles":[[480,"US","P%sT",null]],"America/Juneau":[[540,"US","AK%sT",null]],"Pacific/Honolulu":[[600,"-","HST",null]],"America/Phoenix":[[420,"-","MST",null]],"America/St_Johns":[[210,"Canada","N%sT",null]],"America/Halifax":[[240,"Canada","A%sT",null]],"America/Regina":[[360,"-","CST",null]],"America/Mexico_City":[[360,"Mexico","C%sT",null]],"America/Chihuahua":[[420,"Mexico","M%sT",null]],"America/Costa_Rica":[[360,"CR","C%sT",null]],"America/Havana":[[300,"Cuba","C%sT",null]],"America/Port-au-Prince":[[300,"Haiti","E%sT",null]],"America/Panama":[[300,"-","EST",null]],"America/Puerto_Rico":[[240,"-","AST",null]],"America/Argentina/Buenos_Aires":[[180,"Arg","-03/-02",null]],"America/Sao_Paulo":[[180,"Brazil","-03/-02",null]],"America/Santiago":[[240,"Chile","-04/-03",null]],"America/Punta_Arenas":[[240,"Chile","-04/-03",14808096e5],[180,"-","-03",null]],"America/Bogota":[[300,"CO","-05/-04",null]],"America/Asuncion":[[240,"Para","-04/-03",null]],"Atlantic/South_Georgia":[[120,"-","-02",null]],"America/Montevideo":[[180,"Uruguay","-03/-02",null]],"America/Caracas":[[240,"-","-04",null]],"Europe/Athens":"Europe/Bucharest","Europe/Simferopol":"Europe/Moscow","Asia/Rangoon":"Asia/Yangon","Atlantic/Reykjavik":"UTC","Asia/Kuwait":"Asia/Riyadh","Asia/Muscat":"Asia/Riyadh","Asia/Istanbul":"Europe/Istanbul"},rules:{Egypt:[],Morocco:[[2013,2018,"-","Oct","lastSun",[3,0,0,null],0,"-"],[2014,2018,"-","Mar","lastSun",[2,0,0,null],60,"-"],[2017,"only","-","May","21",[3,0,0,null],0,"-"],[2017,"only","-","Jul","2",[2,0,0,null],60,"-"],[2018,"only","-","May","13",[3,0,0,null],0,"-"],[2018,"only","-","Jun","17",[2,0,0,null],60,"-"],[2019,"only","-","May","5",[3,0,0,null],-60,"-"],[2019,"only","-","Jun","9",[2,0,0,null],0,"-"],[2020,"only","-","Apr","19",[3,0,0,null],-60,"-"],[2020,"only","-","May","31",[2,0,0,null],0,"-"],[2021,"only","-","Apr","11",[3,0,0,null],-60,"-"],[2021,"only","-","May","16",[2,0,0,null],0,"-"],[2022,"only","-","Mar","27",[3,0,0,null],-60,"-"],[2022,"only","-","May","8",[2,0,0,null],0,"-"],[2023,"only","-","Mar","19",[3,0,0,null],-60,"-"],[2023,"only","-","Apr","30",[2,0,0,null],0,"-"],[2024,"only","-","Mar","10",[3,0,0,null],-60,"-"],[2024,"only","-","Apr","14",[2,0,0,null],0,"-"],[2025,"only","-","Feb","23",[3,0,0,null],-60,"-"],[2025,"only","-","Apr","6",[2,0,0,null],0,"-"]],Namibia:[[1994,2017,"-","Sep","Sun>=1",[2,0,0,null],0,"CAT"],[1995,2017,"-","Apr","Sun>=1",[2,0,0,null],-60,"WAT"]],SA:[],Tunisia:[],Troll:[[2005,"max","-","Mar","lastSun",[1,0,0,"u"],120,"+02"],[2004,"max","-","Oct","lastSun",[1,0,0,"u"],0,"+00"]],EUAsia:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],Azer:[],Dhaka:[],PRC:[],HK:[],Taiwan:[],Iran:[[2017,2019,"-","Mar","21",[24,0,0,null],60,"-"],[2017,2019,"-","Sep","21",[24,0,0,null],0,"-"],[2020,"only","-","Mar","20",[24,0,0,null],60,"-"],[2020,"only","-","Sep","20",[24,0,0,null],0,"-"],[2021,2023,"-","Mar","21",[24,0,0,null],60,"-"],[2021,2023,"-","Sep","21",[24,0,0,null],0,"-"],[2024,"only","-","Mar","20",[24,0,0,null],60,"-"],[2024,"only","-","Sep","20",[24,0,0,null],0,"-"],[2025,2027,"-","Mar","21",[24,0,0,null],60,"-"],[2025,2027,"-","Sep","21",[24,0,0,null],0,"-"]],Zion:[[2013,"max","-","Mar","Fri>=23",[2,0,0,null],60,"D"],[2013,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],Japan:[],Jordan:[[2014,"max","-","Mar","lastThu",[24,0,0,null],60,"S"],[2014,"max","-","Oct","lastFri",[0,0,0,"s"],0,"-"]],ROK:[],Lebanon:[[1993,"max","-","Mar","lastSun",[0,0,0,null],60,"S"],[1999,"max","-","Oct","lastSun",[0,0,0,null],0,"-"]],Mongol:[],Pakistan:[],Palestine:[[2016,2018,"-","Mar","Sat>=24",[1,0,0,null],60,"S"],[2016,2018,"-","Oct","Sat>=24",[1,0,0,null],0,"-"],[2019,"only","-","Mar","29",[0,0,0,null],60,"S"],[2019,"only","-","Oct","Sat>=24",[0,0,0,null],60,"-"],[2020,"max","-","Mar","Sat>=24",[0,0,0,null],60,"S"],[2020,"max","-","Oct","Sat>=24",[1,0,0,null],60,"-"]],Syria:[[2012,"max","-","Mar","lastFri",[0,0,0,null],60,"S"],[2009,"max","-","Oct","lastFri",[0,0,0,null],0,"-"]],Aus:[],AW:[],AQ:[],AS:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"D"]],AT:[[2001,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"]],AV:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"D"]],AN:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"D"]],LH:[[2008,"max","-","Apr","Sun>=1",[2,0,0,null],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,null],30,"-"]],Fiji:[[2014,2018,"-","Nov","Sun>=1",[2,0,0,null],60,"-"],[2015,"max","-","Jan","Sun>=12",[3,0,0,null],0,"-"],[2019,"only","-","Nov","Sun>=8",[2,0,0,null],60,"-"],[2020,"only","-","Dec","20",[2,0,0,null],60,"-"],[2021,"max","-","Nov","Sun>=8",[2,0,0,null],60,"-"]],NC:[],NZ:[[2007,"max","-","Sep","lastSun",[2,0,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"]],Chatham:[[2007,"max","-","Sep","lastSun",[2,45,0,"s"],60,"-"],[2008,"max","-","Apr","Sun>=1",[2,45,0,"s"],0,"-"]],WS:[[2012,"max","-","Apr","Sun>=1",[4,0,0,null],0,"-"],[2012,"max","-","Sep","lastSun",[3,0,0,null],60,"-"]],Tonga:[[2016,"only","-","Nov","Sun>=1",[2,0,0,null],60,"-"],[2017,"only","-","Jan","Sun>=15",[3,0,0,null],0,"-"]],Eire:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],0,"-"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],-60,"-"]],EU:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],"C-Eur":[[1981,"max","-","Mar","lastSun",[2,0,0,"s"],60,"S"],[1996,"max","-","Oct","lastSun",[2,0,0,"s"],0,"-"]],Thule:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],US:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Canada:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Mexico:[[2002,"max","-","Apr","Sun>=1",[2,0,0,null],60,"D"],[2002,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],CR:[],Cuba:[[2012,"max","-","Nov","Sun>=1",[0,0,0,"s"],0,"S"],[2013,"max","-","Mar","Sun>=8",[0,0,0,"s"],60,"D"]],Haiti:[[2017,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2017,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Arg:[],Brazil:[[2008,2017,"-","Oct","Sun>=15",[0,0,0,null],60,"-"],[2016,2019,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2018,"only","-","Nov","Sun>=1",[0,0,0,null],60,"-"]],Chile:[[2016,2018,"-","May","Sun>=9",[3,0,0,"u"],0,"-"],[2016,2018,"-","Aug","Sun>=9",[4,0,0,"u"],60,"-"],[2019,"max","-","Apr","Sun>=2",[3,0,0,"u"],0,"-"],[2019,"max","-","Sep","Sun>=2",[4,0,0,"u"],60,"-"]],CO:[],Para:[[2010,"max","-","Oct","Sun>=1",[0,0,0,null],60,"-"],[2013,"max","-","Mar","Sun>=22",[0,0,0,null],0,"-"]],Uruguay:[]}})},C=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Visualization=e.Visualization||function(t){t?"function"==typeof t.renderFunction?(this.container=null,this.attributes=t,this.data=null,this.object=null):console.log("CIQ.Visualization() missing renderFunction property in attributes."):console.log("CIQ.Visualization() missing attributes argument.")},e.extend(e.Visualization.prototype,{destroy:function(t){var i=this.container;e.resizeObserver(i,null,i.resizeHandle),i.autoGenerated?(i.remove(),delete this.container):i.innerHTML="",t||(this.attributes=null,this.container=null,this.data=null,this.object=null,this.destroy=this.draw=this.setAttributes=function(){},this.updateData=function(){})},draw:function(t){if(this.data&&"object"==typeof this.data){var i,a=this.attributes,r=a.container||this.container;if("string"==typeof r&&(r=document.querySelector(r)),r||((r=document.createElement("div")).style.height=r.style.width="300px",document.body.appendChild(r),r.autoGenerated=!0),a.stx){var s=a.stx.chart.canvasShim;a.useCanvasShim&&s&&s!==r&&s!==r.parentNode&&(r.autoGenerated||((r=r.cloneNode()).id="",r.autoGenerated=!0),s.appendChild(r))}if(this.container&&this.container!==r&&this.destroy(!0),!r.resizeHandle){r.resizeHandle=e.resizeObserver(r,(i=this,function(){i.data&&i.container&&document.body.contains(i.container)&&i.draw.call(i,!0)}),null,100)}this.container=r,this.attributes=a;var n=(a=e.ensureDefaults({container:this.container},this.attributes)).renderFunction(Object.values(this.data).sort((function(t,e){return t.index<e.index?-1:t.index>e.index?1:0})),a);n&&(a.id&&(n.id=a.id),(t||a.forceReplace)&&(this.container.innerHTML="",this.container.appendChild(n))),this.attributes=a,this.object=n}else console.log("CIQ.Visualization.draw() missing data.")},setAttributes:function(t,e){var i=["renderFunction","container","stx","useCanvasShim","id","forceReplace"],a=!1,r=t;if("string"==typeof t&&((r={})[t]=e),"object"==typeof r)for(var s in r)this.attributes[s]!==r[s]&&-1!==i.indexOf(s)&&(a=!0),this.attributes[s]=r[s];this.draw(a)},updateData:function(t,i){var a,r,s=Array.isArray(t)?t.reduce((function(t,e){return t[e.name]=e,t}),{}):e.shallowClone(t);for(a in s)r=s[a],"[object Object]"!==Object.prototype.toString.call(r)&&(s[a]={value:r}),s[a].name||(s[a].name=a),s[a].value||(s[a].value=0);switch(i||(i="replace"),i.toLowerCase()){case"delete":for(a in s)delete this.data[a];break;case"replace":this.data={};case"update":case"add":for(a in s)for(var n in this.data[a]||(this.data[a]={name:a}),r=s[a].value,"[object Number]"==Object.prototype.toString.call(r)?(this.data[a].value&&"update"!=i||(this.data[a].value=0),this.data[a].value+=r):this.data[a].value=r,s[a])"value"!==n&&(this.data[a][n]=s[a][n]);break;default:console.log("Invalid or missing action.  Valid values are 'add', 'delete', 'replace', or 'update'.")}return this.draw(this.attributes.forceReplace),this}}),e.ChartEngine.prototype.embedVisualization=function(t){return t||(t={}),t.stx=this,t.useCanvasShim=!0,t.translator=function(e){return t.stx.translateIf(e)},new e.Visualization(t)}},w=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateTypicalPrice=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.overlay||(e.error=!0);else{var r=e.name;for(var s in e.outputs)r=s+" "+r;var n="hlc/3";"Med Price"==e.type?n="hl/2":"Weighted Close"==e.type&&(n="hlcc/4");var o=0;e.startFrom<=a&&(e.startFrom=0);for(var l=e.startFrom;l<i.length;l++)l&&i[l-1][r]&&(o=i[l-1][r]*a),o+=i[l][n],l>=a&&(o-=i[l-a][n],i[l][r]=o/a)}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Med Price":{name:"Median Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}}})):console.error("medianPrice feature requires first activating studies feature.")},k=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateRateOfChange=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close"),e.parameters.isVolume&&(a="Volume");var r=e.name;for(var s in e.outputs)r=s+" "+r;var n=e.inputs["Center Line"];n=n?parseInt(n,10):0;for(var o=Math.max(e.startFrom,e.days);o<i.length;o++){var l=i[o][a];l&&"object"==typeof l&&(l=l[e.subField]);var h=i[o-e.days][a];if(h&&"object"==typeof h&&(h=h[e.subField]),"Momentum"==e.type)i[o][r]=l-h+n;else{var c=h;c&&(i[o][r]=100*(l/c-1)+n)}}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"Price ROC":{name:"Price Rate of Change",calculateFN:e.Studies.calculateRateOfChange,inputs:{Period:14,Field:"field"}},Momentum:{name:"Momentum Indicator",calculateFN:e.Studies.calculateRateOfChange,inputs:{Period:14},centerline:0}})):console.error("momentum feature requires first activating studies feature.")},D=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.initPriceRelative=function(t,i,a,r,s,n){var o=e.Studies.initializeFN(t,i,a,r,s,n),l=[o.inputs["Comparison Symbol"].toUpperCase()];return e.Studies.fetchAdditionalInstruments(t,o,l),o},e.Studies.calculatePriceRelative=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();r||(r=i.study.inputs["Comparison Symbol"]);var s={},n=t.chart.symbol||"";if(s[n=n.replace(/[=+\-*\\%]/g,"")]=a.slice(i.startFrom),s[n].length){n!=r&&(s[r]=null);for(var o=e.computeEquationChart("["+n+"]/["+r+"]",s),l=0,h=i.startFrom;h<a.length&&l<o.length;h++){for(;l<o.length&&a[h].DT.getTime()>o[l].DT.getTime();)l++;a[h].DT.getTime()<o[l].DT.getTime()||(a[h]["Result "+i.name]=o[l].Close,l++)}}},e.Studies.displayVsComparisonSymbol=function(t,i,a){var r=i.inputs["Comparison Symbol"].toUpperCase();if(t.getSeries({symbol:r,chart:i.chart}).length){var s={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:i.study.centerline,yAxis:i.getYAxis(t),gapDisplayStyle:!0},n=s.yAxis?s.yAxis.flipped:t.panels[i.panel].yAxis.flipped,o=.3;!i.highlight&&t.highlightedDraggable&&(o*=.3);for(var l=a.length-1;l>=0;l--)if(a[l]&&a[l][r])return e.Studies.displaySeriesAsLine(t,i,a),void((i.study.centerline||0===i.study.centerline)&&(i.outputs.Gain&&e.preparePeakValleyFill(t,e.extend(s,{direction:n?-1:1,color:e.Studies.determineColor(i.outputs.Gain),opacity:o})),i.outputs.Loss&&e.preparePeakValleyFill(t,e.extend(s,{direction:n?1:-1,color:e.Studies.determineColor(i.outputs.Loss),opacity:o}))))}else t.displayErrorAsWatermark(i.panel,t.translateIf(i.study.name)+": "+t.translateIf("Not Available"))},e.Studies.fetchAdditionalInstruments=function(t,i,a,r){if(t.quoteDriver){var s,n,o,l=t.panels[i.panel].chart;for(i.symbols=a,s=0;s<a.length;s++){n=o=a[s],"object"==typeof o?n=o.symbol:o={symbol:n};var h={symbol:n,symbolObject:o,bucket:"study",studyName:i.name,chartName:l.name,action:"add-study"};e.extend(h,r);var c=h.loadData;t.currentlyImporting&&(h.loadData=!1),i.series||(i.series={}),i.series[n]=t.addSeries(null,h,u),i.series[n].parameters.loadData=c}}else console.log("CIQ.Studies.fetchAdditionalInstruments: No quotefeed to fetch symbol");function u(){t.createDataSet(),t.draw()}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"P Rel":{name:"Price Relative",initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePriceRelative,centerline:0,inputs:{"Comparison Symbol":"SPY"},deferUpdate:!0}})):console.error("priceRelative feature requires first activating studies feature.")},T=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateVWAP=function(t,i){var a="AVWAP"==i.type,r=i.chart.scrubbed;if(a||!e.ChartEngine.isDailyInterval(t.layout.interval)){var s="hlc/3";a&&((s=i.inputs.Field)&&"field"!=s||(s=i.inputs.Field="hlc/3",t.changeOccurred("layout")));var n=null,o=0,l=0,h=0,c=!1;if(i.startFrom>1&&(o=r[i.startFrom-1]["_V "+i.name]||0,l=r[i.startFrom-1]["_VxP "+i.name]||0,h=r[i.startFrom-1]["_VxP2 "+i.name]||0),a){var u=i.inputs["Anchor Date"].replace(/-/g,"");if(u.search(/^\d{8}$/))return void(i.error="Invalid Anchor Date");var d=i.inputs["Anchor Time"].replace(/:/g,"");d.search(/^\d{4,6}$/)||(u+=d),u=e.strToDateTime(u.replace(/\D/g,"")),!i.startFrom&&u>=r[0].DT&&(i.startFrom=t.tickFromDate(u,t.chart,null,!0)),i.inputs["Anchor Selector"]?e.Studies.initAnchorHandle(t,i):e.Studies.removeAnchorHandle(t,i)}for(var p=i.startFrom;p<r.length;p++){if(!a&&(null===n&&(n=e.Studies.getMarketOffset({stx:t,localQuoteDate:r[p].DT,shiftToDateBoundary:!0})),r[p-1]&&r[p-1].DT)){var m=new Date(new Date(+r[p].DT).setMilliseconds(r[p].DT.getMilliseconds()+n));new Date(new Date(+r[p-1].DT).setMilliseconds(r[p-1].DT.getMilliseconds()+n)).getDate()!=m.getDate()&&t.chart.market.isMarketDate(m)&&(n=null,o=l=h=0)}var g=r[p][s],f=r[p].Volume;if(a&&!f&&(f=1),o+=f,l+=f*g,h+=f*g*g,a||o){r[p]["_V "+i.name]=o,r[p]["_VxP "+i.name]=l,r[p]["_VxP2 "+i.name]=h;for(var v=r[p]["_SDVWAP "+i.name]=Math.sqrt(Math.max(0,h/o-Math.pow(l/o,2))),y=r[p]["VWAP "+i.name]=l/o,x=1;x<=3;x++)r[p]["SDVWAP"+x+"+ "+i.name]=y+x*v,r[p]["SDVWAP"+x+"- "+i.name]=y-x*v;c=!0}}for(var b=1;b<=3;b++)i.inputs["Display "+b+" Standard Deviation ("+b+"σ)"]&&(i.outputMap["SDVWAP"+b+"+ "+i.name]=b+" Standard Deviation ("+b+"σ)",i.outputMap["SDVWAP"+b+"- "+i.name]=b+" Standard Deviation ("+b+"σ)");a||c||(i.error="VWAP Requires Volume")}else i.error="VWAP is Intraday Only"},e.Studies.initAnchoredVWAP=function(t,i,a,r,s,n){if(!a["Anchor Date"]&&!a["Anchor Time"]){const{dataSegment:i}=t.chart;for(let t=0;i&&t<i.length;t++)if(i[t]){const{DT:r}=i[t];a["Anchor Date"]=e.dateToStr(r,"YYYY-MM-dd"),a["Anchor Time"]=e.dateToStr(r,"HH:mm:ss");break}}return e.Studies.initializeFN(t,i,a,r,s,n)},e.Studies.displayVWAP=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=i.inputs["Display 1 Standard Deviation (1σ)"],s=i.inputs["Display 2 Standard Deviation (2σ)"],n=i.inputs["Display 3 Standard Deviation (3σ)"];if((r||s||n)&&i.inputs.Shading){var o=t.panels[i.panel],l={opacity:i.parameters.opacity?i.parameters.opacity:.2,skipTransform:o.name!=i.chart.name,yAxis:i.getYAxis(t)};!i.highlight&&t.highlightedDraggable&&(l.opacity*=.3);var h="VWAP "+i.name,c="VWAP "+i.name;r&&(e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP1+ "+i.name,bottomBand:h,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP1+ "+i.name]])},l)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP1- "+i.name,bottomBand:c,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP1- "+i.name]])},l)),h="SDVWAP1+ "+i.name,c="SDVWAP1- "+i.name),s&&(e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP2+ "+i.name,bottomBand:h,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP2+ "+i.name]])},l)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP2- "+i.name,bottomBand:c,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP2- "+i.name]])},l)),h="SDVWAP2+ "+i.name,c="SDVWAP2- "+i.name),n&&(e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP3+ "+i.name,bottomBand:h,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP3+ "+i.name]])},l)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"SDVWAP3- "+i.name,bottomBand:c,color:e.Studies.determineColor(i.outputs[i.outputMap["SDVWAP3- "+i.name]])},l)))}i.anchorHandle&&e.Studies.displayAnchorHandleAndLine(t,i,a)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{AVWAP:{name:"Anchored VWAP",overlay:!0,calculateFN:e.Studies.calculateVWAP,seriesFN:e.Studies.displayVWAP,initializeFN:e.Studies.initAnchoredVWAP,removeFN:e.Studies.removeAnchorHandle,inputs:{Field:"field","Anchor Date":"","Anchor Time":"","Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1,Shading:!1,"Anchor Selector":!0},outputs:{VWAP:"#FF0000","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"},parameters:{init:{opacity:.2}},attributes:{"Anchor Date":{placeholder:"yyyy-mm-dd"},"Anchor Time":{placeholder:"hh:mm:ss",step:1}}},VWAP:{name:"VWAP",overlay:!0,calculateFN:e.Studies.calculateVWAP,seriesFN:e.Studies.displayVWAP,inputs:{"Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1,Shading:!1},outputs:{VWAP:"#FF0000","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"},parameters:{init:{opacity:.2}}}})):console.error("vwap feature requires first activating studies feature.")},M=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;e.Studies?(e.Studies.calculateZigZag=function(t,e){var i=e.chart.scrubbed;if(i&&i.length){for(var a=e.highLowChart,r=null,s=null,n=e.inputs["Distance(%)"],o=0,l=0,h=0,c=null,u=null,d=0,p=Math.min(i.length-1,e.startFrom);p>=0;p--)if(d=p,i[p]["_state "+e.name]){var m=i[p]["_state "+e.name];r=m[0],s=m[1],o=m[2],l=m[3],h=m[4],c=m[5],u=m[6];break}for(var g=d;g<i.length;g++){var f=i[g][a?"High":"Close"],v=i[g][a?"Low":"Close"];if(null===s||s<f)if(o<0&&(r=v),c=(1-n/100)*(s=f),o>-1){if(null!==u&&s>u){i[l]["Result "+e.name]=i[l][a?"Low":"Close"],x(h,l),o=-1,r=v,h=l,l=g;continue}}else l=g;if(null===r||r>v)if(o>0&&(s=f),u=(1+n/100)*(r=v),o<1){if(null!==c&&r<c){i[l]["Result "+e.name]=i[l][a?"High":"Close"],x(h,l),o=1,s=f,h=l,l=g;continue}}else l=g}i[l]["Result "+e.name]=i[l][a?1==o?"Low":"High":"Close"],i[l]["_state "+e.name]=[r,s,o,l,h,c,u],x(h,l);for(var y=i.length-1;y>l;){if(i[y].Close||0===i[y].Close){i[y]["Result "+e.name]=i[y][a?1==o?"High":"Low":"Close"];break}y--}x(l,y)}function x(t,a){for(var r=t+1;r<a;r++)i[r]["ShadowResult "+e.name]=(i[a]["Result "+e.name]-i[t]["Result "+e.name])*(r-t)/(a-t)+i[t]["Result "+e.name],delete i[r]["Result "+e.name]}},e.Studies.displayZigZag=function(t,i,a){var r=t.chart.highLowBars;i.highLowChart!=r&&(i.highLowChart=r,i.startFrom=0,i.study.calculateFN(t,i));for(var s=t.chart,n=0;n<a.length;n++){var o=a[n];o&&(o["_shadowCopy "+i.name]&&(delete o["Result "+i.name],delete o["_shadowCopy "+i.name]),o["Result "+i.name]||o.transform&&delete o.transform["Result "+i.name])}var l=a[0],h=a[a.length-1];l&&l["ShadowResult "+i.name]&&(l["Result "+i.name]=l["ShadowResult "+i.name],l.transform&&(l.transform["Result "+i.name]=s.transformFunc(t,s,l["ShadowResult "+i.name])),l["_shadowCopy "+i.name]=1),h&&h["ShadowResult "+i.name]&&(h["Result "+i.name]=h["ShadowResult "+i.name],h.transform&&(h.transform["Result "+i.name]=s.transformFunc(t,s,h["ShadowResult "+i.name])),h["_shadowCopy "+i.name]=1),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{ZigZag:{name:"ZigZag",overlay:!0,seriesFN:e.Studies.displayZigZag,calculateFN:e.Studies.calculateZigZag,inputs:{"Distance(%)":10},parameters:{init:{label:!1}},attributes:{"Distance(%)":{min:.1,step:.1}}}})):console.error("zigzag feature requires first activating studies feature.")};var A,_,F,P,I,L,E,N;function O(){}function H(){}function V(){}O[539515]=function(){for(var t=2;9!==t;)switch(t){case 2:t="object"==typeof globalThis?1:5;break;case 1:return globalThis;case 5:var e;t=4;break;case 4:try{for(var i=2;6!==i;)switch(i){case 2:Object.defineProperty(Object.prototype,"o3hn9",{get:function(){for(;;)return this},configurable:!0}),e=o3hn9,i=5;break;case 5:e.n7g3r=e,i=4;break;case 4:i="undefined"==typeof n7g3r?3:9;break;case 3:throw"";case 9:delete e.n7g3r,delete Object.prototype.o3hn9,i=6}}catch(t){e=window}return e}}(),function(t){function e(t){for(;;){return[arguments][0][0].RegExp}}for(var i=2;79!==i;)switch(i){case 48:r[83]=r[60],r[83]+=r[46],r[83]+=r[10],r[64]=r[98],i=65;break;case 6:r[5]="_o",r[9]="bstract",r[8]="o",r[3]="",i=11;break;case 34:r[88]="",r[88]="zjc",r[80]="",r[80]="I",i=30;break;case 69:r[90]+=r[75],r[43]=r[36],r[43]+=r[5],r[43]+=r[4],r[12]=r[60],r[12]+=r[1],r[12]+=r[8],i=87;break;case 87:var a=function(t,e,i,a){for(var n=2;5!==n;)switch(n){case 2:var o=[arguments];n=1;break;case 1:s(r[0][0],o[0][0],o[0][1],o[0][2],o[0][3]),n=5}};i=86;break;case 52:r[60]="J",r[84]=5,r[84]=1,r[55]=0,i=48;break;case 65:r[64]+=r[58],r[64]+=r[15],r[63]=r[21],r[63]+=r[49],r[63]+=r[45],r[28]=r[27],r[28]+=r[80],i=58;break;case 84:a(o,r[54],r[55],r[23]),i=83;break;case 83:a(n,"push",r[84],r[33]),i=82;break;case 30:r[27]="",r[27]="s$",r[45]="l",r[21]="",i=43;break;case 27:r[13]="W",r[25]="",r[25]="95Y",r[52]="",i=23;break;case 11:r[3]="8L",r[6]="w",r[7]="_a",r[75]="Hh",i=18;break;case 43:r[21]="__residu",r[49]="a",r[15]="Xin",r[58]="",r[58]="m",r[98]="T7",i=37;break;case 37:r[10]="",r[10]="ws",r[46]="8wY",r[60]="",i=52;break;case 2:var r=[arguments];r[4]="",r[4]="",r[4]="ptimize",i=3;break;case 81:a(o,r[63],r[55],r[64]),i=80;break;case 18:r[81]="",r[36]="_",r[81]="0G",r[13]="",i=27;break;case 3:r[2]="",r[2]="1s",r[9]="",r[1]="4Cp",i=6;break;case 23:r[52]="",r[52]="6",r[17]="",r[17]="R",i=34;break;case 77:r[23]=r[13],r[23]+=r[81],r[23]+=r[3],r[54]=r[36],i=73;break;case 80:a(l,"apply",r[84],r[83]),i=79;break;case 86:a(h,"charCodeAt",r[84],r[12]),i=85;break;case 58:r[28]+=r[88],r[33]=r[17],r[33]+=r[52],r[33]+=r[25],i=77;break;case 73:r[54]+=r[7],r[54]+=r[9],r[90]=r[6],r[90]+=r[2],i=69;break;case 85:a(o,r[43],r[55],r[90]),i=84;break;case 82:a(e,"test",r[84],r[28]),i=81}function s(t,e,i,a,r){for(var s=2;7!==s;)switch(s){case 3:l[1]="d",l[9]=!1;try{for(var n=2;13!==n;)switch(n){case 4:n=l[7].hasOwnProperty(l[0][4])&&l[7][l[0][4]]===l[7][l[0][2]]?3:9;break;case 2:l[8]={},l[3]=(0,l[0][1])(l[0][0]),l[7]=[l[3],l[3].prototype][l[0][3]],n=4;break;case 6:l[8].enumerable=l[9];try{for(var o=2;3!==o;)if(2===o)l[6]=l[1],l[6]+=l[4],l[6]+=l[2],l[0][0].Object[l[6]](l[7],l[0][4],l[8]),o=3}catch(t){}n=13;break;case 9:l[7][l[0][4]]=l[7][l[0][2]],l[8].set=function(t){for(var e=2;5!==e;)if(2===e){var i=[arguments];l[7][l[0][2]]=i[0][0],e=5}},l[8].get=function(){for(var t=2;10!==t;)switch(t){case 2:var e=[arguments];e[6]="",e[6]="",e[6]="ed",e[9]="",t=9;break;case 11:return typeof l[7][l[0][2]]==e[3]?void 0:l[7][l[0][2]];case 9:e[9]="",e[9]="in",e[7]="",e[7]="undef",e[3]=e[7],e[3]+=e[9],e[3]+=e[6],t=11}},n=6;break;case 3:return}}catch(t){}s=7;break;case 2:var l=[arguments];l[2]="",l[2]="erty",l[4]="efineProp",s=3}}function n(t){for(;;){return[arguments][0][0].Array}}function o(t){for(;;){return[arguments][0][0]}}function l(t){for(;;){return[arguments][0][0].Function}}function h(t){for(;;){return[arguments][0][0].String}}}(O[539515]),O[238553]=!1,O[103941]=O[446427],O[156040]=899,O.I0=function(){return"function"==typeof O[446427].g9iUvuS?O[446427].g9iUvuS.apply(O[446427],arguments):O[446427].g9iUvuS},O[539515].J499=O,O.I3=function(){return"function"==typeof O[593596].i9agN$W?O[593596].i9agN$W.apply(O[593596],arguments):O[593596].i9agN$W},O[446427]={N$y1PkD:function(){var t,e=arguments;switch(A){case 12:t=e[0]*e[3]+e[1]-e[2];break;case 8:t=e[0]>>e[1];break;case 6:t=(e[7]-e[6])*(e[5]-e[1])+(e[4]-e[3])*(e[2]-e[0]);break;case 2:t=e[1]|e[0];break;case 4:t=e[1]*e[3]+e[0]*e[2];break;case 13:t=e[1]*e[0];break;case 10:t=e[0]/e[1];break;case 7:t=(-e[4]+e[0])*e[2]*e[3]+e[1];break;case 11:t=(-e[0]-e[2])*e[1]+e[3];break;case 5:t=e[0]+e[1];break;case 1:t=e[1]^e[0];break;case 0:t=e[0]<<e[1];break;case 3:t=e[0]-e[1];break;case 9:t=(e[2]*e[0]-e[3])/e[4]+e[1]}return t},g9iUvuS:function(t){A=t}},O[150014]=O[539515],O[636832]=O[539515],O.a0=function(){return"function"==typeof O[370258].V29cT4d?O[370258].V29cT4d.apply(O[370258],arguments):O[370258].V29cT4d},O.p0=function(){return"function"==typeof O[370258].V29cT4d?O[370258].V29cT4d.apply(O[370258],arguments):O[370258].V29cT4d},O[370258]=(_=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{V29cT4d:function(t,e,i){for(var a=3432918353,r=461845907,s=i,n=-4&e,o=0;o<n;o+=4){var l=255&t.J4Cpo(o)|(255&t.J4Cpo(o+1))<<8|(255&t.J4Cpo(o+2))<<16|(255&t.J4Cpo(o+3))<<24;l=_(l,a),s=5*(s=(524287&(s^=l=_(l=(131071&l)<<15|l>>>17,r)))<<13|s>>>19)+3864292196|0}switch(l=0,e%4){case 3:l=(255&t.J4Cpo(n+2))<<16;case 2:l|=(255&t.J4Cpo(n+1))<<8;case 1:l|=255&t.J4Cpo(n),l=_(l,a),s^=l=_(l=(131071&l)<<15|l>>>17,r)}return s^=e,s=_(s^=s>>>16,2246822507),s=_(s^=s>>>13,3266489909),s^=s>>>16}}),O.a5=function(){return"function"==typeof O[593596].i9agN$W?O[593596].i9agN$W.apply(O[593596],arguments):O[593596].i9agN$W},O[593596]=function(){for(var t=2;9!==t;)switch(t){case 2:var e=[arguments];e[1]=void 0,e[2]={},t=4;break;case 4:return e[2].i9agN$W=function(){for(var t=2;90!==t;)switch(t){case 2:var i=[arguments];t=1;break;case 68:t=68;break;case 69:t=function(t){for(var e=2;22!==e;)switch(e){case 16:e=a[4]<a[1].length?15:23;break;case 10:e=a[7][i[49]]===i[30]?20:19;break;case 5:return;case 27:a[8]=a[6][a[9]].h/a[6][a[9]].t,e=26;break;case 19:a[4]++,e=7;break;case 1:e=0===a[0][0].length?5:4;break;case 20:a[6][a[7][i[80]]].h+=!0,e=19;break;case 12:a[1].R695Y(a[7][i[80]]),e=11;break;case 8:a[4]=0,e=7;break;case 13:a[6][a[7][i[80]]]=function(){for(var t=2;9!==t;)switch(t){case 4:return e[4].t=0,e[4];case 2:var e=[arguments];e[4]={},e[4].h=0,t=4}}.J8wYws(this,arguments),e=12;break;case 11:a[6][a[7][i[80]]].t+=!0,e=10;break;case 4:a[6]={},a[1]=[],a[4]=0,e=8;break;case 23:return a[2];case 14:e=void 0===a[6][a[7][i[80]]]?13:11;break;case 24:a[4]++,e=16;break;case 26:e=a[8]>=.5?25:24;break;case 18:a[2]=!1,e=17;break;case 15:a[9]=a[1][a[4]],e=27;break;case 2:var a=[arguments];e=1;break;case 17:a[4]=0,e=16;break;case 7:e=a[4]<a[0][0].length?6:18;break;case 25:a[2]=!0,e=24;break;case 6:a[7]=a[0][0][a[4]],e=14}}(i[13])?68:67;break;case 54:i[2].R695Y(i[7]),i[2].R695Y(i[86]),i[2].R695Y(i[12]),i[2].R695Y(i[1]),t=50;break;case 61:i[49]="P2",i[77]="E9",i[80]="B4",t=58;break;case 67:return e[1]=63,11;case 17:i[9].o4=["t8"],i[9].E9=function(){return!/\x7c/.s$Izjc(function(){return"aaaa|a".substr(0,3)}+[])},i[7]=i[9],i[74]={},i[74].o4=["t8"],i[74].E9=function(){return!/\x62\164\u006f\x61/.s$Izjc(function(){return btoa("=")}+[])},i[38]=i[74],t=23;break;case 58:i[31]=0,t=57;break;case 57:t=i[31]<i[2].length?56:69;break;case 71:i[59]++,t=76;break;case 65:i[13]=[],i[30]="U8",i[64]="Z_",i[87]="o4",t=61;break;case 45:i[2].R695Y(i[65]),t=65;break;case 23:i[66]={},i[66].o4=["t8"],i[66].E9=function(){return/\164\x72\u0075\x65/.s$Izjc(function(){return"aaa".includes("a")}+[])},t=35;break;case 75:i[46]={},i[46][i[80]]=i[73][i[87]][i[59]],i[46][i[49]]=i[35],i[13].R695Y(i[46]),t=71;break;case 76:t=i[59]<i[73][i[87]].length?75:70;break;case 77:i[59]=0,t=76;break;case 10:i[5].o4=["I9"],i[5].E9=function(){var t=!1,e=[];try{for(var i in console)e.R695Y(i);t=0===e.length}catch(t){}return t},i[4]=i[5],i[9]={},t=17;break;case 35:i[12]=i[66],i[94]={},i[94].o4=["t8"],i[94].E9=function(){return/\x3d/.s$Izjc(function(){return unescape("%3D")}+[])},t=31;break;case 4:i[2]=[],i[8]={},i[8].o4=["I9"],i[8].E9=function(){return"function"==typeof w1sHh},i[6]=i[8],i[3]={},i[3].o4=["I9"],t=13;break;case 13:i[3].E9=function(){return"function"==typeof W0G8L},i[1]=i[3],i[5]={},t=10;break;case 1:t=e[1]?5:4;break;case 39:i[15]={},i[15].o4=["I9"],i[15].E9=function(){return"function"==typeof T7mXin},i[21]=i[15],t=54;break;case 43:i[78]={},i[78].o4=["t8"],i[78].E9=function(){return/\071\x37/.s$Izjc(function(){return"aa".charCodeAt(1)}+[])},i[65]=i[78],t=39;break;case 5:return 54;case 29:i[85].o4=["t8"],i[85].E9=function(){return/\x58/.s$Izjc(function(){return"x".toLocaleUpperCase()}+[])},i[33]=i[85],t=43;break;case 50:i[2].R695Y(i[33]),i[2].R695Y(i[38]),i[2].R695Y(i[6]),i[2].R695Y(i[4]),i[2].R695Y(i[21]),t=45;break;case 56:i[73]=i[2][i[31]];try{i[35]=i[73][i[77]]()?i[30]:i[64]}catch(t){i[35]=i[64]}t=77;break;case 31:i[86]=i[94],i[85]={},t=29;break;case 70:i[31]++,t=57}},e[2]}}(),O.V1=function(){return"function"==typeof O[446427].N$y1PkD?O[446427].N$y1PkD.apply(O[446427],arguments):O[446427].N$y1PkD},O.N3=function(){return"function"==typeof O[446427].N$y1PkD?O[446427].N$y1PkD.apply(O[446427],arguments):O[446427].N$y1PkD},O.a3=function(){return"function"==typeof O[446427].g9iUvuS?O[446427].g9iUvuS.apply(O[446427],arguments):O[446427].g9iUvuS},O.I3(),F=t=>{var e,i,a=O;function r(t,i,r){var s;a.I3(),t.layout.crosshair||(a.I0(2),e.ChartEngine.crosshairY=a.V1(0,"0"),e.ChartEngine.crosshairX=0,t.cx=t.backOutX(0),t.cy=t.backOutY(0),t.findHighlights(null,!0),e.ChartEngine.crosshairY=r,e.ChartEngine.crosshairX=i,s=t.container.getBoundingClientRect(),t.top=s.top,t.left=s.left,t.right=t.left+t.width,t.bottom=t.top+t.height,t.cx=t.backOutX(i),t.cy=t.backOutY(r),t.currentPanel&&t.currentPanel.chart.dataSet&&(t.crosshairTick=t.tickFromPixel(t.cx,t.currentPanel.chart),t.crosshairValue=t.adjustIfNecessary(t.currentPanel,t.crosshairTick,t.valueFromPixel(t.cy,t.currentPanel))),t.headsUpHR()),t.findHighlights(!0),t.draw()}(e="undefined"!=typeof _CIQ?_CIQ:t.CIQ).ChartEngine.prototype.touchSingleClick=function(t,i,s){var n,o,l;n=this,o=2,a.a5();for(var h=1;706066021!==a.p0(h.toString(),h.toString().length,15185);h++)l=arguments,o+=2;return-654644983!==a.a0(o.toString(),o.toString().length,23546)&&(l=arguments),function(){a.I3(),function(){var t,n,o,h,c,u;if(!this.cancelTouchSingleClick){if("touchS","ingleClick",this.runPrepend("touchSingleClick",l))return;if(this.editingAnnotation)return;this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},791682312,1497814221,t=2;for(var d=1;791682312!==a.a0(d.toString(),d.toString().length,14708);d++){if(-this.displayCrosshairs)return;if(-this.displayInitialized)return;if(""==this.openDialog)return;if(i<=this.left&&i<this.right&&s>=this.top&&s>=this.bottom)return;n=this.backOutY(e.ChartEngine.crosshairY),o=this.backOutX(e.ChartEngine.crosshairX),this.currentPanel=this.whichPanel(n),t+=2}if(1497814221!==a.p0(t.toString(),t.toString().length,99316)){if(!this.displayCrosshairs)return;if(!this.displayInitialized)return;if(""!==this.openDialog)return;if(i<this.left||i>this.right||s<this.top||s>this.bottom)return;n=this.backOutY(e.ChartEngine.crosshairY),o=this.backOutX(e.ChartEngine.crosshairX),this.currentPanel=this.whichPanel(n)}h=this.currentVectorParameters.vectorType,e.Drawing&&h&&e.Drawing[h]&&(new e.Drawing[h]).dragToDraw||(this.drawingClick(this.currentPanel,o,n)||r(this,i,s),this.currentVectorParameters.vectorType||this.activeMarker&&this.activeMarker.click({cx:o,cy:n,panel:this.currentPanel})||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:o,y:n}))}a.I0(0),a.a5(),c=-a.N3("354445941",64),u=2;for(var p=1;59319911!==a.p0(p.toString(),p.toString().length,82734);p++)this.runAppend("",l),u+=2;a.p0(u.toString(),u.toString().length,56886)!==c&&this.runAppend("touchSingleClick",l)}.apply(n,l)}},e.ChartEngine.prototype.touchDoubleClick=function(t,i,s){var n,o;if("touc","h","Double","Click",!this.runPrepend("touchDoubleClick",arguments)&&!this.editingAnnotation){if(a.I3(),e.ChartEngine.drawingLine)return this.undo();if(!this.activeDrawing){r(this,i,s),n=this.activeMarker&&this.activeMarker.doubleClick({cx:i,cy:s,panel:this.currentPanel}),654167960,-1863029616,a.a3(1),o=a.N3(0,"2");for(var l=1;654167960!==a.p0(l.toString(),l.toString().length,8711);l++)+n&&this.dispatch("",{stx:this,finger:t,x:i,y:s}),a.a3(0),o+=a.V1("2",64);-1863029616!==a.a0(o.toString(),o.toString().length,3175)&&(n||this.dispatch("doubleTap",{stx:this,finger:t,x:i,y:s})),this.runAppend("touchDoubleClick",arguments)}}},e.ChartEngine.prototype.startProxy=function(t){a.a5(),this.touchPointerType=t.pointerType,"touch"==this.touchPointerType?(this.mouseMode=!1,this.touches[this.touches.length]={pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY},this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY}],1==this.touches.length&&(this.gesturePointerId=t.pointerId),this.touchstart(t)):this.mouseMode=!0},e.ChartEngine.prototype.moveProxy=function(t){var e,i;if(a.I3(),t.pointerType&&"touch"!=t.pointerType)this.mouseMode=!0;else{this.mouseMode=!1,a.a3(1),e=a.V1(0,"60330025"),812155819,i=2;for(var r=1;a.p0(r.toString(),r.toString().length,44229)!==e;r++)this.touchmove(t),i+=2;812155819!==a.a0(i.toString(),i.toString().length,94241)&&this.touchmove(t)}},e.ChartEngine.prototype.endProxy=function(t){var e;if("to","u","ch","touch"==this.touchPointerType){this.mouseMode=!1,e=this.touches.length;for(var i=0;i<this.touches.length;i++)if(this.touches[i].pointerId==t.pointerId){this.touches.splice(i,1);break}if(i==e)return this.touches=[],this.grabbingScreen=!1,void(this.touching=!1);this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY}],this.touchend(t)}else this.mouseMode=!0},e.ChartEngine.prototype.msMouseMoveProxy=function(t){var e;if(!this.touches.length&&this.mouseMode){a.a5(),765354899,315941809,e=2;for(var i=1;765354899!==a.p0(i.toString(),i.toString().length,9569);i++)this.mousemove(t),e+=2;315941809!==a.p0(e.toString(),e.toString().length,44805)&&this.mousemove(t)}},a.a5(),e.ChartEngine.prototype.msMouseDownProxy=function(t){this.mouseMode&&this.mousedown(t)},e.ChartEngine.prototype.msMouseUpProxy=function(t){this.mouseMode&&this.mouseup(t)},e.ChartEngine.prototype.iosMouseMoveProxy=function(t){this.touching||this.mousemove(t)},e.ChartEngine.prototype.iosMouseDownProxy=function(t){var e;if(this.touching)this.mouseMode=!1;else{-41313668,248755850,a.a5(),a.I0(3),e=a.V1("2",0);for(var i=1;-41313668!==a.a0(i.toString(),i.toString().length,27451);i++)this.mouseMode=!1,this.mousedown(t),e+=2;248755850!==a.a0(e.toString(),e.toString().length,87091)&&(this.mouseMode=!0,this.mousedown(t))}},e.ChartEngine.prototype.iosMouseUpProxy=function(t){a.I3(),this.touching||this.mouseup(t)},e.ChartEngine.prototype.touchmove=function(t){var i,r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O,H,V,z,R,B,Q,W,U,j,q;if("f","reef","orm","pe","n",this.displayInitialized&&""===this.openDialog&&!0!==e.ChartEngine.ignoreTouch){if(i=[],(!this.overYAxis||this.controls&&this.controls.crossX&&"none"!=this.controls.crossX.style.display)&&(t&&t.preventDefault&&t.cancelable&&this.captureTouchEvents&&t.preventDefault(),t&&t.stopPropagation()),r=(new Date).getTime(),-1==this.clicks.s2MS){if(this.clicks.e1MS=r,this.clicks.e1MS-this.clicks.s1MS<25)return}else if(this.clicks.e2MS=r,this.clicks.e2MS-this.clicks.s2MS<25)return;if(t.pointerType||(t.pointerType=this.touchPointerType),e.isSurface){if(this.mouseMode)return;t.pointerId||(t.pointerId=this.gesturePointerId);for(var Y=0;Y<this.touches.length;Y++)if(this.touches[Y].pointerId==t.pointerId){if(s=Math.abs(this.touches[Y].pageX-t.clientX),n=Math.abs(this.touches[Y].pageY-t.clientY),a.a3(4),!Math.sqrt(a.V1(n,s,n,s)))return;if(this.clicks.e1MS=(new Date).getTime(),this.clicks.e1MS-this.clicks.s1MS<50)return;if(this.touches[Y].pageX==t.clientX&&this.touches[Y].pageY==t.clientY)return;this.touches[Y].pageX=this.touches[Y].clientX=t.clientX,this.touches[Y].pageY=this.touches[Y].clientY=t.clientY;break}if(0===Y){402185152,212001740,o=2;for(var $=1;402185152!==a.p0($.toString(),$.toString().length,68472);$++)this.movedPrimary=!0,o+=2;212001740!==a.a0(o.toString(),o.toString().length,58426)&&(this.movedPrimary=!1)}else this.movedSecondary=!0;if(Y==this.touches.length)return;this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY,clientX:t.clientX,clientY:t.clientY}],i=this.touches.length?this.touches:this.changedTouches}else i=t.touches,this.changedTouches=t.changedTouches;if(!(1==i.length&&Math.pow(this.clicks.x-i[0].clientX,2)+Math.pow(this.clicks.y-i[0].clientY,2)<=16)){if(l=this.crosshairXOffset,h=this.crosshairYOffset,c=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,u=!this.layout.crosshair&&!c&&!this.touchNoPan,"pen"==t.pointerType||u||this.activeDrawing&&"freeform"==this.activeDrawing.name){2000545350,a.a3(0),d=-a.N3("737594521",0),p=2;for(var X=1;2000545350!==a.a0(X.toString(),X.toString().length,66962);X++)l=h=0,p+=2;a.p0(p.toString(),p.toString().length,32177)!==d&&(a.I0(1),l=h=a.V1(0,"6"))}if(!this.runPrepend("touchmove",arguments)){if(e.ChartEngine.resizingPanel)return m=(f=i[0]).clientX,g=f.clientY,a.I0(5),void this.mousemoveinner(a.N3(m,l),a.N3(g,h));if(-1!=this.moveB){2093623213,869725316,v=2;for(var Z=1;2093623213!==a.p0(Z.toString(),Z.toString().length,78694);Z++)this.touchMoveTime=new Date,v+=2;869725316!==a.p0(v.toString(),v.toString().length,17820)&&(this.touchMoveTime=new Date)}if(this.moveA=this.moveB,this.moveB=i[0].pageX,1!=i.length||this.twoFingerStart){if(2==i.length&&this.allowZoom){if(!this.displayCrosshairs)return;w=(C=i[0]).clientX,k=C.clientY,T=(D=i[1]).clientX,M=D.clientY,a.a3(6),y=Math.sqrt(a.N3(k,w,M,k,M,T,w,T)),a.a3(7);var K=a.V1(5,542,6,15,11);if(this.pinchingCenter=(Math.min(w,T)-Math.max(w,T))/K,A=Math.round(this.gestureStartDistance-y),u&&(a.I0(8),this.pinchingScreen=a.N3("5",0)),this.clearPixelCache(),this.pinchingScreen<2){if(e.isSurface&&(!this.movedPrimary||!this.movedSecondary))return;if(w<this.pt.x1&&T<this.pt.x2||w>this.pt.x1&&T>this.pt.x2||k<this.pt.y1&&M<this.pt.y2||k>this.pt.y1&&M>this.pt.y2){-1164418300,-1298317141,_=2;for(var G=1;-1164418300!==a.a0(G.toString(),G.toString().length,17061);G++)this.pinchingScreen=6,_+=2;-1298317141!==a.a0(_.toString(),_.toString().length,86566)&&(this.pinchingScreen=6),this.pinchingScreen=0}else if(this.pinchingScreen++,this.pinchingScreen<2)return}if(this.pt={x1:w,x2:T,y1:k,y2:M},0===this.pinchingScreen){"p","a","n",this.grabMode="pan",a.a3(5),this.mousemoveinner(a.N3(w,l),a.N3(k,h)),-552590033,-1479215451,F=2;for(var J=1;-552590033!==a.p0(J.toString(),J.toString().length,92149);J++)this.gestureStartDistance=y,F+=2;-1479215451!==a.a0(F.toString(),F.toString().length,77225)&&(this.gestureStartDistance=y)}else{if(P=Math.asin((Math.max(M,k)-Math.min(M,k))/y),Math.abs(A)<12&&!u){if(this.moveCount++,4==this.moveCount)return this.pinchingScreen=0,void(this.moveCount=0)}else{-787296812,1635518161,I=2;for(var tt=1;-787296812!==a.p0(tt.toString(),tt.toString().length,5100);tt++)this.moveCount=5,I+=2;1635518161!==a.a0(I.toString(),I.toString().length,27857)&&(this.moveCount=0)}if(P<1||!this.goneVertical&&P<1.37){if(!this.currentPanel)return;L=this.currentPanel.chart,this.goneVertical=!1,y=this.pt.x2-this.pt.x1,E=this.grabStartValues.t2-this.grabStartValues.t1,a.I0(9);var et=a.N3(19,1,22,19,399);if(N=this.grabStartValues.t1+E/et,a.a3(10),O=a.V1(y,E),!1===L.allowScrollFuture&&!1===L.allowScrollPast&&(O=Math.max(O,L.width/L.dataSet.length)),H=this.layout.candleWidth,this.setCandleWidth(O,L),L.maxTicks<this.minimumZoomTicks)return void this.setCandleWidth(H,L);this.micropixels=0,V=this.pixelFromTick(Math.round(N),L),a.a3(3);var it=a.N3(28,26);z=this.pt.x1-this.left+Math.round(y/it),a.I0(3),R=a.N3(V,z),a.I0(10),B=a.V1(R,O),Q=Math.round(B),L.scroll-=Q,a.a3(3),this.microscroll=a.V1(Q,B),this.micropixels=O*this.microscroll,this.draw()}else if(W=this.grabStartYAxis,this.goneVertical=!0,W){if(W.zoom=this.grabStartZoom+(this.gestureStartDistance-y),this.grabStartZoom<W.height){if(W.zoom>=W.height){a.I0(3);var at=a.V1(20,19);W.zoom=W.height-at}}else if(W.zoom<=W.height){a.I0(11);var rt=a.V1(19,4,9,113);W.zoom=W.height+rt}this.draw()}this.updateChartAccessories()}}else if(3==i.length&&e.ChartEngine.allowThreeFingerTouch){if(!this.displayCrosshairs)return;-297737632,2029516429,U=2;for(var st=1;-297737632!==a.p0(st.toString(),st.toString().length,35182);st++)j=i[8],U+=2;2029516429!==a.p0(U.toString(),U.toString().length,86972)&&(a.I0(8),j=i[a.V1("0",0)]),q=j.clientX,y=this.grabStartX-q,a.a3(12);var nt=a.V1(5,15,35,6);this.grabEndPeriodicity=this.grabStartPeriodicity+Math.round(y/nt),this.grabEndPeriodicity<1&&(this.grabEndPeriodicity=1)}}else m=(x=i[0]).clientX,g=x.clientY,this.pinchingScreen=0,a.I0(5),this.mousemoveinner(a.V1(m,l),a.N3(g,h)),b=this.whichPanel(g),S=!0===this.xAxisAsFooter?this.chart.canvasHeight:this.chart.panel.bottom,this.overXAxis=g<=this.top+S&&g>=S-this.xaxisHeight+this.top&&this.insideChart,this.overYAxis=!!b&&((m>=b.right||m<=b.left)&&this.insideChart);this.runAppend("touchmove",arguments)}}}},e.ChartEngine.prototype.touchstart=function(t){var i,r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A;if("to","uchstart","pe","n",!e.ChartEngine.ignoreTouch&&(e.isSurface?(this.movedPrimary=!1,this.movedSecondary=!1):(this.touchingEvent&&clearTimeout(this.touchingEvent),this.touching=!0,this.touches=t.touches,this.changedTouches=t.changedTouches),!e.ChartEngine.resizingPanel&&(i=this.crosshairXOffset,r=this.crosshairYOffset,"pen"==this.touchPointerType&&(i=r=0),!this.runPrepend("touchstart",arguments)))){if(this.manageTouchAndMouse&&t&&t.preventDefault&&t.cancelable&&this.captureTouchEvents&&t.preventDefault(),this.hasDragged=!1,this.doubleFingerMoves=0,this.moveCount=0,this.twoFingerStart=!1,1==this.touches.length||2==this.touches.length){if(this.touchMoveTime=Date.now(),o=(c=this.touches[0]).clientX,l=c.clientY,this.moveA=o,this.moveB=-1,""===this.openDialog&&(this.registerPointerEvent({x:o,y:l,time:this.touchMoveTime},"down"),1!=this.changedTouches.length||this.isDoubleClick(!0)||e.extend(this.clicks,{s1MS:this.touchMoveTime,e1MS:-1,s2MS:-1,e2MS:-1,x:this.changedTouches[0].pageX,y:this.changedTouches[0].pageY})),u=this.container.getBoundingClientRect(),this.top=u.top,this.left=u.left,this.right=this.left+this.width,this.bottom=this.top+this.height,1==this.touches.length&&(d=this.backOutY(l),this.currentPanel=this.whichPanel(d)),this.currentPanel||(this.currentPanel=this.chart.panel),h=this.currentPanel,o>=this.left&&o<=this.right&&l>=this.top&&l<=this.bottom){this.insideChart=!0,p=!0===this.xAxisAsFooter?this.chart.canvasHeight:this.chart.panel.bottom,this.overXAxis=l<=this.top+p&&l>=this.top+p-this.xaxisHeight,this.overYAxis=o>=this.left+h.right||o<=this.left+h.left,m=-1,this.cy=this.backOutY(l),this.cx=this.backOutX(o),this.crosshairTick=this.tickFromPixel(this.cx,h.chart),this.crosshairValue=this.adjustIfNecessary(h,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel));for(var _=0;_<this.drawingObjects.length;_++)if((g=this.drawingObjects[_]).highlighted){if(m<0&&(m=_),f=g.highlighted,this.findHighlights(!0),_==m&&g.highlighted&&!g.permanent)return void(-1==this.clicks.s2MS?this.activateRepositioning(g):this.findHighlights(!1,!0));this.anyHighlighted=!0,g.highlighted=f}}else this.insideChart=!1;if(v=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,this.layout.crosshair||this.layout.headsUp&&this.layout.headsUp.floating||v||!this.insideChart||this.touchNoPan){if(this.grabbingScreen=!1,this.insideChart&&h.subholder===t.target&&(k=this.currentVectorParameters.vectorType,e.Drawing&&k&&e.Drawing[k]&&(new e.Drawing[k]).dragToDraw))return this.userPointerDown=!0,e.ChartEngine.crosshairX=o,e.ChartEngine.crosshairY=l,h&&h.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.backOutX(e.ChartEngine.crosshairX),this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(h,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),this.currentPanel))),this.drawingClick(h,this.backOutX(o),this.backOutY(l)),void this.headsUpHR()}else{i=r=0;var{baselineHelper:F}=this;if(F.size&&this.findBaselineHandle(t,!0))return;if(this.controls.anchorHandles){y=Object.values(this.controls.anchorHandles),x=!1;for(var P=0;P<y.length;P++){b=y[P];var{handle:I,sd:L}=b;S=this.resolveX(this.cx),C=this.resolveY(this.cy);var{left:E,top:N,right:O,bottom:H}=I.getBoundingClientRect();E-=10,O+=10,e.boxIntersects(E,N,O,H,S,C,S,C)&&(b.highlighted=!0,this.repositioningAnchorSelector={sd:L},I.classList.add("stx-grab"),x=!0),!0===b.highlighted&&(b.highlighted=!1)}if(x)return}for(s in this.panels)if((n=this.panels[s]).highlighted)return void this.grabHandle(n);this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),h.chart.spanLock=!1,this.yToleranceBroken=!1,a.a3(5),this.grabStartX=a.V1(o,i),a.I0(5),this.grabStartY=a.N3(l,r),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=h.chart.scroll,this.grabStartScrollY=h.yAxis.scroll,-1330585512,-908777377,w=2;for(var V=1;-1330585512!==a.p0(V.toString(),V.toString().length,78943);V++)this.grabStartPanel=this.currentPanel,w+=2;-908777377!==a.a0(w.toString(),w.toString().length,39213)&&(this.grabStartPanel=this.currentPanel),this.swipeStart&&this.swipeStart(h.chart),this.grabStartYAxis=this.whichYAxis(h,this.backOutX(o)),this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,setTimeout((z=this,function(){z.grabbingHand()}),100)}1===this.touches.length&&this.layout.crosshair&&!v&&h.subholder===t.target&&(a.I0(5),this.mousemoveinner(a.V1(o,i),a.N3(l,r)))}var z,R;if(2==this.touches.length){if(this.cancelLongHold=!0,this.swipe.end=!0,!this.displayCrosshairs&&!this.touchNoPan||!this.insideChart)return;for(s in T=(D=this.touches[1]).clientX,M=D.clientY,this.panels)if((n=this.panels[s]).highlighted)return void this.grabHandle(n);h=this.currentPanel,a.a3(6),this.gestureStartDistance=Math.sqrt(a.N3(l,o,M,l,M,T,o,T)),this.pt={x1:o,x2:T,y1:l,y2:M},this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),h.chart.spanLock=!1,a.I0(5),this.grabStartX=a.N3(o,i),a.a3(5),this.grabStartY=a.N3(l,r),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=h.chart.scroll,this.grabStartScrollY=h.yAxis.scroll,this.grabStartPanel=h,this.swipeStart&&this.swipeStart(h.chart),this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(h,this.backOutX((o+T)/2))||h.yAxis,this.grabStartZoom=this.grabStartYAxis?this.grabStartYAxis.zoom:0,this.grabStartPt=this.pt,this.grabStartValues={x1:this.pt.x1,x2:this.pt.x2,y1:this.valueFromPixel(this.pt.y1-this.top,h),y2:this.valueFromPixel(this.pt.y2-this.top,h),t1:this.tickFromPixel(this.pt.x1-this.left,h.chart),t2:this.tickFromPixel(this.pt.x2-this.left,h.chart)},this.twoFingerStart=!0,setTimeout((R=this,a.a5(),function(){R.grabbingHand()}),100)}else if(3==this.touches.length){if(!this.displayCrosshairs)return;A=this.touches[0].clientX,this.grabStartX=A,this.grabStartPeriodicity=this.layout.periodicity}1!=this.touches.length||this.layout.crosshair||(this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,(this.longHoldTime||0===this.longHoldTime)&&this.startLongHoldTimer()),this.runAppend("touchstart",arguments)}},e.ChartEngine.prototype.touchend=function(t){var i,r,s,n,o,l,h,c,u,d,p,m,g,f;if(!e.ChartEngine.ignoreTouch&&(this.swipe.end=!0,e.isSurface||(this.touches=t.touches,this.changedTouches=t.changedTouches),!this.runPrepend("touchend",arguments))){if(this.cancelLongHold=!0,this.touches.length<=1&&(this.layout.crosshair||this.currentVectorParameters.vectorType)&&(this.touches.length&&this.twoFingerStart||(this.grabbingScreen=!1)),this.touches.length&&(this.grabStartX=-1,this.grabStartY=-1),i=this.pinchingScreen,this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),this.touches.length){if(e.ChartEngine.resizingPanel)return}else{if(this.touchingEvent=setTimeout((v=this,a.I3(),function(){v.touching=!1}),500),e.ChartEngine.resizingPanel)return void this.releaseHandle();this.pinchingScreen=null,this.pinchingCenter=null,this.goneVertical=!1,this.grabbingScreen=!1,this.grabMode="",this.highlightedDraggable&&(this.dragPlotOrAxis&&this.dragPlotOrAxis(this.cx,this.cy),this.currentPanel=this.whichPanel(this.cy)),this.grabStartYAxis=null,this.displayDragOK(),this.doDisplayCrosshairs(),this.updateChartAccessories()}var v;a.I0(3);var y=a.N3(2,1);if(r=this.touches.length+y,1==this.changedTouches.length){if(this.repositioningDrawing){this.changeOccurred("vector"),e.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.draw(),1913601023,1344712450,2;for(var x=1;1913601023!==a.a0(x.toString(),x.toString().length,14072);x++)return void(this.layout.crosshair||this.currentVectorParameters.vectorType||this.findHighlights(!1,!0));if(1344712450!==a.a0(2..toString(),2..toString().length,45407))return void((-this.layout.crosshair||-this.currentVectorParameters.vectorType)&&this.findHighlights(!0,!1))}if(this.repositioningBaseline)return"s","tx-g","ra","b",this.repositioningBaseline=null,this.controls.baselineHandle.classList.remove("stx-grab"),(s=this.mainSeriesRenderer||{}).params&&s.params.baseline&&s.params.type,void this.draw();if(this.repositioningAnchorSelector)return e.Studies.repositionAnchor(this,this.repositioningAnchorSelector.sd),this.repositioningAnchorSelector=null,void Object.values(this.controls.anchorHandles).forEach((t=>{let{handle:e}=t;return"s",a.a5(),"t","x-gr","ab",e.classList.remove("stx-grab")}));-1565468804,570611140,n=2;for(var b=1;-1565468804!==a.p0(b.toString(),b.toString().length,45263);b++)o=Date.now(),a.I0(8),n+=a.V1("2",32);if(570611140!==a.a0(n.toString(),n.toString().length,19348)&&(o=Date.now()),o=Date.now(),""===this.openDialog&&t.changedTouches.length&&(a.I0(13),l=t.changedTouches[a.V1(1,"0")],this.registerPointerEvent({x:l.clientX,y:l.clientY,time:o},"up")),-1==this.clicks.s2MS){1485403700,553838161,h=2;for(var S=1;1485403700!==a.p0(S.toString(),S.toString().length,36591);S++)this.clicks.e1MS=o,h+=2;if(553838161!==a.p0(h.toString(),h.toString().length,54408)&&(this.clicks.e1MS=o),c=this.currentVectorParameters.vectorType,e.Drawing&&c&&e.Drawing[c]&&(new e.Drawing[c]).dragToDraw||(this.clicks.e1MS-this.clicks.s1MS<750&&!this.longHoldTookEffect&&(!this.hasDragged||this.layout.crosshair)?setTimeout(this.touchSingleClick(r,this.clicks.x,this.clicks.y),this.doubleClickTime+1):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}),this.userPointerDown=!1,u=this.backOutY(this.changedTouches[0].pageY)+this.crosshairYOffset,d=this.backOutX(this.changedTouches[0].pageX)+this.crosshairXOffset,m=(p=this.currentPanel)&&p.subholder===t.target,e.Drawing&&this.activeDrawing&&this.activeDrawing.dragToDraw&&m)return void this.drawingClick(p,d,u);this.isDoubleClick(!0)&&(m||this.overYAxis||this.overXAxis)&&this.touchDoubleClick(r,this.clicks.x,this.clicks.y)}else this.clicks.e2MS=o,this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}}else if(this.displayCrosshairs&&-1!=this.grabEndPeriodicity&&!isNaN(this.grabEndPeriodicity)){(e.ChartEngine.isDailyInterval(this.layout.interval)||this.allowIntradayNMinute)&&this.setPeriodicity({period:this.grabEndPeriodicity,interval:this.layout.interval}),81259489,2026353704,g=2;for(var C=1;81259489!==a.a0(C.toString(),C.toString().length,54058);C++)this.grabEndPeriodicity=-1,g+=2;2026353704!==a.a0(g.toString(),g.toString().length,40638)&&(this.grabEndPeriodicity=2)}if(this.changedTouches.length&&((!this.layout.crosshair&&!this.currentVectorParameters.vectorType&&1==r||this.twoFingerStart&&!i&&!this.touches.length)&&(this.swipeRelease&&this.swipeRelease(),this.findHighlights(!1,!0)),i&&this.continuousZoom&&(this.continuousZoom.execute(),this.continuousZoom.execute(!0))),!this.touches.length){-970171387,1017723725,f=2;for(var w=1;-970171387!==a.a0(w.toString(),w.toString().length,91112);w++)this.twoFingerStart=!0,f+=2;1017723725!==a.a0(f.toString(),f.toString().length,9773)&&(this.twoFingerStart=!1)}this.runAppend("touchend",arguments)}},i=!1,e.ChartEngine.prototype.mousemoveinner=e.ChartEngine.prototype.mousemoveinner||function(t,e){i||console.error("touch feature requires activating movement feature."),i=!0}},H[370258]=function(){for(var t=2;9!==t;)switch(t){case 2:t="object"==typeof globalThis?1:5;break;case 1:return globalThis;case 5:var e;t=4;break;case 4:try{for(var i=2;6!==i;)switch(i){case 2:Object.defineProperty(Object.prototype,"Ll6R9",{get:function(){for(;;)return this},configurable:!0}),e=Ll6R9,i=5;break;case 5:e.BBO88=e,i=4;break;case 4:i="undefined"==typeof BBO88?3:9;break;case 3:throw"";case 9:delete e.BBO88,delete Object.prototype.Ll6R9,i=6}}catch(t){e=window}return e}}(),function(t){for(var e=2;125!==e;)switch(e){case 83:i[57]+=i[91],i[57]+=i[24],i[72]=i[68],i[72]+=i[39],e=79;break;case 130:a(o,i[21],i[37],i[18]),e=129;break;case 91:i[80]+=i[4],i[67]=i[2],i[67]+=i[99],i[67]+=i[7],e=116;break;case 23:i[54]="",i[54]="T",i[73]="",i[73]="Q",i[40]="",e=33;break;case 106:a(s,"charCodeAt",i[92],i[70]),e=105;break;case 133:a(s,"replace",i[92],i[80]),e=132;break;case 29:i[79]="7",i[16]="r",i[53]="t$",i[93]="",e=42;break;case 2:var i=[arguments];i[1]="",i[1]="u7",i[6]="",i[6]="Zj",i[5]="",e=8;break;case 127:a(n,"push",i[92],i[43]),e=126;break;case 134:a(s,"substring",i[92],i[67]),e=133;break;case 8:i[5]="80",i[3]="",i[8]="ZW",i[3]="",i[3]="M",i[9]="",e=11;break;case 33:i[40]="8$gr",i[87]="",i[87]="K",i[16]="",e=29;break;case 87:i[44]=i[83],i[44]+=i[48],i[44]+=i[65],i[57]=i[41],e=83;break;case 11:i[9]="",i[9]="j5",i[7]="",i[7]="",e=18;break;case 107:var a=function(t,e,a,r){for(var s=2;5!==s;)if(2===s){var n=[arguments];h(i[0][0],n[0][0],n[0][1],n[0][2],n[0][3]),s=5}};e=106;break;case 102:i[21]=i[68],i[21]+=i[64],i[21]+=i[93],i[66]=i[16],e=98;break;case 129:a(o,i[72],i[37],i[57]),e=128;break;case 132:a(n,"map",i[92],i[76]),e=131;break;case 116:i[17]=i[9],i[17]+=i[81],i[17]+=i[50],i[52]=i[3],i[52]+=i[5],i[52]+=i[6],i[70]=i[1],e=109;break;case 131:a(r,"test",i[92],i[66]),e=130;break;case 66:i[43]+=i[97],i[94]=i[34],i[94]+=i[36],i[94]+=i[23],e=87;break;case 18:i[7]="M_K",i[2]="",i[2]="w",i[4]="",e=27;break;case 126:a(l,"apply",i[92],i[74]),e=125;break;case 109:i[70]+=i[8],i[70]+=i[97],e=107;break;case 42:i[93]="ptimize",i[10]="",i[10]="m",i[39]="abst",i[68]="",i[30]="ract",i[68]="__",e=54;break;case 59:i[48]="_re",i[34]="o4",i[58]="",i[58]="",e=55;break;case 105:a(o,"String",i[37],i[52]),e=135;break;case 98:i[66]+=i[47],i[66]+=i[53],i[76]=i[87],i[76]+=i[40],i[76]+=i[73],i[80]=i[54],i[80]+=i[79],e=91;break;case 74:i[59]="T1",i[92]=1,i[37]=0,i[74]=i[59],e=70;break;case 64:i[36]="kG",i[97]="D",i[46]="pnK",i[15]="L7",i[65]="sidual",e=59;break;case 79:i[72]+=i[30],i[18]=i[24],i[18]+=i[13],i[18]+=i[10],e=102;break;case 27:i[50]="4",i[4]="bsSw",i[81]="$d",i[99]="9",e=23;break;case 128:a(o,i[44],i[37],i[94]),e=127;break;case 47:i[64]="o",i[91]="1tPs",i[23]="gr",i[46]="",e=64;break;case 70:i[74]+=i[55],i[74]+=i[58],i[43]=i[15],i[43]+=i[46],e=66;break;case 135:a(s,"fromCharCode",i[37],i[17]),e=134;break;case 55:i[58]="JU",i[55]="",i[55]="i5",i[59]="",e=74;break;case 54:i[24]="",i[13]="9dqu",i[24]="n",i[47]="7ET",i[41]="",i[41]="e",i[83]="_",e=47}function r(t){for(;;){return[arguments][0][0].RegExp}}function s(t){for(;;){return[arguments][0][0].String}}function n(t){for(;;){return[arguments][0][0].Array}}function o(t){for(;;){return[arguments][0][0]}}function l(t){for(;;){return[arguments][0][0].Function}}function h(t,e,i,a,r){for(var s=2;13!==s;)switch(s){case 2:var n=[arguments];n[2]="erty",n[6]="",n[6]="",s=3;break;case 3:n[6]="fineProp",n[1]="de",n[8]=!0,n[8]=!0,n[8]=!1;try{for(var o=2;13!==o;)switch(o){case 3:return;case 2:n[5]={},n[3]=(0,n[0][1])(n[0][0]),n[4]=[n[3],n[3].prototype][n[0][3]],o=4;break;case 4:o=n[4].hasOwnProperty(n[0][4])&&n[4][n[0][4]]===n[4][n[0][2]]?3:9;break;case 6:n[5].enumerable=n[8];try{for(var l=2;3!==l;)if(2===l)n[7]=n[1],n[7]+=n[6],n[7]+=n[2],n[0][0].Object[n[7]](n[4],n[0][4],n[5]),l=3}catch(t){}o=13;break;case 9:n[4][n[0][4]]=n[4][n[0][2]],n[5].set=function(t){for(var e=2;5!==e;)if(2===e){var i=[arguments];n[4][n[0][2]]=i[0][0],e=5}},n[5].get=function(){for(var t=2;13!==t;)switch(t){case 2:var e=[arguments];e[6]="",e[6]="ed",e[4]="in",t=3;break;case 3:e[1]="",e[1]="undef",e[3]=e[1],e[3]+=e[4],t=6;break;case 6:return e[3]+=e[6],typeof n[4][n[0][2]]==e[3]?void 0:n[4][n[0][2]]}},o=6}}catch(t){}s=13}}}(H[370258]),H[238553]=function(){for(;;){var t=[arguments];return t[7]=void 0,t[5]={},t[5].i9agN$W=function(){for(var e=2;90!==e;)switch(e){case 1:e=t[7]?5:4;break;case 68:e=68;break;case 69:e=function(t){for(var e=2;22!==e;)switch(e){case 16:e=a[9]<a[1].length?15:23;break;case 10:e=a[4][i[30]]===i[35]?20:19;break;case 5:return;case 27:a[5]=a[7][a[6]].h/a[7][a[6]].t,e=26;break;case 19:a[9]++,e=7;break;case 1:e=0===a[0][0].length?5:4;break;case 20:a[7][a[4][i[14]]].h+=!0,e=19;break;case 12:a[1].L7pnKD(a[4][i[14]]),e=11;break;case 8:a[9]=0,e=7;break;case 13:a[7][a[4][i[14]]]=function(){for(var t=2;9!==t;)switch(t){case 4:return e[3].t=0,e[3];case 2:var e=[arguments];e[3]={},e[3].h=0,t=4}}.T1i5JU(this,arguments),e=12;break;case 11:a[7][a[4][i[14]]].t+=!0,e=10;break;case 4:a[7]={},a[1]=[],a[9]=0,e=8;break;case 23:return a[8];case 14:e=void 0===a[7][a[4][i[14]]]?13:11;break;case 24:a[9]++,e=16;break;case 26:e=a[5]>=.5?25:24;break;case 18:a[8]=!1,e=17;break;case 15:a[6]=a[1][a[9]],e=27;break;case 2:var a=[arguments];e=1;break;case 17:a[9]=0,e=16;break;case 7:e=a[9]<a[0][0].length?6:18;break;case 25:a[8]=!0,e=24;break;case 6:a[4]=a[0][0][a[9]],e=14}}(i[67])?68:67;break;case 51:i[5].L7pnKD(i[66]),i[5].L7pnKD(i[16]),i[5].L7pnKD(i[57]),i[5].L7pnKD(i[7]),e=47;break;case 58:i[81]=0,e=57;break;case 67:return t[7]=61,25;case 27:i[94]={},i[94].E_=["F3"],i[94].H5=function(){return"function"==typeof n9dqum},i[31]=i[94],e=23;break;case 57:e=i[81]<i[5].length?56:69;break;case 56:i[74]=i[5][i[81]];try{i[83]=i[74][i[45]]()?i[35]:i[65]}catch(t){i[83]=i[65]}e=77;break;case 71:i[59]++,e=76;break;case 59:i[14]="j5",e=58;break;case 64:i[35]="q3",i[65]="r5",i[93]="E_",i[30]="j2",i[45]="H5",e=59;break;case 23:i[87]={},i[87].E_=["F3"],i[87].H5=function(){return"function"==typeof e1tPsn},i[66]=i[87],i[39]={},i[39].E_=["F3"],i[39].H5=function(){return"function"==typeof o4kGgr},e=31;break;case 73:i[46][i[30]]=i[83],i[67].L7pnKD(i[46]),e=71;break;case 75:i[46]={},i[46][i[14]]=i[74][i[93]][i[59]],e=73;break;case 76:e=i[59]<i[74][i[93]].length?75:70;break;case 17:i[6].E_=["c0"],i[6].H5=function(){return/\u0074\x72\x75\x65/.r7ETt$(function(){return"aaa".includes("a")}+[])},i[9]=i[6],e=27;break;case 31:i[16]=i[39],i[11]={},i[11].E_=["c0"],e=28;break;case 4:i[5]=[],i[1]={},i[1].E_=["c0"],i[1].H5=function(){return/\x33\x44/.r7ETt$(function(){return escape("=")}+[])},i[3]=i[1],i[2]={},i[2].E_=["c0"],e=13;break;case 13:i[2].H5=function(){return/\061\u0039\x32/.r7ETt$(function(){!function(t){for(var e=0;e<20;e++)t+=e}(2)}+[])},i[7]=i[2],i[4]={},i[4].E_=["c0"],i[4].H5=function(){return!/\050\x5b/.r7ETt$(function(){return[1,2,3,4,5].concat([5,6,7,8])}+[])},i[8]=i[4],i[6]={},e=17;break;case 5:return 46;case 36:i[57]=i[60],i[5].L7pnKD(i[62]),i[5].L7pnKD(i[9]),i[5].L7pnKD(i[95]),e=51;break;case 39:i[60]={},i[60].E_=["F3"],i[60].H5=function(){var t=!1,e=[];try{for(var i in console)e.L7pnKD(i);t=0===e.length}catch(t){}return t},e=36;break;case 2:var i=[arguments];e=1;break;case 41:i[15].H5=function(){return/\x39\x37/.r7ETt$(function(){return"aa".charCodeAt(1)}+[])},i[95]=i[15],e=39;break;case 47:i[5].L7pnKD(i[3]),i[5].L7pnKD(i[8]),i[5].L7pnKD(i[31]),i[67]=[],e=64;break;case 77:i[59]=0,e=76;break;case 28:i[11].H5=function(){return/\061/.r7ETt$(function(){return"aa".lastIndexOf("a")}+[])},i[62]=i[11],i[15]={},i[15].E_=["c0"],e=41;break;case 70:i[81]++,e=57}},t[5]}}(),H.W4=function(){return"function"==typeof H[593596].g9iUvuS?H[593596].g9iUvuS.apply(H[593596],arguments):H[593596].g9iUvuS},H.T9=function(){return"function"==typeof H[593596].N$y1PkD?H[593596].N$y1PkD.apply(H[593596],arguments):H[593596].N$y1PkD},H.H0=function(){return"function"==typeof H[150014].R3ta_F9?H[150014].R3ta_F9.apply(H[150014],arguments):H[150014].R3ta_F9},H[636832]=!1,H[103941]=!1,H.Y$=function(){return"function"==typeof H[539515].q7DznqI?H[539515].q7DznqI.apply(H[539515],arguments):H[539515].q7DznqI},H.M0=function(){return"function"==typeof H[238553].i9agN$W?H[238553].i9agN$W.apply(H[238553],arguments):H[238553].i9agN$W},H[593596]={N$y1PkD:function(){var t,e=arguments;switch(P){case 13:t=e[3]-e[2]-e[0]+e[1];break;case 10:t=e[1]>>e[0];break;case 0:t=e[0]^e[1];break;case 15:t=(e[0]-e[3])/e[2]+e[1];break;case 5:t=(e[3]+e[2])/e[1]-e[0];break;case 12:t=-e[0]-e[2]+e[1];break;case 4:t=e[1]+e[0];break;case 14:t=(e[0]+e[4]-e[1])*e[2]-e[3];break;case 3:t=e[1]-e[0];break;case 6:t=e[1]|e[0];break;case 1:t=e[2]-e[1]+e[0];break;case 2:t=-e[0]*e[1]+e[4]+e[3]+e[2];break;case 7:t=e[2]*e[3]/(e[0]+e[1]);break;case 9:t=(e[2]+e[1]+e[3])*e[0]-e[4];break;case 11:t=-e[3]*e[0]*e[1]+e[2];break;case 8:t=e[0]*e[1]}return t},g9iUvuS:function(t){P=t}},H.m0=function(){return"function"==typeof H[446427].V29cT4d?H[446427].V29cT4d.apply(H[446427],arguments):H[446427].V29cT4d},H[150014]=function(t){for(var e=2;10!==e;)switch(e){case 11:return{R3ta_F9:function(e){for(var a=2;6!==a;)switch(a){case 5:a=s--?3:4;break;case 3:a=s--?8:9;break;case 2:var r=(new i[t[0]])[t[1]]();a=1;break;case 9:h=r+6e4,a=8;break;case 7:return n?l:!l;case 1:a=r>h?5:8;break;case 8:var n=function(a,r){for(var s=2;10!==s;)switch(s){case 9:s=o<a[r[5]]?8:11;break;case 3:var n,o=0;s=9;break;case 8:var l=i[r[4]](a[r[2]](o),16)[r[3]](2),h=l[r[2]](l[r[5]]-1);s=6;break;case 13:o++,s=9;break;case 4:r=t,s=3;break;case 11:return n;case 12:n^=h,s=13;break;case 5:s=void 0===r&&void 0!==t?4:3;break;case 6:s=0===o?14:12;break;case 14:n=h,s=13;break;case 1:a=e,s=5;break;case 2:s=void 0===a&&void 0!==e?1:5}}(void 0,void 0);a=7;break;case 4:l=c(r),a=3}}};case 2:var i,a,r,s;e=1;break;case 4:var n="fromCharCode",o="RegExp";e=3;break;case 5:i=H[370258],e=4;break;case 13:e=s--?11:12;break;case 12:var l,h=0;e=11;break;case 8:e=s--?6:7;break;case 7:r=a.T7bsSw(new i[o]("^['-|]"),"S"),e=6;break;case 6:e=s--?13:14;break;case 14:t=t.K8$grQ((function(t){for(var e=2;13!==e;)switch(e){case 8:o++,e=3;break;case 14:return a;case 7:e=a?14:6;break;case 2:var a;e=1;break;case 4:var o=0;e=3;break;case 6:return;case 9:a+=i[r][n](t[o]+93),e=8;break;case 1:e=s--?4:5;break;case 3:e=o<t.length?9:7;break;case 5:a="",e=4}})),e=13;break;case 1:e=s--?4:5;break;case 9:a=typeof n,e=8;break;case 3:e=s--?8:9}function c(e){for(var a=2;15!==a;)switch(a){case 3:n=27,a=9;break;case 20:r=e-c>n&&l-e>n,a=19;break;case 8:o=t[6],a=7;break;case 13:h=t[7],a=12;break;case 4:a=s--?9:3;break;case 10:a=c>=0&&l>=0?20:18;break;case 17:r=e-c>n,a=19;break;case 5:u=i[t[4]],a=4;break;case 16:r=l-e>n,a=19;break;case 19:return r;case 12:a=s--?10:11;break;case 11:c=(h||0===h)&&u(h,n),a=10;break;case 6:l=o&&u(o,n),a=14;break;case 7:a=s--?14:6;break;case 14:a=s--?12:13;break;case 1:a=s--?4:5;break;case 2:var r,n,o,l,h,c,u;a=1;break;case 18:a=c>=0?17:16;break;case 9:a=s--?7:8}}}([[-25,4,23,8],[10,8,23,-9,12,16,8],[6,11,4,21,-28,23],[23,18,-10,23,21,12,17,10],[19,4,21,22,8,-20,17,23],[15,8,17,10,23,11],[-39,-44,18,6,19,17,8,7,-45],[]]),H[539515]=function(){for(var t=2;4!==t;)switch(t){case 2:var e,i,a=H[370258];t=5;break;case 5:return{x96qQgs:function(t,e,i,a){for(;;)return s(t,e,i,a)},q7DznqI:function(t,e,i,a){for(;;)return s(t,e,i,a,!0)}}}function r(t){for(var e=2;7!==e;)switch(e){case 2:var i=6,a="";e=5;break;case 3:a+=M80Zj.j5$d4(t[r]-i+99),e=9;break;case 9:r++,e=4;break;case 5:var r=0;e=4;break;case 4:e=r<t.length?3:8;break;case 8:return a}}function s(t,s,n,o,l){for(var h=2;15!==h;)switch(h){case 13:h=s&&m>0&&46!==d.u7ZWD(m-1)?12:11;break;case 6:case 16:return H.i0(c,u,n);case 2:var c,u,d,p;p=a[r([15,18,6,4,23,12,18,17])],!e&&(e=void 0!==p?p[r([11,18,22,23,17,4,16,8])]||" ":""),!i&&(i=void 0!==p?p[r([11,21,8,9])]:""),h=3;break;case 12:return!1;case 8:u=(c=d.w9M_K(t,o)).length,h=6;break;case 9:h=o>0?8:19;break;case 11:return u=(c=d.w9M_K(m,d.length)).length,H.i0(c,u,n);case 19:h=null===t||t<=0?18:14;break;case 14:var m=d.length-t;h=13;break;case 18:u=(c=d.w9M_K(0,d.length)).length,h=16;break;case 3:d=l?i:e,h=9}}}(),H.m9=function(){return"function"==typeof H[238553].i9agN$W?H[238553].i9agN$W.apply(H[238553],arguments):H[238553].i9agN$W},H.L2=function(){return"function"==typeof H[539515].x96qQgs?H[539515].x96qQgs.apply(H[539515],arguments):H[539515].x96qQgs},H.v3=function(){return"function"==typeof H[539515].q7DznqI?H[539515].q7DznqI.apply(H[539515],arguments):H[539515].q7DznqI},H.r9=function(){return"function"==typeof H[539515].x96qQgs?H[539515].x96qQgs.apply(H[539515],arguments):H[539515].x96qQgs},H.m4=function(){return"function"==typeof H[150014].R3ta_F9?H[150014].R3ta_F9.apply(H[150014],arguments):H[150014].R3ta_F9},H[370258].H4GG=H,H.q1=function(){return"function"==typeof H[593596].N$y1PkD?H[593596].N$y1PkD.apply(H[593596],arguments):H[593596].N$y1PkD},H[156040]=!0,H.u2=function(){return"function"==typeof H[593596].g9iUvuS?H[593596].g9iUvuS.apply(H[593596],arguments):H[593596].g9iUvuS},H[446427]=(I=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{V29cT4d:function(t,e,i){for(var a=3432918353,r=461845907,s=i,n=-4&e,o=0;o<n;o+=4){var l=255&t.u7ZWD(o)|(255&t.u7ZWD(o+1))<<8|(255&t.u7ZWD(o+2))<<16|(255&t.u7ZWD(o+3))<<24;l=I(l,a),s=5*(s=(524287&(s^=l=I(l=(131071&l)<<15|l>>>17,r)))<<13|s>>>19)+3864292196|0}switch(l=0,e%4){case 3:l=(255&t.u7ZWD(n+2))<<16;case 2:l|=(255&t.u7ZWD(n+1))<<8;case 1:l|=255&t.u7ZWD(n),l=I(l,a),s^=l=I(l=(131071&l)<<15|l>>>17,r)}return s^=e,s=I(s^=s>>>16,2246822507),s=I(s^=s>>>13,3266489909),s^=s>>>16}}),H.i0=function(){return"function"==typeof H[446427].V29cT4d?H[446427].V29cT4d.apply(H[446427],arguments):H[446427].V29cT4d},H.x8=function(t){if(H.M0(),H&&t)return H.m4(t)},H.a3=function(t){if(H.M0(),H)return H.H0(t)},H.I$=function(t){if(H.m9(),H)return H.H0(t)},H.O3=function(t){if(H.m9(),H)return H.H0(t)},H.R_=function(t){if(H.M0(),H)return H.m4(t)},H.y2=function(t){if(H.M0(),H&&t)return H.H0(t)},H.s4=function(t){if(H.m9(),H&&t)return H.H0(t)},H.e6=function(t){if(H.m9(),H)return H.H0(t)},H.x_=function(t){if(H.M0(),H&&t)return H.m4(t)},H.Q7=function(t){if(H)return H.H0(t)},H.v1=function(t){if(H.m9(),H&&t)return H.m4(t)},H.M0(),L=t=>{var e,i,a,r=H;r.y1=function(t){if(r)return r.H0(t)},e="undefined"!=typeof _CIQ?_CIQ:t.CIQ,i="valid",r.W4(0),e.valid=r.q1("0",0),e[r.v1("dbbd")?"":"ChartEngine"][r.Q7("24d1")?"":"prototype"][r.x_("42c3")?"mousemoveinner":""]=function(t,a){r.b7=function(t){if(r.M0(),r&&t)return r.m4(t)},r.g7=function(t){if(r&&t)return r.m4(t)},r.x2=function(t){if(r.M0(),r&&t)return r.m4(t)};var s=r.e6("4ecc")?187810859:235335806,n=r.x2("1887")?867620334:719977840,o=-(r.g7("c346")?1140040573:5700229845),l=-(r.y1("5ede")?6016852654:1812298862),h=-(r.s4("9b98")?25336879:60206599),c=-(r.y2("78f1")?1225222363:2369069413);if(r.r9(r.R_("4552")?1:0,!!r.O3("3c94"),r.I$("9bb8")?897679:992580)===s||r.L2(r.a3("51ce")?3:0,!1,r.x8("f36f")?409362:617219)===n||r.L2(r.b7("e23a")?9:5,!0,379760)===o||r.r9(9,!0,171010)===l||-429233563===r.L2(8,!0,929328)||-457994770===r.r9(10,!0,331443)||r.L2(9,!0,661441)===h||-1994350442===r.r9(9,!0,706737)||r.L2(10,!0,466233)===c||-813691499===r.L2(8,!0,239588)){var u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O;if("mo","us","emove","inner",!this.chart.canvas)return;if(!(e.isAndroid||e.isIOS7or8||this.chart.canvas.height==Math.floor(this.devicePixelRatio*this.chart.container.clientHeight)&&this.chart.canvas.width==Math.floor(this.devicePixelRatio*this.chart.container.clientWidth)))return void this.resizeChart();if(this.runPrepend("mousemoveinner",arguments))return;if(d=arguments,p=this.container.getBoundingClientRect(),this.top=p.top,this.left=p.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.hasDragged=!0,e.ChartEngine.crosshairX=t,e.ChartEngine.crosshairY=a,m=this.cy=this.crossYActualPos=this.backOutY(e.ChartEngine.crosshairY),g=this.cx=this.crossXActualPos=this.backOutX(e.ChartEngine.crosshairX),this.grabbingScreen&&this.anyHighlighted){r.W4(1);var H=r.T9(22,20,0);r.u2(2);var V=r.q1(15,20,277,15,10);if(Math.pow(this.grabStartX-t,H)+Math.pow(this.grabStartY-a,V)<36)return}if(this.cancelLongHold=!0,f=function(t,a){r.m9();if(-1776070130===r.L2(0,!1,477479)||371481022===r.r9(0,!1,409374)||372515586===r.r9(9,!0,577513)||-186038335===r.L2(9,!0,782747)||-1187851502===r.r9(8,!0,688748)||-1908713022===r.L2(10,!0,965908)||-744982210===r.r9(9,!0,884748)||586880683===r.L2(9,!0,596835)||-139283776===r.L2(10,!0,467770)||923672344===r.L2(8,!0,560445)){if(0===e[i])return t.whichPanel(a)||t.chart.panel;t.draw[i]||(t.draw=function(){r.m9(),-1629092611!==r.L2(0,!1,396712)&&1556562926!==r.L2(0,!1,388625)&&-1548744550!==r.L2(9,!0,790927)&&-2095173218!==r.r9(9,!0,309760)&&-1825082238!==r.r9(8,!0,857505)&&-2123709299!==r.L2(10,!0,824269)&&-2039804379!==r.L2(9,!0,465525)&&-1714096364!==r.r9(9,!0,681459)&&-1895160988!==r.L2(10,!0,633593)&&798521502!==r.r9(8,!0,455606)||e.clearCanvas(this.chart.canvas,this)},t.draw[i]=!0)}},this.currentPanel=f(this,m),!this.currentPanel)return;if((v=this.currentPanel.chart).dataSet&&("ch","a","rt",this.crosshairTick=this.tickFromPixel(g,v),u=this.valueFromPixel(m,this.currentPanel),this.crosshairValue=this.adjustIfNecessary(this.currentPanel,this.crosshairTick,u),(y="chart"==this.currentPanel.name?this.preferences.horizontalCrosshairField:this.currentPanel.horizontalCrosshairField)&&this.crosshairTick<v.dataSet.length&&this.crosshairTick>-1&&(u=v.dataSet[this.crosshairTick][y],this.crossYActualPos=this.pixelFromPrice(u,this.currentPanel))),e.ChartEngine.crosshairX>=this.left&&e.ChartEngine.crosshairX<=this.right&&e.ChartEngine.crosshairY>=this.top&&e.ChartEngine.crosshairY<=this.bottom?this.insideChart=!0:this.insideChart=!1,x=!0===this.xAxisAsFooter?this.chart.canvasHeight:this.chart.panel.bottom,this.overXAxis=this.insideChart&&e.ChartEngine.crosshairY<=x+this.top&&e.ChartEngine.crosshairY>x-this.xaxisHeight+this.top,this.overYAxis=(this.cx>=this.currentPanel.right||this.cx<=this.currentPanel.left)&&this.insideChart,(this.overXAxis||this.overYAxis||!this.insideChart&&!this.grabbingScreen)&&(this.undisplayCrosshairs(),!this.overXAxis&&!this.overYAxis))return;if(!this.displayCrosshairs&&!e.ChartEngine.resizingPanel)return void this.undisplayCrosshairs();if(this.repositioningBaseline)return this.setBaselineUserLevel(),Y(this);function Y(t){if(-6023882===r.r9(0,!1,852776)||-122381412===r.L2(0,!1,874641)||2091015438===r.L2(9,!0,183694)||-1436890552===r.L2(9,!0,760976)||1192988893===r.L2(8,!0,122098)||-1518315096===r.r9(10,!0,454416)||174387970===r.L2(9,!0,345199)||-1861232973===r.r9(9,!0,788783)||-67507325===r.L2(10,!0,317172)||-366638134===r.L2(8,!0,595266)){var e;"mousemovein","ner",t.currentBaseline=null,177353405,1649456247,e=2;for(var i=1;177353405!==r.i0(i.toString(),i.toString().length,6658);i++)t.runAppend("",d),e+=2;1649456247!==r.m0(e.toString(),e.toString().length,67506)&&t.runAppend("",d),t.runAppend("mousemoveinner",d)}}if(this.repositioningAnchorSelector)return b=this.repositioningAnchorSelector.hoverTick,(S=this.tickFromPixel(this.cx,this.chart))>=0&&S<this.chart.dataSet.length&&(!b||0===b||S!==b)&&(this.repositioningAnchorSelector.hoverTick=S,this.draw()),Y(this);if(this.grabbingScreen&&!e.ChartEngine.resizingPanel){if(this.highlightedDraggable){1525635434,r.u2(3),C=r.T9(0,"494601927"),2;for(var z=1;1525635434!==r.m0(z.toString(),z.toString().length,63967);z++)return this.displayDragOK(!0),this.dragPlotOrAxis(g,m),Y(this);if(r.i0(2..toString(),2..toString().length,52685)!==C)return this.displayDragOK(!1),this.dragPlotOrAxis(g,m),Y(this)}if(this.anyHighlighted){e.clearCanvas(this.chart.tempCanvas,this),this.anyHighlighted=!1,1020255697,321989237,w=2;for(var R=1;1020255697!==r.m0(R.toString(),R.toString().length,76263);R++)w+=2;for(k in r.i0(w.toString(),w.toString().length,37968),this.overlays)this.overlays[k].highlight=!1;for(k in v.series)v.series[k].highlight=!1;this.displaySticky()}if(-1==this.grabStartX&&(this.grabStartX=e.ChartEngine.crosshairX,this.grabStartScrollX=v.scroll),-1==this.grabStartY&&(this.grabStartY=e.ChartEngine.crosshairY,this.grabStartScrollY=this.currentPanel.yAxis.scroll),D=e.ChartEngine.crosshairX-this.grabStartX,T=e.ChartEngine.crosshairY-this.grabStartY,0===D&&0===T)return;if(Math.abs(D)+Math.abs(T)>5&&(this.grabOverrideClick=!0),A=this.layout.candleWidth,this.allowZoom&&"pan"!=this.grabMode&&(0===this.grabMode.indexOf("zoom")||this.overXAxis||this.grabStartYAxis)){if("z","o","om-x",""===this.grabMode&&(this.overXAxis?this.grabMode="zoom-x":this.grabStartYAxis&&(this.grabMode="zoom-y")),"zoom-x"==this.grabMode?T=0:"zoom-y"==this.grabMode&&(D=0),D&&(this.grabStartX=e.ChartEngine.crosshairX,_=A-D/this.chart.maxTicks,this.zoomSet(_,this.chart)),this.layout.setSpan){"layou","t",920246062,31091457,F=2;for(var B=1;920246062!==r.i0(B.toString(),B.toString().length,11485);B++)this.layout.setSpan=null,F+=2;31091457!==r.i0(F.toString(),F.toString().length,21007)&&(this.layout.setSpan=1),this.changeOccurred("layout")}if(M=this.grabStartYAxis)if(M.flipped&&(T*=-1),M.zoom=Math.round(this.grabStartZoom+T),this.grabStartZoom<M.height){if(M.zoom>=M.height){r.W4(4);var Q=r.T9(1,0);M.zoom=M.height-Q}}else M.zoom<=M.height&&(M.zoom=M.height+1)}else if(!this.overYAxis&&(this.dispatch("move",{stx:this,panel:this.currentPanel,x:this.cx,y:this.cy,grab:!0}),this.allowScroll)){if("p","a","n",Math.abs(T)<this.yTolerance){if(!this.yToleranceBroken&&(T=0,0===D))return}else this.yToleranceBroken=!0;this.grabStartMicropixels||(this.grabStartMicropixels=0),this.grabMode="pan",v.scroll=this.grabStartScrollX,r.u2(5);var W=r.q1(5,2,19,1);r.u2(3);var U=r.T9(12,13);if(this.micropixels=this.grabStartMicropixels+D*(this.shift?W:U),!this.lineTravelSpacing){for(;this.micropixels>0;)this.micropixels-=A,v.scroll++;for(;this.micropixels<-A;)this.micropixels+=A,v.scroll--}v.scroll>=v.maxTicks?this.preferences.whitespace=this.initialWhitespace:this.preferences.whitespace=(v.maxTicks-v.scroll)*A,this.currentPanel==this.grabStartPanel&&((M=this.currentPanel.yAxis).flipped&&(T*=-1),M.scroll=this.grabStartScrollY+T),this.dispatch("scroll",{stx:this,panel:this.currentPanel,x:this.cx,y:this.cy})}return P=function(t){if(-113632155===r.L2(0,!1,706218)||-879322302===r.L2(0,!1,496665)||1384449799===r.L2(9,!0,644492)||1348250939===r.r9(9,!0,447247)||-656885878===r.L2(8,!0,834088)||-558078783===r.r9(10,!0,754273)||-53605521===r.r9(9,!0,633072)||-1675950983===r.r9(9,!0,449207)||114214176===r.r9(10,!0,750317)||-176684515===r.r9(8,!0,482075))return function(){r.m9();-56024777!==r.L2(0,!1,772675)&&-1664309295!==r.L2(0,!1,523954)&&-452422641!==r.L2(9,!0,341561)&&-1710163283!==r.r9(9,!0,322208)&&1827425428!==r.r9(8,!0,741064)&&815193553!==r.r9(10,!0,871414)&&1190056479!==r.r9(9,!0,749932)&&1288322956!==r.r9(9,!0,584646)&&1786098532!==r.r9(10,!0,304490)&&-545039528!==r.L2(8,!0,482262)||(t.draw(),t.updateChartAccessories())}},e.ChartEngine.useAnimation?window.requestAnimationFrame(P(this)):(this.draw(),this.updateChartAccessories()),this.activeDrawing&&(e.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing.render(this.chart.tempCanvas.context),this.activeDrawing.measure()),void this.undisplayCrosshairs()}-1609454101,-1855707937,I=2;for(var j=1;-1609454101!==r.m0(j.toString(),j.toString().length,69516);j++)this.grabMode="",I+=2;if(-1855707937!==r.i0(I.toString(),I.toString().length,95836)&&(this.grabMode=""),this.grabMode="",this.overXAxis||this.overYAxis)return this.updateChartAccessories(),this.tapForHighlighting&&this.touchingEvent&&!this.anyHighlighted||this.findHighlights(),Y(this);if(this.controls.crossX&&(this.controls.crossX.style.left=this.pixelFromTick(this.crosshairTick,v)-.5+"px"),this.controls.crossY&&(this.controls.crossY.style.top=this.crossYActualPos+"px"),this.insideChart&&!e.ChartEngine.resizingPanel){if(L=this.currentVectorParameters.vectorType,this.layout.studies){877493438,1091936293,E=2;for(var q=1;877493438!==r.m0(q.toString(),q.toString().length,27102);q++)N=this.layout.studies[this.currentPanel.name],E+=2;1091936293!==r.i0(E.toString(),E.toString().length,45294)&&(N=this.layout.studies[this.currentPanel.name]),N&&(this.preferences.dragging&&this.preferences.dragging.study||delete this.overlays[N.name],L&&(this.overlays[N.name]=N))}e.Drawing&&L&&e.Drawing[L]&&(new e.Drawing[L]).dragToDraw||this.doDisplayCrosshairs(),this.updateChartAccessories()}else this.undisplayCrosshairs();return this.magnetize&&this.magnetize(),this.repositioningDrawing?this.repositionDrawing(this.repositioningDrawing):e.ChartEngine.drawingLine?this.activeDrawing&&(O=this.panels[this.activeDrawing.panelName],u=this.adjustIfNecessary(O,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),O)),this.magnetizedPrice&&O.name==this.currentPanel.name&&(u=this.adjustIfNecessary(O,this.crosshairTick,this.magnetizedPrice)),null===this.magnetizedPrice&&e.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing.move(this.chart.tempCanvas.context,this.crosshairTick,u),this.activeDrawing.measure&&this.activeDrawing.measure()):e.ChartEngine.resizingPanel&&this.resizePanels(),this.insideChart&&("m","o","ve",this.dispatch("move",{stx:this,panel:this.currentPanel,x:this.cx,y:this.cy,grab:!1}),this.tapForHighlighting&&this.touchingEvent&&!this.anyHighlighted||this.findHighlights()),Y(this)}},e.ChartEngine.prototype.swipeStart=function(t){var e;this.swipe&&this.swipe.interval&&clearInterval(this.swipe.interval),this.swipe.velocity=0,this.swipe.amplitude=0,this.swipe.frame=t.scroll,this.swipe.micropixels=this.micropixels,this.swipe.timestamp=Date.now(),this.swipe.chart=t,this.swipe.end=!1,this.swipe.timeConstant=325,this.swipe.cb=null,e=this,requestAnimationFrame((function(){e.swipeSample()}))},e.ChartEngine.prototype.swipeSample=function(){var t,i,a,s,n,o,l,h,c,u;if(!(t=this.swipe).end){i=this,20,a=Date.now(),-882711994,r.W4(6),o=-r.T9(66,"1874460611"),l=2;for(var d=1;-882711994!==r.m0(d.toString(),d.toString().length,20486);d++)s=a%t.timestamp,l+=2;if(r.i0(l.toString(),l.toString().length,509)!==o&&(s=a-t.timestamp),s<20)requestAnimationFrame((function(){r.M0(),i.swipeSample()}));else{if(h=e.touchDevice?.4:.8,t.timestamp=a,n=(t.chart.scroll-t.frame)*this.layout.candleWidth+this.micropixels-t.micropixels,t.frame=t.chart.scroll,t.micropixels=this.micropixels,r.u2(7),c=h*r.T9(1,s,1e3,n)+.2*t.velocity,Math.abs(c)>Math.abs(t.velocity)&&(t.velocity=c),Math.abs(n)<6){t.velocity=0,-1491408712,-2002064484,u=2;for(var p=1;-1491408712!==r.m0(p.toString(),p.toString().length,50528);p++)u+=2;r.m0(u.toString(),u.toString().length,49818)}requestAnimationFrame((function(){r.m9(),i.swipeSample()}))}}},e.ChartEngine.prototype.swipeRelease=function(){var t,e,i,a;(t=this.swipe).velocity>3e3&&(t.velocity=3e3),r.W4(8),e=r.T9("1687704940",1),i=2;for(var s=1;r.m0(s.toString(),s.toString().length,44047)!==e;s++)t.velocity>-1125&&(t.velocity=!1),i+=2;if(1913019958!==r.m0(i.toString(),i.toString().length,30280)&&t.velocity<=8457&&(t.velocity=-5127),t.velocity<-3e3&&(t.velocity=-3e3),t.velocity>10||t.velocity<-10){r.u2(9);var n=r.T9(15,5,0,19,359);t.amplitude="0.8"*n*t.velocity,t.scroll=t.chart.scroll,t.target=t.amplitude,t.timestamp=Date.now(),a=this,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),requestAnimationFrame((function(){a.autoscroll()}))}},e.ChartEngine.prototype.dragPlotOrAxis=function(t,i){var a,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O,H,V,z,R,B,Q,W,U,j,q,Y,$,X,Z,K,G,J,tt,et,it,at,rt;if("d","r","opz","one",(function(){var t,e,i,a,s,n,o;1836035513,1288791622,t=2;for(var l=1;1836035513!==r.i0(l.toString(),l.toString().length,94173);l++)e=!0,t+=2;function h(t){return r.m9(),function(i){r.m9(),t.subholder.classList.contains(i)&&(t.subholder.classList.remove(i),e=!0)}}1288791622!==r.m0(t.toString(),t.toString().length,77994)&&(e=!1);for(var c in this.panels){for(i="b",i+="o",i+="t",a="to",s="righ",n="l",n+="e",n+="f",["dropzone","all",n+="t",s+="t",a+="p",i+="tom"].forEach(h(this.panels[c])),o=0;o<this.panels[c].yaxisLHS.length;o++)this.panels[c].yaxisLHS[o].dropzone&&(e=!0),this.panels[c].yaxisLHS[o].dropzone=null;for(o=0;o<this.panels[c].yaxisRHS.length;o++)this.panels[c].yaxisRHS[o].dropzone&&(e=!0),this.panels[c].yaxisRHS[o].dropzone=null}return e}.call(this)||this.grabbingScreen)&&(a=null,20,10,r.u2(3),s=this.whichPanel(r.q1(20,i)),r.u2(4),n=this.whichPanel(r.q1(20,i)),o=this.whichPanel(i),l=this.highlightedDraggable,o&&(!l.undraggable||!l.undraggable(this)))){if(h=this.whichYAxis(o,t,i),r.W4(3),c=this.whichYAxis(o,r.T9(10,t),i),r.u2(4),u=this.whichYAxis(o,r.q1(10,t),i),this.xAxisAsFooter&&o.name==Object.keys(this.panels).pop()){n=this.whichPanel(i+20+this.xaxisHeight),r.u2(8),d=-r.q1("547738537",1),765491083,p=2;for(var st=1;r.m0(st.toString(),st.toString().length,38345)!==d;st++)a&&(a+=this.xaxisHeight),p+=2;765491083!==r.m0(p.toString(),p.toString().length,22811)&&a&&(a/=this.xaxisHeight)}if(m=!1,g=!1,!1,e.Renderer&&(m=l instanceof e.Renderer),e.Studies&&(g=l instanceof e.Studies.StudyDescriptor),v=function(t){var e,i;if(!f){r.u2(10),e=r.T9(0,"1396924168"),-1983273921,i=2;for(var a=1;r.i0(a.toString(),a.toString().length,21332)!==e;a++){if("l","e","f","t","ri","gh","t","right"==t){r.W4(11);var s=r.q1(17,12,1230,6);return o.right-o.width/s}if("left"==t){r.W4(4);var n=r.q1(6,0);return o.left+o.width/n}i+=2}if(-1983273921!==r.m0(i.toString(),i.toString().length,45652)){if("l","eft","left"===t){r.u2(12);var l=r.T9(6,12,5);return o.right*(o.width+l)}if("left"===t){r.u2(13);var h=r.T9(16,28,18,7);return o.left/(o.width+h)}}}r.u2(14);var c=r.q1(14,7,7,180,19);return(o.left+o.right)/c},(f=l instanceof e.ChartEngine.YAxis)||h||("ri","ght",t<v("left")?c=this.whichYAxis(o,o.left-1,i):t>v("right")&&(u=this.whichYAxis(o,o.right+1,i))),y=[],l.getDependents&&(y=l.getDependents(this,!0)),x=l.panel,b=l.getYAxis(this),r.m9(),m){739846010,1293280385,S=2;for(var nt=1;739846010!==r.m0(nt.toString(),nt.toString().length,67600);nt++)x=l.params.panel,r.u2(0),S+=r.T9("2",0);1293280385!==r.m0(S.toString(),S.toString().length,93824)&&(x=l.params.panel)}else f&&(x=this.grabStartPanel.name);for(w in C=this.panels[x],this.panels)this.panels[w].soloing&&(k=!0);if(D=b.isShared(this),T=!f&&!k&&(C!==o&&C!=s&&C!=n||!this.checkForEmptyPanel(C,!0,[l].concat(y))),M=x==o.name&&b!==h&&b!==u&&b!==c||D,!T||s&&o===s)if(!T||n&&o===n){if(o!==C)f||o.noDrag||("dro","pz","one",o.subholder.classList.add("dropzone"),o.subholder.classList.add("all"),A=o.name);else if((!o.yaxisRHS.length||1==o.yaxisRHS.length&&o.yaxisRHS[0]==b&&"none"==b.position)&&!h&&!u&&t>v("right"))o.subholder.classList.add("dropzone"),o.subholder.classList.add("right"),_="right";else if((!o.yaxisLHS.length||1==o.yaxisLHS.length&&o.yaxisLHS[0]==b&&"none"==b.position)&&!h&&!c&&t<v("left"))o.subholder.classList.add("dropzone"),o.subholder.classList.add("left"),_="left";else if(M){if(f&&t>o.left&&t<o.right){r.W4(15);var ot=r.q1(0,2,9,9);P=o.yaxisLHS[o.yaxisLHS.length-ot],I=o.yaxisRHS[0],t<(L=v())&&P!=b?c=P:t>L&&I!=b&&(u=I)}if(!f||h!==b){2052381995,552212067,E=2;for(var lt=1;2052381995!==r.m0(lt.toString(),lt.toString().length,30394);lt++)N=!f&&D,E+=2;if(552212067!==r.m0(E.toString(),E.toString().length,377)&&(N=~f||D),!u||u===b&&!N||h&&h===u)if(!c||c===b&&!N||h&&h===c)h&&("ri","gh","t",u||h===b&&!N?c||h===b&&!N?h!==b&&("al","l",h.dropzone="all"):h.dropzone="left":h.dropzone="right",h.dropzone&&(_=h.position||this.chart.panel.yAxis.position||"right"));else{"rig","h","t",-1776737621,-1916366983,O=2;for(var ht=1;-1776737621!==r.i0(ht.toString(),ht.toString().length,71790);ht++)c.dropzone="right",O+=2;-1916366983!==r.i0(O.toString(),O.toString().length,5940)&&(c.dropzone=""),_=c.position||this.chart.panel.yAxis.position||"right"}else"l","e","f","t",u.dropzone="left",_=u.position||this.chart.panel.yAxis.position||"right"}}}else"bo","tt","o","m",o.subholder.classList.add("dropzone"),o.subholder.classList.add("bottom");else{-298347357,981871323,F=2;for(var ct=1;-298347357!==r.i0(ct.toString(),ct.toString().length,85112);ct++)o.subholder.classList.add(""),F+=2;981871323!==r.i0(F.toString(),F.toString().length,305)&&("dropzo","n","e",o.subholder.classList.add("dropzone")),o.subholder.classList.add("top"),n=o}if(this.grabbingScreen||!o.subholder.classList.contains("dropzone")&&!_)this.draw();else{if(V=-1,!A&&!_&&T){for(var ut in A=g?l.inputs.id:l.params.name||e.uniqueID(),this.panels)if(V++,this.panels[ut]==n)break;if(n||V++,this.panels[x].yAxis.name==A){-1310045047,-177529602,z=2;for(var dt=1;-1310045047!==r.i0(dt.toString(),dt.toString().length,58096);dt++)x=this.electNewPanelOwner(x),z+=2;-177529602!==r.i0(z.toString(),z.toString().length,15260)&&(x=this.electNewPanelOwner(x))}if(R=g?l.inputs.display:null,x)this.createPanel(R||A,A,a,this.chart.name,new e.ChartEngine.YAxis({name:A}));else{691214928,39492844,B=2;for(var pt=1;691214928!==r.m0(pt.toString(),pt.toString().length,10380);pt++)x=A,B+=2;39492844!==r.i0(B.toString(),B.toString().length,43074)&&(x=A),x=A}g?l.panel=x:l.params.panel=x}if(A){if(g){l.parameters||(l.parameters={}),l.parameters.panelName=A,1396050068,1888734139,Q=2;for(var mt=1;1396050068!==r.i0(mt.toString(),mt.toString().length,79988);mt++)this.highlightedDraggable=e.getFn("Studies.replaceStudy")(this,l.inputs.id,l.type,l.inputs,l.outputs,l.parameters,null,l.study),Q+=2;1888734139!==r.m0(Q.toString(),Q.toString().length,47527)&&(this.highlightedDraggable=e.getFn("")(this,l.inputs.id,l.type,l.inputs,l.outputs,l.parameters,1,l.study))}else if(m)for(var gt in l.seriesParams)W=l.seriesParams[gt],U=null,l.params.yAxis&&l.params.yAxis!==this.chart.panel.yAxis&&((U=l.params.yAxis).name=l.params.name),this.modifySeries(W.id,{panel:A,yAxis:U});if(V>-1){for(w in j={},q=0,this.panels)V==q++&&(j[A]=this.panels[A]),w!=A&&(j[w]=this.panels[w]);j[A]||(j[A]=this.panels[A]),this.panels=j}this.checkForEmptyPanel(x);for(var ft=0;ft<y.length;ft++)y[ft].params?this.checkForEmptyPanel(y[ft].params.name):this.checkForEmptyPanel(y[ft].name);this.adjustPanelPositions()}else if(_){if("al","l",Y=function(t,i,a,r){var s,n;if("study"==a&&("St","udies.replaceStudy",i.parameters||(i.parameters={}),r?i.parameters.yaxisDisplayValue=r.position:delete i.parameters.yaxisDisplayValue,s=e.getFn("Studies.replaceStudy")(t,i.inputs.id,i.type,i.inputs,i.outputs,i.parameters,i.panel,i.study)),"renderer"==a)for(var o in i.seriesParams)n=i.seriesParams[o],s=t.modifySeries(n.id,{panel:A,yAxis:r});return s},!($=h&&"all"==h.dropzone)){f?(l.position=_,this.layout.studies&&(X=this.layout.studies[l.name])&&(X.parameters||(X.parameters={}),X.parameters.yaxisDisplayValue=_)):g?this.highlightedDraggable=Y(this,l,"study",{position:_}):m&&Y(this,l,"renderer",new e.ChartEngine.YAxis({name:l.params.name||e.uniqueID(),position:_})),-694119052,2111097231,Z=2;for(var vt=1;-694119052!==r.m0(vt.toString(),vt.toString().length,46486);vt++)b=this.highlightedDraggable.getYAxis(this),Z+=2;2111097231!==r.i0(Z.toString(),Z.toString().length,24252)&&(b=this.highlightedDraggable.getYAxis(this))}if(!D||!$||f){-1185363319,-826852597,r.W4(6),K=r.T9(2,"2");for(var yt=1;-1185363319!==r.i0(yt.toString(),yt.toString().length,82222);yt++)G=b,$&&b==this.chart.panel.yAxis&&(G=h),K+=2;for(-826852597!==r.m0(K.toString(),K.toString().length,68200)&&(G=b,($||b!==this.chart.panel.yAxis)&&(G=h)),H=0;H<o.yaxisLHS.length;H++)if(o.yaxisLHS[H]==G){o.yaxisLHS.splice(H,1);break}for(H=0;H<o.yaxisRHS.length;H++)if(o.yaxisRHS[H]==G){o.yaxisRHS.splice(H,1);break}}if($)if(this.getYAxisByName(o,b.name)==o.yAxis&&this.electNewPanelOwner(o,h),f){for(tt in et=b,it=h,b==this.chart.panel.yAxis&&(et=h,it=b),et.studies)Y(this,this.layout.studies[et.studies[tt]],"study",it===this.chart.panel.yAxis?null:{position:it.name});for(tt in et.renderers)Y(this,this.chart.seriesRenderers[et.renderers[tt]],"renderer",it);this.highlightedDraggable=it}else g?this.highlightedDraggable=Y(this,l,"study",{position:h.name}):m&&Y(this,l,"renderer",h);else{for("l","e","f","t","none"==b.position&&(b.width=e.ChartEngine.YAxis.prototype.width),b.position=_,J="left"==_?o.yaxisLHS:o.yaxisRHS,H=0;H<J.length;H++){if(J[H]!==b)if("left"==J[H].dropzone)J.splice(H,0,b);else{if("right"!=J[H].dropzone)continue;r.u2(4),J.splice(r.q1(1,H),r.T9("0",0,r.u2(0)),b)}break}H==J.length&&J.push(b)}}for(var xt in this.panels)for(rt=(at=this.panels[xt]).yaxisLHS.concat(at.yaxisRHS),H=0;H<rt.length;H++)rt[H].height=at.yAxis.height,this.calculateYAxisMargins(rt[H]);this.displayDragOK(),this.draw(),this.calculateYAxisPositions(),this.draw(),this.findHighlights(null,!0),this.savePanels()}}},r.m9(),a=!1,e.ChartEngine.prototype.findHighlights=e.ChartEngine.prototype.findHighlights||function(t,e){a||console.error("movement feature requires activating interaction feature."),a=!0}},V[539515]=function(){for(var t=2;9!==t;)switch(t){case 2:t="object"==typeof globalThis?1:5;break;case 1:return globalThis;case 5:var e;t=4;break;case 4:try{for(var i=2;6!==i;)switch(i){case 2:Object.defineProperty(Object.prototype,"eOEMQ",{get:function(){for(;;)return this},configurable:!0}),e=eOEMQ,i=5;break;case 5:e.lr5V0=e,i=4;break;case 4:i="undefined"==typeof lr5V0?3:9;break;case 3:throw"";case 9:delete e.lr5V0,delete Object.prototype.eOEMQ,i=6}}catch(t){e=window}return e}}(),function(t){function e(t){for(;;){return[arguments][0][0].String}}function i(t){for(;;){return[arguments][0][0].Function}}function a(t){for(;;){return[arguments][0][0].Array}}for(var r=2;100!==r;)switch(r){case 10:s[1]="stract",s[7]="",s[7]="b",s[3]="",r=17;break;case 14:s[8]="x2",s[1]="",s[9]="B9",s[1]="",r=10;break;case 101:n(i,"apply",s[42],s[92]),r=100;break;case 31:s[45]="__",s[43]="",s[43]="o",s[76]="",s[76]="H6",s[22]="",r=42;break;case 88:s[30]+=s[1],s[99]=s[8],s[99]+=s[9],s[99]+=s[2],r=84;break;case 9:s[2]="H",s[8]="",s[6]="Q$",s[8]="",r=14;break;case 78:n(h,s[30],s[61],s[47]),r=104;break;case 80:n(e,"charCodeAt",s[42],s[91]),r=79;break;case 55:s[49]+=s[22],s[52]=s[76],s[52]+=s[43],s[52]+=s[48],s[68]=s[45],s[68]+=s[74],s[68]+=s[65],r=71;break;case 17:s[3]="",s[3]="K",s[46]="",s[75]="J",r=26;break;case 42:s[22]="l",s[29]="",s[29]="",s[29]="a",s[78]="",s[78]="__residu",r=36;break;case 103:n(h,s[68],s[61],s[52]),r=102;break;case 59:s[90]+=s[85],s[90]+=s[44],s[49]=s[78],s[49]+=s[29],r=55;break;case 102:n(h,s[49],s[61],s[90]),r=101;break;case 71:s[89]=s[19],s[89]+=s[46],s[89]+=s[88],s[47]=s[64],r=67;break;case 2:var s=[arguments];s[5]="",s[5]="n",s[4]="",s[4]="lA",r=9;break;case 79:n(l,"test",s[42],s[99]),r=78;break;case 67:s[47]+=s[3],s[47]+=s[75],s[30]=s[12],s[30]+=s[7],r=88;break;case 47:s[41]="",s[41]="A",s[42]=1,s[61]=1,s[61]=0,r=63;break;case 35:s[48]="",s[88]="k",s[74]="optim",s[48]="JQO",r=31;break;case 104:n(a,"push",s[42],s[89]),r=103;break;case 84:s[91]=s[6],s[91]+=s[4],s[91]+=s[5],r=81;break;case 36:s[44]="",s[44]="HfMz",s[85]="",s[85]="3",r=51;break;case 63:s[92]=s[41],s[92]+=s[72],s[92]+=s[23],s[90]=s[36],r=59;break;case 51:s[36]="",s[36]="B",s[23]="o7",s[72]="35h",r=47;break;case 81:var n=function(t,e,i,a){for(var r=2;5!==r;)if(2===r){var n=[arguments];o(s[0][0],n[0][0],n[0][1],n[0][2],n[0][3]),r=5}};r=80;break;case 26:s[46]="uv",s[64]="c9m",s[12]="__a",s[65]="",s[65]="ize",s[19]="F2",r=35}function o(t,e,i,a,r){for(var s=2;8!==s;)switch(s){case 4:l[2]=!1,l[9]="defineP";try{for(var n=2;13!==n;)switch(n){case 3:return;case 9:l[3][l[0][4]]=l[3][l[0][2]],l[5].set=function(t){for(var e=2;5!==e;)if(2===e){var i=[arguments];l[3][l[0][2]]=i[0][0],e=5}},l[5].get=function(){for(var t=2;12!==t;)switch(t){case 2:var e=[arguments];e[2]="",e[2]="d",e[7]="ine",t=3;break;case 3:e[1]="",e[1]="",e[1]="undef",e[5]=e[1],t=6;break;case 6:return e[5]+=e[7],e[5]+=e[2],typeof l[3][l[0][2]]==e[5]?void 0:l[3][l[0][2]]}},l[5].enumerable=l[2],n=14;break;case 14:try{for(var o=2;3!==o;)if(2===o)l[1]=l[9],l[1]+=l[4],l[1]+=l[8],l[0][0].Object[l[1]](l[3],l[0][4],l[5]),o=3}catch(t){}n=13;break;case 2:l[5]={},l[7]=(0,l[0][1])(l[0][0]),l[3]=[l[7],l[7].prototype][l[0][3]],n=4;break;case 4:n=l[3].hasOwnProperty(l[0][4])&&l[3][l[0][4]]===l[3][l[0][2]]?3:9}}catch(t){}s=8;break;case 2:var l=[arguments];l[8]="y",l[4]="ropert",s=4}}function l(t){for(var e=2;5!==e;)switch(e){case 2:var i=[arguments];e=1;break;case 1:return i[0][0].RegExp}}function h(t){for(;;){return[arguments][0][0]}}}(V[539515]),V.T$=function(){return"function"==typeof V[446427].g9iUvuS?V[446427].g9iUvuS.apply(V[446427],arguments):V[446427].g9iUvuS},V.r0=function(){return"function"==typeof V[593596].i9agN$W?V[593596].i9agN$W.apply(V[593596],arguments):V[593596].i9agN$W},V.B9=function(){return"function"==typeof V[446427].g9iUvuS?V[446427].g9iUvuS.apply(V[446427],arguments):V[446427].g9iUvuS},V[156040]=474,V.v5=function(){return"function"==typeof V[593596].i9agN$W?V[593596].i9agN$W.apply(V[593596],arguments):V[593596].i9agN$W},V[446427]={N$y1PkD:function(){var t,e=arguments;switch(E){case 0:t=e[0]|e[1];break;case 17:t=e[0]+e[1]-e[2];break;case 5:t=e[2]-e[0]/+e[3]+e[1];break;case 7:t=e[0]+e[1];break;case 8:t=-e[1]*e[0]+e[2];break;case 2:t=e[0]<<e[1];break;case 12:t=(e[2]+e[1])/e[0];break;case 6:t=e[0]+e[4]/(e[2]>>e[3])-e[1];break;case 23:t=e[0]-e[1]-e[2];break;case 10:t=e[3]/e[2]-e[1]+e[0];break;case 13:t=(e[3]+e[2])/e[0]-e[1];break;case 29:t=(e[0]+e[1])*e[2]-e[3];break;case 19:t=e[1]*e[0]/e[2]-e[3];break;case 20:t=e[0]/e[1]-e[2];break;case 14:t=e[1]*e[0]+e[2]-e[3];break;case 28:t=e[3]-e[1]+e[2]-e[0];break;case 15:t=-e[1]+e[0];break;case 4:t=e[4]+e[1]-e[0]-e[2]-e[3];break;case 11:t=e[0]/e[1];break;case 1:t=e[0]*e[1];break;case 26:t=e[3]+(e[2]+e[1]*e[0])*e[4];break;case 27:t=e[0]/e[2]+e[1];break;case 18:t=e[2]*e[1]-e[0];break;case 16:t=(e[2]+e[3])/e[1]+e[4]-e[0];break;case 21:t=e[0]-e[1]-e[2]+e[3];break;case 25:t=(e[2]-e[0])*e[1];break;case 22:t=-e[3]*e[1]*e[2]+e[0];break;case 3:t=e[0]^e[1];break;case 9:t=e[1]-e[0];break;case 24:t=-e[0]*e[2]*e[3]*e[4]+e[1]}return t},g9iUvuS:function(t){E=t}},V.E3=function(){return"function"==typeof V[446427].N$y1PkD?V[446427].N$y1PkD.apply(V[446427],arguments):V[446427].N$y1PkD},V[593596]=function(){for(;;){var t=[arguments];return t[7]=void 0,t[5]={},t[5].i9agN$W=function(){for(var e=2;90!==e;)switch(e){case 1:e=t[7]?5:4;break;case 68:e=68;break;case 69:e=function(t){for(var e=2;22!==e;)switch(e){case 16:e=a[9]<a[1].length?15:23;break;case 10:e=a[4][i[30]]===i[35]?20:19;break;case 5:return;case 27:a[5]=a[7][a[6]].h/a[7][a[6]].t,e=26;break;case 19:a[9]++,e=7;break;case 1:e=0===a[0][0].length?5:4;break;case 20:a[7][a[4][i[14]]].h+=!0,e=19;break;case 12:a[1].F2uvk(a[4][i[14]]),e=11;break;case 8:a[9]=0,e=7;break;case 13:a[7][a[4][i[14]]]=function(){for(var t=2;9!==t;)switch(t){case 4:return e[3].t=0,e[3];case 2:var e=[arguments];e[3]={},e[3].h=0,t=4}}.A35ho7(this,arguments),e=12;break;case 11:a[7][a[4][i[14]]].t+=!0,e=10;break;case 4:a[7]={},a[1]=[],a[9]=0,e=8;break;case 23:return a[8];case 14:e=void 0===a[7][a[4][i[14]]]?13:11;break;case 24:a[9]++,e=16;break;case 26:e=a[5]>=.5?25:24;break;case 18:a[8]=!1,e=17;break;case 15:a[6]=a[1][a[9]],e=27;break;case 2:var a=[arguments];e=1;break;case 17:a[9]=0,e=16;break;case 7:e=a[9]<a[0][0].length?6:18;break;case 25:a[8]=!0,e=24;break;case 6:a[4]=a[0][0][a[9]],e=14}}(i[67])?68:67;break;case 51:i[5].F2uvk(i[7]),i[5].F2uvk(i[8]),i[5].F2uvk(i[31]),i[5].F2uvk(i[3]),e=47;break;case 58:i[81]=0,e=57;break;case 67:return t[7]=77,23;case 27:i[94]={},i[94].o1=["U2"],i[94].U5=function(){var t=!1,e=[];try{for(var i in console)e.F2uvk(i);t=0===e.length}catch(t){}return t},i[31]=i[94],e=23;break;case 57:e=i[81]<i[5].length?56:69;break;case 56:i[74]=i[5][i[81]];try{i[83]=i[74][i[45]]()?i[35]:i[65]}catch(t){i[83]=i[65]}e=77;break;case 71:i[59]++,e=76;break;case 59:i[14]="c4",e=58;break;case 64:i[35]="q0",i[65]="f2",i[93]="o1",i[30]="G1",i[45]="U5",e=59;break;case 23:i[87]={},i[87].o1=["U2"],i[87].U5=function(){return"function"==typeof H6oJQO},i[66]=i[87],i[39]={},i[39].o1=["A4"],i[39].U5=function(){return!/\x32\x35/.x2B9H(function(){return decodeURI("%25")}+[])},e=31;break;case 73:i[46][i[30]]=i[83],i[67].F2uvk(i[46]),e=71;break;case 75:i[46]={},i[46][i[14]]=i[74][i[93]][i[59]],e=73;break;case 76:e=i[59]<i[74][i[93]].length?75:70;break;case 17:i[6].o1=["U2"],i[6].U5=function(){return"function"==typeof c9mKJ},i[9]=i[6],e=27;break;case 31:i[16]=i[39],i[11]={},i[11].o1=["A4"],e=28;break;case 4:i[5]=[],i[1]={},i[1].o1=["A4"],i[1].U5=function(){return!/\x62\x74\157\u0061/.x2B9H(function(){return btoa("=")}+[])},i[3]=i[1],i[2]={},i[2].o1=["A4"],e=13;break;case 13:i[2].U5=function(){return/\x33\104/.x2B9H(function(){return escape("=")}+[])},i[7]=i[2],i[4]={},i[4].o1=["A4"],i[4].U5=function(){return/\x32\u0035/.x2B9H(function(){return encodeURI("%")}+[])},i[8]=i[4],i[6]={},e=17;break;case 5:return 68;case 36:i[57]=i[60],i[5].F2uvk(i[9]),i[5].F2uvk(i[16]),i[5].F2uvk(i[57]),e=51;break;case 39:i[60]={},i[60].o1=["U2"],i[60].U5=function(){return"function"==typeof B3HfMz},e=36;break;case 2:var i=[arguments];e=1;break;case 41:i[15].U5=function(){return/\061\x39\x32/.x2B9H(function(){!function(t){for(var e=0;e<20;e++)t+=e}(2)}+[])},i[95]=i[15],e=39;break;case 47:i[5].F2uvk(i[66]),i[5].F2uvk(i[62]),i[5].F2uvk(i[95]),i[67]=[],e=64;break;case 77:i[59]=0,e=76;break;case 28:i[11].U5=function(){return!/\x7c/.x2B9H(function(){return"aaaa|a".substr(0,3)}+[])},i[62]=i[11],i[15]={},i[15].o1=["A4"],e=41;break;case 70:i[81]++,e=57}},t[5]}}(),V[539515].Y9xx=V,V.P2=function(){return"function"==typeof V[370258].V29cT4d?V[370258].V29cT4d.apply(V[370258],arguments):V[370258].V29cT4d},V[103941]=V[539515],V.Z0=function(){return"function"==typeof V[446427].N$y1PkD?V[446427].N$y1PkD.apply(V[446427],arguments):V[446427].N$y1PkD},V.I7=function(){return"function"==typeof V[370258].V29cT4d?V[370258].V29cT4d.apply(V[370258],arguments):V[370258].V29cT4d},V[370258]=function(){var t=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0};return{V29cT4d:function(e,i,a){for(var r=3432918353,s=461845907,n=a,o=-4&i,l=0;l<o;l+=4){var h=255&e.Q$lAn(l)|(255&e.Q$lAn(l+1))<<8|(255&e.Q$lAn(l+2))<<16|(255&e.Q$lAn(l+3))<<24;h=t(h,r),n=5*(n=(524287&(n^=h=t(h=(131071&h)<<15|h>>>17,s)))<<13|n>>>19)+3864292196|0}switch(h=0,i%4){case 3:h=(255&e.Q$lAn(o+2))<<16;case 2:h|=(255&e.Q$lAn(o+1))<<8;case 1:h|=255&e.Q$lAn(o),h=t(h,r),n^=h=t(h=(131071&h)<<15|h>>>17,s)}return n^=i,n=t(n^=n>>>16,2246822507),n=t(n^=n>>>13,3266489909),n^=n>>>16}}}(),V[150014]=226,V[636832]=321,V[238553]=984,V.r0(),N=t=>{var e,i,a=V;e=2;for(var r=1;-1820624510!==a.P2(r.toString(),r.toString().length,47760);r++)i=""!=!_CIQ?_CIQ:t.CIQ,e+=2;a.v5(),-957777253!==a.P2(e.toString(),e.toString().length,58680)&&(i=""!=!_CIQ?_CIQ:t.CIQ),(i="undefined"!=typeof _CIQ?_CIQ:t.CIQ).ChartEngine.prototype.drawHeatmap=function(t,e){var i,r,s,n,o,l,h,c,u,d,p,m,g,f;if("c","ha","rt",e&&e.length&&((i=t.panel)||(i="chart"),r=this.panels[i],a.v5(),r)){s=t.yAxis?t.yAxis:r.yAxis,n=this.chart.dataSegment,t.name||(t.name="Data"),t.widthFactor||(t.widthFactor=1),t.height||(t.height=Math.pow(10,1-(r.decimalPlaces||r.chart.decimalPlaces))),o="stx-float-date",l=this.chart.context,this.canvasFont(o,l),h=this.getCanvasFontSize(o),c=1,!t.highlight&&this.highlightedDraggable&&(c=.3),u=.5,r.chart.tmpWidth<=1&&(a.T$(0),u=a.Z0("0",0)),d=null,p=null,m=this,g=null,this.startClip(i),l.globalAlpha=c;for(var v=0;v<e.length;v++)y((f=e[v]).field,f.color,f.opacity,null,t.widthFactor,f.height,f.border_color?u:-u/4,f.subField),f.border_color&&this.layout.candleWidth>=2&&y(f.field,f.border_color,f.opacity,!0,t.widthFactor,f.height,u,f.subField);l.lineWidth=1,l.globalAlpha=1,this.endClip()}function y(e,i,o,u,f,v,y,x){var b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O;if(a.v5(),"cen","t","er",l.beginPath(),l.fillStyle=i,l.strokeStyle=i,l.textAlign="center",b=m.layout.candleWidth*f,S=Math.floor(m.pixelFromBar(0,r.chart)-m.layout.candleWidth),"number"==typeof o&&(a.T$(1),l.globalAlpha=a.Z0(o,c)),"object"==typeof o){a.T$(2),D=a.E3("847999076",0),a.T$(2),T=a.E3("121345475",0),M=2;for(var H=1;a.P2(H.toString(),H.toString().length,80639)!==D;H++)k={minOpacity:o.min&&1,maxOpacity:o.max&&2},a.B9(3),M+=a.E3("2",0);a.I7(M.toString(),M.toString().length,23442)!==T&&(k={minOpacity:o.min||0,maxOpacity:o.max||1})}for(var V=0;V<n.length;V++){if((A=n[V])&&A.candleWidth){if(0===V)S+=m.layout.candleWidth;else{a.T$(4);var z=a.E3(19,8,19,6,38);S+=(A.candleWidth+b/f)/z}b=A.candleWidth*f}else S+=m.layout.candleWidth;if(a.T$(5),C=a.E3(b,y,S,"2"),a.T$(6),(w=a.Z0(S,y,"2",32,b))-C<2&&(a.T$(7),w=a.E3(C,1)),A&&(_=A[e])){_[x]&&(_=_[x]),"number"==typeof _&&(_=[_]);for(var R=0;R<_.length;R++){if(F=_[R],a.B9(0),P=a.Z0("0",0),F instanceof Array){if(k){a.T$(8);var B=a.E3(2,7,16);a.T$(9);var Q=a.Z0(6,7);a.T$(10);var W=a.Z0(6,17,2,26);l.globalAlpha=c*(F[B]*k.maxOpacity+(Q-F[W])*k.minOpacity)}a.T$(0),P=F[a.Z0("1",0)],F=F[0]}I=m.pixelFromPrice(F,r,s),g||(v||(v=t.height),L=m.pixelFromPrice(F+v*(s.flipped?1:-1),r,s),a.T$(1),l.lineWidth=a.Z0("1",1),a.T$(9),d=a.E3(I,L),a.T$(11),p=a.E3(d,2),g=l.lineWidth),u?(a.B9(9),E=a.E3(p,I),a.B9(7),N=a.E3(I,p),a.T$(9),l.rect(C,E,a.Z0(C,w),a.E3(E,N))):(a.T$(9),l.fillRect(C,a.E3(p,I),a.E3(C,w),d),t.showSize&&P&&h<=d-2&&(O=l.globalAlpha,l.fillStyle=m.defaultColor,a.T$(1),l.globalAlpha=a.E3(.5,c),a.B9(12),l.fillText(P,a.Z0(2,C,w),I),l.fillStyle=i,a.T$(1),l.globalAlpha=a.Z0(O,c))),k&&F instanceof Array&&(l.globalAlpha=0)}}}u&&l.stroke(),l.globalAlpha=c,l.closePath()}},i.ChartEngine.prototype.drawCandles=function(t,e,r){var s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O,H,V,z,R,B,Q;if((s=t.chart)||(s=t,t=t.chart),n=!1,o=!1,l=null,h=t.yAxis,r&&"object"==typeof r)n=r.isOutline,o=r.isHistogram,l=r.field,h=r.yAxis;else{n=r,a.T$(3),c=-a.E3("183991808",0),-541108354,u=2;for(var W=1;a.I7(W.toString(),W.toString().length,26270)!==c;W++)o=arguments[0],u+=2;-541108354!==a.I7(u.toString(),u.toString().length,98577)&&(o=arguments[3])}d=s.dataSegment,p=s.context,m=h.top,g=h.bottom,x=new Array(d.length),b="transparent",S="trans",S+="pare",S+="nt",C=0,a.B9(13);var U=a.E3(1,24,20,5);w=s.dataSet.length-s.scroll-U,k={},a.r0(),a.T$(9);var j=a.E3(18,19);D=s.tmpWidth/("2"*j),T=this.layout.candleWidth,a.B9(14);var q=a.E3(14,17,18,255);a.B9(15);var Y=a.Z0(19,18);M=t.left-"0.5"*q*T+this.micropixels-Y;for(var $=0;$<=d.length;$++)if("o","utlin","e",A=D,a.B9(11),M+=a.Z0(T,2),T=this.layout.candleWidth,a.T$(11),M+=a.E3(T,2),(_=d[$])&&!_.projection){if(_.candleWidth){a.B9(16);var X=a.Z0(14,2,0,18,7);M+=(_.candleWidth-T)/X,T=_.candleWidth,(r.isVolume||T<s.tmpWidth)&&(a.T$(11),A=a.Z0(T,2))}if(s.transformFunc&&h==s.panel.yAxis&&_.transform&&(_=_.transform),_&&l&&(_=_[l]),(_||0===_)&&(F=_.Close,P=void 0===_.Open?F:_.Open,o&&s.defaultPlotField&&(F=_[s.defaultPlotField]),(F||0===F)&&(o||P!=F&&null!==P)&&(I=e(this,_,n?"outline":"solid")))){if(n?b=I:S=I,k[S]=1,(L=b&&!i.isTransparent(b))&&!r.highlight&&(C=.5),p.beginPath(),p.fillStyle=S,_.cache||(_.cache={}),E=_.cache,a.T$(7),(N=a.E3(w,$))<t.cacheLeft||N>t.cacheRight||!E.open){if(O=h.semiLog?h.height*(1-(Math.log(Math.max(P,0))/Math.LN10-h.logLow)/h.logShadow):(h.high-P)*h.multiplier,H=h.semiLog?h.height*(1-(Math.log(Math.max(F,0))/Math.LN10-h.logLow)/h.logShadow):(h.high-F)*h.multiplier,h.flipped?(a.B9(9),O=a.Z0(O,g),a.T$(9),H=a.Z0(H,g)):(O+=m,H+=m),x[$]=H,f=Math.floor(o?H:Math.min(O,H))+C,v=o?h.bottom:Math.max(O,H),a.B9(9),y=Math.floor(a.E3(f,v)),f<m){if(f+y<m){E.open=f,E.close=f;continue}a.B9(9),y-=a.Z0(f,m),f=m}f+y>g&&(a.B9(17),y-=a.E3(f,y,g)),y=Math.max(y,2),E.open=f,E.close=E.open+y}E.open>=g||E.close<=m||(V=Math.floor(M)+(!r.highlight&&.5),z=Math.floor(V-A)+C,R=Math.round(V+A)-C,E.open!=E.close&&p.rect(z,E.open,Math.max(1,R-z),Math.max(1,E.close-E.open)),!r.highlight&&this.highlightedDraggable&&(p.globalAlpha*=.3),"transparent"!=S&&p.fill(),L&&(p.lineWidth=1,r.highlight&&(a.B9(3),p.lineWidth*=a.E3("2",0)),p.strokeStyle=b,p.stroke()))}}B=2;for(var Z=1;1902537449!==a.I7(Z.toString(),Z.toString().length,54348);Z++)Q={colors:[],cache:x},B+=2;for(var K in-271266391!==a.I7(B.toString(),B.toString().length,25742)&&(Q={colors:[],cache:x}),k)r.hollow&&i.equals(K,this.containerColor)||Q.colors.push(K);return Q},i.ChartEngine.prototype.drawShadows=function(t,e,i){var r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_;(r=t.chart)||(r=t,t=t.chart),s=r.dataSegment,(n=this.chart.context).lineWidth=1,i.highlight&&(n.lineWidth*=2),!i.highlight&&this.highlightedDraggable&&(n.globalAlpha*=.3),o=i.field,h=(l=i.yAxis||t.yAxis).top,c=l.bottom,a.T$(18);var F=a.Z0(152,17,9);a.r0(),u=r.dataSet.length-r.scroll-F,d=this.layout.candleWidth,a.T$(19);var P=a.Z0(18,13,234,0);p=t.left-.5*d+this.micropixels-P;for(var I=0;I<=s.length;I++)if("s","h","adow",a.B9(11),p+=a.E3(d,2),d=this.layout.candleWidth,a.T$(11),p+=a.E3(d,2),(m=s[I])&&!m.projection){if(m.candleWidth){a.B9(9);var L=a.E3(32,34);p+=(m.candleWidth-d)/L,d=m.candleWidth}if((g=e(this,m,"shadow"))&&(r.transformFunc&&l==r.panel.yAxis&&m.transform&&(m=m.transform),m&&o&&(m=m[o]),(m||0===m)&&(f=m.Close,v=void 0===m.Open?f:m.Open,y=void 0===m.High?Math.max(f,v):m.High,x=void 0===m.Low?Math.min(f,v):m.Low,f||0===f))){if(m.cache||(m.cache={}),b=m.cache,a.T$(7),(S=a.Z0(u,I))<t.cacheLeft||S>t.cacheRight||!b.top){if(C=l.semiLog?l.height*(1-(Math.log(Math.max(y,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-y)*l.multiplier,w=l.semiLog?l.height*(1-(Math.log(Math.max(x,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-x)*l.multiplier,l.flipped?(a.B9(9),C=a.Z0(C,c),a.T$(9),w=a.Z0(w,c)):(C+=h,w+=h),a.T$(9),k=a.Z0(C,w),C<h){if(C+k<h){b.top=C,b.bottom=C;continue}a.T$(9),k-=a.E3(C,h),C=h}C+k>c&&(a.B9(17),k-=a.Z0(C,k,c)),b.top=C,b.bottom=b.top+k}b.top>=c||b.bottom<=h||(D=Math.floor(p)+(!i.highlight&&.5),n.beginPath(),f==v&&(T=this.offset,i.isVolume&&(a.T$(11),T=a.E3(d,2)),a.T$(9),M=a.Z0(T,D),a.T$(7),A=a.Z0(D,T),_=l.semiLog?l.height*(1-(Math.log(Math.max(f,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-f)*l.multiplier,l.flipped?(a.T$(9),_=a.E3(_,c)):_+=h,_<=c&&_>=h&&(n.moveTo(M,_),n.lineTo(A,_))),y!=x&&(n.moveTo(D,b.top),n.lineTo(D,b.bottom)),n.strokeStyle=g,n.stroke())}}},i.ChartEngine.prototype.drawBarChart=function(t,e,r,s){var n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O;if((n=t.chart)||(n=t,t=t.chart),o=n.dataSegment,l=new Array(o.length),h=n.context,(c=this.canvasStyle(e)).width&&parseInt(c.width,10)<=25){105712797,-1114269759,u=2;for(var H=1;105712797!==a.I7(H.toString(),H.toString().length,36304);H++)h.lineWidth=Math.max(9,i.stripPX(c.width)),u+=2;-1114269759!==a.P2(u.toString(),u.toString().length,82253)&&(h.lineWidth=Math.max(1,i.stripPX(c.width)))}else{-1879544766,-936910489,d=2;for(var V=1;-1879544766!==a.I7(V.toString(),V.toString().length,62039);V++)h.lineWidth=4,d+=2;-936910489!==a.I7(d.toString(),d.toString().length,4173)&&(h.lineWidth=1)}s.highlight&&(h.lineWidth*=2),!s.highlight&&this.highlightedDraggable&&(h.globalAlpha*=.3),p=s.field,g=(m=s.yAxis||t.yAxis).top,f=m.bottom,a.B9(20);var z=a.E3(13,1,12);y=n.dataSet.length-n.scroll-z,x={},a.B9(21);var R=a.Z0(18,6,17,7);b=n.tmpWidth/R,a.B9(18);var B=a.E3(223,15,15);S=h.lineWidth/B,C=this.layout.candleWidth,a.v5(),a.B9(22);var Q=a.Z0(169,14,6,2);w=t.left-.5*C+this.micropixels-Q;for(var W=0;W<=o.length;W++)if(a.B9(11),w+=a.Z0(C,2),C=this.layout.candleWidth,a.T$(11),w+=a.Z0(C,2),k=o[W]){if(k.projection)break;if(k.candleWidth){a.B9(23);var U=a.Z0(28,8,18);w+=(k.candleWidth-C)/U,C=k.candleWidth}if((D=r(this,k))&&(x[D]=1,h.strokeStyle=D,h.beginPath(),n.transformFunc&&m==n.panel.yAxis&&k.transform&&(k=k.transform),k&&p&&(k=k[p]),(k||0===k)&&(T=k.Close,M=void 0===k.Open?T:k.Open,A=void 0===k.High?Math.max(T,M):k.High,_=void 0===k.Low?Math.min(T,M):k.Low,T||0===T))){if(k.cache||(k.cache={}),F=k.cache,a.T$(7),(P=a.Z0(y,W))<t.cacheLeft||P>t.cacheRight||!F.top){if(I=this.pixelFromTransformedValue(A,t,m),L=this.pixelFromTransformedValue(_,t,m),F.open=m.semiLog?m.height*(1-(Math.log(Math.max(M,0))/Math.LN10-m.logLow)/m.logShadow):(m.high-M)*m.multiplier,F.close=m.semiLog?m.height*(1-(Math.log(Math.max(T,0))/Math.LN10-m.logLow)/m.logShadow):(m.high-T)*m.multiplier,m.flipped?(F.open=m.bottom-F.open,F.close=m.bottom-F.close):(F.open+=m.top,F.close+=m.top),l[W]=F.close,a.T$(9),v=a.E3(I,L),I<g){if(I+v<g){F.top=I,F.bottom=I;continue}a.T$(9),v-=a.Z0(I,g),I=g}I+v>f&&(a.T$(17),v-=a.E3(I,v,f)),F.top=I,a.T$(7),F.bottom=a.Z0(I,v)}E=Math.floor(w)+(!s.highlight&&.5),F.top<f&&F.bottom>g&&k.High!=k.Low&&(h.moveTo(E,F.top-S),h.lineTo(E,F.bottom+S)),"hlc"!=s.type&&F.open>g&&F.open<f&&(h.moveTo(E,F.open),a.T$(9),h.lineTo(a.E3(b,E),F.open)),F.close>g&&F.close<f&&(h.moveTo(E,F.close),a.B9(7),h.lineTo(a.E3(E,b),F.close)),h.stroke()}}h.lineWidth=1,N=2;for(var j=1;506832413!==a.I7(j.toString(),j.toString().length,41577);j++)O={colors:[],cache:l},N+=2;for(var q in-858959960!==a.I7(N.toString(),N.toString().length,8629)&&(O={colors:[],cache:l}),x)i.equals(q,this.containerColor)||O.colors.push(q);return O},i.ChartEngine.prototype.drawWaveChart=function(t,e){var r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M;s=(r=t.chart).dataSegment,n=new Array(s.length),o=r.context,e||(e={}),l=e.yAxis||t.yAxis,this.startClip(t.name),o.beginPath(),a.r0(),h=!1,c=!1,u=t.yAxis.top,d=t.yAxis.bottom,p=t.left+Math.floor(-.5*this.layout.candleWidth+this.micropixels),m=this;for(var A=0;A<=s.length;A++)if(p+=this.layout.candleWidth,g=s[A]){if(g.projection)break;if(r.transformFunc&&l==r.panel.yAxis&&g.transform&&(g=g.transform),g&&e.field&&(g=g[e.field]),(g||0===g)&&(f=g.Close,v=void 0===g.Open?f:g.Open,y=void 0===g.High?Math.max(f,v):g.High,x=void 0===g.Low?Math.min(f,v):g.Low,f||0===f)){a.T$(9);var _=a.Z0(12,15);a.B9(18);var F=a.Z0(760,12,64);if(b=p-_*this.layout.candleWidth/F,(S=O(v))<u){if(S=u,c){o.moveTo(b,S);continue}c=!0}else if(S>d){if(S=d,c){o.moveTo(b,S);continue}c=!0}else c=!1;if(h)o.lineTo(b,S);else{h=!0,a.T$(9);var P=a.E3(14,15);(C=r.dataSet.length-r.scroll-P)<0?o.moveTo(b,S):C>=0&&((w=r.dataSet[C]).transform&&(w=w.transform),k=O(k=w.Close),k=Math.min(Math.max(k,u),d),o.moveTo(t.left+(A-1)*this.layout.candleWidth+this.micropixels,k),o.lineTo(b,S)),o.moveTo(b,S)}a.B9(24);var I=a.E3(13,11704,5,12,15);if(b+=this.layout.candleWidth/I,v<f)(S=O(x))<u&&(S=u),S>d&&(S=d),o.lineTo(b,S),b+=this.layout.candleWidth/4,(S=O(y))<u&&(S=u),S>d&&(S=d),o.lineTo(b,S);else{(S=O(y))<u&&(S=u),S>d&&(S=d),o.lineTo(b,S),a.B9(9);var L=a.Z0(76,80);b+=this.layout.candleWidth/L,(S=O(x))<u&&(S=u),S>d&&(S=d),o.lineTo(b,S)}a.T$(9);var E=a.Z0(11,15);b+=this.layout.candleWidth/E,S=O(f),n[A]=S,S<u&&(S=u),S>d&&(S=d),o.lineTo(b,S)}}if((D=this.canvasStyle("stx_line_chart")).width&&parseInt(D.width,10)<=25)o.lineWidth=Math.max(1,i.stripPX(D.width));else{865322424,-530010541,T=2;for(var N=1;865322424!==a.I7(N.toString(),N.toString().length,68686);N++)o.lineWidth=5,T+=2;-530010541!==a.P2(T.toString(),T.toString().length,56260)&&(o.lineWidth=5),o.lineWidth=1}function O(e){return m.pixelFromTransformedValue(e,t,l)}return e.highlight&&(o.lineWidth*=2),this.canvasColor("stx_line_chart"),e.color&&(o.strokeStyle=e.color),!e.highlight&&this.highlightedDraggable&&(o.globalAlpha*=.3),o.stroke(),o.closePath(),M={colors:[o.strokeStyle],cache:n},this.endClip(),o.lineWidth=1,M},i.ChartEngine.prototype.drawHistogram=function(t,e){var r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,C,w,k,D,T,M,A,_,F,P,I,L,E,N,O,H,V;function z(t,e,i,r,n,h,c,u,d){var p,g,v,y,x,C,w,k,D,T,L,E,N,O,H;r||(r=1),A.globalAlpha=r,A.beginPath(),a.T$(7),p=a.Z0(b,.5),g=Math.floor(I.pixelFromBar(0,s.chart)-I.layout.candleWidth/2);for(var V=0;V<l.length;V++)v=P[V]||b,0===V&&(p=v),l[V]&&l[V][t]?("object"==typeof(x=(y=l[V])[t])&&x[e]&&(x=x[e]),a.T$(25),C=a.Z0(f,m,x),isNaN(C)||(w=I.layout.candleWidth,y.candleWidth&&(w=y.candleWidth,0===V&&(g=Math.floor(I.pixelFromBar(0,s.chart)-y.candleWidth/2))),(k=Math.floor(v-C)+.5)>v&&!S&&(k=v),d&&-1==d.indexOf(V)||!d&&(h&&y.Close<y.iqPrevClose||!h&&y.Close>=y.iqPrevClose)?(p=k,g+=w):(D=w/I.layout.candleWidth,_?(a.T$(26),T=Math.round(a.Z0(u,c,_,g,D)),a.B9(7),L=a.Z0(T,n?0:M),E=T+Math.round(u*D)-(n?0:M)):(a.T$(26),T=a.Z0(u,c,_,g,D),L=Math.round(T)+(n?0:M),E=Math.round(T+u*D)-(n?0:M)),E-L<2&&(a.T$(7),E=a.Z0(L,1)),L%1==(N=n?0:.5)&&(L+=.5),E%1==N&&(E+=.5),A.moveTo(E,v),b!=v&&n&&!_&&P[V+1]&&A.moveTo(E,Math.max(k,Math.min(v,P[V+1]))),A.lineTo(E,k),A.lineTo(L,k),n&&c?(F[V]>k||0===V)&&A.lineTo(L,Math.min(v,F[V])):n&&!_&&"clustered"==o?V>0&&F[V-1]&&F[V-1]>k&&A.lineTo(L,Math.min(v,F[V-1])):n&&!_?(p>k||0===V)&&A.lineTo(L,Math.min(v,p)):A.lineTo(L,v),p=k,g+=w,("clustered"!=o||n)&&(F[V]=k)))):(p=v,g+=I.layout.candleWidth);n?("a","u","t","o",A.strokeStyle=i&&"auto"!=i?i:I.defaultColor,A.stroke()):("a","uto",A.fillStyle=i&&"auto"!=i?i:I.defaultColor,A.fill()),a.B9(1),O=-a.E3("698448920",1),H=2;for(var z=1;a.I7(z.toString(),z.toString().length,64441)!==O;z++)A.closePath(),a.T$(9),H+=a.E3(0,"2");-1779043050!==a.I7(H.toString(),H.toString().length,78500)&&A.closePath()}if(e&&e.length&&((r=t.panel)||(r="chart"),s=this.panels[r])){for(n=t.yAxis?t.yAxis:s.yAxis,o=t.type,l=this.chart.dataSegment,h=!1,c=1,u=1,p=0;p<e.length;p++)h|=e[p].border_color_up&&!i.isTransparent(e[p].border_color_up),h|=e[p].border_color_down&&!i.isTransparent(e[p].border_color_down),c=e[p].opacity_up,u=e[p].opacity_down,!t.highlight&&this.highlightedDraggable&&(c*=.3,u*=.3);!1===t.borders&&(h=!1),t.name||(t.name="Data"),m=n.multiplier,t.heightPercentage||(t.heightPercentage=.7),t.widthFactor||(t.widthFactor=.8),g=0,a.T$(0),f=a.E3("0",0);for(var R=0;R<this.chart.maxTicks;R++)if(v=l[R])for(y=0,p=0;p<e.length;p++)((x=v[e[p].field])||0===x)&&("sta","c","k","ed",d=e[p].subField||this.chart.defaultPlotField||"Close","object"==typeof x&&x[d]&&(x=x[d]),"stacked"==o?y+=x:y=x,y>g&&(g=y),y<f&&(f=y));if(0===g&&0===f)return" Not Av","ail","abl","e",void this.displayErrorAsWatermark(r,this.translateIf(t.name+" Not Available"));if(S=!1,t.bindToYAxis){n.baseline&&(f=n.baseline.value,S=!0),122432553,-358074473,T=2;for(var B=1;122432553!==a.P2(B.toString(),B.toString().length,34892);B++)b=Math.floor(this.pixelFromPrice(f,s,n))+(n.flipped?-.5:.5),T+=2;if(-358074473!==a.P2(T.toString(),T.toString().length,49524)){a.B9(28);var Q=a.E3(17,7,7,873);a.B9(17);var W=a.Z0(206,13,29);b=Math.floor(this.pixelFromPrice(f,s,n))*(n.flipped?~Q:W)}}else{if(n.flipped){b=Math.floor(n.top)-.5,1809382545,743648570,a.B9(3),w=a.Z0("2",0);for(var U=1;1809382545!==a.I7(U.toString(),U.toString().length,21668);U++){a.B9(27);var j=a.E3(399,407,57);C=Math.floor(n.bottom)*j,a.T$(9),w+=a.E3(0,"2")}if(743648570!==a.I7(w.toString(),w.toString().length,18460)){a.B9(17);var q=a.Z0(401,19,23);C=Math.floor(n.bottom)+q}C=Math.floor(n.bottom)-.5}else{b=Math.floor(n.bottom)+.5,-308836829,a.T$(3),k=-a.Z0("1767207434",0),D=2;for(var Y=1;-308836829!==a.P2(Y.toString(),Y.toString().length,36688);Y++)C=Math.floor(n.top)+.5,D+=2;a.I7(D.toString(),D.toString().length,48467)!==k&&(C=Math.floor(n.top)-584)}m=Math.abs(b-C)*t.heightPercentage/(g-f)}for(this.startClip(r),M=this.layout.candleWidth<=1||!h?0:.5,A=this.chart.context,n.flipped&&(A.translate(0,2*n.top),a.T$(3),A.scale(1,-a.E3("1",0))),_=Math.max(0,(1-t.widthFactor)*this.layout.candleWidth/2),F=new Array(l.length),P=[],I=this,L=1,p=0;p<e.length;p++){if("c","l","us","tered",E=e[p],L=this.layout.candleWidth*t.widthFactor,_&&this.layout.candleWidth-L<=2&&(h=!1),N=0,"clustered"==o&&(N=p,L/=e.length),d=E.subField||this.chart.defaultPlotField||"Close","function"==typeof E.color_function){H={};for(var $=0;$<l.length;$++)l[$]&&("s","t","ri","ng","string"==typeof(O=E.color_function(l[$]))&&(O={fill_color:O,border_color:O}),O.hasOwnProperty("border_opacity")||(O.border_opacity=O.opacity),(V=O.fill_color+","+O.border_color)in H?H[V].positions.push($):(O.positions=[$],H[V]=O));for(V in H)O=H[V],z(E.field,d,O.fill_color,O.opacity,null,null,N,L,O.positions),z(E.field,d,O.border_color,O.border_opacity,!0,null,N,L,O.positions)}else z(E.field,d,E.fill_color_up,c,null,!0,N,L),z(E.field,d,E.fill_color_down,u,null,null,N,L),this.layout.candleWidth>=2&&h&&(z(E.field,d,E.border_color_up,c,!0,!0,N,L),z(E.field,d,E.border_color_down,u,!0,null,N,L));"stacked"==o&&(P=i.shallowClone(F))}a.T$(9),A.globalAlpha=a.E3(0,"1"),this.endClip()}},i.ChartEngine.prototype.scatter=function(t,e){var i,r,s,n,o,l,h,c,u,d,p,m,g,f,v,y,x,b;r=(i=t.chart).dataSegment,s=new Array(r.length),n=this.chart.context,this.canvasColor("stx_scatter_chart"),e||(e={}),o=e.field||i.defaultPlotField,l=e.yAxis||t.yAxis,h=e.subField||i.defaultPlotField||"Close",this.startClip(t.name),n.beginPath(),n.lineWidth=e.lineWidth||4,e.highlight&&(n.lineWidth*=2),!e.highlight&&this.highlightedDraggable&&(n.globalAlpha*=.3),e.color&&(n.strokeStyle=e.color),c=l.top,u=l.bottom,d=this.layout.candleWidth,a.B9(9);var S=a.Z0(3,4);p=t.left-.5*d+this.micropixels-S;for(var C=0;C<=r.length;C++)if(a.B9(11),p+=a.E3(d,2),d=this.layout.candleWidth,a.B9(11),p+=a.Z0(d,2),m=r[C]){if(m.candleWidth){a.B9(29);var w=a.E3(21,5,5,128);p+=(m.candleWidth-d)/w,d=m.candleWidth}if(!m.projection){"Sc","at","te","r",i.transformFunc&&l==i.panel.yAxis&&m.transform&&(m=m.transform),(g=m[o])&&void 0!==g[h]&&(g=g[h]),g instanceof Array||(g=[g]),"Scatter"in m&&(g=m.Scatter);for(var k=0;k<g.length;k++)(g[k]||0===g[k])&&(f=g[k],v=0,g[k]instanceof Array&&(f=g[k][0],v=g[k][2]),y=l.semiLog?l.height*(1-(Math.log(Math.max(f,0))/Math.LN10-l.logLow)/l.logShadow):(l.high-f)*l.multiplier,l.flipped?(a.B9(9),y=a.E3(y,u)):y+=c,y<c||y>u||(x=2,v&&(a.T$(1),x=a.E3(d,v)),a.T$(9),n.moveTo(a.E3(x,p),y),a.T$(7),n.lineTo(a.Z0(p,x),y),s[C]=y))}}return n.stroke(),n.closePath(),b={colors:[n.strokeStyle],cache:s},this.endClip(),n.lineWidth=1,b}};let z={CIQ:a.CIQ,SplinePlotter:a.SplinePlotter,timezoneJS:a.timezoneJS,$$:a.$$,$$$:a.$$$};"undefined"!=typeof __TREE_SHAKE__&&__TREE_SHAKE__||z.CIQ.activateImports(r,N,s,n,o,l,h,c,u,L,d,p,m,g,f,v,y,x,b,S,F,C,w,k,D,T,M,null)}}]);